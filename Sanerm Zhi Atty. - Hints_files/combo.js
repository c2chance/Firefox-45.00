function newFactEditModal(persondata,assertionId,hasLifeStoryOptions,tabActivate,contentActivate,addPersonNewPID,saveEventData,isFromCreateEvent){var saveEventDataObj,pid,url;if(typeof persondata=="undefined"){alert("persondata cannot be null");return}var isValidNewAddPersonId=typeof addPersonNewPID!="undefined"&&addPersonNewPID!=null&&addPersonNewPID.length>0,dateFieldVal="",placeFieldVal="",descriptionFieldVal="",isPrimary=!1,eventType="",newPersonPid="";window.PersonData=persondata;PersonData.hasAddedNewSpouse=!1;PersonData.newAddedSpouseId="";isValidNewAddPersonId&&(newPersonPid=addPersonNewPID,PersonData.hasAddedNewSpouse=!0,PersonData.newAddedSpouseId=addPersonNewPID,typeof saveEventData!="undefined"&&saveEventData.length>0&&(saveEventDataObj=jQuery.parseJSON(saveEventData),eventType=saveEventDataObj.eventType,dateFieldVal=saveEventDataObj.dateField,placeFieldVal=saveEventDataObj.placeField,descriptionFieldVal=saveEventDataObj.descriptionField,isPrimary=!1,saveEventDataObj.isAddNewSpouse==="true"&&($(".editModalSaveButton").unbind("click"),ResetWarningsAndValues(),FactEditModal.isAddNewSpouse=!0)));pid=typeof PersonData.personId!="object"?PersonData.personId:PersonData.personId.value;url="/modals/factedit/tree/"+PersonData.treeId+"/person/"+pid+"/assertionid/"+assertionId;$("<div>").modal({showLoading:!0,useCustomPadding:!0,onOpen:function($this){$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,data:{hasLifeStoryOptions:hasLifeStoryOptions,newPersonPid:newPersonPid},success:function(data){var spouseCount,dateField,placeField,descriptionField,$indvSpouseSelect,$sortingDivTopAlert,$sortingDivBottomAlert,locationField,openTab,modalHeader,cancelClose,factItem,modalEditEvent,selectedPerson,preferredStored,preferredEventStored,individualSpouseSelect,multipleSpouseSelect,displayLifeStory,displayLifeStoryVal;if(data.result){if($.modal.showLoading(!1),$.modal.resize(760),$this.html(data.html),$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning),sortingCardOutlineHover(),!isValidNewAddPersonId&&isRelationshipEventType()&&$(".editModalSaveButton").unbind("click"),spouseCount=parseInt(FactEditModal.person.spouseCount),isValidNewAddPersonId&&(dateField=$(".dateField"),dateField.length>0&&dateField.val(dateFieldVal),placeField=$(".placeField"),placeField.length>0&&placeField.val(placeFieldVal),descriptionField=$(".descriptionField"),descriptionField.length>0&&descriptionField.val(descriptionFieldVal),$("#individualSpouseSelect").show(),$("#selectedSpouse-individual").removeClass("selectedPerson"),$indvSpouseSelect=$(".existingSpouseIndividual"),$indvSpouseSelect.length>0&&$indvSpouseSelect.addClass("selectedPerson"),$("#multipleSpouseSelect").hide(),spouseCount>1?($("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();"),$("#chooseOtherButton").hide()):($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")),FactEditModal.warningMessage="",FactEditModal.hasValidationWarningToSelectSpouse=!1,FactEditModal.isAddNewSpouse=!1),typeof FactEditModal!="undefined"&&$(".modalEditEvent .iconRotateRight").callout({position:"left",type:"click",classes:"calloutGenerateNarrative",content:"#generateNarrativeCalloutDomContent",onAfterOpen:function(){$("#callout").attr("onClick",".closeCallouts",function(){closeCallouts()})},style:"dark"}),$(".modalEditEvent .removeButton").callout({position:"top",style:"dark",type:"click",classes:"calloutRemoveEvent",content:"#removeEventCalloutDomContent",onAfterOpen:function(){$("#callout").attr("onClick",".closeCallouts",function(){closeCallouts()})}}),sortingCardOutlineHover(),$sortingDivTopAlert=$("#source_sortingDivTop .alert"),$sortingDivBottomAlert=$("#source_sortingDivBottom .alert"),$sortingDivTopAlert.alert(personViewModalAlertSettingsNote),$sortingDivBottomAlert.alert(personViewModalAlertSettingsNote),$.cachedScript(PersonData.animateCardUrl).done(function(){$("#source_sortingDivBottom").animateCard({items:".card",animateMove:{afterAnimate:function(item){item.find(".sortingIcon").hasClass("iconAdd")?(item.removeClass("cardOutline2").addClass("attached"),PersonData.hasEditRights&&item.find(".sortingIcon").removeClass("iconAdd noHover").addClass("iconClose")):(item.removeClass("cardOutline2").removeClass("attached"),PersonData.hasEditRights&&item.find(".sortingIcon").removeClass("iconClose noHover").addClass("iconAdd"))},beforeAnimate:function(item){item.find(".card").addClass("cardOutline2")},connectWith:"#source_sortingDivTop",emptyContent:".alertNote"},onListEmpty:function(emptyList){emptyList.find(".alertNote").alert("open")},onEmptyListAdd:function(list){list.find(".alertNote").alert("close")}})}),$("#source_sortingDivTop .card").length===0&&$sortingDivTopAlert.alert("open"),$("#source_sortingDivBottom .card").length===0&&$sortingDivBottomAlert.alert("open"),locationField=$("#location"),locationField.length>0&&factModalInitTypeAhead(PersonData.treeId,locationField),openTab=0,typeof PersonData.openOnLoadTab!="undefined"&&(openTab=parseInt(PersonData.openOnLoadTab)),PersonData.openOnLoadTab=0,(FactEditModal.isAddNewFact||typeof isFromCreateEvent!="undefined"&&isFromCreateEvent)&&(typeof tabActivate!="undefined"&&tabActivate!=null&&tabActivate.length>0&&typeof contentActivate!="undefined"&&contentActivate!=null&&contentActivate.length>0?(modalHeader=$("#modalHeader"),modalHeader.length>0&&modalHeader.remove(),tabActivate!=="factEditModalEvent"&&tabActivate!=="editModalSaveButton"&&($("#factEditModalEvent").removeClass("tabActive active"),$(".tabContent1").removeClass("tabActive active")),$("#"+tabActivate).hasClass("tabActive active")||$("#"+tabActivate).addClass("tabActive active"),contentActivate!=="tabContent1"&&$(".tabContent1").removeClass("tabActive active"),$("."+contentActivate).hasClass("tabActive active")||$("."+contentActivate).addClass("tabActive active"),openTab=contentActivate==="tabContent2"?1:contentActivate==="tabContent3"?2:0,PersonData.openOnLoadTab=openTab,cancelClose=$(".cancelClose"),cancelClose.length>0&&cancelClose.text(FactEditModal.text.close),setFactModalTabsClick(!FactEditModal.hasValidationError,null,!0)):($("#factEditModalEvent").addClass("tabActive active"),$(".tabContent1").addClass("tabActive active"))),$("#modalContainer .tabs").tabs({activeIndex:openTab,onOpen:!1}),modalButtonClick(),setupFactModalUserCard(),factItem=$("#fi"+assertionId),modalEditEvent=$(".tabContent1"),modalEditEvent.length>0&&openTab===0)if(selectedPerson=modalEditEvent.find(".selectedPerson"),isRelationshipEventType()&&selectedPerson.length===0&&(selectedPerson=modalEditEvent.find(".selectedPerson")),!isValidNewAddPersonId&&isRelationshipEventType()&&FactEditModal.originalSpouseId.length===0&&selectedPerson.length>0&&resetIndividualSpouseNode(selectedPerson,0),(FactEditModal.eventType.toLowerCase()==="birth"||FactEditModal.eventType.toLowerCase()==="death"||FactEditModal.eventType.toLowerCase()==="name")&&(factItem.hasClass("preferredEvent"+FactEditModal.eventType)?(modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!0),modalEditEvent.find(".isPrimaryCheckbox").attr("data-original-isprimary","true"),$("#preferredEventButtonLabel").show(),FactEditModal.eventType.toLowerCase()!=="name"&&$("#factEditModalTimelineOptions").css("display","")):($("#preferredEventCheckbox").show(),modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!1))),retrieveStoredFactValues(factItem,".givenNameStored"+assertionId,modalEditEvent,"#givenName"),retrieveStoredFactValues(factItem,".surnameStored"+assertionId,modalEditEvent,"#surname"),retrieveStoredFactValues(factItem,".suffixStored"+assertionId,modalEditEvent,"#suffix"),preferredStored=factItem.find(".preferredStored"+assertionId),preferredStored.length>0&&(preferredStored.val()==="true"&&factItem.hasClass("preferredEvent"+FactEditModal.eventType)?modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!0):modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!1)),retrieveStoredFactValues(factItem,".dateStored"+assertionId,modalEditEvent,"#date"),retrieveStoredFactValues(factItem,".placeStored"+assertionId,modalEditEvent,"#location"),retrieveStoredFactValues(factItem,".descriptionStored"+assertionId,modalEditEvent,"#description"),preferredEventStored=factItem.find(".preferredEventStored"+assertionId),preferredEventStored.length>0&&(preferredEventStored.val()==="true"&&factItem.hasClass("preferredEvent"+FactEditModal.eventType)?modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!0):modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!1)),individualSpouseSelect=modalEditEvent.find("#individualSpouseSelect"),isRelationshipEventType()&&(typeof newPersonPid=="undefined"||typeof newPersonPid!="undefined"&&newPersonPid.length===0)&&FactEditModal.originalSpouseId.length===0)selectedPerson.length>0&&resetIndividualSpouseNode(selectedPerson,0),modalEditEvent.find(".eventAreaBannerWarning").alert("close"),ResetWarningsAndValues(),multipleSpouseSelect=modalEditEvent.find("#multipleSpouseSelect"),spouseCount===1?(individualSpouseSelect.hide(),multipleSpouseSelect.show(),$("#singleScenarioSpouseSelect").show(),$("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):spouseCount>1?(individualSpouseSelect.hide(),$("#spouseText").hide(),$("#selectSpouseForEventText").show(),multipleSpouseSelect.show(),$("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").hide(),$("#chooseOtherButton").show().attrn("onClick","showSpouseTypeAheadSection();")):($("#chooseOtherButton").hide(),$(".addRelationships").show(),showSpouseTypeAheadSection(),$(".erAddCancel").hide()),setEditModalSaveButtonClick();else if(isRelationshipEventType()&&typeof newPersonPid!="undefined"&&newPersonPid.length>0){if(spouseCount===1&&setIndividualSpouseData(modalEditEvent,".singleScenarioSpouseSelect"),!showIndividualSpouse())return;individualSpouseSelect=$(".existingSpouseIndividual");individualSpouseSelect.length>0&&individualSpouseSelect.addClass("selectedPerson");(spouseCount===0||spouseCount===1)&&($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();"));setEditModalSaveButtonClick()}$(".tabContent4").find(".narrativeDataFields").hide();displayLifeStory=$(".tabContent4").find(".displayLifestory");displayLifeStory.length>0&&(displayLifeStoryVal=displayLifeStory.prop("checked"),displayLifeStory.data("original-displaylifestory",displayLifeStoryVal.toString()));FactEditModal.eventType==="Gender"?($(".editModalSaveButton").removeAttr("disabled"),setFactModalTabsClick(!FactEditModal.hasValidationError)):FactEditModal.eventType==="Name"?(modalEditEvent.find(".eventAreaBannerWarning").alert("close"),setFactModalTabsClick(!FactEditModal.hasValidationError)):typeof tabActivate!="undefined"&&tabActivate!=null&&tabActivate.length>0&&typeof contentActivate!="undefined"&&contentActivate!=null&&contentActivate.length>0||setButtonandBannerBasedOnValidation(!1);setButtonBasedOnValidation()}$("#modalClose").length===0&&$("#modalContents").prepend('<button type="button" title="Close modal" id="modalClose" class="closeBtn"><\/button>')},error:function(ex){typeof ex!="undefined"&&typeof ex.statusText!="undefined"&&($.modal.showLoading(!1),$("<div><p>"+PersonCard.text.addPersonErrorText+"<\/p><\/div>").modal({title:""}),window.console&&window.console.log(ex.statusText))}})},onClose:function(){$(".factItemSelected").focus()}})}function sortingCardOutlineHover(){$(".sortingCard").on("click",".sortingIcon",function(){$(this).addClass("noHover")}).on("mouseenter",".sortingIcon:not(.noHover)",function(){$(this).closest(".card").addClass("cardOutline2")}).on("mouseleave",".sortingIcon:not(.noHover)",function(){$(this).closest(".card").removeClass("cardOutline2")})}function isRelationshipEventType(){return typeof FactEditModal.isRelationshipType=="undefined"&&(FactEditModal.isRelationshipType=FactEditModal.eventType==="Marriage"||FactEditModal.eventType==="MarriageBann"||FactEditModal.eventType==="MarriageContract"||FactEditModal.eventType==="MarriageLicense"||FactEditModal.eventType==="MarriageSettlement"||FactEditModal.eventType==="Annulment"||FactEditModal.eventType==="Divorce"||FactEditModal.eventType==="DivorceFiled"||FactEditModal.eventType==="Engagement"||FactEditModal.eventType==="SealSpouseLDS"||FactEditModal.eventType==="NumMarriages"||FactEditModal.eventType==="Separation"),FactEditModal.isRelationshipType}function factModalInitTypeAhead(treeId,locationField){locationField.autocomplete({source:"/suggest/place?treeId="+treeId+"&tad=none",key:"placeName",queryParameter:"term",dataType:"json",minLength:3,maxResults:12,customDisplay:function(data){return{value:data.value,display:data.display}},onItemSelect:function(itemData){var $this,$card;itemData!==""&&($this=$(this),itemData.PID!=""&&($card=$this.closest(".card"),$card.find(".erAddExistingData").data("itemData",itemData),$card.find(".erAddSave").prop("disabled",!1)))},onOpen:!1,onClose:!1})}function setupFactModalUserCard(){var factTitlePersonCard=$(".factTitlePersonCard");if(factTitlePersonCard.length>0){var userCardImgSquare=factTitlePersonCard.find(".userCardImgSquare"),userCardTitle=factTitlePersonCard.find(".userCardTitle"),userCardSubTitle=factTitlePersonCard.find(".userCardSubTitle");userCardTitle.length>0&&userCardSubTitle.length>0&&(userCardImgSquare.addClass("icon"+PersonCard.gender),userCardTitle.html(PersonCard.name),PersonCard.lifeYearRange.length>1&&PersonCard.lifeYearRange!=="&ndash;"?userCardSubTitle.text("("+PersonCard.lifeYearRange.replace("&ndash;","-")+")"):userCardSubTitle.text(""),factTitlePersonCard.show())}}function retrieveStoredFactValues(factItem,storedAccessor,modalArea,fieldId){var storedValue=factItem.find(storedAccessor);storedValue.length>0&&modalArea.find(fieldId).val(storedValue.val())}function setButtonandBannerBasedOnValidation(showBanner){var modalEditEvent=$(".tabContent1"),bannerObj=modalEditEvent.find(".eventAreaBannerWarning");checkFieldValidation(!1,showBanner,[]);showBanner&&(FactEditModal.hasValidationWarning||FactEditModal.hasValidationDateWarning||FactEditModal.hasValidationError||FactEditModal.hasValidationWarningToSelectSpouse?displayBannerObjWarning(bannerObj):clearAllBanners());setButtonBasedOnValidation();setupCorrectClickActionLinks()}function displayBannerObjWarning(bannerObj){typeof bannerObj!="undefined"&&bannerObj.length>0&&setTimeout(function(){var validationMessage="";FactEditModal.hasValidationError?typeof FactEditModal.validationErrorMessage!="undefined"&&FactEditModal.validationErrorMessage.length>0&&(validationMessage=FactEditModal.validationErrorMessage):FactEditModal.hasValidationWarning||FactEditModal.hasValidationDateWarning?(typeof FactEditModal.validationWarningMessage!="undefined"&&FactEditModal.validationWarningMessage.length>0&&(validationMessage=FactEditModal.validationWarningMessage),isRelationshipEventType()&&FactEditModal.hasValidationWarningToSelectSpouse?validationMessage=validationMessage.length>0?validationMessage+"  "+FactEditModal.text.warnToSelectSpouse:FactEditModal.text.warnToSelectSpouse:isDatePlaceEventType()&&(validationMessage=FactEditModal.hasValidationDateWarning?validationMessage.length>0?validationMessage+"  "+FactEditModal.text.warnStillUseItDate:FactEditModal.text.warnStillUseItDate:validationMessage.length>0?validationMessage+"  "+FactEditModal.text.warnStillUseIt:FactEditModal.text.warnStillUseIt)):isRelationshipEventType()&&FactEditModal.hasValidationWarningToSelectSpouse&&(validationMessage=validationMessage.length>0?validationMessage+"  "+FactEditModal.text.warnToSelectSpouse:FactEditModal.text.warnToSelectSpouse);validationMessage=FactEditModal.isAddNewFact?validationMessage.replace("{createAnywayOrSaveAnyway}",FactEditModal.text.addAnyway):validationMessage.replace("{createAnywayOrSaveAnyway}",FactEditModal.text.saveAnyway);validationMessage.length>0&&(bannerObj.text(validationMessage),bannerObj.alert("open"),$.modal.center())},500)}function checkFieldValidation(checkChanged,showBanner,dictionary){var modalEditEvent=$(".tabContent1"),selectedPerson=modalEditEvent.find(".selectedPerson"),requiredFields=0,emptyRequiredFields=0,fields=0,emptyFields=0,changed=!1,$checkBox,sid;return modalEditEvent.find(".factField").each(function(){var $field=$(this),fState=$field.data("state"),val=$field.val(),originalValue,currentValue,extra;$field.hasClass("requiredField")?requiredFields++:fields++;$field.attr("name")!=="gender"&&(val?(fState=="0"&&(fState=validateField($field.get(0))),fState=="4"||fState=="3"?showBanner&&(FactEditModal.validationWarningMessage=FactEditModal.validationWarningMessage.length===0?$field.data("msg"):FactEditModal.validationWarningMessage+" "+$field.data("msg"),fState=="3"?FactEditModal.hasValidationDateWarning=!0:fState=="4"&&(FactEditModal.hasValidationWarning=!0)):fState=="2"||fState=="1"):$field.hasClass("requiredField")?emptyRequiredFields++:emptyFields++);checkChanged&&($field.attr("name")!=="gender"||$field.is(":checked"))&&(originalValue=typeof $field.data("original-value")!="undefined"?$field.data("original-value"):"",currentValue=$field.val(),originalValue!=currentValue&&(changed=!0),extra=typeof $field.data("extra")!="undefined"?$field.data("extra"):"",dictionary[$field.attr("id")]={value:currentValue,origValue:originalValue,extra:extra})}),checkChanged&&($checkBox=modalEditEvent.find(".isPrimaryCheckbox"),$checkBox.length>0&&$checkBox.is(":checked")&&$checkBox.data("original-isprimary")==!1&&(changed=!0)),isRelationshipEventType()&&(typeof selectedPerson=="undefined"||selectedPerson.length===0?checkChanged&&!FactEditModal.isAddNewFact&&typeof FactEditModal.originalSpouseId!="undefined"&&FactEditModal.originalSpouseId.length>0?changed=!0:showBanner&&(FactEditModal.hasValidationWarningToSelectSpouse=!0):checkChanged&&(typeof FactEditModal.originalSpouseId=="undefined"||FactEditModal.originalSpouseId.length===0?changed=!0:(sid=selectedPerson.data("assertionid"),FactEditModal.originalSpouseId!=sid&&(changed=!0)))),(emptyRequiredFields>0||fields===emptyFields)&&(showBanner&&PersonData.hasEditRights&&(FactEditModal.validationErrorMessage=getWarningMessage(requiredFields>0&&requiredFields===emptyRequiredFields,fields===emptyFields)),FactEditModal.hasValidationError=!0,changed=!1),changed}function clearAllBanners(){$(".tabContent").find(".alert:not(.alertNote)").each(function(){var $this=$(this);$this.hasClass("alertHidden")||$this.alert("close")})}function setButtonBasedOnValidation(){!FactEditModal.hasValidationError&&(FactEditModal.hasValidationWarning||FactEditModal.hasValidationDateWarning||FactEditModal.hasValidationWarningToSelectSpouse)?(setupCreateOrSaveAnywayTextButton(),$(".editModalSaveButton").removeAttr("disabled")):(setupCreateOrSaveTextButton(),FactEditModal.hasValidationError?$(".editModalSaveButton").attr("disabled","disabled"):$(".editModalSaveButton").removeAttr("disabled"))}function setupCreateOrSaveTextButton(){FactEditModal.isAddNewFact?$(".editModalSaveButton").text(FactEditModal.text.create):$(".editModalSaveButton").text(FactEditModal.text.saveChanges)}function setupCorrectClickActionLinks(){var modalEditEvent=$(".tabContent1"),selectedPerson=modalEditEvent.find(".selectedPerson");FactEditModal.isAddNewFact?setAddNewFactCreateAction():PersonData.hasAddedNewSpouse&&PersonData.newAddedSpouseId.length>0?setFactModalTabsClick(!FactEditModal.hasValidationError,PersonData.newAddedSpouseId):isRelationshipEventType()&&(typeof selectedPerson=="undefined"||typeof selectedPerson!="undefined"&&selectedPerson.length===0)?setFactActionWithValidate():setFactModalTabsClick(!FactEditModal.hasValidationError)}function setFactModalTabsClick(valid,newPidVal,showBanner){var newPid,clearBanners,showBannerVal,jss;valid&&(typeof FactEditModal.buttonsBound!="undefined"&&FactEditModal.buttonsBound||(newPid="",typeof newPidVal!="undefined"&&newPidVal!=null&&newPidVal.length>0&&(newPid=newPidVal),clearBanners=typeof showBanner!="undefined"&&showBanner?"false":"true",showBannerVal=typeof showBanner!="undefined"&&showBanner?"true":"false",$(".editModalSaveButton").attr("onClick","factEditModalHandleTabClick('editModalSaveButton', '"+newPid+"', "+clearBanners+", "+showBannerVal+", true);"),$("#factEditModalEvent").attr("onClick","factEditModalHandleTabClick('factEditModalEvent', '"+newPid+"', "+clearBanners+", "+showBannerVal+", true);"),$("#factEditModalAttachMedia").attr("onClick","factEditModalHandleTabClick('factEditModalAttachMedia', '"+newPid+"', "+clearBanners+", "+showBannerVal+", true);"),$("#factEditModalSourceCitations").attr("onClick","factEditModalHandleTabClick('factEditModalSourceCitations', '"+newPid+"', "+clearBanners+", "+showBannerVal+", true);"),$("#factEditModalTimelineOptions").attr("onClick","factEditModalHandleTabClick('factEditModalTimelineOptions', '"+newPid+"', "+clearBanners+", "+showBannerVal+", true);"),jss="javascript:spouseClickHandler('"+FactEditModal.person.spouseCount+"', '"+FactEditModal.assertionId+"', '"+newPid+"', '');",FactEditModal.person.spouseCount==="1"?$(".chooseOtherButton").attr("onClick",jss):$(".changeSpouseButton").attr("onClick",jss),FactEditModal.buttonsBound=!0))}function spouseClickHandler(count){count==="1"?showSpouseTypeAheadSection():showMultipleSpouseSelect()}function unsetFactModalTabsClick(){}function savePersonNarrativeAndEventDataModal(assertionid,newRelationshipPid,saveEventData,isSpouseDataValidate,clearBanners){var descriptionField,genderTypeField,originalIsPrimary,saveValue,url;typeof clearBanners!="undefined"&&clearBanners&&clearAllBanners();var modalEditEvent=$(".tabContent1"),modalNarrative=$(".tabContent4"),modalEditEventActive=modalEditEvent.hasClass("tabActive"),modalNarrativeActive=modalNarrative.hasClass("tabActive"),selectedPerson=modalEditEvent.find(".selectedPerson"),isCreateRelationshipEvent=!1,eventType=FactEditModal.eventType,isPrimary=modalEditEvent.find(".isPrimaryCheckbox").prop("checked"),saveEventDataObj="",placeField="",placeFieldDataExtra="",dictionary=[],eventChanged=modalEditEventActive?checkFieldValidation(!0,!1,dictionary):!1,narrativeChanged=!1,placeGpid=null,titleField=typeof dictionary.title!="undefined"?dictionary.title.value:"",dateField=typeof dictionary.date!="undefined"?dictionary.date.value:"";typeof dictionary.location!="undefined"&&(placeField=dictionary.location.value,placeFieldDataExtra=dictionary.location.extra);descriptionField=typeof dictionary.description!="undefined"?dictionary.description.value:"";genderTypeField=typeof dictionary.genderMale!="undefined"?"Male":typeof dictionary.genderFemale!="undefined"?"Female":"Unknown";typeof placeFieldDataExtra!="undefined"&&placeFieldDataExtra.length>0&&$.each($.parseJSON(placeFieldDataExtra),function(key,value){key==="GPID"&&(placeGpid=value)});var valueField=typeof dictionary.value!="undefined"?dictionary.value.value:"",givenNameField=typeof dictionary.givenName!="undefined"?dictionary.givenName.value:"",surnameField=typeof dictionary.surname!="undefined"?dictionary.surname.value:"",suffixNameField=typeof dictionary.suffix!="undefined"?dictionary.suffix.value:"";if(typeof newRelationshipPid!="undefined"&&newRelationshipPid.length>0&&(isCreateRelationshipEvent=!0,typeof saveEventData!="undefined"&&saveEventData.length>0&&(saveEventDataObj=jQuery.parseJSON(saveEventData),eventType=saveEventDataObj.eventType,dateField=saveEventDataObj.dateField,placeField=saveEventDataObj.placeField,descriptionField=saveEventDataObj.descriptionField,isPrimary=!1)),originalIsPrimary=modalEditEvent.find(".isPrimaryCheckbox").attr("data-original-isprimary"),modalNarrativeActive){var lifestoryTitleField=modalNarrative.find(".lifestoryTitleField").val(),originalLifestoryTitleVal=modalNarrative.find(".lifestoryTitleField").attr("data-original-lifestorytitle"),narrativeField=modalNarrative.find(".narrativeField").val(),originalNarrativeVal=modalNarrative.find(".narrativeField").attr("data-original-narrative"),displayOnLifeStory=modalNarrative.find("#displayLifestory").prop("checked"),originalDisplayOnLifeStory=modalNarrative.find("#displayLifestory").attr("data-original-displaylifestory");(typeof originalLifestoryTitleVal!="undefined"&&typeof lifestoryTitleField!="undefined"&&originalLifestoryTitleVal!==lifestoryTitleField||typeof originalNarrativeVal!="undefined"&&typeof narrativeField!="undefined"&&originalNarrativeVal!==narrativeField||typeof originalDisplayOnLifeStory!="undefined"&&typeof displayOnLifeStory!="undefined"&&originalDisplayOnLifeStory!==displayOnLifeStory.toString())&&(narrativeChanged=!0)}var relationshipEventType=isRelationshipEventType(),relationshipId=typeof newRelationshipPid!="undefined"&&newRelationshipPid.length>0?newRelationshipPid:typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-assertionId")!="undefined"&&selectedPerson.attr("data-assertionId").length>0?selectedPerson.attr("data-assertionId"):"",relTypeAheadVal="false";if(relationshipEventType&&relationshipId!=null&&relationshipId!==""&&FactEditModal.originalSpouseId!==relationshipId?(eventChanged=!0,relTypeAheadVal=typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-isTypeAhead")!="undefined"&&selectedPerson.attr("data-isTypeAhead").length>0?selectedPerson.attr("data-isTypeAhead"):"false"):relationshipEventType&&typeof FactEditModal.originalSpouseId!="undefined"&&FactEditModal.originalSpouseId!=null&&FactEditModal.originalSpouseId.length>0&&typeof FactEditModal.newSpouseId!="undefined"&&FactEditModal.newSpouseId!=null&&FactEditModal.newSpouseId.length>0&&FactEditModal.originalSpouseId!==FactEditModal.newSpouseId&&(eventChanged=!0,relationshipId=FactEditModal.newSpouseId),saveValue="",FactEditModal.hasValidationError||(eventChanged&&narrativeChanged?saveValue="0":eventChanged?saveValue="1":narrativeChanged&&(saveValue="2")),typeof isSpouseDataValidate!="undefined"&&isSpouseDataValidate!==!0||typeof originalDateVal=="undefined"||typeof dateField=="undefined"||originalDateVal===dateField||FactEditModal.hasValidationWarningAgainstSpouseData||!relationshipEventType||FactEditModal.validatedAgainstSpouseData[relationshipId]!=="undefined"&&(FactEditModal.validatedAgainstSpouseData[relationshipId]==="undefined"||FactEditModal.validatedAgainstSpouseData[relationshipId])||(eventChanged=validateRelationshipEventAgainstSpouseData(selectedPerson,eventType,dateField,!1),FactEditModal.hasValidationWarningAgainstSpouseData=!eventChanged,FactEditModal.validatedAgainstSpouseData[relationshipId]=!0),relationshipEventType&&eventChanged&&(FactEditModal.originalSpouseId=relationshipId),typeof assertionid!="undefined"&&assertionid!=null&&saveValue.length>0&&(eventChanged||narrativeChanged))handleButtonsSavingMode(),url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/assertionid/"+assertionid+"/savepersonnarrativeandeventdata",$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,data:{saveContentValue:saveValue,title:lifestoryTitleField,narrative:narrativeField,isHidden:!displayOnLifeStory,isMapOn:$(".narrativeIsMapOn").length>0&&$(".narrativeIsMapOn").val().length>0?$(".narrativeIsMapOn").val():!1,isImageOn:$(".narrativeIsImageOn").length>0&&$(".narrativeIsImageOn").val().length>0?$(".narrativeIsImageOn").val():!1,preferredImageId:$(".narrativePreferredImageId").length>0&&$(".narrativePreferredImageId").val().length>0?$(".narrativePreferredImageId").val():"",eventId:assertionid,eventType:eventType,customEventTitle:titleField,date:dateField,place:placeField,placeGpid:placeGpid,description:valueField!=null&&valueField.length>0?valueField:descriptionField,relationshipId:relationshipId,relTypeAhead:relTypeAheadVal,isPrimary:isPrimary,givenName:givenNameField,surname:surnameField,suffixName:suffixNameField,genderType:genderTypeField},success:function(data){var cancelClose,factItem,fullname,preferredStored,splitTitle,existingDate,factDesc,preferredEventStored,successBanner,narrativeTextArea,lifestoryTitle,displayLifestory;if(handleButtonsNormalMode(),data.result){if(FactEditModal.hasValidationWarningAgainstSpouseData=!1,cancelClose=$(".cancelClose"),eventChanged){if(cancelClose.length>0&&cancelClose.text(FactEditModal.text.close),isRelationshipEventType()&&window.glue.reload(),factItem=$("#fi"+assertionid),eventType==="Name")setFieldValidationValues(dictionary),fullname=(givenNameField.length>0?givenNameField:"")+(surnameField.length>0?(givenNameField.length>0?" ":"")+surnameField:"")+(suffixNameField.length>0?" "+suffixNameField:""),factItem.find(".cardTitle").text(fullname),isPrimary===!0&&($("#personCard .userCardTitle").text(fullname),PersonCard.name=fullname,handleFactModalUserCardData(".userCardTitle",fullname),setOldPreferredCard("preferredEventName"),setNewPreferredCard(factItem,"preferredEventName"),setAndRetrieveStoredFactValues(factItem,"givenNameStored"+assertionid,givenNameField),setAndRetrieveStoredFactValues(factItem,"surnameStored"+assertionid,surnameField),setAndRetrieveStoredFactValues(factItem,"suffixStored"+assertionid,suffixNameField),preferredStored=factItem.find(".preferredStored"+assertionid),preferredStored.length>0?preferredStored.val(modalEditEvent.find(".isPrimaryCheckbox").prop("checked")):factItem.append('<input class="preferredStored'+assertionid+'" type="hidden" value="'+modalEditEvent.find(".isPrimaryCheckbox").prop("checked")+'" />')),originalIsPrimary.toLowerCase()!==isPrimary.toString()&&($("html").data("factItemNeedsRefocus",$(".factItemFocused").attr("id")),window.glue.reload());else if(eventType==="Gender")window.location.reload();else{if(typeof titleField!="undefined"&&titleField.length>0&&(factItem.find(".cardSubtitle").text(titleField),modalTitle=$(".modalHeader").find(".modalTitle"),modalTitle.length>0&&(splitTitle=modalTitle.text().split(" "),splitTitle.length>0&&modalTitle.text(splitTitle[0]+" "+titleField)),modalEditEvent.find(".titleField").val(titleField),modalEditEvent.find(".titleField").attr("data-original-value",titleField)),(typeof originalIsPrimary!="undefined"&&typeof isPrimary!="undefined"&&originalIsPrimary.toLowerCase()!==isPrimary.toString()||typeof originalDateVal!="undefined"&&typeof dateField!="undefined"&&(originalDateVal!==dateField||originalDateVal.indexOf(data.dateYear)===-1||dateField.length===0))&&($("html").data("factItemNeedsRefocus",$(".factItemFocused").attr("id")),window.glue.reload()),setFieldValidationValues(dictionary),modalEditEvent.find(".isPrimaryCheckbox").prop("checked",isPrimary),typeof dateField!="undefined"&&dateField.length>0?factItem.find(".factItemDate").length>0?factItem.find(".factItemDate").text(dateField):factItem.find(".factItemLocation").length>0?factItem.find(".factItemLocation").before('<span class="factItemDate">'+dateField+"<\/span> &bull; "):factItem.find(".cardTitle").append('<span class="factItemDate">'+dateField+"<\/span>"):factItem.find(".factItemDate").length>0&&factItem.find(".factItemDate").remove(),typeof placeField!="undefined"&&placeField.length>0?factItem.find(".factItemLocation").length>0?factItem.find(".factItemLocation").text(placeField):factItem.find(".factItemDate").length>0?factItem.find(".factItemDate").after(' &bull; <span class="factItemLocation">'+placeField+"<\/span>"):factItem.find(".cardTitle").append('<span class="factItemLocation">'+placeField+"<\/span>"):factItem.find(".factItemLocation").length>0&&(factItem.find(".factItemDate").length>0?(existingDate=factItem.find(".factItemDate"),factItem.find(".cardTitle").html('<span class="factItemDate">'+existingDate.text()+"<\/span>")):factItem.find(".factItemLocation").remove()),factDesc=factItem.find(".factDesc"),factDesc.length>0&&typeof valueField!="undefined"&&valueField.length>0&&factItem.find(".factDesc").text(valueField),factDesc.length>0&&typeof descriptionField!="undefined"&&descriptionField.length>0?factItem.find(".factDesc").text(descriptionField):typeof descriptionField!="undefined"&&descriptionField.length>0&&factDesc.length===0?factItem.find(".cardTitle").after('<p class="factDesc textWrap">'+descriptionField+"<\/p>"):typeof descriptionField!="undefined"&&descriptionField.length===0&&factDesc.length>0&&factItem.find(".factDesc").remove(),isPrimary===!0){var hasBirth=PersonCard.lifeYearRange.indexOf("&ndash;")>0||PersonCard.lifeYearRange.indexOf("-")>0,hasDeath=(PersonCard.lifeYearRange.indexOf("&ndash;")===0||PersonCard.lifeYearRange.indexOf("-")===0)&&PersonCard.lifeYearRange.length>7||PersonCard.lifeYearRange.length>11,splitYears=PersonCard.lifeYearRange.indexOf("&ndash;")!==-1?PersonCard.lifeYearRange.split("&ndash;"):PersonCard.lifeYearRange.split("-"),eventResults=validDate(dateField,eventType.toString().toLowerCase(),FactEditModal.person.personBirth,FactEditModal.person.personDeath,FactEditModal.person.motherBirth,FactEditModal.person.motherDeath,FactEditModal.person.fatherBirth,FactEditModal.person.fatherDeath,!1),dateSet="";typeof dateField!="undefined"&&typeof placeField!="undefined"&&isPrimary===!0&&eventType.toString()==="Birth"?(window.getPersonCard(),dateSet=(eventResults[0]===0?eventResults[1]:splitYears.length>0&&hasBirth?splitYears[0]:"")+"&ndash;"+(splitYears.length>0&&hasDeath?splitYears.length>1?splitYears[1]:splitYears[0]:""),PersonCard.lifeYearRange=dateSet,dateSet.length>1&&dateSet!=="&ndash;"?handleFactModalUserCardData(".userCardSubTitle","("+dateSet.replace("&ndash;","-")+")"):handleFactModalUserCardData(".userCardSubTitle","")):typeof dateField!="undefined"&&typeof placeField!="undefined"&&isPrimary===!0&&eventType.toString()==="Death"&&(window.getPersonCard(),dateSet=(splitYears.length>0&&hasBirth?splitYears[0]:"")+"&ndash;"+(eventResults[0]===0?eventResults[1]:splitYears.length>0&&hasDeath?splitYears.length>1?splitYears[1]:splitYears[0]:""),PersonCard.lifeYearRange=dateSet,dateSet.length>1&&dateSet!=="&ndash;"?handleFactModalUserCardData(".userCardSubTitle","("+dateSet.replace("&ndash;","-")+")"):handleFactModalUserCardData(".userCardSubTitle",""))}isPrimary===!0&&(setOldPreferredCard("preferredEvent"+eventType.toString()),setNewPreferredCard(factItem,"preferredEvent"+eventType.toString()),typeof dateField!="undefined"&&setAndRetrieveStoredFactValues(factItem,"dateStored"+assertionid,dateField),typeof placeField!="undefined"&&setAndRetrieveStoredFactValues(factItem,"placeStored"+assertionid,placeField),typeof descriptionField!="undefined"&&setAndRetrieveStoredFactValues(factItem,"descriptionStored"+assertionid,descriptionField),preferredEventStored=factItem.find(".preferredEventStored"+assertionid),preferredEventStored.length>0?preferredEventStored.val(modalEditEvent.find(".isPrimaryCheckbox").prop("checked")):factItem.append('<input class="preferredEventStored'+assertionid+'" type="hidden" value="'+modalEditEvent.find(".isPrimaryCheckbox").prop("checked")+'" />'))}isCreateRelationshipEvent&&showIndividualSpouse()}saveValue.length>0&&(successBanner=$(".tabActive").find(".alertSuccess"),successBanner.length>0&&switchOnSuccessBanner(successBanner),setupCreateOrSaveTextButton(),$.modal.center());narrativeChanged&&(narrativeTextArea=$("#narrative"),narrativeTextArea.length>0&&(narrativeTextArea.text(narrativeField),narrativeTextArea.val(narrativeField),narrativeTextArea.attr("data-original-narrative",narrativeField)),lifestoryTitle=$(".lifestoryTitleField"),lifestoryTitle.length>0&&lifestoryTitle.attr("value",lifestoryTitleField).attr("data-original-lifestorytitle",lifestoryTitleField),displayLifestory=$("#displayLifestory"),displayLifestory.length>0&&displayLifestory.prop("checked",displayOnLifeStory).attr("data-original-displaylifestory",displayOnLifeStory.toString()),modalNarrative.removeClass("loading").find(".narrativeDataFields").show(),cancelClose.length>0&&cancelClose.text(FactEditModal.text.close),narrativeField.length===0&&factEditModalTimelineOptions(PersonCard.treeId,PersonCard.personId,assertionid))}},error:function(xhr,ajaxOptions,thrownError){throwException("status->"+xhr.status+" thrownError->"+thrownError);handleButtonsNormalMode()}});else if(FactEditModal.hasValidationError)return setButtonandBannerBasedOnValidation(!0),!1;return!0}function factEditModalHandleTabClick(selector,newPid,clearBanners,showBannerVal,getMedia){personAnalyticsTrackClick(selector);switch(selector){case"factEditModalEvent":case"editModalSaveButton":savePersonNarrativeAndEventDataModal(FactEditModal.assertionId,newPid,"",!0,clearBanners)&&resetEventDetails();break;case"factEditModalAttachMedia":if(!FactEditModal.mediaLoaded||getMedia){if(savePersonNarrativeAndEventDataModal(FactEditModal.assertionId,newPid,"",!1,clearBanners))return factEditModalAttachedMedia(showBannerVal)}else return savePersonNarrativeAndEventDataModal(FactEditModal.assertionId,newPid,"",!1,clearBanners);break;case"factEditModalSourceCitations":if(savePersonNarrativeAndEventDataModal(FactEditModal.assertionId,newPid,"",!1,clearBanners))return factEditModalSources(showBannerVal);break;case"factEditModalTimelineOptions":if(savePersonNarrativeAndEventDataModal(FactEditModal.assertionId,newPid,"",!1,clearBanners))return factEditModalTimelineOptions(FactEditModal.treeId,FactEditModal.personId,FactEditModal.assertionId)}return!0}function factEditModalAttachedMedia(hasBanner){var addMediaSection=$("#addMediaSection"),url;addMediaSection.hide().closest(".tabContent").removeClass("showUpload");url="/modals/factedit/tree/"+FactEditModal.treeId+"/person/"+FactEditModal.personId+"/assertionid/"+FactEditModal.assertionId+"/attachedmedia?noRecordMedia=true";$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,data:{eventType:FactEditModal.eventType,eventTitle:FactEditModal.eventTitle},success:function(data){var tabActive=$(".tabActive"),attachedMediaList=tabActive.find(".attachedMediaList"),hasFactMediaError,$sortingDivTopAlert,$sortingDivBottomAlert,bannerArea;data.result&&data.html!=null&&data.html.length>0?(tabActive.removeClass("loading"),attachedMediaList.html(data.html),$(".attachedMediaList").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning),hasFactMediaError=$("#hasFactMediaError"),hasFactMediaError.length>0&&hasFactMediaError.val()==="true"?($(".sortingDivTopFactNoAttachedMediaMSG").alert("close"),$(".sortingDivTopFactErrorMSG").alert("open"),$(".sortingDivBottomFactNoMediaMSG").alert("close"),$(".sortingDivBottomFactErrorMSG").alert("open")):(FactEditModal.mediaLoaded=!0,(typeof PersonData!="undefined"&&PersonData.hasEditRights||PersonData.hasContributorRights)&&addMediaSection.show().closest(".tabContent").addClass("showUpload"),factEditModalMedia(data.attachedMediaIds,data.unAttachedMediaIds),sortingCardOutlineHover(),$sortingDivTopAlert=$(".sortingDivTopFactMedia .sortingDivTopFactNoAttachedMediaMSG"),$sortingDivBottomAlert=$(".sortingDivBottomFactMedia .sortingDivBottomFactNoMediaMSG"),$sortingDivTopAlert.alert(personViewModalAlertSettingsNote),$sortingDivBottomAlert.alert(personViewModalAlertSettingsNote),$.cachedScript(typeof PersonData!="undefined"&&PersonData.animateCardUrl).done(function(){$(".sortingDivBottomFactMedia").animateCard({animateMove:{afterAnimate:function(item){item.find(".sortingIcon").hasClass("iconAdd")?(item.removeClass("cardOutline2").addClass("attached"),(PersonData.hasEditRights||PersonData.hasContributorRights)&&item.find(".sortingIcon").removeClass("iconAdd noHover").addClass("iconClose")):(item.removeClass("cardOutline2").removeClass("attached"),(PersonData.hasEditRights||PersonData.hasContributorRights)&&item.find(".sortingIcon").removeClass("iconClose noHover").addClass("iconAdd"));window.lock.actionInProgress=!1},beforeAnimate:function(item){item.find(".card").addClass("cardOutline2")},connectWith:".sortingDivTopFactMedia",emptyContent:".alertNote"},items:".card",onListEmpty:function(emptyList){emptyList.find(".alertNote").alert("open")},onEmptyListAdd:function(list){list.find(".alertNote").alert("close")}})}),$(".sortingDivTopFactMedia .card").length===0&&$sortingDivTopAlert.alert("open"),$(".sortingDivBottomFactMedia .card").length===0&&$sortingDivBottomAlert.alert("open"),bannerArea=$(".tabActive").find(".alertSuccess"),typeof hasBanner!="undefined"&&hasBanner==="true"&&bannerArea.length>0&&(switchOnSuccessBanner(bannerArea),setFactModalTabsClick(!FactEditModal.hasValidationError)))):($(".sortingDivTopFactNoAttachedMediaMSG").alert("close"),$(".sortingDivTopFactErrorMSG").alert("open"),$(".sortingDivBottomFactNoMediaMSG").alert("close"),$(".sortingDivBottomFactErrorMSG").alert("open"),tabActive.removeClass("loading"))},error:function(){$(".sortingDivTopFactNoAttachedMediaMSG").alert("close");$(".sortingDivTopFactErrorMSG").alert("open");$(".sortingDivBottomFactNoMediaMSG").alert("close");$(".sortingDivBottomFactErrorMSG").alert("open")}});resetValidationValues()}function resetEventDetails(){var modalEditEvent=$(".tabContent1");modalEditEvent.find(".factField").each(function(){var $field=$(this),originalVal;$field.attr("name")!=="gender"&&(originalVal=$field.data("original-value"),$field.val(originalVal))});clearAllBanners();$(".editModalSaveButton").removeAttr("disabled");setFactModalTabsClick(!FactEditModal.hasValidationError)}function resetValidationValues(){FactEditModal.hasValidationWarning=!1;FactEditModal.hasValidationDateWarning=!1;FactEditModal.validationWarningMessage="";FactEditModal.hasValidationError=!1;FactEditModal.validationErrorMessage="";FactEditModal.hasValidationWarningToSelectSpouse=!1}function validateAndSetupDisplay(element){resetValidationValues();typeof element!="undefined"&&validateField(element);setButtonandBannerBasedOnValidation(!0)}function factEditModalMedia(attachedMediaIds,unAttachedMediaIds){attachedMediaIds.length>0&&setupFactEditModalDetailsForMedia(attachedMediaIds,FactEditModal.assertionId);unAttachedMediaIds.length&&setupFactEditModalDetailsForMedia(unAttachedMediaIds,FactEditModal.assertionId)}function validateField(el){var origVal,eventResults,eventValidationValues,surname,validationNameMessage,msg;if(typeof el!="undefined"){var isjQueryObj=el instanceof jQuery,$element=isjQueryObj?el:$(el),value=$element.val();return value.length===0?($element.data("state","0"),$element.data("msg",""),0):$element.hasClass("dateField")?value.charAt(0)==="\\"||value.charAt(date.length-1)==="\\"?($element.data("state","3"),msg=FactEditModal.text.warnDateMayBeWrong+" "+FactEditModal.text.warnInvalidCharacterStartEndDate,$element.data("msg",msg),3):(origVal=$element.data("original-value"),typeof origVal!="undefined"&&origVal===value)?($element.data("state","1"),$element.data("msg",""),1):(eventResults=validDate(value,FactEditModal.eventType.toLowerCase(),FactEditModal.person.personBirth,FactEditModal.person.personDeath,FactEditModal.person.motherBirth,FactEditModal.person.motherDeath,FactEditModal.person.fatherBirth,FactEditModal.person.fatherDeath,!1),eventValidationValues=validationCheck(FactEditModal.eventType.toLowerCase(),eventResults),eventValidationValues.hasValidationWarning?($element.data("state","3"),$element.data("msg",eventValidationValues.validationMessage),3):($element.data("state","2"),$element.data("msg",""),2)):$element.hasClass("surnameField")?(surname=$element.val(),validationNameMessage=validateSurname(surname,FactEditModal.person.fatherSurname,FactEditModal.person.spouseSurname,FactEditModal.gender,FactEditModal.normalSurnameValidation),validationNameMessage.length>0?($element.data("state","3"),msg=FactEditModal.validationWarningMessage.length>0?FactEditModal.validationWarningMessage+"  "+validationNameMessage:validationNameMessage,$element.data("msg",msg),typeof surname=="undefined"||FactEditModal.person.fatherSurname===surname)?($element.data("state","2"),$element.data("msg",""),2):3:($element.data("state","2"),$element.data("msg",""),2)):($element.data("state","2"),$element.data("msg",""),2)}}function handleButtonsSavingMode(){$(".editModalSaveButton").addClass("loading disabled").attr("aria-busy","true");var cancelClose=$(".cancelClose");cancelClose.length>0&&cancelClose.hide()}function handleButtonsNormalMode(){$(".editModalSaveButton").removeAttr("disabled aria-busy").removeClass("loading disabled");var cancelClose=$(".cancelClose");cancelClose.length>0&&cancelClose.show()}function setFieldValidationValues(dictionary){var modalEditEvent=$(".tabContent1");modalEditEvent.find(".factField").each(function(){var $field=$(this),field;$field.attr("name")=="gender"?(field=dictionary[$field.attr("id")],field!="undefined"?($field.attr("checked",!0),$field.data("state",1),$field.val(field.value),$field.data("original-value",field.value)):($field.attr("checked",!1),$field.data("state",0),$field.val(""),$field.data("original-value",""))):(field=dictionary[$field.attr("id")],field!="undefined"?($field.data("state",field.value.length===0?0:1),$field.val(field.value),$field.data("original-value",field.value),field.extra.length>0&&$field.data("extra",field.extra)):($field.data("state",0),$field.val(""),$field.data("original-value",""),$field.data("extra","")))})}function setupFactEditModalDetailsForMedia(eventMediaIds,factId){var getTrackingId=function(isAttached){return isAttached?"editFactModalRemoveMedia":"editFactModalAttachMedia"},mediaList=eventMediaIds.split(",");mediaList!=null&&mediaList.length>0&&$.each(mediaList,function(i,mediaId){setupCardClickEvent(mediaId,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachMediaFromEvent(factId,mediaId,attachDetachCallback):attachMediaToEvent(factId,mediaId,attachDetachCallback)})})}function setupSourceEditModalDetailsForMedia(eventMediaIds,sourceId){var getTrackingId=function(isAttached){return isAttached?"removeMediaFromCitation":"attachMediaToCitation"},mediaList=eventMediaIds.split(",");mediaList!=null&&mediaList.length>0&&$.each(mediaList,function(i,mediaId){setupCardClickEvent(mediaId,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachMediaFromCitation(sourceId,mediaId,attachDetachCallback):attachMediaToCitation(sourceId,mediaId,attachDetachCallback)})})}function setupCardClickEvent(cardId,getTrackingId,makeServerCall){var $card=$("#"+cardId);$card.on("click.card","button.sortingIcon",function(e){var isAttached,attachDetachCallback;e.preventDefault();isAttached=$card.hasClass("attached");personAnalyticsTrackClick(getTrackingId(isAttached));clearAllBanners();attachDetachCallback=function(data){data&&data.result&&($card.trigger("animateListItem.move"),saveUIState($(".factItemFocused")),window.glue.reload(function(){loadUIState("click")}))};typeof makeServerCall=="function"&&makeServerCall(isAttached,attachDetachCallback)})}function factEditModalSources(hasBanner){var eventSourcesList=$(".eventSourcesList"+FactEditModal.assertionId),unattachedEventSourcesList,bannerArea;eventSourcesList.length>0&&eventSourcesList.val()!=null&&eventSourcesList.val().length>0&&setupFactEditModalDetailsForSource(eventSourcesList,!0);unattachedEventSourcesList=$(".unattachedEventSourcesList"+FactEditModal.assertionId);unattachedEventSourcesList.length>0&&unattachedEventSourcesList.val()!=null&&unattachedEventSourcesList.val().length>0&&setupFactEditModalDetailsForSource(unattachedEventSourcesList,!1);bannerArea=$(".tabActive").find(".alertSuccess");typeof hasBanner!="undefined"&&hasBanner&&bannerArea.length>0&&(switchOnSuccessBanner(bannerArea),setFactModalTabsClick(!FactEditModal.hasValidationError))}function setupFactEditModalDetailsForSource(listItem){var getTrackingId=function(isAttached){return isAttached?"editFactModalRemoveSource":"editFactModalAddSource"},sourcesList=listItem.val().split(",");sourcesList!=null&&sourcesList.length>0&&$.each(sourcesList,function(i,sourceId){var sourceItem=$("#modal_si"+sourceId),userCardItem=$(".userCardsi"+sourceId),dbId,imgSrc,selector;if(sourceItem.length>0){if(dbId=sourceItem.find(".dbId").val(),dbId==="1030")userCardItem.find(".userCardImg").addClass("icon iconAcom");else{var sourceNode=$("#si"+sourceId),nodeUserCardImg=sourceNode.find(".userCardImg"),imgItem=nodeUserCardImg.children("img");imgItem.length>0?(imgSrc=imgItem.attr("src"),userCardItem.length>0&&(userCardItem.find(".userCardImg").html('<img class="" src="'+imgSrc+'" alt="" />'),userCardItem.find(".userCardImg").attr("style","background-image:url('"+imgSrc+"');"),userCardItem.find(".userCardImg").addClass("userCardImgSquare userCardImgCenter"))):userCardItem.find(".userCardImg").addClass("icon iconDocument")}selector="modal_si"+sourceId;setupCardClickEvent(selector,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachSourceFromEvent(FactEditModal.assertionId,sourceId,selector,attachDetachCallback):attachSourceToEvent(FactEditModal.assertionId,sourceId,selector,attachDetachCallback)})}else sourceId==="1030"?userCardItem.find(".userCardImg").addClass("icon iconAcom"):userCardItem.find(".userCardImg").addClass("icon iconDocument")})}function factEditModalTimelineOptions(treeId,personId,assertionId){var url="/modals/factedit/tree/"+treeId+"/person/"+personId+"/assertionid/"+assertionId+"/timeline";$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,success:function(data){var narrativeTextArea,displayLifestory,generateNarrativeButton,lifestoryTitleField;$(".tabContent4").removeClass("loading").find(".narrativeDataFields").show();narrativeTextArea=$("#narrative");displayLifestory=$("#displayLifestory");data.result&&data.personEventNarrativeDataResponse!=null?(generateNarrativeButton=$("#generateNarrative"),generateNarrativeButton.length>0&&data.personEventNarrativeDataResponse.DefaultNarrative!=null&&data.personEventNarrativeDataResponse.DefaultNarrative.length>0&&generateNarrativeButton.show(),narrativeTextArea.length>0&&(narrativeTextArea.text(data.personEventNarrativeDataResponse.Narrative),narrativeTextArea.val(data.personEventNarrativeDataResponse.Narrative),narrativeTextArea.attr("data-original-narrative",data.personEventNarrativeDataResponse.Narrative||"")),lifestoryTitleField=$(".lifestoryTitleField"),lifestoryTitleField.length>0&&lifestoryTitleField.attr("value",data.personEventNarrativeDataResponse.Title).attr("data-original-lifestorytitle",data.personEventNarrativeDataResponse.Title),displayLifestory.length>0&&displayLifestory.prop("checked",!data.personEventNarrativeDataResponse.IsHidden).attr("data-original-displaylifestory",(!data.personEventNarrativeDataResponse.IsHidden).toString()),$(".narrativeIsMapOn").val(data.personEventNarrativeDataResponse.IsMapOn),$(".narrativeIsImageOn").val(data.personEventNarrativeDataResponse.IsImageOn),$(".narrativePreferredImageId").val(data.personEventNarrativeDataResponse.PreferredImageId)):displayLifestory.length>0&&($(".narrativeIsMapOn").val(!1),$(".narrativeIsImageOn").val(!1),displayLifestory.prop("checked",!1).attr("disabled",!0).attr("data-original-displaylifestory","false"))}})}function switchOnSuccessBanner(bannerArea){bannerArea.text(FactEditModal.text.savedSuccessfullyBanner);bannerArea.hasClass("alertHidden")&&bannerArea.alert("open")}function showMultipleSpouseSelect(){var hasSelectedPerson,selectedSpouseRadio,dontValidate,spouseCount,selectedSpouseId;$(".editModalSaveButton").unbind("click");FactEditModal.isAddNewSpouse=!1;FactEditModal.showMultipleSpouseSelected=!0;var modalEditEvent=$(".tabContent1"),individualSpouseSelect=modalEditEvent.find("#individualSpouseSelect"),multipleSpouseSelect=modalEditEvent.find("#multipleSpouseSelect"),selectedPerson=modalEditEvent.find(".selectedPerson");isRelationshipEventType()&&selectedPerson.length===0&&(selectedPerson=modalEditEvent.find(".selectedPerson"));hasSelectedPerson=typeof selectedPerson!="undefined"&&selectedPerson.length>0;hasSelectedPerson&&(selectedSpouseId=selectedPerson.attr("id").replace("selectedSpouse","").replace("-individual",""),selectedSpouseRadio=$("#selectedSpouseRadio"+selectedSpouseId),selectedSpouseRadio.attr("checked","checked"),selectedPerson.hide());$("#changeSpouseButton").hide();$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();");dontValidate=!1;spouseCount=parseInt(FactEditModal.person.spouseCount);FactEditModal.isAddNewFact||spouseCount!==1||typeof FactEditModal.originalSpouseId=="undefined"||FactEditModal.originalSpouseId.length!==0?!FactEditModal.isAddNewFact&&spouseCount>1&&typeof FactEditModal.originalSpouseId!="undefined"&&FactEditModal.originalSpouseId.length===0?(individualSpouseSelect.hide(),$("#spouseText").hide(),$("#selectSpouseForEventText").show(),multipleSpouseSelect.show(),$("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").show(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):spouseCount===1?(hasSelectedPerson&&(selectedSpouseId=selectedPerson.attr("id").replace("selectedSpouse","").replace("-individual",""),resetIndividualSpouseNode(selectedPerson,selectedSpouseId)),setIndividualSpouseData(modalEditEvent,".singleScenarioSpouseSelect"),dontValidate=!0,individualSpouseSelect.show(),multipleSpouseSelect.hide()):spouseCount===0?($("#noSpouseChooseOther").show(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):(individualSpouseSelect.hide(),$("#spouseText").hide(),$("#selectSpouseForEventText").show(),multipleSpouseSelect.show().addClass("multipleSpouseSelected"),FactEditModal.previousSelectedSpouseHTML.length>0&&FactEditModal.previousSelectedSpouseHTML.indexOf("selectedPerson")!==-1&&modalEditEvent.find("#individualSpouseSelect").html(FactEditModal.previousSelectedSpouseHTML)):(individualSpouseSelect.hide(),multipleSpouseSelect.show(),$("#singleScenarioSpouseSelect").show(),$("#noSpouseForEventSingle").show(),$("#noSpouseForEventMulti").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();"));dontValidate||hasSelectedPerson?FactEditModal.isAddNewFact?setAddNewFactCreateAction():setFactModalTabsClick(FactEditModal.hasValidationError):setFactActionWithValidate();$.modal.center()}function showIndividualSpouse(){var singleScenarioSpouseSelect,existingSpouseIndividual2;FactEditModal.isAddNewSpouse=!1;FactEditModal.showMultipleSpouseSelected=!1;var modalEditEvent=$(".tabContent1"),individualSpouseSelect=modalEditEvent.find("#individualSpouseSelect"),multipleSpouseSelect=modalEditEvent.find("#multipleSpouseSelect"),spouseCount=parseInt(FactEditModal.person.spouseCount);if(spouseCount>=1&&(singleScenarioSpouseSelect=$("#singleScenarioSpouseSelect"),spouseCount===1&&singleScenarioSpouseSelect.length>0&&typeof $("#singleScenarioSpouseSelect").attr("style").length!="undefined"&&$("#singleScenarioSpouseSelect").attr("style").length===0?($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):($("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();"),$("#chooseOtherButton").hide())),$("#spouseText").show(),$("#selectSpouseForEventText").hide(),setIndividualSpouseData(modalEditEvent,".selectedPerson"))$("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").hide();else return!1;return spouseCount>0&&(individualSpouseSelect.show(),multipleSpouseSelect.hide()),existingSpouseIndividual2=individualSpouseSelect.find(".existingSpouseIndividual"),existingSpouseIndividual2.length>0&&existingSpouseIndividual2.hasClass("selectedPerson")&&existingSpouseIndividual2.show(),multipleSpouseSelect.removeClass("multipleSpouseSelected"),$.modal.center(),!0}function showIndividualSpouseCommon(modalEditEvent,selectedPerson,selectedSpouseIndividual){typeof selectedPerson!="undefined"&&selectedPerson.length>0&&(selectedPerson.removeClass("selectedPerson").removeAttr("style"),selectedSpouseIndividual.addClass("selectedPerson").attr("data-assertionId",selectedPerson.attr("data-assertionId")).attr("data-spouseLifeRange",selectedPerson.attr("data-spouseLifeRange")),setEditModalSaveButtonClick())}function validateRelationshipEventAgainstSpouseData(selectedPerson,eventType,dateField,isCreate){var hasValidationWarning=!1,validationMessage=FactEditModal.text.warnDateMayBeWrong+"  ",relationshipLifeRange,lifeRangeSplit,eventResults;return(overrideValidation(),FactEditModal.hasValidationWarning=!1,FactEditModal.validationWarningMessage="",FactEditModal.warningMessage="",relationshipLifeRange=typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-spouseLifeRange")!="undefined"&&selectedPerson.attr("data-spouseLifeRange").length>0?selectedPerson.attr("data-spouseLifeRange").trim():"",relationshipLifeRange.length>0&&relationshipLifeRange.indexOf(":")!==-1&&(lifeRangeSplit=relationshipLifeRange.split(":"),eventResults=validDate(dateField,eventType.toString().toLowerCase(),FactEditModal.person.personBirth,FactEditModal.person.personDeath,FactEditModal.person.motherBirth,FactEditModal.person.motherDeath,FactEditModal.person.fatherBirth,FactEditModal.person.fatherDeath,!1),lifeRangeSplit[0].length>0&&parseInt(eventResults[1],10)<lifeRangeSplit[0]&&(hasValidationWarning=!0,validationMessage+=warnDateBeforeBirthOfSpouse),lifeRangeSplit[1].length>0&&parseInt(eventResults[1],10)>lifeRangeSplit[1]&&(hasValidationWarning=!0,validationMessage+=warnDateAfterDeathOfSpouse),hasValidationWarning))?(FactEditModal.hasValidationWarning=!0,FactEditModal.validationWarningMessage="",FactEditModal.warningMessage="",setupCreateOrSaveAnywayTextButton(),isCreate?setAddNewFactCreateAction():setFactModalTabsClick(FactEditModal.hasValidationError),!1):!0}function showSpouseTypeAheadSection(){var typeAheadCancelButton,typeAheadAddPersonButton,typeAheadSaveButton,$typeAheadNameField;FactEditModal.isAddNewSpouse=!0;var modalEditEvent=$(".tabContent1"),selectedPerson=modalEditEvent.find(".selectedPerson"),spouseCount=parseInt(FactEditModal.person.spouseCount);$("#noSpouseForEventMulti").hide();$("#noSpouseForEventSingle").hide();FactEditModal.previousSelectedSpouseHTML=modalEditEvent.find("#individualSpouseSelect").html();typeof selectedPerson!="undefined"&&selectedPerson.length>0&&resetIndividualSpouseNode(selectedPerson,"");spouseCount===0&&$("#noSpouseChooseOther").hide();$("#individualSpouseSelect").hide();$("#multipleSpouseSelect").hide();$("#selectSpouseForEventText").hide();$("#changeSpouseButton").hide();$("#chooseOtherButton").hide();$("#spouseText").show();$("#typeAheadArea").show();$(".addRelationships").show();typeAheadCancelButton=$(".erAddCancel");typeAheadCancelButton.length>0&&typeAheadCancelButton.attr("onClick","hideSpouseTypeAheadSection();");typeAheadAddPersonButton=$(".erAddNew");typeAheadAddPersonButton.length>0&&typeAheadAddPersonButton.attr("onClick","spouseTypeAheadSectionAddPersonModal();");typeAheadSaveButton=$(".erAddSave");$typeAheadNameField=$(".erFindExistingPerson");$typeAheadNameField.length>0&&typeAheadSaveButton.length>0&&(typeAheadSaveButton.attr("onClick","selectFromSpouseTypeAhead(this);"),$typeAheadNameField.data("itemData",""),typeAheadSaveButton.attr("disabled","disabled"),personTypeAheadNameField($typeAheadNameField,FactEditModal.autocompletePidsToExclude,typeAheadSaveButton,"factEditModal",!1));setupCreateOrSaveTextButton();setupCorrectClickActionLinks();$.modal.center()}function hideSpouseTypeAheadSection(){var modalEditEvent,spouseCount,$typeAheadNameField;FactEditModal.isAddNewSpouse=!1;FactEditModal.previousSelectedSpouseHTML.length>0&&FactEditModal.previousSelectedSpouseHTML.indexOf("selectedPerson")!==-1&&(modalEditEvent=$(".tabContent1"),modalEditEvent.find("#individualSpouseSelect").html(FactEditModal.previousSelectedSpouseHTML),FactEditModal.previousSelectedSpouseHTML="");spouseCount=parseInt(FactEditModal.person.spouseCount);spouseCount>1?(FactEditModal.showMultipleSpouseSelected=!0,$("#spouseText").hide(),$("#selectSpouseForEventText").show()):(FactEditModal.showMultipleSpouseSelected=!1,$("#spouseText").show(),$("#selectSpouseForEventText").hide());$("#typeAheadArea").hide();$typeAheadNameField=$(".erFindExistingPerson");$typeAheadNameField.length>0&&$typeAheadNameField.data("itemData","");FactEditModal.hasExistingSpouseToSelect?FactEditModal.showMultipleSpouseSelected||$("#singleScenarioSpouseSelect").attr("style").length===0?($("#multipleSpouseSelect").show(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();"),FactEditModal.isAddNewFact||spouseCount!==1||FactEditModal.originalSpouseId.length!==0?!FactEditModal.isAddNewFact&&spouseCount>1&&FactEditModal.originalSpouseId.length===0&&($("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").show()):($("#noSpouseForEventSingle").show(),$("#noSpouseForEventMulti").hide())):($("#individualSpouseSelect").show(),spouseCount>1?$("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();"):$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):spouseCount===0&&($("#noSpouseChooseOther").show(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();"));setupCreateOrSaveTextButton();setupCorrectClickActionLinks();$.modal.center()}function resetIndividualSpouseNode(selectedPerson,selectedSpouseId){typeof selectedPerson!="undefined"&&selectedPerson.length>0&&(selectedPerson.removeClass("selectedPerson").removeAttr("style"),FactEditModal.previousSelectedSpouseId=selectedSpouseId,FactEditModal.hasValidationWarningAgainstSpouseData=!1,selectedPerson.attr("id","selectedSpouse-individual"),selectedPerson.find(".nodeImageDiv").html(""),selectedPerson.find(".userCardTitle").text(""),selectedPerson.find(".userCardSubTitle").text(""),selectedPerson.attr("data-assertionId","0"))}function setFactActionWithValidate(){FactEditModal.isAddNewFact?setAddNewFactCreateAction():setFactModalTabsClick(FactEditModal.hasValidationError)}function switchSelectedPersonClass(selectedItem){var modalEditEvent=$(".tabContent1"),selectedPerson=modalEditEvent.find(".selectedPerson"),origSelectedSpouseId,selectedSpouseRadio;isRelationshipEventType()&&selectedPerson.length===0&&(selectedPerson=modalEditEvent.find(".selectedPerson"));typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("id")!="undefined"&&(origSelectedSpouseId=selectedPerson.attr("id").replace("selectedSpouse","").replace("-individual",""),resetIndividualSpouseNode(selectedPerson,origSelectedSpouseId));var selectedSpouseId=selectedItem.id.replace("selectedSpouseRadio",""),selectedSpouseItem=$("#selectedSpouse"+selectedSpouseId),spouseCount=parseInt(FactEditModal.person.spouseCount);(FactEditModal.isAddNewFact||spouseCount>0)&&(clearAllBanners(),typeof selectedSpouseItem!="undefined"&&selectedSpouseItem.length>0&&(selectedSpouseRadio=$("#selectedSpouseRadio"+FactEditModal.previousSelectedSpouseId),selectedSpouseRadio.removeAttr("checked"),selectedSpouseItem.addClass("selectedPerson")));FactEditModal.showMultipleSpouseSelected=!1;(spouseCount===1||spouseCount>1)&&(spouseCount===1&&$("#singleScenarioSpouseSelect").attr("style").length===0?($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):($("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();"),$("#chooseOtherButton").hide()));$("#spouseText").show();setFactActionWithValidate();setButtonandBannerBasedOnValidation(!1)}function setIndividualSpouseData(modalEditEvent,selectedPersonClass){var selectedPerson=modalEditEvent.find(selectedPersonClass),$selectedSpouseIndividual=modalEditEvent.find("#selectedSpouse-individual");if(typeof selectedPerson!="undefined"&&selectedPerson.length>0)$selectedSpouseIndividual.attr("id",selectedPerson.attr("id")+"-individual"),$selectedSpouseIndividual.find(".nodeImageDiv").html(selectedPerson.find(".nodeImageDiv").html()),$selectedSpouseIndividual.find(".userCardTitle").text(selectedPerson.find(".userCardTitle").text()),$selectedSpouseIndividual.find(".userCardSubTitle").text(selectedPerson.find(".userCardSubTitle").text());else return!1;return showIndividualSpouseCommon(modalEditEvent,selectedPerson,$selectedSpouseIndividual),$selectedSpouseIndividual.addClass("selectedPerson"),!0}function setEditModalSaveButtonClick(){$(".editModalSaveButton").on("click",function(event){$(".editModalSaveButton").unbind("click");event.stopPropagation()})}function selectFromSpouseTypeAhead(e){var modalEditEvent=$(".tabContent1"),selectedPerson=modalEditEvent.find(".selectedPerson"),imageHtml,dates,spouseCount,selectedSpouseRadio,eventType,dateField;typeof selectedPerson!="undefined"&&selectedPerson.length>0&&(resetIndividualSpouseNode(selectedPerson,""),clearAllBanners());var $this=$(e),$card=$this.closest(".card"),$field=$card.find(".erFindExistingPerson"),data=$card.find(".erAddExistingData").data("itemData"),pid=data.PID;FactEditModal.findExistingPersonPID=pid;var personImage=data.image,personName=data.name,personBirth=data.birth,personDeath=data.death,genderIconType=data.genderIconType,selectedSpouseIndividual=modalEditEvent.find("#selectedSpouse-individual");typeof selectedSpouseIndividual!="undefined"&&selectedSpouseIndividual.length>0&&(selectedSpouseIndividual.attr("id","selectedSpouse"+FactEditModal.findExistingPersonPID+"-individual"),selectedSpouseIndividual.attr("data-isTypeAhead","true"),imageHtml="",imageHtml=personImage.indexOf("mediasvc")!==-1?'<div class="userCardImg userCardImgSquare userCardImgCenter" style="background-image:url(\''+personImage.replace('"','"')+'\');"><img alt="" src="'+personImage+'"><\/div>':'<div class="userCardImg userCardImgSquare icon icon'+genderIconType+'"><\/div>',selectedSpouseIndividual.find(".nodeImageDiv").html(imageHtml),selectedSpouseIndividual.find(".userCardTitle").text(personName),dates=personBirth.length>0&&personDeath.length>0?personBirth+" - "+personDeath:personBirth.length>0?personBirth+" - ":personDeath.length>0?" - "+personDeath:"",selectedSpouseIndividual.find(".userCardSubTitle").text(dates),selectedSpouseIndividual.hasClass("selectedPerson")||selectedSpouseIndividual.addClass("selectedPerson"),selectedSpouseIndividual.attr("data-assertionId",FactEditModal.findExistingPersonPID));$("#spouseText").show();$("#selectSpouseForEventText").hide();$field.length>0&&$field.data("itemData","");$("#typeAheadArea").hide();$("#multipleSpouseSelect").hide();$("#individualSpouseSelect").show();$(".selectedPerson").show();spouseCount=parseInt(FactEditModal.person.spouseCount);spouseCount===0?($("#noSpouseChooseOther").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):(FactEditModal.isAddNewFact||FactEditModal.originalSpouseId.length!==0?FactEditModal.isAddNewFact&&spouseCount>0?($("#chooseOtherButton").hide(),$("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();")):($("#chooseOtherButton").hide(),$("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();")):spouseCount>=1?($("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();"),$("#chooseOtherButton").hide()):($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")),FactEditModal.previousSelectedSpouseId.length>0&&(selectedSpouseRadio=$("#selectedSpouseRadio"+FactEditModal.previousSelectedSpouseId),selectedSpouseRadio.removeAttr("checked")));eventType=FactEditModal.eventType;dateField=modalEditEvent.find(".dateField").val();validateRelationshipEventAgainstSpouseData(selectedPerson,eventType,dateField,!0);setButtonBasedOnValidation();setupCorrectClickActionLinks()}function overrideValidation(){isRelationshipEventType()&&$(".editModalSaveButton").unbind("click");FactEditModal.warningMessage.length>0&&typeof $(".editModalSaveButton").attr("disabled")=="undefined"?setupCreateOrSaveAnywayTextButton():setupCreateOrSaveTextButton();resetValidationValues();FactEditModal.isAddNewFact&&setAddNewFactCreateAction();FactEditModal.warningMessage=""}function setupCreateOrSaveAnywayTextButton(){(isRelationshipEventType()||!isDatePlaceEventType())&&$(".editModalSaveButton").unbind("click");FactEditModal.isAddNewFact?$(".editModalSaveButton").text(FactEditModal.text.createAnyway):$(".editModalSaveButton").text(FactEditModal.text.saveAnyway);$(".editModalSaveButton").removeAttr("disabled")}function spouseTypeAheadSectionAddPersonModal(){var modalEditEvent=$(".tabContent1"),eventType=FactEditModal.eventType,dateField=modalEditEvent.find(".dateField").val(),placeField=modalEditEvent.find(".placeField").val(),descriptionField=modalEditEvent.find(".descriptionField").val(),addRelType=FactEditModal.gender==="Male"?"w":"h",genderType=FactEditModal.gender==="Male"?"F":"M",addPersonArgs='{"rel":"'+addRelType+'","gender":"'+genderType+'", "eventType": "'+eventType+'", "dateField": "'+dateField+'", "placeField": "'+placeField+'", "descriptionField": "'+descriptionField+'", "modalHeaderTitle": "'+($("#modalHeader").length>0?$("#modalHeader").text():"")+'", "showAddNewOnly": "true", "isAddNewSpouse": "true", "selectedContentArea": "tabContent1", "tabOrButtonItem": "factEditModalEvent"'+(FactEditModal.isAddNewFact?"":', "assertionid": "'+FactEditModal.assertionId+'"')+"}",addPersonPgStkArgs="pg=32768&pgpl=pid&pgps="+FactEditModal.personId,apmCallback=function(cbResponse){if(!window.isCancelClicked&&cbResponse.status==="success"){var modalContents=$("#modalContents");modalContents.length>0&&$.modal.showLoading(!0)}return FactEditModal.isAddNewFact?addNewFact(cbResponse.newPid,addPersonArgs):newFactEditModal(PersonData,FactEditModal.assertionId,"tabContent1","",cbResponse.newPid,addPersonArgs,!1),!0};AddPerson.Add(PersonData.treeId,PersonData.personId,addPersonArgs,apmCallback)}function validationCheck(eventType,eventResults){var returnValues={hasValidationWarning:!1,validationMessage:""},dateMonthYear,dateSplit;return eventResults[0]!==0&&(returnValues.hasValidationWarning=!0,returnValues.validationMessage=FactEditModal.text.warnDateMayBeWrong),dateMonthYear=FactEditModal.person.dateStamp,dateMonthYear.length>0?(dateSplit=dateMonthYear.split(","),eventResults[2]!=null&&typeof eventResults[2]!="undefined"&&eventResults[1]===dateSplit[2]&&parseInt(eventResults[2])>parseInt(dateSplit[1])||eventResults[2]!=null&&typeof eventResults[2]!="undefined"&&eventResults[1]===dateSplit[2]&&parseInt(eventResults[2])===parseInt(dateSplit[1])&&eventResults[3]!=null&&parseInt(eventResults[3])>parseInt(dateSplit[0])?(returnValues.hasValidationWarning=!0,returnValues.validationMessage=FactEditModal.text.warnDateMayBeWrong+" "+FactEditModal.text.warnDateIsInFuture):eventResults[1].length>0&&(returnValues.validationMessage=returnValues.validationMessage.length>0?returnValues.validationMessage+" "+eventResults[1]:eventResults[1])):eventResults[1].length>0&&(returnValues.validationMessage=returnValues.validationMessage.length>0?returnValues.validationMessage+" "+eventResults[1]:eventResults[1]),returnValues}function getWarningMessage(requiredEmpty,isEmpty){return requiredEmpty?isEmpty?FactEditModal.text.warnToEnterTitleAndData:FactEditModal.text.warnToEnterTitle:FactEditModal.text.warnToEnterData}function isDatePlaceEventType(){return typeof FactEditModal.datePlaceType=="undefined"&&(FactEditModal.datePlaceType=FactEditModal.eventType!=="Name"&&FactEditModal.eventType!=="Gender"),FactEditModal.datePlaceType}function addFactModal(persondata){var modalContainer,url;if(typeof persondata=="undefined"){alert("persondata cannot be null");return}window.PersonData=persondata;modalContainer=$("#modalContainer");modalContainer.length>0&&modalContainer.remove();closeCallouts();url="/modals/addfact/tree/"+PersonData.treeId+"/person/"+PersonData.personId;$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,success:function(data){data.result&&$(data.html).modal({width:"410",title:PersonData.menu.facts.addFactTitle,useCustomPadding:!1,onOpen:function(){$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning);$("#addFactSelect").change(function(){var selectedFactType=$(this).find("option:selected");selectedFactType.hasClass("creatableOption")&&(personAnalyticsTrackClick("addNewFact"+selectedFactType.val()),addNewFact());$("#modalClose").on("click.addFactModalCloseButton",function(){personAnalyticsTrackClick("addFactModalCloseButton")})})},onClose:function(){$(".addModalTriggered").removeClass("addModalTriggered").focus();$("#modalClose").off("click.addFactModal");resetModalContents(!0)}})}})}function addNewFact(newRelationshipPid,saveEventData){var isValidaNewRelationshipPID=typeof newRelationshipPid!="undefined"&&newRelationshipPid.length>0,eventType=$("#addFactSelect").val(),dateFieldVal="",placeFieldVal="",descriptionFieldVal="",modalHeaderTitle="",isPrimary=!1,saveEventDataObj="",isCreateRelationshipEvent=!1,newPersonPid="",url;PersonData.hasAddedNewSpouse=!1;PersonData.newAddedSpouseId="";isValidaNewRelationshipPID&&(isCreateRelationshipEvent=!0,newPersonPid=newRelationshipPid,PersonData.hasAddedNewSpouse=!0,PersonData.newAddedSpouseId=newRelationshipPid);typeof saveEventData!="undefined"&&saveEventData.length>0&&(saveEventDataObj=jQuery.parseJSON(saveEventData),eventType=saveEventDataObj.eventType,dateFieldVal=saveEventDataObj.dateField,placeFieldVal=saveEventDataObj.placeField,descriptionFieldVal=saveEventDataObj.descriptionField,modalHeaderTitle=saveEventDataObj.modalHeaderTitle,isPrimary=!1,saveEventDataObj.isAddNewSpouse==="true"&&(ResetWarningsAndValues(),FactEditModal.isAddNewSpouse=!0));url="/modals/addnewfact/tree/"+PersonData.treeId+"/person/"+PersonData.personId;$("<div>").modal({showLoading:!0,useCustomPadding:!0,onOpen:function($this){$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,data:{eventType:eventType,newPersonPid:newPersonPid},success:function(data){var addPerson,spouseCount,dateField,placeField,descriptionField,$iSpouseSelect,$indvSpouseSelect,locationField,modalEditEvent;data.result&&($.modal.showLoading(!1),$.modal.resize(760),resetModalContents(!0),isValidaNewRelationshipPID&&(addPerson=$("#AddPerson"),addPerson.length>0&&$("#AddPerson").remove()),$this.html(data.html),modalHeaderTitle.length>0?setupModalHeader(modalHeaderTitle):setupModalHeader(data.title),$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning),setupFactModalUserCard(),$.modal.center(),$("#factEditModalEvent").addClass("tabActive active"),$(".tabContent1").addClass("tabActive active"),spouseCount=parseInt(FactEditModal.person.spouseCount),isRelationshipEventType()&&(isValidaNewRelationshipPID||spouseCount>0)&&(dateField=$(".dateField"),dateField.length>0&&dateField.val(dateFieldVal),placeField=$(".placeField"),placeField.length>0&&placeField.val(placeFieldVal),descriptionField=$(".descriptionField"),descriptionField.length>0&&descriptionField.val(descriptionFieldVal),$iSpouseSelect=$("#individualSpouseSelect"),$iSpouseSelect.is(":visible")?($("#multipleSpouseSelect").is(":visible")&&spouseCount>1?($("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();"),$("#chooseOtherButton").hide()):($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")),$indvSpouseSelect=$iSpouseSelect.find(".existingSpouseIndividual"),$indvSpouseSelect.length>0&&$indvSpouseSelect.addClass("selectedPerson"),$("#multipleSpouseSelect").hide()):($indvSpouseSelect=$iSpouseSelect.find(".existingSpouseIndividual"),$indvSpouseSelect.length>0&&$indvSpouseSelect.removeClass("selectedPerson"),spouseCount<2&&($("#individualSpouseSelect").show(),$("#multipleSpouseSelect").hide()),$("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();"))),locationField=$("#location"),locationField.length>0&&factModalInitTypeAhead(PersonData.treeId,locationField),FactEditModal.eventType.toLowerCase()==="birth"||FactEditModal.eventType.toLowerCase()==="death"?$(".card").hasClass("preferredEvent"+FactEditModal.eventType)&&$("#preferredEventCheckbox").show():FactEditModal.eventType.toLowerCase()==="name"&&($("#preferredEventCheckbox").show(),FactEditModal.person.fatherSurname.length>0&&(modalEditEvent=$(".tabContent1"),modalEditEvent.find("#surname").val(FactEditModal.person.fatherSurname))),FactEditModal.eventType==="Gender"?($(".editModalSaveButton").removeAttr("disabled"),setAddNewFactCreateAction()):(FactEditModal.eventType==="Name"?$(".editModalSaveButton").removeAttr("disabled"):(isRelationshipEventType()&&dateFieldVal===""&&placeFieldVal===""&&descriptionFieldVal===""&&$(".editModalSaveButton").attr("disabled","disabled"),setupCreateOrSaveTextButton()),setFactActionWithValidate()),isValidaNewRelationshipPID?FactEditModal.isAddNewSpouse=!0:isRelationshipEventType()&&(setAddNewFactCreateAction(),spouseCount===0&&FactEditModal.isAddNewFact&&($("#chooseOtherButton").hide(),$(".addRelationships").show(),showSpouseTypeAheadSection(),$(".erAddCancel").hide())),setButtonandBannerBasedOnValidation(!1))}})}})}function setAddNewFactCreateAction(){$(".editModalSaveButton").attr("onClick","createNewEvent('tabContent1', 'editModalSaveButton');");$("#factEditModalEvent").attr("onClick","createNewEvent('tabContent1', 'factEditModalEvent');");$("#factEditModalAttachMedia").attr("onClick","createNewEvent('tabContent2', 'factEditModalAttachMedia');");$("#factEditModalSourceCitations").attr("onClick","createNewEvent('tabContent3', 'factEditModalSourceCitations');");$("#factEditModalTimelineOptions").attr("onClick","createNewEvent('tabContent4', 'factEditModalTimelineOptions');")}function setupModalHeader(modalTitle){var factEditModalHeader=$("#factEditModalHeader");factEditModalHeader.length>0?factEditModalHeader.find(".modalTitle").text(modalTitle):($("#modalHeader").length===0&&$("#modalContents").append('<h4 class="modalHeader" id="modalHeader"><\/h4>'),$("#modalHeader").text(modalTitle))}function ResetWarningsAndValues(){var modalEditEvent=$(".tabContent1");modalEditEvent.find(".eventAreaBanner").alert("close");modalEditEvent.find(".eventAreaBannerWarning").alert("close");resetValidationValues();setupCreateOrSaveTextButton()}function resetModalContents(){var loading=$(".loading"),modalContents,modalHeader,modalContainer;loading.length>0&&loading.remove();modalContents=$("#modalContents");modalContents.length>0&&(modalHeader=$("#modalHeader"),modalHeader.length>0&&modalHeader.remove(),modalContainer=$("#modalContainer"),modalContainer.length>0&&modalContainer.remove())}function createNewEvent(selectedContentArea,tabOrButtonItem){var modalEditEvent=$(".tabContent1"),modalEditEventActive=modalEditEvent.hasClass("tabActive"),selectedPerson=modalEditEvent.find(".selectedPerson"),isCreateRelationshipEvent=!1,eventType=FactEditModal.eventType,isPrimary=!1,eventChanged=!1,isFailedSpouseData=!1,dictionary=[],dataExtra,relTypeAheadVal,dateField,$checkBox,url;eventChanged=modalEditEventActive?checkFieldValidation(!0,!0,dictionary):!1;var relationshipEventType=isRelationshipEventType(),relationshipId=typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-assertionId")!="undefined"&&selectedPerson.attr("data-assertionId").length>0?selectedPerson.attr("data-assertionId"):"",isFindExistingPerson=!1;if(relationshipEventType&&(relationshipId==="0"||relationshipId.length===0)&&(dataExtra=typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-extra")!="undefined"&&selectedPerson.attr("data-extra").length>0?selectedPerson.attr("data-extra"):"",typeof dataExtra!="undefined"&&dataExtra.length>0&&(dataExtra=jQuery.parseJSON(dataExtra)),relationshipId=typeof dataExtra!="undefined"?dataExtra.PID:"",isCreateRelationshipEvent=!0,FactEditModal.originalSpouseId=relationshipId,isFindExistingPerson=!0),relTypeAheadVal="false",relationshipEventType&&relationshipId!=null&&relationshipId!==""&&(relTypeAheadVal=typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-isTypeAhead")!="undefined"&&selectedPerson.attr("data-isTypeAhead").length>0?selectedPerson.attr("data-isTypeAhead"):isFindExistingPerson?"true":"false",relTypeAheadVal==="true"&&(isCreateRelationshipEvent=!0),FactEditModal.originalSpouseId=relationshipId),!FactEditModal.hasValidationWarningAgainstSpouseData&&relationshipEventType&&(dateField=modalEditEvent.find(".dateField").val(),typeof dateField!="undefined"&&dateField.length>0&&(eventChanged=validateRelationshipEventAgainstSpouseData(selectedPerson,eventType,dateField,!0,isFailedSpouseData),isFailedSpouseData=!eventChanged,FactEditModal.hasValidationWarningAgainstSpouseData=isFailedSpouseData)),eventChanged){var titleField=typeof dictionary.title!="undefined"?dictionary.title.value:"",dateField=typeof dictionary.date!="undefined"?dictionary.date.value:"",placeField="",placeFieldDataExtra="";typeof dictionary.location!="undefined"&&(placeField=dictionary.location.value,typeof dictionary.location.extra!="undefined"&&(placeFieldDataExtra=dictionary.location.extra));var descriptionField=typeof dictionary.description!="undefined"?dictionary.description.value:"",valueField=typeof dictionary.value!="undefined"?dictionary.value.value:"",givenNameField=typeof dictionary.givenName!="undefined"?dictionary.givenName.value:"",surnameField=typeof dictionary.surname!="undefined"?dictionary.surname.value:"",suffixNameField=typeof dictionary.suffix!="undefined"?dictionary.suffix.value:"",genderTypeField=typeof dictionary.genderMale!="undefined"?"Male":typeof dictionary.genderFemale!="undefined"?"Female":"Unknown";handleButtonsSavingMode();FactEditModal.isPrimary&&(isPrimary=!0);$checkBox=modalEditEvent.find(".isPrimaryCheckbox");$checkBox.length>0&&$checkBox.is(":checked")&&(isPrimary=!0);url="/tree/"+PersonData.treeId+"/person/"+PersonData.personId+"/createnewevent";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,data:{eventType:eventType,customEventTitle:titleField,date:dateField,place:placeField,description:valueField!=null&&valueField.length>0?valueField:descriptionField,relationshipId:relationshipId,relTypeAhead:relTypeAheadVal,isPrimary:isPrimary,givenName:givenNameField,surname:surnameField,suffixName:suffixNameField,genderType:genderTypeField},success:function(data){var fullname,hasBirth,hasDeath,hasLifeStoryOptions,cancelClose;if(handleButtonsNormalMode(),data.result&&typeof data.assertionId!="undefined"){if(resetModalContents(!1),typeof isPrimary!="undefined"&&isPrimary===!0&&(eventType.toString()==="Birth"||eventType.toString()==="Death"||eventType.toString()==="Name"))if(eventType.toString()==="Name")typeof surnameField!="undefined"&&(fullname=(givenNameField.length>0?givenNameField:"")+(surnameField.length>0?(givenNameField.length>0?" ":"")+surnameField:"")+(suffixNameField.length>0?" "+suffixNameField:""),$("#personCard .userCardTitle").html(fullname),PersonCard.name=fullname,handleFactModalUserCardData(".userCardTitle",fullname));else if(hasBirth=PersonCard.lifeYearRange.indexOf("&ndash;")>0||PersonCard.lifeYearRange.indexOf("-")>0,hasDeath=(PersonCard.lifeYearRange.indexOf("&ndash;")===0||PersonCard.lifeYearRange.indexOf("-")===0)&&PersonCard.lifeYearRange.length>7||PersonCard.lifeYearRange.length>11,!PersonCard.isFamilySearchUser||(hasBirth||eventType.toLowerCase()!=="birth")&&(hasDeath||eventType.toLowerCase()!=="death")){var splitYears=PersonCard.lifeYearRange.indexOf("&ndash;")!==-1?PersonCard.lifeYearRange.split("&ndash;"):PersonCard.lifeYearRange.split("-"),eventResults=validDate(dateField,eventType.toString().toLowerCase(),FactEditModal.person.personBirth,FactEditModal.person.personDeath,FactEditModal.person.motherBirth,FactEditModal.person.motherDeath,FactEditModal.person.fatherBirth,FactEditModal.person.fatherDeath,!1),dateSet="";typeof dateField!="undefined"&&typeof placeField!="undefined"&&eventType.toString()==="Birth"?(window.getPersonCard(),dateSet=(eventResults[0]===0?eventResults[1]:splitYears.length>0&&hasBirth?splitYears[0]:"")+"&ndash;"+(splitYears.length>0&&hasDeath?splitYears.length>1?splitYears[1]:splitYears[0]:""),PersonCard.lifeYearRange=dateSet,dateSet.length>1&&dateSet!=="&ndash;"?handleFactModalUserCardData(".userCardSubTitle","("+dateSet.replace("&ndash;","-")+")"):handleFactModalUserCardData(".userCardSubTitle","")):typeof dateField!="undefined"&&typeof placeField!="undefined"&&eventType.toString()==="Death"&&(window.getPersonCard(),dateSet=(splitYears.length>0&&hasBirth?splitYears[0]:"")+"&ndash;"+(eventResults[0]===0?eventResults[1]:splitYears.length>0&&hasDeath?splitYears.length>1?splitYears[1]:splitYears[0]:""),PersonCard.lifeYearRange=dateSet,dateSet.length>1&&dateSet!=="&ndash;"?handleFactModalUserCardData(".userCardSubTitle","("+dateSet.replace("&ndash;","-")+")"):handleFactModalUserCardData(".userCardSubTitle",""))}else location.reload();tabOrButtonItem!=="editModalSaveButton"&&tabOrButtonItem!=="factEditModalEvent"?(hasLifeStoryOptions=!0,(eventType.toLowerCase()!=="birth"&&eventType.toLowerCase()!=="death"||isPrimary)&&eventType.toLowerCase()!=="name"&&eventType.toLowerCase()!=="gender"||(hasLifeStoryOptions=!1),factEditModal(PersonData.treeId,PersonData.personId,data.assertionId,hasLifeStoryOptions,tabOrButtonItem,selectedContentArea,"","",!0)):$.modal.close();isCreateRelationshipEvent&&showIndividualSpouse();window.glue.reload()}else cancelClose=$(".cancelClose"),cancelClose.length>0&&cancelClose.show(),setButtonandBannerBasedOnValidation(!0)},error:function(xhr,ajaxOptions,thrownError){throwException("status->"+xhr.status+" thrownError->"+thrownError);handleButtonsNormalMode()}})}else setButtonandBannerBasedOnValidation(!0)}function generateNarrativeDataModal(assertionid){var modalNarrative=$(".tabContent4");modalNarrative.addClass("loading").find(".narrativeDataFields").hide();modalNarrative.find(".narrativeField").val("");savePersonNarrativeAndEventDataModal(assertionid,"","",!1)}(function(){window.PersonData||(window.PersonData={})})();typeof personViewModalAlertSettingsNote=="undefined"&&(window.personViewModalAlertSettingsNote={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"note"},personViewModalAlertSettingsInfo={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"info"},personViewModalAlertSettingsSuccess={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"success"},personViewModalAlertSettingsWarning={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"warning"});
"use strict";function connectLines(el){var factItem=$(el),factItems=$(".factsSectionFactsAndSources .factItem."+el.id),animateLines=!0;$(".factItem[data-toggled-off]").length===1&&(animateLines=!1);factItem.belay(factItems,{animate:animateLines,strokeColor:"#897ea2",distinct:!0,callback:belayCallbackEndFacts});animateLines===!1&&(animateLines=!0);$(".factItem[data-toggled-off]").removeAttr("data-toggled-off")}function belayCallbackEndFacts(){var activeElement=$(".factItemSelected").attr("id"),$relatedElements=$("."+activeElement);$relatedElements.addClass("cardOutline2 factItemFocused")}function reconnectLines(){typeof Belay!="undefined"&&(Belay.off(),$(".factsSectionFactsAndSources .factItemSelected").each(function(){$("#"+this.id).belay($("."+this.id),{animate:!1,strokeColor:"#897ea2"})}),$(".factItem[data-toggled-off]").removeAttr("data-toggled-off"))}function checkFieldValidation(checkChanged,showBanner,dictionary){var modalEditEvent=$(".tabContent1"),selectedPerson=modalEditEvent.find(".selectedPerson"),requiredFields=0,emptyRequiredFields=0,fields=0,emptyFields=0,changed=!1,$checkBox,sid;return modalEditEvent.find(".factField").each(function(){var $field=$(this),fState=$field.data("state"),val=$field.val(),originalValue,currentValue,extra;$field.hasClass("requiredField")?requiredFields++:fields++;$field.attr("name")!=="gender"&&(val?(fState=="0"&&(fState=validateField($field.get(0))),fState=="4"||fState=="3"?showBanner&&(FactEditModal.validationWarningMessage=FactEditModal.validationWarningMessage.length===0?$field.data("msg"):FactEditModal.validationWarningMessage+" "+$field.data("msg"),fState=="3"?FactEditModal.hasValidationDateWarning=!0:fState=="4"&&(FactEditModal.hasValidationWarning=!0)):fState=="2"||fState=="1"):$field.hasClass("requiredField")?emptyRequiredFields++:emptyFields++);checkChanged&&($field.attr("name")!=="gender"||$field.is(":checked"))&&(originalValue=typeof $field.data("original-value")!="undefined"?$field.data("original-value"):"",currentValue=$field.val(),originalValue!=currentValue&&(changed=!0),extra=typeof $field.data("extra")!="undefined"?$field.data("extra"):"",dictionary[$field.attr("id")]={value:currentValue,origValue:originalValue,extra:extra})}),checkChanged&&($checkBox=modalEditEvent.find(".isPrimaryCheckbox"),$checkBox.length>0&&$checkBox.is(":checked")&&$checkBox.data("original-isprimary")==!1&&(changed=!0)),isRelationshipEventType()&&(typeof selectedPerson=="undefined"||selectedPerson.length===0?checkChanged&&!FactEditModal.isAddNewFact&&typeof FactEditModal.originalSpouseId!="undefined"&&FactEditModal.originalSpouseId.length>0?changed=!0:showBanner&&(FactEditModal.hasValidationWarningToSelectSpouse=!0):checkChanged&&(typeof FactEditModal.originalSpouseId=="undefined"||FactEditModal.originalSpouseId.length===0?changed=!0:(sid=selectedPerson.data("assertionid"),FactEditModal.originalSpouseId!=sid&&(changed=!0)))),(emptyRequiredFields>0||fields===emptyFields)&&(showBanner&&PersonResearch.hasEditRights&&(FactEditModal.validationErrorMessage=getWarningMessage(requiredFields>0&&requiredFields===emptyRequiredFields,fields===emptyFields)),FactEditModal.hasValidationError=!0,changed=!1),changed}function setFieldValidationValues(dictionary){var modalEditEvent=$(".tabContent1");modalEditEvent.find(".factField").each(function(){var $field=$(this),field;$field.attr("name")=="gender"?(field=dictionary[$field.attr("id")],field!="undefined"?($field.attr("checked",!0),$field.data("state",1),$field.val(field.value),$field.data("original-value",field.value)):($field.attr("checked",!1),$field.data("state",0),$field.val(""),$field.data("original-value",""))):(field=dictionary[$field.attr("id")],field!="undefined"?($field.data("state",field.value.length===0?0:1),$field.val(field.value),$field.data("original-value",field.value),field.extra.length>0&&$field.data("extra",field.extra)):($field.data("state",0),$field.val(""),$field.data("original-value",""),$field.data("extra","")))})}function resetValidationValues(){FactEditModal.hasValidationWarning=!1;FactEditModal.hasValidationDateWarning=!1;FactEditModal.validationWarningMessage="";FactEditModal.hasValidationError=!1;FactEditModal.validationErrorMessage="";FactEditModal.hasValidationWarningToSelectSpouse=!1}function setButtonBasedOnValidation(){!FactEditModal.hasValidationError&&(FactEditModal.hasValidationWarning||FactEditModal.hasValidationDateWarning||FactEditModal.hasValidationWarningToSelectSpouse)?(setupCreateOrSaveAnywayTextButton(),$(".editModalSaveButton").removeAttr("disabled")):(setupCreateOrSaveTextButton(),FactEditModal.hasValidationError?$(".editModalSaveButton").attr("disabled","disabled"):$(".editModalSaveButton").removeAttr("disabled"))}function setupCreateOrSaveTextButton(){FactEditModal.isAddNewFact?$(".editModalSaveButton").text(FactEditModal.text.create):$(".editModalSaveButton").text(FactEditModal.text.saveChanges)}function setupCreateOrSaveAnywayTextButton(){(isRelationshipEventType()||!isDatePlaceEventType())&&$(".editModalSaveButton").unbind("click");FactEditModal.isAddNewFact?$(".editModalSaveButton").text(FactEditModal.text.createAnyway):$(".editModalSaveButton").text(FactEditModal.text.saveAnyway);$(".editModalSaveButton").removeAttr("disabled")}function overrideValidation(){isRelationshipEventType()&&$(".editModalSaveButton").unbind("click");FactEditModal.warningMessage.length>0&&typeof $(".editModalSaveButton").attr("disabled")=="undefined"?setupCreateOrSaveAnywayTextButton():setupCreateOrSaveTextButton();resetValidationValues();FactEditModal.isAddNewFact&&setAddNewFactCreateAction();FactEditModal.warningMessage=""}function validationCheck(eventType,eventResults){var returnValues={hasValidationWarning:!1,validationMessage:""},dateMonthYear,dateSplit;return eventResults[0]!==0&&(returnValues.hasValidationWarning=!0,returnValues.validationMessage=FactEditModal.text.warnDateMayBeWrong),dateMonthYear=FactEditModal.person.dateStamp,dateMonthYear.length>0?(dateSplit=dateMonthYear.split(","),eventResults[2]!=null&&typeof eventResults[2]!="undefined"&&eventResults[1]===dateSplit[2]&&parseInt(eventResults[2])>parseInt(dateSplit[1])||eventResults[2]!=null&&typeof eventResults[2]!="undefined"&&eventResults[1]===dateSplit[2]&&parseInt(eventResults[2])===parseInt(dateSplit[1])&&eventResults[3]!=null&&parseInt(eventResults[3])>parseInt(dateSplit[0])?(returnValues.hasValidationWarning=!0,returnValues.validationMessage=FactEditModal.text.warnDateMayBeWrong+" "+FactEditModal.text.warnDateIsInFuture):eventResults[1].length>0&&(returnValues.validationMessage=returnValues.validationMessage.length>0?returnValues.validationMessage+" "+eventResults[1]:eventResults[1])):eventResults[1].length>0&&(returnValues.validationMessage=returnValues.validationMessage.length>0?returnValues.validationMessage+" "+eventResults[1]:eventResults[1]),returnValues}function setValidationWarningDateIsInFuture(returnValues){returnValues.eventChanged=!1;returnValues.hasValidationWarning=!0;returnValues.validationMessage=FactEditModal.text.warnDateMayBeWrong+" "+FactEditModal.text.warnDateIsInFuture}function addSourceModal(){$("#modalAddSource").modal({width:"410",title:PersonResearch.menu.sources.addSourceTitle,onOpen:function(){$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning)},onClose:function(){$(".addModalTriggered").removeClass("addModalTriggered").focus()}})}function factModalInitTypeAhead(treeId,locationField){locationField.autocomplete({source:"/suggest/place?treeId="+treeId+"&tad=none",key:"placeName",queryParameter:"term",dataType:"json",minLength:3,maxResults:12,customDisplay:function(data){return{value:data.value,display:data.display}},onItemSelect:function(itemData){var $this,$card;itemData!==""&&($this=$(this),itemData.PID!=""&&($card=$this.closest(".card"),$card.find(".erAddExistingData").data("itemData",itemData),$card.find(".erAddSave").prop("disabled",!1)))},onOpen:!1,onClose:!1})}function factEditModal(treeId,personId,assertionId,hasLifeStoryOptions,tabActivate,contentActivate,addPersonNewPID,saveEventData,isFromCreateEvent){var isValidNewAddPersonId=typeof addPersonNewPID!="undefined"&&addPersonNewPID!=null&&addPersonNewPID.length>0,dateFieldVal="",placeFieldVal="",descriptionFieldVal="",isPrimary=!1,eventType="",newPersonPid="",saveEventDataObj,url;PersonResearch.hasAddedNewSpouse=!1;PersonResearch.newAddedSpouseId="";isValidNewAddPersonId&&(newPersonPid=addPersonNewPID,PersonResearch.hasAddedNewSpouse=!0,PersonResearch.newAddedSpouseId=addPersonNewPID,typeof saveEventData!="undefined"&&saveEventData.length>0&&(saveEventDataObj=jQuery.parseJSON(saveEventData),eventType=saveEventDataObj.eventType,dateFieldVal=saveEventDataObj.dateField,placeFieldVal=saveEventDataObj.placeField,descriptionFieldVal=saveEventDataObj.descriptionField,isPrimary=!1,saveEventDataObj.isAddNewSpouse==="true"&&($(".editModalSaveButton").unbind("click"),ResetWarningsAndValues(),FactEditModal.isAddNewSpouse=!0)));url="/modals/factedit/tree/"+treeId+"/person/"+personId+"/assertionid/"+assertionId;$("<div>").modal({showLoading:!0,useCustomPadding:!0,onOpen:function($this){$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,data:{hasLifeStoryOptions:hasLifeStoryOptions,newPersonPid:newPersonPid},success:function(data){var spouseCount,dateField,placeField,descriptionField,$indvSpouseSelect,$sortingDivTopAlert,$sortingDivBottomAlert,locationField,openTab,modalHeader,cancelClose,factItem,modalEditEvent,selectedPerson,preferredStored,preferredEventStored,individualSpouseSelect,multipleSpouseSelect,displayLifeStory,displayLifeStoryVal;if(data.result){if($.modal.showLoading(!1),$.modal.resize(760),$this.html(data.html),$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning),sortingCardOutlineHover(),!isValidNewAddPersonId&&isRelationshipEventType()&&$(".editModalSaveButton").unbind("click"),spouseCount=parseInt(FactEditModal.person.spouseCount),isValidNewAddPersonId&&(dateField=$(".dateField"),dateField.length>0&&dateField.val(dateFieldVal),placeField=$(".placeField"),placeField.length>0&&placeField.val(placeFieldVal),descriptionField=$(".descriptionField"),descriptionField.length>0&&descriptionField.val(descriptionFieldVal),$("#individualSpouseSelect").show(),$("#selectedSpouse-individual").removeClass("selectedPerson"),$indvSpouseSelect=$(".existingSpouseIndividual"),$indvSpouseSelect.length>0&&$indvSpouseSelect.addClass("selectedPerson"),$("#multipleSpouseSelect").hide(),spouseCount>1?($("#changeSpouseButton").show().attr("onclick","showMultipleSpouseSelect();"),$("#chooseOtherButton").hide()):($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onclick","showSpouseTypeAheadSection();")),FactEditModal.warningMessage="",FactEditModal.hasValidationWarningToSelectSpouse=!1,FactEditModal.isAddNewSpouse=!1),typeof FactEditModal!="undefined"&&$(".modalEditEvent .iconRotateRight").callout({position:"left",type:"click",classes:"calloutGenerateNarrative",content:"#generateNarrativeCalloutDomContent",onAfterOpen:function(){$("#callout").on("click",".closeCallouts",function(){closeCallouts()})},style:"dark"}),$(".modalEditEvent .removeButton").callout({position:"top",style:"dark",type:"click",classes:"calloutRemoveEvent",content:"#removeEventCalloutDomContent",onAfterOpen:function(){$("#callout").on("click",".closeCallouts",function(){closeCallouts()})}}),sortingCardOutlineHover(),$sortingDivTopAlert=$("#source_sortingDivTop .alert"),$sortingDivBottomAlert=$("#source_sortingDivBottom .alert"),$sortingDivTopAlert.alert(personViewModalAlertSettingsNote),$sortingDivBottomAlert.alert(personViewModalAlertSettingsNote),$.cachedScript(PersonResearch.animateCardUrl).done(function(){$("#source_sortingDivBottom").animateCard({items:".card",animateMove:{afterAnimate:function(item){item.find(".sortingIcon").hasClass("iconAdd")?(item.removeClass("cardOutline2").addClass("attached"),PersonResearch.hasEditRights&&item.find(".sortingIcon").removeClass("iconAdd noHover").addClass("iconClose")):(item.removeClass("cardOutline2").removeClass("attached"),PersonResearch.hasEditRights&&item.find(".sortingIcon").removeClass("iconClose noHover").addClass("iconAdd"))},beforeAnimate:function(item){item.find(".card").addClass("cardOutline2")},connectWith:"#source_sortingDivTop",emptyContent:".alertNote"},onListEmpty:function(emptyList){emptyList.find(".alertNote").alert("open")},onEmptyListAdd:function(list){list.find(".alertNote").alert("close")}})}),$("#source_sortingDivTop .card").length===0&&$sortingDivTopAlert.alert("open"),$("#source_sortingDivBottom .card").length===0&&$sortingDivBottomAlert.alert("open"),locationField=$("#location"),locationField.length>0&&factModalInitTypeAhead(treeId,locationField),openTab=0,typeof PersonResearch.openOnLoadTab!="undefined"&&(openTab=parseInt(PersonResearch.openOnLoadTab)),PersonResearch.openOnLoadTab=0,(FactEditModal.isAddNewFact||typeof isFromCreateEvent!="undefined"&&isFromCreateEvent)&&(typeof tabActivate!="undefined"&&tabActivate!=null&&tabActivate.length>0&&typeof contentActivate!="undefined"&&contentActivate!=null&&contentActivate.length>0?(modalHeader=$("#modalHeader"),modalHeader.length>0&&modalHeader.remove(),tabActivate!=="factEditModalEvent"&&tabActivate!=="editModalSaveButton"&&($("#factEditModalEvent").removeClass("tabActive active"),$(".tabContent1").removeClass("tabActive active")),$("#"+tabActivate).hasClass("tabActive active")||$("#"+tabActivate).addClass("tabActive active"),contentActivate!=="tabContent1"&&$(".tabContent1").removeClass("tabActive active"),$("."+contentActivate).hasClass("tabActive active")||$("."+contentActivate).addClass("tabActive active"),PersonResearch.openOnLoadTab=contentActivate==="tabContent2"?1:contentActivate==="tabContent3"?2:0,openTab=PersonResearch.openOnLoadTab,cancelClose=$(".cancelClose"),cancelClose.length>0&&cancelClose.text(FactEditModal.text.close),setFactModalTabsClick(!0)):($("#factEditModalEvent").addClass("tabActive active"),$(".tabContent1").addClass("tabActive active"))),$("#modalContainer .tabs").tabs({activeIndex:openTab,onOpen:!1}),modalButtonClick(),setupFactModalUserCard(),factItem=$("#fi"+assertionId),modalEditEvent=$(".tabContent1"),modalEditEvent.length>0&&openTab===0)if(selectedPerson=modalEditEvent.find(".selectedPerson"),isRelationshipEventType()&&selectedPerson.length===0&&(selectedPerson=modalEditEvent.find(".selectedPerson")),!isValidNewAddPersonId&&isRelationshipEventType()&&FactEditModal.originalSpouseId.length===0&&selectedPerson.length>0&&resetIndividualSpouseNode(selectedPerson,0),(FactEditModal.eventType.toLowerCase()==="birth"||FactEditModal.eventType.toLowerCase()==="death"||FactEditModal.eventType.toLowerCase()==="name")&&(factItem.hasClass("preferredEvent"+FactEditModal.eventType)?(modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!0),modalEditEvent.find(".isPrimaryCheckbox").attr("data-original-isprimary","true"),$("#preferredEventButtonLabel").show(),FactEditModal.eventType.toLowerCase()!=="name"&&$("#factEditModalTimelineOptions").css("display","")):($("#preferredEventCheckbox").show(),modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!1))),retrieveStoredFactValues(factItem,".givenNameStored"+assertionId,modalEditEvent,"#givenName"),retrieveStoredFactValues(factItem,".surnameStored"+assertionId,modalEditEvent,"#surname"),retrieveStoredFactValues(factItem,".suffixStored"+assertionId,modalEditEvent,"#suffix"),preferredStored=factItem.find(".preferredStored"+assertionId),preferredStored.length>0&&(preferredStored.val()==="true"&&factItem.hasClass("preferredEvent"+FactEditModal.eventType)?modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!0):modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!1)),retrieveStoredFactValues(factItem,".dateStored"+assertionId,modalEditEvent,"#date"),retrieveStoredFactValues(factItem,".placeStored"+assertionId,modalEditEvent,"#location"),retrieveStoredFactValues(factItem,".descriptionStored"+assertionId,modalEditEvent,"#description"),preferredEventStored=factItem.find(".preferredEventStored"+assertionId),preferredEventStored.length>0&&(preferredEventStored.val()==="true"&&factItem.hasClass("preferredEvent"+FactEditModal.eventType)?modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!0):modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!1)),individualSpouseSelect=modalEditEvent.find("#individualSpouseSelect"),isRelationshipEventType()&&(typeof newPersonPid=="undefined"||typeof newPersonPid!="undefined"&&newPersonPid.length===0)&&FactEditModal.originalSpouseId.length===0)selectedPerson.length>0&&resetIndividualSpouseNode(selectedPerson,0),modalEditEvent.find(".eventAreaBannerWarning").alert("close"),ResetWarningsAndValues(),multipleSpouseSelect=modalEditEvent.find("#multipleSpouseSelect"),spouseCount===1?(individualSpouseSelect.hide(),multipleSpouseSelect.show(),$("#singleScenarioSpouseSelect").show(),$("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").hide(),$("#chooseOtherButton").show().attr("onclick","showSpouseTypeAheadSection();")):spouseCount>1?(individualSpouseSelect.hide(),$("#spouseText").hide(),$("#selectSpouseForEventText").show(),multipleSpouseSelect.show(),$("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").hide(),$("#chooseOtherButton").show().attr("onclick","showSpouseTypeAheadSection();")):($("#chooseOtherButton").hide(),$(".addRelationships").show(),showSpouseTypeAheadSection(),$(".erAddCancel").hide()),setEditModalSaveButtonClick();else if(isRelationshipEventType()&&typeof newPersonPid!="undefined"&&newPersonPid.length>0){if(spouseCount===1&&setIndividualSpouseData(modalEditEvent,".singleScenarioSpouseSelect"),!showIndividualSpouse())return;individualSpouseSelect=$(".existingSpouseIndividual");individualSpouseSelect.length>0&&individualSpouseSelect.addClass("selectedPerson");(spouseCount===0||spouseCount===1)&&($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onclick","showSpouseTypeAheadSection();"));setEditModalSaveButtonClick()}$(".tabContent4").find(".narrativeDataFields").hide();displayLifeStory=$(".tabContent4").find(".displayLifestory");displayLifeStory.length>0&&(displayLifeStoryVal=displayLifeStory.prop("checked"),displayLifeStory.data("original-displaylifestory",displayLifeStoryVal.toString()));FactEditModal.eventType==="Gender"?($(".editModalSaveButton").removeAttr("disabled"),setFactModalTabsClick(!0)):FactEditModal.eventType==="Name"?(modalEditEvent.find(".eventAreaBannerWarning").alert("close"),setFactModalTabsClick(!0)):typeof tabActivate!="undefined"&&tabActivate!=null&&tabActivate.length>0&&typeof contentActivate!="undefined"&&contentActivate!=null&&contentActivate.length>0||setButtonandBannerBasedOnValidation(!1);setButtonBasedOnValidation()}$("#modalClose").length===0&&$("#modalContents").prepend('<button type="button" title="Close modal" id="modalClose" class="closeBtn"><\/button>')}})},onClose:function(){$(".factItemSelected").focus()}})}function retrieveStoredFactValues(factItem,storedAccessor,modalArea,fieldId){var storedValue=factItem.find(storedAccessor);storedValue.length>0&&modalArea.find(fieldId).val(storedValue.val())}function sourceEditModal(treeId,personId,sourceId,formId){var url="/modals/sourceedit/tree/"+treeId+"/person/"+personId+"/sourceid/"+sourceId;$("<div>").modal({showLoading:!0,useCustomPadding:!0,onOpen:function($this){$.ajax({type:"GET",url:url,data:$("#FormSourceItem"+formId+" :input").serialize(),cache:!1,timeout:2e4,success:function(data){var $sortingDivTopAlert,$sortingDivBottomAlert,openTab;$.modal.showLoading(!1);$.modal.resize(760);$this.html(data);$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning);sortingCardOutlineHover();$sortingDivTopAlert=$("#fact_sortingDivTop .alert");$sortingDivBottomAlert=$("#fact_sortingDivBottom .alert");$sortingDivTopAlert.alert(personViewModalAlertSettingsNote);$sortingDivBottomAlert.alert(personViewModalAlertSettingsNote);$.cachedScript(PersonResearch.animateCardUrl).done(function(){$("#fact_sortingDivBottom").animateCard({animateMove:{afterAnimate:function(item){item.find(".sortingIcon").hasClass("iconAdd")?(item.removeClass("cardOutline2").addClass("attached"),PersonResearch.hasEditRights&&item.find(".sortingIcon").removeClass("iconAdd noHover").addClass("iconClose")):(item.removeClass("cardOutline2").removeClass("attached"),PersonResearch.hasEditRights&&item.find(".sortingIcon").removeClass("iconClose noHover").addClass("iconAdd"))},beforeAnimate:function(item){item.find(".card").addClass("cardOutline2")},connectWith:"#fact_sortingDivTop",emptyContent:".alertNote"},items:".card",onListEmpty:function(emptyList){emptyList.find(".alertNote").alert("open")},onEmptyListAdd:function(list){list.find(".alertNote").alert("close")}})});$("#fact_sortingDivTop .card").length===0&&$sortingDivTopAlert.alert("open");$("#fact_sortingDivBottom .card").length===0&&$sortingDivBottomAlert.alert("open");typeof SourceEditModal!="undefined"&&$(".modalEditSource .removeButton").callout({classes:"calloutRemoveSource",content:"#removeSourceCalloutDomContent",onAfterOpen:function(){$("#callout").on("click",".closeCallouts",function(){closeCallouts()})},position:"top",style:"dark",type:"click"});openTab=0;typeof PersonResearch.openOnLoadTab!="undefined"&&(openTab=parseInt(PersonResearch.openOnLoadTab));PersonResearch.tabName==="Media"&&(sourceEditModalAttachedMedia(PersonResearch.treeId,PersonResearch.personId,sourceId),openTab=SourceEditModal.hasRecord?3:2);$("#modalContainer .tabs").tabs({activeIndex:openTab,onOpen:!1});modalButtonClick();updateModalTitle($(".sourceEditModaltitle").val(),$(".citationDetailTitle").val(),$(".associatedFactsEventsTitle").val(),$(".attachedMediaTitle").val());$("#sourceEditModalFacts").on("click",function(){sourceEditModalFacts()});$("#sourceEditModalAttachMedia").on("click",function(){sourceEditModalAttachedMedia(PersonResearch.treeId,PersonResearch.personId,sourceId)})}})},onClose:function(){$(".factItemSelected").focus();PersonResearch.tabName==="Media"&&window.glue.reload()}})}function toggleShowFamilyEvents(treeId,personId){toggleFactsCheckedMenuItem("#factsFamilyEvents");var toggleUrl="/tree/"+treeId+"/person/"+personId+"/tab/facts/toggleShowFamilyEvents";$.ajax({url:toggleUrl,method:"GET",cache:!1,success:function(){window.glue.reload()}})}function toggleShowAlternateEvents(treeId,personId){toggleFactsCheckedMenuItem("#factsAlternateEvents");var toggleUrl="/tree/"+treeId+"/person/"+personId+"/toggleShowAlternateEvents";$.ajax({url:toggleUrl,method:"GET",cache:!1,success:function(){window.glue.reload()}})}function toggleShowHistoricalInsights(treeId,personId){toggleFactsCheckedMenuItem("#factsHistoricalInsights");var toggleUrl="/tree/"+treeId+"/person/"+personId+"/tab/facts/toggleShowHistoricalInsights";$.ajax({url:toggleUrl,method:"GET",cache:!1,success:function(){window.glue.reload()}})}function toggleFactsCheckedMenuItem(idVal){var factsMenuItem=$(idVal);factsMenuItem.hasClass("calloutMenuChecked")?(factsMenuItem.removeClass("calloutMenuChecked"),factsMenuItem.addClass("calloutMenuUnchecked loading loadingSmall loadingOnBlack")):(factsMenuItem.removeClass("calloutMenuUnchecked"),factsMenuItem.addClass("calloutMenuChecked loading loadingSmall loadingOnBlack"));factsMenuItem.closest(".factsOptionsMenu").addClass("factsOptionsMenuDisabled")}var personViewModalAlertSettingsNote={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"note"},personViewModalAlertSettingsInfo={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"info"},personViewModalAlertSettingsSuccess={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"success"},personViewModalAlertSettingsWarning={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"warning"},initialize=function(){$.extend(PersonResearch,{selected:null});$(".optionsButtonFacts.iconArrowSmallDownAfter").callout({type:"click",classes:"calloutMenu factsOptionsCallout",content:"#factsOptionsCalloutDomContent",style:"dark"});$(".calloutContent").hasClass("factsOptionsCallout")&&((window.personScreenType("not-large-screen")||window.personScreenType("large-screen"))&&$(".optionsButtonFacts.hide480").callout("close").callout("open"),window.personScreenType("smart-phone")&&$(".optionsButtonFacts.show480").callout("close").callout("open"),window.personScreenType("smart-phone-portrait")&&$(".optionsButtonFacts.show320").callout("close").callout("open"));$("button.optionsButtonSources:not(.disabled)").callout({type:"click",classes:"calloutMenu sourcesOptionsCallout",content:"#sourcesOptionscalloutDomContent",onAfterOpen:function(){$(".sourcesOptionsMenu").on("click",".addModalTrigger",function(){$(".optionsButtonSources").addClass("addModalTriggered")})},style:"dark"});$("button.optionsButtonFamily.optionsButton:not(.disabled)").callout({type:"click",classes:"familyOptionsCallout",content:"#familyOptionscalloutDomContent",onAfterOpen:function(){$(".familyOptionsMenu").on("click",".link",function(){$(".optionsButtonFamily.optionsButton").addClass("addFamModalTriggered")})},style:"dark"});$(".optionsButtonFamily:not(.optionsButton)").callout({type:"click",classes:"familyOptionsCallout",content:"#familyOptionscalloutDomContent",onAfterOpen:function(){$(".familyOptionsMenu").on("click",".link",function(){$(".optionsButtonFamily:not(.optionsButton)").addClass("addFamModalTriggered")})},position:"top",style:"dark"});var doubleClick=!1,enterPressed=!1;$(".personPageFacts").off("click").off("dblclick").on("belay.on",".connectFact",function(){var factItem=$(this);factItem.addClass("bgColor2 bgDark cardSelected factItemFocused factItemSelected").find(".cardActions a").addClass("bgDark");factItem.hasClass("factItemWeblink")||connectLines(factItem.get(0))}).on("belay.off",".connectFact",function(){$(".factItemFocused").removeClass("bgColor2 bgDark cardSelected factItemFocused factItemSelected cardOutline2").find(".cardActions a").removeClass("bgDark");typeof Belay!="undefined"&&Belay.off()}).on("mousedown",".cardHasSelectAction.connectFact.factItemSelected",function(e){e.preventDefault()}).on("keypress",".cardHasSelectAction.connectFact.factItemSelected",function(e){(e.which===13||e.which===32)&&(e.preventDefault(),enterPressed===!1?$(this).trigger("click.off"):$(this).trigger("dblclick"))}).on("keypress",".cardHasSelectAction.connectFact:not(.factItemSelected)",function(e){(e.which===13||e.which===32)&&(e.preventDefault(),enterPressed=!0,$(this).trigger("click.on"),setTimeout(function(){enterPressed=!1},300))}).on("click.off",".cardHasSelectAction.connectFact.factItemSelected",function(e){e.preventDefault();var factItem=$(this);setTimeout(function(){doubleClick===!1&&factItem.trigger("belay.off")},300)}).on("click.on",".cardHasSelectAction.connectFact:not(.factItemSelected)",function(e){e.preventDefault();var factItem=$(this);doubleClick=!1;$(".connectFact.factItemSelected").trigger("belay.off");PersonResearch.scriptLoaded?factItem.trigger("belay.on"):$.cachedScript(PersonResearch.cacheUrl+"/lib/d3/d3-3.4.11.min.js").done(function(){$.cachedScript(PersonResearch.belayFileUrl).done(function(){PersonResearch.scriptLoaded=!0;factItem.trigger("belay.on")})})}).on("dblclick",".cardHasSelectAction.connectFact",function(e){var factItem,allowEditOrView,hasLifeStoryOptions,formId;if(doubleClick=!0,setTimeout(function(){doubleClick=!1},1e3),factItem=$(this),factItem.hasClass("factItemWeblink"))editWebLinkModal(factItem);else{var factsSection=factItem.closest(".factsSection"),assertionId=factItem.attr("id").replace("fi",""),sourceid=factItem.attr("id").replace("si","");factsSection.hasClass("factsSectionFacts")&&(allowEditOrView=factItem.find(".allowEditOrView").val(),allowEditOrView==="true"&&typeof factEditModal!="undefined"&&(hasLifeStoryOptions=factItem.find(".hasLifestoryOptions").val(),assertionId==="UnknownGender"&&(assertionId="99"),newFactEditModal(PersonResearch,assertionId,hasLifeStoryOptions,"","",!1)));factsSection.hasClass("factsSectionSources")&&(formId=factItem.attr("id"),sourceid=sourceid.indexOf("0x")===-1?sourceid:"0",typeof sourceEditModal!="undefined"&&sourceEditModal(PersonResearch.treeId,PersonResearch.personId,sourceid,formId))}e.stopPropagation()}).on("keypress",".cardAction",function(e){(e.which===13||e.which===32)&&$(this).closest(".connectFact").trigger("dblclick")}).on("click",".cardAction",function(){$(this).closest(".connectFact").trigger("dblclick")}).on("keypress",".cardEmpty[onclick]",function(e){(e.which===13||e.which===32)&&(e.preventDefault(),$(this).get(0).click())});$(".factsSectionFacts").on("click",".editFact",function(event){var assertionId,allowEditOrView,hasLifeStoryOptions;$(this).closest(".factItem").attr("id").length>0&&(assertionId=$(this).closest(".factItem").attr("id").replace("fi",""),allowEditOrView=$(this).closest(".factItem").find(".allowEditOrView").val(),allowEditOrView==="true"&&typeof factEditModal!="undefined"&&(hasLifeStoryOptions=$(this).closest(".factItem").find(".hasLifestoryOptions").val(),assertionId==="UnknownGender"&&(assertionId="99"),newFactEditModal(PersonResearch,assertionId,hasLifeStoryOptions,"","",!1)));event.stopPropagation()}).on("keypress",".mediaItemsCount, .sourceCitationsCount",function(e){e.stopPropagation();(e.which===13||e.which===32)&&(e.preventDefault(),$(this).closest(".connectFact").trigger("dblclick"))}).on("click",'[onclick="addFactModal();"]',function(){$(this).addClass("addModalTriggered")}).on("click",".FocusPerson",function(e){e.stopPropagation()}).on("click",".sourceCitationsCount",function(){$(this).closest(".connectFact").trigger("dblclick");PersonResearch.openOnLoadTab=2}).on("click",".mediaItemsCount, .factThumb",function(){$(this).closest(".connectFact").trigger("dblclick");PersonResearch.openOnLoadTab=1});$(".factsSectionSources").on("click",".editFact",function(){if($(this).closest(".factItem").attr("id").length>0){var formId=$(this).closest(".factItem").attr("id"),sourceid=formId.replace("si",""),sourceId=sourceid.indexOf("0x")===-1?sourceid:"0";typeof sourceEditModal!="undefined"&&sourceEditModal(PersonResearch.treeId,PersonResearch.personId,sourceId,formId)}}).on("click",".openWebLinkModal",function(){$(this).addClass("openWebLinkModalTriggered")});$(".sourcesOptionsMenu").on("click",".openWebLinkModal",function(){$(".optionsButtonSources").addClass("openWebLinkModalTriggered")});$(".factItemSource").on("click dblclick",".userCardImg.photo",function(event){event.stopPropagation()});$(".factItemWeblink").on("click dblclick",".cardActions a",function(event){event.stopPropagation()});$(".personClick").on("click",function(){var factItem=$(this).closest(".factItem");factItem.length>0&&(factItem.removeClass("factItemSelected"),factItem.unbind("click"))});$(".factItemName").each(function(){var $this=$(this);$this.attr("data-classes",$this.attr("class")).removeAttr("class").attr("class","factItemName")});$(".factItemGender").each(function(){var $this=$(this);$this.attr("data-classes",$this.attr("class")).removeAttr("class").attr("class","factItemGender")});$(".factsSection").on("click","#toggleNameAndGenderButton",function(){function removeConnection(){$(".factItemName").each(function(){$(this).removeAttr("class").attr("class","factItemName")});$(".factItemGender").each(function(){$(this).removeAttr("class").attr("class","factItemGender")})}var $factsSection=$(".factsSectionFacts");$factsSection.hasClass("factsSectionFactsShowingNameAndGender")?($factsSection.removeClass("factsSectionFactsShowingNameAndGender"),$(".factItemFocused").hasClass("factItemName")||$(".factItemFocused").hasClass("factItemGender")?(($(".factItemSelected").hasClass("factItemName")||$(".factItemSelected").hasClass("factItemGender"))&&($(".factItemSelected").trigger("belay.off").attr("data-toggled-off","factItemToggledOff"),removeConnection()),($(".factItemFocused:not(.factItemSelected)").hasClass("factItemName")||$(".factItemFocused:not(.factItemSelected)").hasClass("factItemGender"))&&($(".factItemFocused:not(.factItemSelected)").attr("data-toggled-off","factItemToggledOff"),removeConnection(),reconnectLines())):(removeConnection(),reconnectLines())):($(".factItemName").each(function(){$(this).attr("class",$(this).attr("data-classes"))}),$(".factItemGender").each(function(){$(this).attr("class",$(this).attr("data-classes"))}),$factsSection.addClass("factsSectionFactsShowingNameAndGender"),$(".factItem[data-toggled-off]").length>=1&&$(".factItemSelected").length===0?$(".factItem[data-toggled-off]").trigger("belay.on"):$(".factsSectionSources .factItemSelected").length===1?$(".factsSectionSources .factItemSelected").trigger("belay.off").trigger("belay.on"):reconnectLines())});PersonCard.isAddSibling&&(PersonCard.isAddSibling=!1,$(".factsSectionFamily").addClass("factsSectionFamilyShowingSiblings"));$("#myCanvasLogoBtn").callout({type:"click",classes:"calloutMyCanvasLinks calloutMenu",content:"#myCanvasLinks"});$("#printFriendlyCustomizeBtn").callout({type:"click",classes:"calloutPrintFriendlyCustomize calloutMenu",content:"#printFriendlyCalloutDomContent",onOpen:function(){$("html").hasClass("pFNoFamily")?$("#printFamily").removeClass("calloutMenuChecked").addClass("calloutMenuUnchecked"):$("#printFamily").removeClass("calloutMenuUnchecked").addClass("calloutMenuChecked");$("#factsSection").hasClass("factsSectionFactsShowingNameAndGender")?($("#printNameandGender").removeClass("calloutMenuUnchecked").addClass("calloutMenuChecked"),$("html").addClass("pFShowingNameGender")):($("#printNameandGender").removeClass("calloutMenuChecked").addClass("calloutMenuUnchecked"),$("html").removeClass("pFShowingNameGender"));$("#familySection").hasClass("factsSectionFamilyShowingSiblings")?($("#printSiblings").removeClass("calloutMenuUnchecked").addClass("calloutMenuChecked"),$("html").addClass("pFShowingSiblings")):($("#printSiblings").removeClass("calloutMenuChecked").addClass("calloutMenuUnchecked"),$("html").removeClass("pFShowingSiblings"));$("html").hasClass("pFNoSources")?$("#printSources").removeClass("calloutMenuChecked").addClass("calloutMenuUnchecked"):$("#printSources").removeClass("calloutMenuUnchecked").addClass("calloutMenuChecked");$("html").hasClass("pFShowingNotes")?$("#printNotes").removeClass("calloutMenuUnchecked").addClass("calloutMenuChecked"):$("#printNotes").removeClass("calloutMenuChecked").addClass("calloutMenuUnchecked");$("html").hasClass("pFShowingComments")?$("#printComments").removeClass("calloutMenuUnchecked").addClass("calloutMenuChecked"):$("#printComments").removeClass("calloutMenuChecked").addClass("calloutMenuUnchecked")},style:"dark"});$("#printFacts").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked");$("html").toggleClass("pFNoFacts")});$("#printFamilyEvents").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked").addClass("loading loadingSmall loadingOnBlack");$(".printOptionsMenu").addClass("printOptionsMenuDisabled");$("#factsFamilyEvents").trigger("click");$("#printFriendlyCustomizeBtn").trigger("click");customizeCalloutFocusOnFamilyEvents=!0});$("#printHistInsights").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked").addClass("loading loadingSmall loadingOnBlack");$(".printOptionsMenu").addClass("printOptionsMenuDisabled");$("#factsHistoricalInsights").trigger("click");$("#printFriendlyCustomizeBtn").trigger("click");customizeCalloutFocusOnHistInsights=!0});$("#printNameandGender").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked");$("#toggleNameAndGenderButton").trigger("click");$("#printFriendlyCustomizeBtn").trigger("click");$(this).focus()});$("#printAlternatives").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked").addClass("loading loadingSmall loadingOnBlack");$(".printOptionsMenu").addClass("printOptionsMenuDisabled");$("#factsAlternateEvents").trigger("click");$("#printFriendlyCustomizeBtn").trigger("click");customizeCalloutFocusOnAlternatives=!0});$("#printFamily").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked");$("html").toggleClass("pFNoFamily")});$("#printSiblings").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked");$("#toggleSiblingsButton").trigger("click");$("#printFriendlyCustomizeBtn").trigger("click");$(this).focus()});$("#printSources").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked");$("html").toggleClass("pFNoSources")});$("#printNotes").on("click",function(){$("html").toggleClass("pFShowingNotes");$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked")});$("#printComments").on("click",function(){$("html").toggleClass("pFShowingComments");$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked")});$("html").hasClass("printFriendly")&&($(".factsSectionFamily").insertAfter($(".factsSectionFacts")),checkNotesAndComments(),$("html").hasClass("pFShowingNameGender")&&$("#toggleNameAndGenderButton").trigger("click"),$("html").hasClass("pFShowingSiblings")&&$("#toggleSiblingsButton").trigger("click"),$("#printFriendlyCustomizeBtn").callout("close").callout("open"),customizeCalloutFocusOnFamilyEvents===!0?($("#printFamilyEvents").focus(),customizeCalloutFocusOnFamilyEvents=!1):customizeCalloutFocusOnAlternatives===!0?($("#printAlternatives").focus(),customizeCalloutFocusOnAlternatives=!1):customizeCalloutFocusOnHistInsights===!0&&($("#printHistInsights").focus(),customizeCalloutFocusOnHistInsights=!1));$(document).on("keydown",function(e){if(e.ctrlKey&&e.keyCode===80&&$(".pageHeader").hasClass("pageHeaderFacts"))if($("html").hasClass("printFriendly"))$("#printFriendlyPrintBtn").trigger("click");else return e.preventDefault(),printFunction(),!1})};$(function(){$("#tabContentFacts").load(function(){typeof Belay!="undefined"&&Belay.off();$(".cardOutline2").removeClass("cardOutline2")}).load();initialize();$("html").data("factItemNeedsRefocus")&&($("#"+$("html").data("factItemNeedsRefocus")+"").trigger("click"),$("html").removeData("factItemNeedsRefocus"));PersonResearch.showGuidance&&$(".personPageFacts .guidanceModalTrigger").click()});$(window).load(function(){var record,loadActionId,selectOnLoad,selectItem,openOnLoad,openItem;notifyRecordObject!=null&&(record=$(".record_"+notifyRecordObject.data.databaseId+"_"+notifyRecordObject.data.recordId),PersonResearch.selectOnLoad=record.attr("id").replace("si",""),PersonResearch.loadActionId=record.attr("id"));loadActionId=PersonResearch.loadActionId;selectOnLoad=PersonResearch.selectOnLoad;selectOnLoad!=="0"&&(selectItem=$("#"+loadActionId+".connectFact"),selectItem.length>0&&(window.personScreenType("smart-phone")&&$("#factsMobilePageTabs").tabs({activeIndex:1}),selectItem.trigger("click"),$(window).scrollTop(selectItem[0].offsetTop)));openOnLoad=PersonResearch.openOnLoad;openOnLoad!=="0"&&(openItem=$("#"+loadActionId+".connectFact"),openItem.length>0&&(window.personScreenType("smart-phone")&&$("#factsMobilePageTabs").tabs({activeIndex:1}),openItem.trigger("dblclick")))});$(window).resize(function(){window.personScreenType("large-screen")&&reconnectLines()});
"use strict";function setupCardClickEvent(cardId,getTrackingId,makeServerCall){var $card=$("#"+cardId);$card.on("click.card","button.sortingIcon",function(e){var isAttached,attachDetachCallback;e.preventDefault();isAttached=$card.hasClass("attached");personAnalyticsTrackClick(getTrackingId(isAttached));clearAllBanners();attachDetachCallback=function(data){data&&data.result&&($card.trigger("animateListItem.move"),saveUIState($(".factItemFocused")),window.glue.reload(function(){loadUIState("click")}))};typeof makeServerCall=="function"&&makeServerCall(isAttached,attachDetachCallback)})}function sourceEditModalFacts(){var sourceFactsList=$(".sourceFactsList"+SourceEditModal.citationId),unattachedSourceFactsList;sourceFactsList.length>0&&sourceFactsList.val()!=null&&sourceFactsList.val().length>0&&setupSourceEditModalDetailsForFacts(sourceFactsList,!0);unattachedSourceFactsList=$(".unattachedSourceFactsList"+SourceEditModal.citationId);unattachedSourceFactsList.length>0&&unattachedSourceFactsList.val()!=null&&unattachedSourceFactsList.val().length>0&&setupSourceEditModalDetailsForFacts(unattachedSourceFactsList,!1)}function setupSourceEditModalDetailsForFacts(listItem){var getTrackingId=function(isAttached){return isAttached?"editFactModalRemoveSource":"editFactModalAddSource"},factsList=listItem.val().split(",");factsList!=null&&factsList.length>0&&$.each(factsList,function(i,factId){var selector="modal_fi"+factId;setupCardClickEvent(selector,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachSourceFromEvent(factId,SourceEditModal.citationId,selector,attachDetachCallback):attachSourceToEvent(factId,SourceEditModal.citationId,selector,attachDetachCallback)})})}function sourceEditModalAttachedMedia(treeId,personId,citationId){var addMediaSection=$("#addMediaSection"),url;addMediaSection.hide().closest(".tabContent").removeClass("showUpload");url="/modals/sourceedit/tree/"+treeId+"/person/"+personId+"/citationid/"+citationId+"/attachedmedia?noRecordMedia=true";$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,success:function(data){var tabActive=$(".tabActive"),attachedMediaList=tabActive.find(".attachedMediaList"),hasSourceMediaError,$sortingDivTopAlert,$sortingDivBottomAlert;data.result&&data.html!=null&&data.html.length>0?(tabActive.removeClass("loading"),attachedMediaList.html(data.html.replace(/CitationIdValReplace/g,citationId)),$(".attachedMediaList").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning),hasSourceMediaError=$("#hasSourceMediaError"),hasSourceMediaError.length>0&&hasSourceMediaError.val()==="true"?($(".sortingDivTopSourceNoAttachedMediaMSG").alert("close"),$(".sortingDivTopSourceErrorMSG").alert("open"),$(".sortingDivBottomSourceNoMediaMSG").alert("close"),$(".sortingDivBottomSourceErrorMSG").alert("open")):($("#sourceEditModalAttachMedia").unbind("click"),(PersonResearch.hasEditRights||PersonResearch.hasContributorRights)&&addMediaSection.show().closest(".tabContent").addClass("showUpload"),sourceEditModalMedia(data.attachedMediaIds,data.unAttachedMediaIds),sortingCardOutlineHover(),$sortingDivTopAlert=$(".sortingDivTopSourceMedia .sortingDivTopSourceNoAttachedMediaMSG"),$sortingDivBottomAlert=$(".sortingDivBottomSourceMedia .sortingDivBottomSourceNoMediaMSG"),$sortingDivTopAlert.alert(personViewModalAlertSettingsNote),$sortingDivBottomAlert.alert(personViewModalAlertSettingsNote),$.cachedScript(PersonResearch.animateCardUrl).done(function(){$(".sortingDivBottomSourceMedia").animateCard({animateMove:{afterAnimate:function(item){item.find(".sortingIcon").hasClass("iconAdd")?(item.removeClass("cardOutline2"),(PersonResearch.hasEditRights||PersonResearch.hasContributorRights)&&item.find(".sortingIcon").removeClass("iconAdd noHover").addClass("iconClose")):(item.removeClass("cardOutline2"),(PersonResearch.hasEditRights||PersonResearch.hasContributorRights)&&item.find(".sortingIcon").removeClass("iconClose noHover").addClass("iconAdd"));window.lock.actionInProgress=!1},beforeAnimate:function(item){item.find(".card").addClass("cardOutline2")},connectWith:".sortingDivTopSourceMedia",emptyContent:".alertNote"},items:".card",onListEmpty:function(emptyList){emptyList.find(".alertNote").alert("open")},onEmptyListAdd:function(list){list.find(".alertNote").alert("close")}})}),$(".sortingDivTopSourceMedia .card").length===0&&$sortingDivTopAlert.alert("open"),$(".sortingDivBottomSourceMedia .card").length===0&&$sortingDivBottomAlert.alert("open"))):($(".sortingDivTopSourceNoAttachedMediaMSG").alert("close"),$(".sortingDivTopSourceErrorMSG").show(),$(".sortingDivBottomSourceNoMediaMSG").alert("close"),$(".sortingDivBottomSourceErrorMSG").show(),tabActive.removeClass("loading"))},error:function(){$(".sortingDivTopSourceNoAttachedMediaMSG").alert("close");$(".sortingDivTopSourceErrorMSG").alert("open");$(".sortingDivBottomSourceNoMediaMSG").alert("close");$(".sortingDivBottomSourceErrorMSG").alert("open")}})}function factEditModalSources(hasBanner){var eventSourcesList=$(".eventSourcesList"+FactEditModal.assertionId),unattachedEventSourcesList,bannerArea;eventSourcesList.length>0&&eventSourcesList.val()!=null&&eventSourcesList.val().length>0&&setupFactEditModalDetailsForSource(eventSourcesList,!0);unattachedEventSourcesList=$(".unattachedEventSourcesList"+FactEditModal.assertionId);unattachedEventSourcesList.length>0&&unattachedEventSourcesList.val()!=null&&unattachedEventSourcesList.val().length>0&&setupFactEditModalDetailsForSource(unattachedEventSourcesList,!1);bannerArea=$(".tabActive").find(".alertSuccess");typeof hasBanner!="undefined"&&hasBanner&&bannerArea.length>0&&(switchOnSuccessBanner(bannerArea),setFactModalTabsClick())}function setupFactEditModalDetailsForSource(listItem){var getTrackingId=function(isAttached){return isAttached?"editFactModalRemoveSource":"editFactModalAddSource"},sourcesList=listItem.val().split(",");sourcesList!=null&&sourcesList.length>0&&$.each(sourcesList,function(i,sourceId){var sourceItem=$("#modal_si"+sourceId),userCardItem=$(".userCardsi"+sourceId),dbId,imgSrc,selector;if(sourceItem.length>0){if(dbId=sourceItem.find(".dbId").val(),dbId==="1030")userCardItem.find(".userCardImg").addClass("icon iconAcom");else{var sourceNode=$("#si"+sourceId),nodeUserCardImg=sourceNode.find(".userCardImg"),imgItem=nodeUserCardImg.children("img");imgItem.length>0?(imgSrc=imgItem.attr("src"),userCardItem.length>0&&(userCardItem.find(".userCardImg").html('<img class="" src="'+imgSrc+'" alt="" />'),userCardItem.find(".userCardImg").attr("style","background-image:url('"+imgSrc+"');"),userCardItem.find(".userCardImg").addClass("userCardImgSquare userCardImgCenter"))):userCardItem.find(".userCardImg").addClass("icon iconDocument")}selector="modal_si"+sourceId;setupCardClickEvent(selector,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachSourceFromEvent(FactEditModal.assertionId,sourceId,selector,attachDetachCallback):attachSourceToEvent(FactEditModal.assertionId,sourceId,selector,attachDetachCallback)})}else sourceId==="1030"?userCardItem.find(".userCardImg").addClass("icon iconAcom"):userCardItem.find(".userCardImg").addClass("icon iconDocument")})}function factEditModalMedia(attachedMediaIds,unAttachedMediaIds){attachedMediaIds.length>0&&setupFactEditModalDetailsForMedia(attachedMediaIds,FactEditModal.assertionId);unAttachedMediaIds.length&&setupFactEditModalDetailsForMedia(unAttachedMediaIds,FactEditModal.assertionId)}function sourceEditModalMedia(attachedMediaIds,unAttachedMediaIds){attachedMediaIds.length>0&&setupSourceEditModalDetailsForMedia(attachedMediaIds,SourceEditModal.sourceId,!0);unAttachedMediaIds.length&&setupSourceEditModalDetailsForMedia(unAttachedMediaIds,SourceEditModal.sourceId,!1)}function setupFactEditModalDetailsForMedia(eventMediaIds,factId){var getTrackingId=function(isAttached){return isAttached?"editFactModalRemoveMedia":"editFactModalAttachMedia"},mediaList=eventMediaIds.split(",");mediaList!=null&&mediaList.length>0&&$.each(mediaList,function(i,mediaId){setupCardClickEvent(mediaId,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachMediaFromEvent(factId,mediaId,attachDetachCallback):attachMediaToEvent(factId,mediaId,attachDetachCallback)})})}function setupSourceEditModalDetailsForMedia(eventMediaIds,sourceId){var getTrackingId=function(isAttached){return isAttached?"removeMediaFromCitation":"attachMediaToCitation"},mediaList=eventMediaIds.split(",");mediaList!=null&&mediaList.length>0&&$.each(mediaList,function(i,mediaId){setupCardClickEvent(mediaId,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachMediaFromCitation(sourceId,mediaId,attachDetachCallback):attachMediaToCitation(sourceId,mediaId,attachDetachCallback)})})}function factEditModalTimelineOptions(treeId,personId,assertionId){var url="/modals/factedit/tree/"+treeId+"/person/"+personId+"/assertionid/"+assertionId+"/timeline";$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,success:function(data){var narrativeTextArea,displayLifestory,generateNarrativeButton,lifestoryTitleField;$(".tabContent4").removeClass("loading").find(".narrativeDataFields").show();narrativeTextArea=$("#narrative");displayLifestory=$("#displayLifestory");data.result&&data.personEventNarrativeDataResponse!=null?(generateNarrativeButton=$("#generateNarrative"),generateNarrativeButton.length>0&&data.personEventNarrativeDataResponse.DefaultNarrative!=null&&data.personEventNarrativeDataResponse.DefaultNarrative.length>0&&generateNarrativeButton.show(),narrativeTextArea.length>0&&(narrativeTextArea.text(data.personEventNarrativeDataResponse.Narrative),narrativeTextArea.val(data.personEventNarrativeDataResponse.Narrative),narrativeTextArea.attr("data-original-narrative",data.personEventNarrativeDataResponse.Narrative||"")),lifestoryTitleField=$(".lifestoryTitleField"),lifestoryTitleField.length>0&&lifestoryTitleField.attr("value",data.personEventNarrativeDataResponse.Title).attr("data-original-lifestorytitle",data.personEventNarrativeDataResponse.Title),displayLifestory.length>0&&displayLifestory.prop("checked",!data.personEventNarrativeDataResponse.IsHidden).attr("data-original-displaylifestory",(!data.personEventNarrativeDataResponse.IsHidden).toString()),$(".narrativeIsMapOn").val(data.personEventNarrativeDataResponse.IsMapOn),$(".narrativeIsImageOn").val(data.personEventNarrativeDataResponse.IsImageOn),$(".narrativePreferredImageId").val(data.personEventNarrativeDataResponse.PreferredImageId)):displayLifestory.length>0&&($(".narrativeIsMapOn").val(!1),$(".narrativeIsImageOn").val(!1),displayLifestory.prop("checked",!1).attr("disabled",!0).attr("data-original-displaylifestory","false"))}})}function handleFactModalUserCardData(titleSelector,titleData){var factTitlePersonCard=$(".factTitlePersonCard"),userCardTitle;factTitlePersonCard.length>0&&(userCardTitle=factTitlePersonCard.find(titleSelector),userCardTitle.length>0&&userCardTitle.html(titleData))}function handleButtonsSavingMode(){$(".editModalSaveButton").addClass("loading disabled").attr("aria-busy","true");var cancelClose=$(".cancelClose");cancelClose.length>0&&cancelClose.hide()}function handleButtonsNormalMode(){$(".editModalSaveButton").removeAttr("disabled aria-busy").removeClass("loading disabled");var cancelClose=$(".cancelClose");cancelClose.length>0&&cancelClose.show()}function createNewEvent(selectedContentArea,tabOrButtonItem){var modalEditEvent=$(".tabContent1"),modalEditEventActive=modalEditEvent.hasClass("tabActive"),selectedPerson=modalEditEvent.find(".selectedPerson"),isCreateRelationshipEvent=!1,eventType=FactEditModal.eventType,isPrimary=!1,eventChanged=!1,isFailedSpouseData=!1,dictionary=[],dataExtra,relTypeAheadVal,dateField,$checkBox,url;eventChanged=modalEditEventActive?checkFieldValidation(!0,!0,dictionary):!1;var relationshipEventType=isRelationshipEventType(),relationshipId=typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-assertionId")!="undefined"&&selectedPerson.attr("data-assertionId").length>0?selectedPerson.attr("data-assertionId"):"",isFindExistingPerson=!1;if(relationshipEventType&&(relationshipId==="0"||relationshipId.length===0)&&(dataExtra=typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-extra")!="undefined"&&selectedPerson.attr("data-extra").length>0?selectedPerson.attr("data-extra"):"",typeof dataExtra!="undefined"&&dataExtra.length>0&&(dataExtra=jQuery.parseJSON(dataExtra)),relationshipId=typeof dataExtra!="undefined"?dataExtra.PID:"",isCreateRelationshipEvent=!0,FactEditModal.originalSpouseId=relationshipId,isFindExistingPerson=!0),relTypeAheadVal="false",relationshipEventType&&relationshipId!=null&&relationshipId!==""&&(relTypeAheadVal=typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-isTypeAhead")!="undefined"&&selectedPerson.attr("data-isTypeAhead").length>0?selectedPerson.attr("data-isTypeAhead"):isFindExistingPerson?"true":"false",relTypeAheadVal==="true"&&(isCreateRelationshipEvent=!0),FactEditModal.originalSpouseId=relationshipId),!FactEditModal.hasValidationWarningAgainstSpouseData&&relationshipEventType&&(dateField=modalEditEvent.find(".dateField").val(),typeof dateField!="undefined"&&dateField.length>0&&(eventChanged=validateRelationshipEventAgainstSpouseData(selectedPerson,eventType,dateField,!0,isFailedSpouseData),isFailedSpouseData=!eventChanged,FactEditModal.hasValidationWarningAgainstSpouseData=isFailedSpouseData)),eventChanged){var titleField=typeof dictionary.title!="undefined"?dictionary.title.value:"",dateField=typeof dictionary.date!="undefined"?dictionary.date.value:"",placeField="",placeFieldDataExtra="";typeof dictionary.location!="undefined"&&(placeField=dictionary.location.value,typeof dictionary.location.extra!="undefined"&&(placeFieldDataExtra=dictionary.location.extra));var descriptionField=typeof dictionary.description!="undefined"?dictionary.description.value:"",valueField=typeof dictionary.value!="undefined"?dictionary.value.value:"",givenNameField=typeof dictionary.givenName!="undefined"?dictionary.givenName.value:"",surnameField=typeof dictionary.surname!="undefined"?dictionary.surname.value:"",suffixNameField=typeof dictionary.suffix!="undefined"?dictionary.suffix.value:"",genderTypeField=typeof dictionary.genderMale!="undefined"?"Male":typeof dictionary.genderFemale!="undefined"?"Female":"Unknown";handleButtonsSavingMode();FactEditModal.isPrimary&&(isPrimary=!0);$checkBox=modalEditEvent.find(".isPrimaryCheckbox");$checkBox.length>0&&$checkBox.is(":checked")&&(isPrimary=!0);url="/tree/"+PersonResearch.treeId+"/person/"+PersonResearch.personId+"/createnewevent";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,data:{eventType:eventType,customEventTitle:titleField,date:dateField,place:placeField,description:valueField!=null&&valueField.length>0?valueField:descriptionField,relationshipId:relationshipId,relTypeAhead:relTypeAheadVal,isPrimary:isPrimary,givenName:givenNameField,surname:surnameField,suffixName:suffixNameField,genderType:genderTypeField},success:function(data){var fullname,hasBirth,hasDeath,hasLifeStoryOptions,cancelClose;if(handleButtonsNormalMode(),data.result&&typeof data.assertionId!="undefined"){if(resetModalContents(!1),typeof isPrimary!="undefined"&&isPrimary===!0&&(eventType.toString()==="Birth"||eventType.toString()==="Death"||eventType.toString()==="Name"))if(eventType.toString()==="Name")typeof surnameField!="undefined"&&(fullname=(givenNameField.length>0?givenNameField:"")+(surnameField.length>0?(givenNameField.length>0?" ":"")+surnameField:"")+(suffixNameField.length>0?" "+suffixNameField:""),$("#personCard .userCardTitle").html(fullname),PersonCard.name=fullname,handleFactModalUserCardData(".userCardTitle",fullname));else if(hasBirth=PersonCard.lifeYearRange.indexOf("&ndash;")>0||PersonCard.lifeYearRange.indexOf("-")>0,hasDeath=(PersonCard.lifeYearRange.indexOf("&ndash;")===0||PersonCard.lifeYearRange.indexOf("-")===0)&&PersonCard.lifeYearRange.length>7||PersonCard.lifeYearRange.length>11,!PersonCard.isFamilySearchUser||(hasBirth||eventType.toLowerCase()!=="birth")&&(hasDeath||eventType.toLowerCase()!=="death")){var splitYears=PersonCard.lifeYearRange.indexOf("&ndash;")!==-1?PersonCard.lifeYearRange.split("&ndash;"):PersonCard.lifeYearRange.split("-"),eventResults=validDate(dateField,eventType.toString().toLowerCase(),FactEditModal.person.personBirth,FactEditModal.person.personDeath,FactEditModal.person.motherBirth,FactEditModal.person.motherDeath,FactEditModal.person.fatherBirth,FactEditModal.person.fatherDeath,!1),dateSet="";typeof dateField!="undefined"&&typeof placeField!="undefined"&&eventType.toString()==="Birth"?(window.getPersonCard(),dateSet=(eventResults[0]===0?eventResults[1]:splitYears.length>0&&hasBirth?splitYears[0]:"")+"&ndash;"+(splitYears.length>0&&hasDeath?splitYears.length>1?splitYears[1]:splitYears[0]:""),PersonCard.lifeYearRange=dateSet,dateSet.length>1&&dateSet!=="&ndash;"?handleFactModalUserCardData(".userCardSubTitle","("+dateSet.replace("&ndash;","-")+")"):handleFactModalUserCardData(".userCardSubTitle","")):typeof dateField!="undefined"&&typeof placeField!="undefined"&&eventType.toString()==="Death"&&(window.getPersonCard(),dateSet=(splitYears.length>0&&hasBirth?splitYears[0]:"")+"&ndash;"+(eventResults[0]===0?eventResults[1]:splitYears.length>0&&hasDeath?splitYears.length>1?splitYears[1]:splitYears[0]:""),PersonCard.lifeYearRange=dateSet,dateSet.length>1&&dateSet!=="&ndash;"?handleFactModalUserCardData(".userCardSubTitle","("+dateSet.replace("&ndash;","-")+")"):handleFactModalUserCardData(".userCardSubTitle",""))}else location.reload();tabOrButtonItem!=="editModalSaveButton"&&tabOrButtonItem!=="factEditModalEvent"?(hasLifeStoryOptions=!0,(eventType.toLowerCase()!=="birth"&&eventType.toLowerCase()!=="death"||isPrimary)&&eventType.toLowerCase()!=="name"&&eventType.toLowerCase()!=="gender"||(hasLifeStoryOptions=!1),factEditModal(PersonResearch.treeId,PersonResearch.personId,data.assertionId,hasLifeStoryOptions,tabOrButtonItem,selectedContentArea,"","",!0)):$.modal.close();isCreateRelationshipEvent&&showIndividualSpouse();window.glue.reload()}else cancelClose=$(".cancelClose"),cancelClose.length>0&&cancelClose.show(),setButtonandBannerBasedOnValidation(!0)},error:function(xhr,ajaxOptions,thrownError){throwException("status->"+xhr.status+" thrownError->"+thrownError);handleButtonsNormalMode()}})}else setButtonandBannerBasedOnValidation(!0)}function resetEventDatePlaceDesc(){var modalEditEvent=$(".tabContent1");modalEditEvent.find(".factField").each(function(){var $field=$(this),val,originalVal;$field.attr("name")!=="gender"&&(val=$field.val(),originalVal=$field.data("original-value"),FactEditModal.isAddNewFact||typeof val=="undefined"||val.length!==0||$field.val(originalVal))})}function resetEventDetails(){var modalEditEvent=$(".tabContent1");modalEditEvent.find(".factField").each(function(){var $field=$(this),originalVal;$field.attr("name")!=="gender"&&(originalVal=$field.data("original-value"),$field.val(originalVal))});clearAllBanners();$(".editModalSaveButton").removeAttr("disabled");setFactModalTabsClick()}function setOldPreferredCard(preferredEventClass){var preferredEventCard=$("."+preferredEventClass);preferredEventCard.length>0&&preferredEventCard.addClass("factItemAlternate").removeClass(""+preferredEventClass+"").find(".cardSubtitle").append('&nbsp;<em class="factTitleIsAlternate">('+PersonResearch.alternateText+")<\/em>").end().find(".hasLifestoryOptions").val("false")}function setNewPreferredCard(factItem,preferredEventClass){factItem.hasClass(preferredEventClass)||(factItem.addClass(preferredEventClass).removeClass("factItemAlternate").find(".factTitleIsAlternate").remove(),$("#preferredEventCheckbox").hide(),$("#preferredEventButtonLabel").show(),FactEditModal.eventType.toLowerCase()!=="name"&&($("#factEditModalTimelineOptions").css("display",""),factItem.find(".hasLifestoryOptions").val("true")))}function setAndRetrieveStoredFactValues(factItem,storedAccessor,fieldValue){var storedValue=factItem.find("."+storedAccessor);storedValue.length>0?storedValue.val(fieldValue):factItem.append('<input class="'+storedAccessor+'" type="hidden" value="'+fieldValue+'" />')}function updateFactEditGenderRadio(fieldChecked){var $button=$(".tabActive").find("#"+fieldChecked),modalEditEvent;$button.length>0&&(modalEditEvent=$(".tabContent1"),$button.prop("checked",!0))}function switchOnSuccessBanner(bannerArea){bannerArea.text(FactEditModal.text.savedSuccessfullyBanner);bannerArea.hasClass("alertHidden")&&bannerArea.alert("open")}function removePersonEvent(assertionid){var isPrimaryEvent=$("#fi"+assertionid).hasClass("preferredEventBirth")||$("#fi"+assertionid).hasClass("preferredEventDeath"),url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/assertionid/"+assertionid+"/removepersonevent";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){var factNodeItem,eventType;data.status&&(factNodeItem=$("#fi"+assertionid),factNodeItem.length>0&&factNodeItem.remove(),$("#sourcesSection").find(".fi"+assertionid).removeClass("fi"+assertionid+" cardOutline2 factItemFocused"),closeCallouts(),$.modal.close(),reconnectLines(),eventType=FactEditModal.eventType,isPrimaryEvent&&(eventType.toString()==="Birth"||eventType.toString()==="Death")&&(PersonCard.isFamilySearchUser?location.reload():window.getPersonCard()))}})}function removeCitation(citationId){var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/citation/"+citationId+"/removecitation";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){var classList,sourceCitationNodeItem,factItemWithCitation,selectedItem;data.result&&(classList=$("#si"+citationId).attr("class").split(/\s+/),$.each(classList,function(index,item){var sourceCountVal=$("#"+item).find(".sourceCountVal"),sourceCount,cardInfo;sourceCountVal.length>0&&(sourceCount=parseInt(sourceCountVal.text()),sourceCount-1>0?sourceCountVal.text(sourceCount-1):(cardInfo=$("#"+item).find(".cardInfo"),cardInfo.length>0&&cardInfo.remove()))}),sourceCitationNodeItem=$("#si"+citationId),sourceCitationNodeItem.length>0&&sourceCitationNodeItem.remove(),factItemWithCitation=$("#factsSection").find(".si"+citationId),factItemWithCitation.hasClass("si"+citationId)&&factItemWithCitation.removeClass("si"+citationId),selectedItem=$("#factsSection").find(".factItemFocused"),selectedItem.length>0&&(selectedItem.hasClass("cardOutline2")&&selectedItem.removeClass("cardOutline2"),selectedItem.hasClass("bgColor2")&&selectedItem.removeClass("bgColor2"),selectedItem.hasClass("bgDark")&&selectedItem.removeClass("bgDark"),selectedItem.hasClass("cardSelected")&&selectedItem.removeClass("cardSelected"),selectedItem.hasClass("factItemSelected")&&selectedItem.removeClass("factItemSelected"),selectedItem.removeClass("factItemFocused")),closeCallouts(),$.modal.close(),reconnectLines())}})}function removeCitationFromTree(citationId){var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/citation/"+citationId+"/removecitationfromtree";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){data.result&&(closeCallouts(),$.modal.close(),reconnectLines())}})}function removeSource(sourceId){var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/source/"+sourceId+"/removesource";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){data.result&&(closeCallouts(),$.modal.close(),reconnectLines())}})}function addWebLinkModal(){var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/addweblink";$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,success:function(data){data.result&&$(data.html).modal({width:"510",title:PersonResearch.text.addWebLink,onOpen:function(){closeCallouts();$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning);InitiateWebLinkValidator()},onClose:function(){$(".openWebLinkModalTriggered").removeClass("openWebLinkModalTriggered").focus()}})}})}function editWebLinkModal(webLinkItem){var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/editweblink";$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,data:{webLinkId:webLinkItem.attr("id"),webLinkHref:webLinkItem.find(".webLinkHref").text(),webLinkTitle:webLinkItem.find(".webLinkTitle").text()},success:function(data){data.result&&$(data.html).modal({width:"510",title:PersonResearch.text.webLink,onOpen:function(){$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning);InitiateWebLinkValidator();$(".modalWebLinks .removeButton").callout({type:"click",classes:"calloutRemoveWeblink",content:"#removeWeblinksCalloutDomContent",onAfterOpen:function(){$("#removeWeblinksCalloutDomContent").on("click",".closeCallouts",function(){closeCallouts()})},position:"top",style:"dark"})}})}})}function enableOrDisableWebLinkAddOrSaveButton(){var webLinkHref=$("#webAddressInput").val(),webLinkTitle=$("#linkNameInput").val();webLinkHref.length>0&&/\S/.test(webLinkHref)&&webLinkTitle.length>0&&/\S/.test(webLinkTitle)?$(".webLinkSaveButton").removeAttr("disabled"):$(".webLinkSaveButton").attr("disabled","disabled")}function InitiateWebLinkValidator(){$("#modalWebLinks").validator({fields:{webAddressInput:{pattern:"url"}}})}function saveWebLink(weblinkId){$(".webLinkSaveButton").attr("disabled","disabled");var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/saveweblink",weblinkHref=$("#webAddressInput").val(),weblinkTitle=$("#linkNameInput").val();$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,data:{webLinkId:weblinkId,webLinkHref:weblinkHref,webLinkTitle:weblinkTitle},success:function(data){var webLinkIdItem,webLinkIcon;data.result&&(webLinkIdItem=$("#"+data.webLinkId),webLinkIdItem.length>0?(webLinkIdItem.find(".webLinkHref").text(weblinkHref),webLinkIdItem.find(".webLinkTitle").text(weblinkTitle),webLinkIcon=webLinkIdItem.find(".webLinkIcon"),data.isAncestryWebLink?webLinkIcon.hasClass("iconAcom")||(webLinkIcon.removeClass("iconWebLink"),webLinkIcon.addClass("iconAcom")):webLinkIcon.hasClass("iconWebLink")||(webLinkIcon.removeClass("iconAcom"),webLinkIcon.addClass("iconWebLink")),closeCallouts(),$.modal.close()):(closeCallouts(),$.modal.close(),window.glue.reload()))}})}function removeWebLink(webLinkId){var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/weblink/"+webLinkId+"/removeweblink";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){if(data.result){var webLinkIdItem=$("#"+webLinkId);webLinkIdItem.length>0&&webLinkIdItem.hide();closeCallouts();$.modal.close()}}})};
(function($){"use strict";function initializeFamilyCard(){$(".familySection").on("click","#toggleSiblingsButton",function(){var familySection=$(".familySection");familySection.hasClass("factsSectionFamilyShowingSiblings")?familySection.removeClass("factsSectionFamilyShowingSiblings"):familySection.addClass("factsSectionFamilyShowingSiblings")})}$(function(){initializeFamilyCard()})})(jQuery);
(function($){"use strict";function initializeMobileTabs(){$(".tabActive > .personPage > .mobilePageTabs").tabs({overrideOverflow:!0})}function destroyMobileTabs(){$(".tabActive > .personPage > .mobilePageTabs").tabs("destroy")}function resetMobileStickyTabs(){$(".personPage").removeClass("personPageSticky");$(".tabActive > .personPage > .mobilePageTabs").removeClass("bgDark");$("#hintsTabs.bgDark").removeClass("bgDark")}function mobileStickytabs(){function stickyMenu(){var scrollTop=$(window).scrollTop();scrollTop>=$(".tabActive > .personPage").offset().top?$(".tabActive > .personPage").hasClass("personPageSticky")||($(".tabActive > .personPage").addClass("personPageSticky"),$(".tabActive > .personPage > .mobilePageTabs").addClass("bgDark"),$("#hintsTabs").addClass("bgDark")):$(".personPage").hasClass("personPageSticky")&&resetMobileStickyTabs()}stickyMenu()}$(".tabActive > .personPage > .mobilePageTabs").on("click",".tab",function(){$(".personPage").hasClass("personPageSticky")&&$("html, body").animate({scrollTop:$(".personViewPages").offset().top},0)});$(window).resize(function(){var isSmartPhone=window.personScreenType("smart-phone"),isSmartPhonePortrait=window.personScreenType("smart-phone-portrait");isSmartPhonePortrait===!0&&mobileStickytabs();isSmartPhonePortrait===!1&&$(".personPage").hasClass("personPageSticky")&&resetMobileStickyTabs();$(".tabActive > .personPage > .mobilePageTabs").data("tabsInstance")&&isSmartPhone===!1&&destroyMobileTabs();$(".tabActive > .personPage > .mobilePageTabs").data("tabsInstance")||isSmartPhone!==!0||initializeMobileTabs()}).scroll(function(){window.personScreenType("smart-phone-portrait")===!0&&mobileStickytabs()});window.personScreenType("smart-phone")===!0&&initializeMobileTabs()})(jQuery)