(function($){"use strict";function extractData(str){var i,parts=str.replace(/,/g," ").replace(/\//g," ").replace(/-/g," ").replace(/\./g," ").replace(/\s{2,}/g," ").trim().split(" "),terms=[],mods=[],unknowns=[],term,mod;if(parts.length)for(i=0;i<parts.length;i+=1)term=parts[i],mod=isModifier(term),mod?mods.push(mod):isUnknown(term)?unknowns.push(term):term!==""&&terms.push(processTerm(term));return{modifiers:mods,terms:terms,unknowns:unknowns}}function filterCalendarEra(str){var era,rex,match;for(var eraPattern in calendarEras)if(calendarEras.hasOwnProperty(eraPattern)&&(rex=new RegExp(eraPattern,"i"),match=rex.test(str),match)){str=str.replace(rex,"");era=calendarEras[eraPattern];break}return{era:era,str:str.trim()}}function formatDoubleYear(doubleYear){return doubleYear=(doubleYear%100).toString(),doubleYear.length<2&&(doubleYear="0"+doubleYear),doubleYear}function generate1TermDates(terms){var dates=[],term=terms[0];return term.month&&dates.push({month:term.month,monthAbbr:term.monthAbbr}),term.year&&dates.push({year:term.integer}),dates}function generate2TermDates(terms,nonUS){var dates=[],first=terms[0],second=terms[1],dm;return first.month&&second.day&&dates.push({day:second.integer,month:first.month,monthAbbr:first.monthAbbr}),first.day&&second.month&&(first.isOrdinal||first.integer!==second.integer)&&(dm={day:first.integer,month:second.month,monthAbbr:second.monthAbbr},nonUS?dates.unshift(dm):dates.push(dm)),first.month&&second.year&&dates.push({month:first.month,monthAbbr:first.monthAbbr,year:second.integer}),first.year&&isValidDoubleYear(first.integer,second.integer)&&dates.push({year:first.integer,doubleYear:formatDoubleYear(second.integer)}),first.year&&second.month&&first.integer!==second.integer&&dates.push({month:second.month,monthAbbr:second.monthAbbr,year:first.integer}),dates}function generate3TermDates(terms,nonUS){var dates=[],first=terms[0],second=terms[1],third=terms[2],dmy;return first.month&&second.day&&third.year&&dates.push({day:second.integer,month:first.month,monthAbbr:first.monthAbbr,year:third.integer}),first.day&&second.month&&third.year&&(first.isOrdinal||first.integer!==second.integer)&&(dmy={day:first.integer,month:second.month,monthAbbr:second.monthAbbr,year:third.integer},nonUS?dates.unshift(dmy):dates.push(dmy)),first.month&&second.year&&isValidDoubleYear(second.integer,third.integer,!1,first.month)&&dates.push({month:first.month,monthAbbr:first.monthAbbr,year:second.integer,doubleYear:formatDoubleYear(third.integer)}),first.year&&second.month&&third.day&&(third.isOrdinal||first.integer!==third.integer)&&dates.push({day:third.integer,month:second.month,monthAbbr:second.monthAbbr,year:first.integer}),dates}function generate4TermDates(terms,nonUS){var dates=[],first=terms[0],second=terms[1],third=terms[2],fourth=terms[3],dmyy;return first.month&&second.day&&third.year&&isValidDoubleYear(third.integer,fourth.integer,second.integer,first.month)&&dates.push({day:second.integer,month:first.month,monthAbbr:first.monthAbbr,year:third.integer,doubleYear:formatDoubleYear(fourth.integer)}),first.day&&second.month&&third.year&&isValidDoubleYear(third.integer,fourth.integer,first.integer,second.month)&&(first.isOrdinal||first.integer!==second.integer)&&(dmyy={day:first.integer,month:second.month,monthAbbr:second.monthAbbr,year:third.integer,doubleYear:formatDoubleYear(fourth.integer)},nonUS?dates.unshift(dmyy):dates.push(dmyy)),dates}function getGenealogicalDate(data){var dateString="";return data.mods&&data.mods.length&&(dateString+=data.mods[0]+" "),data.date.month&&(data.date.day&&(dateString+=data.date.day+" "),dateString+=data.date.monthAbbr),data.date.year&&(dateString+=data.date.month?" "+data.date.year:data.date.year,data.date.doubleYear?dateString+="/"+data.date.doubleYear:data.era&&(dateString+=" "+data.era)),dateString.length?dateString:!1}function getNumericMonth(str){var numericMonth=0;return!isNaN(str)&&str>0&&str<13?numericMonth=Number(str):isNaN(str)&&str!==!1&&(str=str.toLowerCase(),months.forEach(function(month,i){(str===month.abbr||str.length>3&&str===month.name.substr(0,str.length))&&(numericMonth=i+1)})),numericMonth}function isDayInMonth(day,month,year){var daysInMonth;return month=getNumericMonth(month),daysInMonth=month===2&&year&&!isLeapYear(year)?28:months[month-1].days,day>0&&day<=daysInMonth}function isFutureDate(date){var dateNow=new Date,future=!1;return date.year&&(date.year===dateNow.getFullYear()?date.month&&(date.month-1===dateNow.getMonth()?date.day&&(future=date.day>dateNow.getDate()):future=date.month-1>dateNow.getMonth()):future=date.year>dateNow.getFullYear()),future}function isLeapYear(year){return new Date(year,1,29).getMonth()===1}function isModifier(str){var match=!1,mod;if(str=str.toLowerCase(),modifiers.hasOwnProperty(str))match=modifiers[str];else if(str.length>3)for(mod in modifiers)modifiers.hasOwnProperty(mod)&&str===mod.substr(0,str.length)&&(match=modifiers[mod]);return match}function isOrdinal(str){var returnValue=!1;return typeof str=="string"&&str.length>=2&&(str=str.toLowerCase(),returnValue=ordinals.indexOf(str.substr(-2,2))>=0||ordinals.indexOf(str.substr(-3,3))>=0||ordinals.indexOf(str.substr(-4,4))>=0),returnValue}function isUnknown(str){return str=str.toLowerCase(),!isOrdinal(str)&&isNaN(Number(str))&&getNumericMonth(str)===0&&!isModifier(str)}function isValidDay(day){var dayNumber=Number(day),dayInteger=parseInt(day,10);return!isNaN(dayNumber)&&dayNumber>0&&dayNumber<32||isOrdinal(day)&&dayInteger>0&&dayInteger<32}function isValidDoubleYear(year1,year2,day,month){var valid=!1,valid4Digit,valid2Digit,valid1Digit,year2Length=year2.toString().length;return isYearInDoubleRange(year1)&&(valid4Digit=isYearInDoubleRange(year2)&&year2-year1==1,valid2Digit=year2Length===2&&year2-year1.toString().substr(-2)==1,valid1Digit=year2Length===1&&(year2-year1.toString().substr(-1)==1||year2-year1.toString().substr(-1)==-9),(valid4Digit||valid2Digit||valid1Digit)&&(valid=!0,month&&(valid=!1,month<=3&&(valid=day?month===3?day<25:isDayInMonth(day,month,year1):!0)))),valid}function isValidYear(year){return year=Number(year),!isNaN(year)&&year>=0&&year<2200}function isYearInDoubleRange(year){return year>1581&&year<1753}function processTerm(str){var numeric=getNumericMonth(str);return{day:isValidDay(str),integer:parseInt(str,10),isOrdinal:isOrdinal(str),month:numeric,monthAbbr:numeric?shared.ucfirst(months[numeric-1].abbr):undefined,year:isValidYear(str)}}var langSets={de:{calendarEras:{"v. Chr.":"v. Chr.","v.u.Z":"v.u.Z","v Chr":"v. Chr.",vuZ:"v.u.Z"},modifiers:{ungef:"ungef","ungefähr":"ungefähr",etwa:"etwa",circa:"circa",vor:"vor",nach:"nach"},months:[{name:"januar",abbr:"jan",days:31},{name:"februar",abbr:"feb",days:29},{name:"märz",abbr:"mär",days:31},{name:"april",abbr:"apr",days:30},{name:"mai",abbr:"mai",days:31},{name:"juni",abbr:"jun",days:30},{name:"juli",abbr:"jul",days:31},{name:"august",abbr:"aug",days:31},{name:"september",abbr:"sep",days:30},{name:"oktober",abbr:"okt",days:31},{name:"november",abbr:"nov",days:30},{name:"dezember",abbr:"dez",days:31}],ordinals:[]},en:{calendarEras:{"B.C.E.":"B.C.E.",BCE:"B.C.E.","B.C.":"B.C.",BC:"B.C."},modifiers:{abt:"abt",about:"abt",aft:"aft",after:"aft",around:"abt",bef:"bef",before:"bef",ca:"abt",circa:"abt",near:"abt"},months:[{name:"january",abbr:"jan",days:31},{name:"february",abbr:"feb",days:29},{name:"march",abbr:"mar",days:31},{name:"april",abbr:"apr",days:30},{name:"may",abbr:"may",days:31},{name:"june",abbr:"jun",days:30},{name:"july",abbr:"jul",days:31},{name:"august",abbr:"aug",days:31},{name:"september",abbr:"sep",days:30},{name:"october",abbr:"oct",days:31},{name:"november",abbr:"nov",days:30},{name:"december",abbr:"dec",days:31}],ordinals:["0th","1st","2nd","3rd","4th","5th","6th","7th","8th","9th","11th","12th","13th"]},es:{calendarEras:{"a. C.":"a. C.","a C":"a. C.",AEC:"AEC"},modifiers:{aproximadamente:"aproximadamente",aprox:"aprox",ca:"ca",c:"c",est:"est",ant:"ant",antes:"antes",dps:"dps","después":"después"},months:[{name:"enero",abbr:"ene",days:31},{name:"febrero",abbr:"feb",days:29},{name:"marzo",abbr:"mar",days:31},{name:"abril",abbr:"abr",days:30},{name:"mayo",abbr:"mayo",days:31},{name:"junio",abbr:"jun",days:30},{name:"julio",abbr:"jul",days:31},{name:"agosto",abbr:"ago",days:31},{name:"septiembre",abbr:"set",days:30},{name:"octubre",abbr:"oct",days:31},{name:"noviembre",abbr:"nov",days:30},{name:"diciembre",abbr:"dic",days:31}],ordinals:["0º","1º","2º","3º","4º","5º","6º","7º","8º","9º"]},fr:{calendarEras:{"av. J-C":"av. J-C","av J-C":"av. J-C",AEC:"AEC"},modifiers:{environ:"environ",c:"c",ca:"ca",cca:"cca",vers:"vers",avant:"avant","après":"après"},months:[{name:"janvier",abbr:"jan",days:31},{name:"février",abbr:"fév",days:29},{name:"mars",abbr:"mars",days:31},{name:"avril",abbr:"avr",days:30},{name:"mai",abbr:"mai",days:31},{name:"juin",abbr:"juin",days:30},{name:"juillet",abbr:"jul",days:31},{name:"août",abbr:"août",days:31},{name:"septembre",abbr:"sept",days:30},{name:"octobre",abbr:"oct",days:31},{name:"novembre",abbr:"nov",days:30},{name:"décembre",abbr:"déc",days:31}],ordinals:["1er","2e","3e","4e","5e","6e","7e","8e","9e","0e","1e"]},it:{calendarEras:{"a.C.":"a.C.",aC:"a.C.","a.e.v.":"a.e.v.",aev:"a.e.v."},modifiers:{circa:"circa",prima:"prima",dopo:"dopo"},months:[{name:"gennaio",abbr:"gen",days:31},{name:"febbraio",abbr:"feb",days:29},{name:"marzo",abbr:"mar",days:31},{name:"aprile",abbr:"apr",days:30},{name:"maggio",abbr:"mag",days:31},{name:"giugno",abbr:"giu",days:30},{name:"luglio",abbr:"lug",days:31},{name:"agosto",abbr:"ago",days:31},{name:"settembre",abbr:"set",days:30},{name:"ottobre",abbr:"ott",days:31},{name:"novembre",abbr:"nov",days:30},{name:"dicembre",abbr:"dic",days:31}],ordinals:["0º","1º","2º","3º","4º","5º","6º","7º","8º","9º"]},sv:{calendarEras:{"f.Kr.":"f.Kr.",fKr:"f.Kr.","f.v.t.":"f.v.t.",fvt:"f.v.t."},modifiers:{om:"om",circa:"circa",cirka:"cirka",f:"f","före":"före",e:"e",efter:"efter"},months:[{name:"januari",abbr:"jan",days:31},{name:"februari",abbr:"feb",days:29},{name:"mars",abbr:"mar",days:31},{name:"april",abbr:"apr",days:30},{name:"maj",abbr:"maj",days:31},{name:"juni",abbr:"juni",days:30},{name:"juli",abbr:"juli",days:31},{name:"augusti",abbr:"aug",days:31},{name:"september",abbr:"sep",days:30},{name:"oktober",abbr:"okt",days:31},{name:"november",abbr:"nov",days:30},{name:"december",abbr:"dec",days:31}],ordinals:[]}},shared={lang:function(){var langAttr=$("html").attr("lang")||$("[lang]").first().attr("lang");return langAttr?langAttr.toLowerCase():"en"}(),localize:function(langSet,key){return langSet[this.lang]&&langSet[this.lang][key]?langSet[this.lang][key]:langSet[this.lang.substring(0,2)]&&langSet[this.lang.substring(0,2)][key]?langSet[this.lang.substring(0,2)][key]:langSet.en[key]||""},ucfirst:function(str){return str.charAt(0).toUpperCase()+str.substr(1).toLowerCase()},warn:function(msg,useAlert){window.console&&(console.warn(msg),useAlert&&/ancestry(?:stage|dev)/.test(window.location.hostname)&&alert(msg))}},months=shared.localize(langSets,"months"),modifiers=shared.localize(langSets,"modifiers"),ordinals=shared.localize(langSets,"ordinals"),calendarEras=shared.localize(langSets,"calendarEras"),version=2,doubleIncluded=!!$.dateValidator;if(doubleIncluded){if($.dateValidator.version===version){shared.warn("ERROR: You are including date-validator.js multiple times");return}if(shared.warn("ERROR: You are including multiple versions of date-validator.js"),$.dateValidator.version>version)return}$.dateValidator=function(value){var variations=[],dates=[],filtered=filterCalendarEra(value),extracted=extractData(filtered.str),isValidFormat=!1,nonUS=shared.lang!=="en"&&shared.lang!=="en-us";switch(extracted.terms.length){case 1:variations=generate1TermDates(extracted.terms);break;case 2:variations=generate2TermDates(extracted.terms,nonUS);break;case 3:variations=generate3TermDates(extracted.terms,nonUS);break;case 4:variations=generate4TermDates(extracted.terms,nonUS)}return variations.forEach(function(variation){var genealogical,isValid=!0;variation.day&&variation.month&&!isDayInMonth(variation.day,variation.month,variation.year)&&(isValid=!1);isValid&&(genealogical=getGenealogicalDate({era:filtered.era,date:variation,mods:extracted.modifiers}),genealogical===value&&(isValidFormat=!0),dates.push({day:variation.day,month:variation.month,monthAbbr:variation.monthAbbr,year:variation.year,doubleYear:variation.doubleYear,genealogical:genealogical,isFuture:isFutureDate(variation)}))}),{dates:dates,explicit:dates.length===1&&dates[0].genealogical===value,modifiers:extracted.modifiers,original:value,termsLength:extracted.terms.length,unknowns:extracted.unknowns,valid:isValidFormat}};$.dateValidator.getTest=function(){return{extractData:extractData,filterCalendarEra:filterCalendarEra,formatDoubleYear:formatDoubleYear,generate1TermDates:generate1TermDates,generate2TermDates:generate2TermDates,generate3TermDates:generate3TermDates,generate4TermDates:generate4TermDates,getGenealogicalDate:getGenealogicalDate,getNumericMonth:getNumericMonth,isDayInMonth:isDayInMonth,isFutureDate:isFutureDate,isLeapYear:isLeapYear,isModifier:isModifier,isOrdinal:isOrdinal,isUnknown:isUnknown,isValidDay:isValidDay,isValidDoubleYear:isValidDoubleYear,isValidYear:isValidYear,isYearInDoubleRange:isYearInDoubleRange,processTerm:processTerm}};$.dateValidator.version=version})(jQuery)