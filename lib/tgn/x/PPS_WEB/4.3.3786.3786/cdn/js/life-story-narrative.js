"use strict";function mediaSelectModal(treeId,personId){var url="/modals/mediaselect/tree/"+treeId+"/person/"+personId;$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,success:function(data){$(data).modal({width:"760",onOpen:function(){$("#modalClose").hide()},onClose:function(){mediaSelectUpdate()}})}})}function mediaSelectUpdate(){var IDs=[];$(".mediaSelected").each(function(){IDs.push(this.id)})}function toggleShowFamilyEvents(treeId,personId){toggleStoryCheckedMenuItem("#storyFamilyEvents");var toggleUrl="/tree/"+treeId+"/person/"+personId+"/tab/lifestory/toggleShowFamilyEvents";$.ajax({url:toggleUrl,method:"GET",cache:!1,success:function(){window.glue.reload()}})}function toggleShowHistoricalInsights(treeId,personId){toggleStoryCheckedMenuItem("#storyHistoricalInsights");var toggleUrl="/tree/"+treeId+"/person/"+personId+"/tab/lifestory/toggleShowHistoricalInsights";$.ajax({url:toggleUrl,method:"GET",cache:!1,success:function(){window.glue.reload()}})}function toggleStoryCheckedMenuItem(idVal){var storyMenuItem=$(idVal);storyMenuItem.hasClass("calloutMenuChecked")?(storyMenuItem.removeClass("calloutMenuChecked"),storyMenuItem.addClass("calloutMenuUnchecked loading loadingSmall loadingOnBlack")):(storyMenuItem.removeClass("calloutMenuUnchecked"),storyMenuItem.addClass("calloutMenuChecked loading loadingSmall loadingOnBlack"));storyMenuItem.closest(".lifeStoryOptionsMenu").addClass("lifeStoryOptionsMenuDisabled")}$(function(){var tabPressed=!1,tabShiftPressed=!1,enterPressed=!1,narrativeSelected=!1;$(".lifeStoryNarrative").on("click",".editButton",function(){var $this=$(this),$narrativeSection=$this.closest(".lifeStoryNarrative"),$narrText;closeCallouts();$narrativeSection.addClass("lifeStoryNarrativeEditing");$narrText=$narrativeSection.find(".narrativeText");$narrText.attr({contenteditable:"true",spellcheck:"false"});$(".timelineItem").addClass("timelineItemEditingDisabled");$narrText.focus()}).on("click",".closeNarEditing",function(){var $this=$(this),narrativeSection=$this.closest(".lifeStoryNarrative"),selection=window.getSelection?window.getSelection():document.selection?document.selection:null,narrativeData,narrativeOriginalText;$this.hasClass("closeNarEditingCancel")&&(!selection||(selection.empty?selection.empty():selection.removeAllRanges()),$(".lifeStoryNarrative").removeClass("lifeStoryNarrativeEditing").find(".narrativeText").removeAttr("contenteditable spellcheck"),$(".timelineItem").removeClass("timelineItemEditingDisabled"),narrativeSection.focus(),narrativeData=$(".narrativeText"),narrativeData.length>0&&(narrativeOriginalText=narrativeData.attr("data-narrative-original"),(narrativeData.text().length!==narrativeOriginalText.length||narrativeData.text().toString()!=narrativeOriginalText.toString())&&narrativeData.text(narrativeOriginalText)))}).on("click",".addLifeStory",function(){$(this).closest(".lifeStoryNarrative").find(".editButton").trigger("click")}).on("mousedown",".narrativeText",function(){tabPressed=!1;tabShiftPressed=!1;narrativeSelected=!1}).on("focus",".narrativeText",function(){if(tabPressed||tabShiftPressed){var el=this,range=document.createRange(),sel=window.getSelection();range.selectNodeContents(el);sel.removeAllRanges();sel.addRange(range)}else tabPressed=!1,tabShiftPressed=!1}).on("keydown",".narrativeText, .closeNarEditing",function(event){tabPressed=tabShiftPressed=enterPressed=!1;event.which===9&&event.shiftKey&&(tabShiftPressed=!0);event.which!==9||event.shiftKey||(tabPressed=!0);event.which===13&&(enterPressed=!0)}).on("keyup",".narrativeText",function(){var $this=$(this);$this.text()===""&&$this.empty()}).on("blur",".narrativeText",function(event){var $this=$(this),narrativeSection=$this.closest(".lifeStoryNarrative"),selection=window.getSelection?window.getSelection():document.selection?document.selection:null;return event.preventDefault(),!selection||(selection.empty?selection.empty():selection.removeAllRanges()),window.personScreenType("smart-phone")&&tabShiftPressed&&narrativeSection.find(".closeNarEditingCancel").focus(),!window.personScreenType("smart-phone")&&tabPressed&&narrativeSection.find(".closeNarEditingCancel").focus(),!window.personScreenType("smart-phone")&&tabShiftPressed&&narrativeSection.find(".closeNarEditingSave").focus(),!1}).on("blur",".closeNarEditingCancel",function(){var $this=$(this),narrativeSection=$this.closest(".lifeStoryNarrative");return window.personScreenType("smart-phone")&&tabPressed?(narrativeSection.find(".narrativeText").focus(),!1):!window.personScreenType("smart-phone")&&tabShiftPressed?(narrativeSection.find(".narrativeText").focus(),!1):void 0});PersonStory.showGuidance&&$(".personPageStory .guidanceModalTrigger").click()})