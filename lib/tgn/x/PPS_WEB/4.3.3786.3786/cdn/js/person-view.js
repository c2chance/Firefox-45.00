"use strict";function loadScripts(scriptsToLoad,callback){var remainingScriptsToLoad=scriptsToLoad.slice(),scriptToLoad;remainingScriptsToLoad.length===0?callback&&callback():(scriptToLoad=remainingScriptsToLoad.splice(0,1)[0],$.cachedScript(scriptToLoad,{success:function(){loadScripts(remainingScriptsToLoad,callback)}}))}function checkNotesAndComments(){$("html").hasClass("printFriendly")?((!$("html").hasClass("pFHasNotes")&&showingNotes===!1||$("html").hasClass("pFHasNotes")&&$("#printFriendlyNotes").children().length===0)&&getPersonNotes(),checkComments()):$("html").hasClass("pageWrapDrawer")?(showingNotes===!0&&($("html").removeClass("pFShowingComments"),$("html").addClass("pFShowingNotes"),checkNotes()),showingComments===!0&&($("html").removeClass("pFShowingNotes"),$("html").addClass("pFShowingComments")),checkComments()):$("html").removeClass("pFShowingComments pFShowingNotes")}function checkNotes(){$("#printFriendlyNotes").text().length>0?$("html").addClass("pFHasNotes"):$("html").removeClass("pFHasNotes")}function checkComments(){$("html").hasClass("pFHasComments")&&(commentWidgetHasLoaded===!1?loadComments():cloneCommentsForPrinting())}function beforePrint(){closeBeforePrint();$("html").addClass("pFNoTransitions");$(".pageHeader").hasClass("pageHeaderFacts")&&($("html").hasClass("printFriendly")&&$(".factsSectionSources").insertAfter($(".factsSectionFamily")),checkNotesAndComments())}function afterPrint(){$("html").removeClass("pFNoTransitions");$(".pageHeader").hasClass("pageHeaderFacts")&&($("html").hasClass("printFriendly")&&($(".factsSectionSources").insertAfter($(".factsSectionFacts")),clearPrintFriendly(),typeof checkPageActions=="function"&&checkPageActions()),$(".printFriendlyViewTriggered").length>0&&$(".printFriendlyViewTriggered").removeClass("printFriendlyViewTriggered").focus())}function closeBeforePrint(){$("html").hasClass("modalOpen")&&$.modal.close();$(".callout").hasClass("active")&&closeCallouts()}function clearPrintFriendly(){$("html").removeClass("printFriendly pFNoTransitions pFNoFacts pFNoFamily pFNoSources pFShowingNameGender pFShowingSiblings");checkNotesAndComments()}function printFunction(){PersonCard.showMyCanvas?$(".pageHeader").hasClass("pageHeaderFacts")?($("html").addClass("printFriendly"),beforePrint()):PersonCard.hasEditRights?printPersonViewModal():(closeBeforePrint(),setTimeout(function(){window.print()},200)):(closeBeforePrint(),setTimeout(function(){window.print()},200))}function cloneCommentsForPrinting(){cloneComments===!0&&(cloneComments=!1,$("#printFriendlyComments").empty(),$("#personCommentsSection .comment.userCard:not(.addComment):not(.signIn)").each(function(){var $this=$(this),userCardContent=$this.find(".userCardContent"),userCardName=$this.find(".userCardName").text(),userCardComment=$this.find(".userCardName + span").text(),userCardInfo=$this.find(".userCardInfo small > span:first-child").text();userCardContent.length>0&&$('<div class="userCard userCardSize3 printFriendlyUserCard"><div class="userCardImg icon iconPerson"><\/div><div class="userCardContent"><p class="userCardComment"><strong>'+userCardName+"<\/strong> "+userCardComment+'<\/p><div class="userCardInfo"><small>'+userCardInfo+"<\/small><\/div><\/div><\/div>").appendTo("#printFriendlyComments")}),cloneComments=!0)}function printPersonViewModal(){$("#printPersonViewModal").modal({width:"410",title:PersonCard.text.printingOptionsTitle,useCustomPadding:!0,onOpen:function(){$(".printPersonViewModal").off("click").on("click",".iconPrint",function(){closeBeforePrint();setTimeout(function(){window.print()},200)})},onClose:function(){$(".myCanvasPrintModalTriggered").removeClass("myCanvasPrintModalTriggered").focus()}})}function findAPersonTreeOptionsPersonCard(){$(".treeOptions").callout({type:"click",classes:"treeOptionsCallout",content:"#personLookup",onOpen:function(){personTypeAheadNameField($("#personLookupField"),"",null,"personCard",!0)},onAfterOpen:function(){$("#personLookupField").focus()},onClose:function(){$(".treeOptions").focus()}})}function resetTypeAhead(fieldName){var typeAheadField=$(fieldName);typeAheadField.val().length===0&&$(".autocompleteCon").removeClass("autocompleteVisible")}function personTypeAheadNameField($typeAhead,excludepids,typeAheadSaveButton,section,showExtra){var hasSection=typeof section!="undefined"&&section!=null&&section.length>0,treeId=PersonCard.treeId;typeof typeAheadSaveButton!="undefined"&&typeAheadSaveButton!=null&&typeAheadSaveButton.length>0&&typeAheadSaveButton.attr("disabled","disabled");$typeAhead.autocomplete({alwaysOpenOnFocus:!0,source:"/suggest/person?treeId="+treeId+"&serviceDown=none&excludePids="+excludepids,key:"name",queryParameter:"term",dataType:"json",minLength:3,maxResults:20,customDisplay:function(data){var displayText=data.display;return(data.raw.birth!=""||data.raw.death!="")&&(displayText+=" "+data.raw.birth+" - "+data.raw.death),{value:data.value,display:displayText}},onOpen:function($resultContainer,$before,$after){showExtra&&$after.html($("#findPersonActions").html())},onItemSelect:function(itemData){var pageUrl,$this,$card;if(itemData!==""){if(hasSection&&section==="personCard"){pageUrl=PersonCard.URL.storyHref;switch($(".tabActive").attr("id")){case"tabFacts":pageUrl=PersonCard.URL.factsHref;break;case"tabGallery":pageUrl=PersonCard.URL.galleryHref;break;case"tabHints":pageUrl=PersonCard.URL.hintsHref}typeof itemData.PID!="undefined"&&(pageUrl=pageUrl.replace(PersonCard.personId,itemData.PID));window.location=pageUrl}$this=$(this);$this.length>0&&($this.addClass("selectedPerson"),itemData.PID!=""&&($card=$this.closest(".card"),$card.find(".erAddExistingData").data("itemData",itemData)));typeof typeAheadSaveButton!="undefined"&&typeAheadSaveButton!=null&&typeAheadSaveButton.length>0&&typeAheadSaveButton.removeAttr("disabled")}}});$typeAhead.on("input",function(){$(this).removeClass("selectedPerson")})}function toggleDrawer(){var toggleDrawerElement=$("html");if(toggleDrawerElement.hasClass("pageWrapDrawer"))toggleDrawerElement.removeClass("noTransitionsForPageWrap pageWrapDrawer pFShowingNotes pFShowingComments");else toggleDrawerElement.addClass("pageWrapDrawer").one("transitionend",function(){toggleDrawerElement.hasClass("pageWrapDrawer")&&toggleDrawerElement.addClass("noTransitionsForPageWrap")});drawerIsOpen()?getPersonNotes():closeNotes()}function toggleDrawerToTab(tabSelector){closeCallouts();drawerIsOpen()?$(tabSelector).hasClass("tabActive")?toggleDrawer():$(tabSelector).click():(toggleDrawer(),$(tabSelector).click())}function drawerIsOpen(){return $("html").hasClass("pageWrapDrawer")}function loadCommentCount(){var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/commentcount";$.ajax({url:url,cache:!1,timeout:2e4,success:function(data){if(typeof data!="undefined"&&typeof data.count!="undefined"){var count=data.count<1?"":data.count>99?"99+":data.count;count!==""?($(".personCommentsBtn .badge").text(count).removeClass("hideBadge"),$("html").addClass("pFHasComments")):($(".personCommentsBtn .badge").addClass("hideBadge"),$("html").removeClass("pFHasComments pFShowingComments"))}}})}function loadComments(){function loadScriptTagWithCallback(scriptSrc,callback){var scriptTag=$("<script />",{src:scriptSrc,type:"text/javascript"})[0];scriptTag.onload=callback;document.getElementsByTagName("head")[0].appendChild(scriptTag)}commentWidgetHasLoaded=!1;$("comment-widget").length>0&&$(".tabContentComments.loading").length===0&&($(".tabContentComments").addClass("loading loadingLarge"),$.get("http://"+PersonCard.domain.comments+"/ui/comment/cssfile?includeDomain=true",function(commentCssUrl){$("head").append($("<link />",{href:commentCssUrl,type:"text/css",rel:"stylesheet"}))}),loadScriptTagWithCallback(PersonCard.URL.angular,function(){$.get("http://"+PersonCard.domain.comments+"/ui/comment/jsfile?includeDomain=true",function(commentJsUrl){loadScriptTagWithCallback(commentJsUrl,function(){if(angular.bootstrap($("comment-widget"),["community"]),$(".tabContentComments").removeClass("loading loadingLarge"),$("html").hasClass("pFHasComments")&&$("html").hasClass("printFriendly"))var hasCommentsLoaded=setInterval(function(){$("#personCommentsSection .comment").length>=1&&(clearInterval(hasCommentsLoaded),cloneCommentsForPrinting())},50);commentWidgetHasLoaded=!0})})}))}function addOrientationClasses(image){var $item=$(image),ratio=parseInt($item.css("width"))/parseInt($item.css("height"));ratio<1&&$item.parent(".photo").addClass("photoPortrait");ratio>1&&$item.parent(".photo").addClass("photoLandscape");$item.removeClass("imageNeedsOrientation")}function researchToolbar(){var curView="",tUrl;$(".pageNav").hasClass("pageNavCollapsed")?($(".pageNav").removeClass("pageNavCollapsed").addClass("pageNavExpanded"),curView="Expanded"):($(".pageNav").removeClass("pageNavExpanded").addClass("pageNavCollapsed"),curView="Collapsed");closeCallouts();tUrl="/northstar/personview/researchtoolbar?view="+curView;$.ajax({cache:!1,url:tUrl}).done(function(){})}function closeCallouts(){$(".calloutTrigger.active").callout("close")}function renderView(tabId){var $personHeader=$(".pageHeader"),$currentTab=$(".tabActive"),$newTab=$("#"+tabId),currentId=$currentTab.attr("id");$personHeader.removeClass("pageHeader"+getCurrentViewName(currentId));tabId!=="tabStory"?$personHeader.removeClass("pageHeaderStory").addClass("pageHeaderNotStory pageHeader"+getCurrentViewName(tabId)):$personHeader.removeClass("pageHeaderNotStory pageHeaderFacts pageHeaderGallery pageHeaderHints").addClass("pageHeaderStory");$("html").hasClass("printFriendly")&&clearPrintFriendly()}function getCurrentViewName(id){switch(id){case"tabFacts":return"Facts";case"tabGallery":return"Gallery";case"tabHints":return"Hints";default:return"Story"}}function CheckTextAreaLength(textBox,maxLength){var textBoxEl=$("#"+textBox.id);textBoxEl.length>0&&textBoxEl.val().length>maxLength&&textBoxEl.val(textBoxEl.val().substring(0,maxLength))}function CheckTextElementLength(textBox,maxLength){textBox.innerText.length>maxLength&&(textBox.innerText=textBox.innerText.substring(0,maxLength))}function updateModalTitle(tabContent1Val,tabContent2Val,tabContent3Val,tabContent4Val,tabContent5Val){$(".tabContent1").hasClass("tabActive")&&$.modal.title(tabContent1Val);$(".tabContent2").hasClass("tabActive")&&$.modal.title(tabContent2Val);$(".tabContent3").hasClass("tabActive")&&$.modal.title(tabContent3Val);$(".tabContent4").hasClass("tabActive")&&$.modal.title(tabContent4Val);$(".tabContent5").hasClass("tabActive")&&$.modal.title(tabContent5Val)}function modalButtonClick(){$("#modalContents").on("click",".tab",function(){if($("#modal").hasClass("modalEditEvent")){var displayLifeStory=$(".tabContent4").find(".displayLifestory"),displayLifeStoryVal=displayLifeStory.prop("checked");displayLifeStory.data("original-displaylifestory",displayLifeStoryVal.toString())}$("#modal").hasClass("modalEditSource")&&updateModalTitle($(".title").val(),$(".citationDetailTitle").val(),$(".associatedFactsEventsTitle").val(),$(".attachedMediaTitle").val());$.modal.center()})}function removePersonModal(){closeCallouts();$("#modalRemovePerson").modal({title:PersonCard.text.removePersonTitle,onOpen:function(){$("#documentReturnURL").val(document.URL)},onClose:function(){$(".remModalTriggered").removeClass("remModalTriggered").focus()}})}function removePerson(){$.ajax({url:PersonCard.URL.removePerson,type:"POST",data:{name:PersonCard.name},success:function(data){data&&data.success?location.href=data.returnUrl:($.modal.close(),acom.bus.emit("FamilySearch::Notify::Failure",data.message,PersonCard.text.removePersonTitle))},error:function(){}})}function detachMediaFromCitation(citationId,mediaId,callback){var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/citationId/"+citationId+"/mediaid/"+mediaId+"/detachmediafromcitation";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){typeof callback=="function"&&callback(data)},error:function(){window.lock.actionInProgress=!1;personAnalyticsTrackClick("detachMediaFromCitation-Failed")}})}function detachMediaFromEvent(assertionId,mediaId,callback){var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/assertionid/"+assertionId+"/mediaid/"+mediaId+"/detachmediafromevent";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){typeof callback=="function"&&callback(data,assertionId,mediaId)},error:function(){window.lock.actionInProgress=!1;personAnalyticsTrackClick("detachMediaFromEvent-Failed")}})}function bindProfileImageClick(){if(PersonCard&&PersonCard.hasEditRights&&PersonCard.isProfileImageCropEnabled){var userCard=$("#personCard .userCardImg");if(PersonCard.primaryImageId)userCard.off().callout("destroy").callout({type:"click",style:"dark",classes:"calloutMenu",content:"#profileImageCalloutDomContent"});else userCard.callout("destroy").off().on("click",showChooseProfileImageModal)}}function updatePersonProfileImage(mediaId,cropRect){var url="http://"+PersonCard.domain.mediaAPI+"/api/trees/"+PersonCard.treeId+"/persons/"+PersonCard.personId,requestData={mediaId:mediaId||""},readCookie=function(name){for(var c,nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(c=ca[i];c.charAt(0)===" ";)c=c.substring(1,c.length);if(c.indexOf(nameEQ)===0)return c.substring(nameEQ.length,c.length)}return null};$.ajax({type:"PUT",url:url,data:JSON.stringify(requestData),contentType:"application/json",beforeSend:function(request){request.setRequestHeader("ATT",readCookie("ATT"))},success:function(){PersonCard.primaryImageId=requestData.mediaId;PersonCard.primaryImageCropRect=cropRect||"";loadProfileImage()},error:function(){acom!=null&&acom.bus!=null&&acom.bus.emit("RemoveProfileImage::Notify::Failure",PersonCard.text.removeProfileImageError,PersonCard.text.removeProfileImageTitle)}})}function loadProfileImage(){var userCardImage=$("#personCard .userCardImg");PersonCard.primaryImageId?(userCardImage.removeClass("icon iconMale iconFemale iconPerson").find("img").attr("src",getProfileImageUrl),setMediaViewerCropUrl()):userCardImage.addClass("icon icon"+PersonCard.gender);bindProfileImageClick()}function getProfileImageUrl(){var url=PersonCard.domain.mediaSvc+"/v2/image/namespaces/1093/media/"+PersonCard.primaryImageId+"?client=PersonUI&maxSide=280";return PersonCard.primaryImageCropRect&&(url+="&ImageQuality=UltraHighQuality&scaleUpToMax=true&prescalecroprect="+PersonCard.primaryImageCropRect),url}function showChooseProfileImageModal(){if(acom&&acom.bus){if(!acom.bus.listeners("Selector::selectionUpdated").length)acom.bus.on("Selector::selectionUpdated",function(mediaIds){var mediaItem=mediaIds[0];updatePersonProfileImage(mediaItem.id,mediaItem.cropRect);$.modal.close()});if(!acom.bus.listeners("Selector::loaded").length)acom.bus.on("Selector::loaded",function(){$.modal.center()})}var modalContainer=$("#chooseProfileImageModalContainer");modalContainer.modal({onOpen:function(){var pubOptions;ancestry.pub&&(pubOptions={destInputs:{TreeId:PersonCard.treeId,PersonId:PersonCard.personId,SelectedMediaIds:PersonCard.primaryImageId,MediaTypesFilter:"p"},currentPageIsStart:!0},ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId}),ancestry.pub.getUrl("MediaSelectorComponent",pubOptions,function(e,url){if(!e){var glueOptions={domId:"chooseProfileImageModalContainer",url:url};window.glue.fetch(glueOptions)}return!1}));var $modalHeader=$("#modalHeader"),$modalContents=$("#modalContents"),minHeight=$(window).height()-parseInt($modalContents.css("margin-top"),10)*2-$modalHeader.outerHeight(!1)-parseInt($modalHeader.css("margin-bottom"),10)*2;$modalContents.css({"min-height":minHeight})},onClose:function(){modalContainer.empty()},title:PersonCard.text.chooseProfileImageModalTitle.replace("{personName}",PersonCard.name),width:"100%"})}function attachMediaToCitation(citationId,mediaId,callback){var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/citationId/"+citationId+"/mediaid/"+mediaId+"/attachmediatocitation";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){typeof callback=="function"&&callback(data)},error:function(){window.lock.actionInProgress=!1;personAnalyticsTrackClick("attachMediaToCitation-Failed")}})}function attachMediaToEvent(assertionId,mediaId,callback){var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/assertionid/"+assertionId+"/mediaid/"+mediaId+"/attachmediatoevent";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){typeof callback=="function"&&callback(data)},error:function(){window.lock.actionInProgress=!1;personAnalyticsTrackClick("attachMediaToEvent-Failed")}})}function detachSourceFromEvent(assertionId,sourceId,selector,callback){var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/assertionid/"+assertionId+"/sourceid/"+sourceId+"/detachsourcefromevent";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){typeof callback=="function"&&callback(data)},error:function(){window.lock.actionInProgress=!1;updateSourceAttachDetachState(assertionId,sourceId,!0,selector);personAnalyticsTrackClick("detachSourceFromEvent-Failed")}})}function attachSourceToEvent(assertionId,sourceId,selector,callback){var url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/assertionid/"+assertionId+"/sourceid/"+sourceId+"/attachsourcetoevent";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){typeof callback=="function"&&callback(data)},error:function(){updateSourceAttachDetachState(assertionId,sourceId,!1,selector);personAnalyticsTrackClick("attachSourceToEvent-Failed")}})}function saveToTree(){window.closeCallouts();$.ajax({url:PersonCard.URL.saveToTree,type:"GET",dataType:"jsonp",contentType:"application/json",jsonpCallback:"handleJSON",success:function(){},error:function(){var html="<div><p>"+PersonCard.text.saveToTreeError+"<\/p><\/div>";$(html).modal({title:PersonCard.text.saveToTreeTitle,width:"760",onOpen:function(){}})}})}function quickEdit(){var apmCallback=function(cbResponse){return cbResponse.reqRefresh===!0?(location.reload(),!1):(cbResponse.mode==="m"&&$.modal.close(),cbResponse.status==="success"&&(window.personAnalyticsTrackClick("QuickEditPersonSaved"),window.getPersonCard()),!0)};AddPerson.Edit(PersonCard.treeId,PersonCard.personId,{},apmCallback)}function addFamilyMember(tid,pid,args){var apmCallback=function(cbResponse){return cbResponse.status==="success"&&(window.personAnalyticsTrackClick("QuickEditPersonSaved"),window.getPersonCard()),cbResponse.mode==="m"&&$.modal.close(),!0};AddPerson.Add(tid,pid,args,apmCallback)}function getPersonCard(){$.ajax({url:PersonCard.URL.getPersonCard,type:"GET",dataType:"json",contentType:"application/json",jsonpCallback:"handleJSON",success:function(response){var pcc=$("#personCardContainer");pcc.length>0&&response.html!==""&&(pcc.html(response.html),typeof response.js!="undefined"&&typeof personCardLoaded=="undefined"&&$.getScript(response.js).done(function(){}).fail(function(){}),bindProfileImageClick())},error:function(){}})}function editRelationships(addedPid,addedRelation,isTransition){(isTransition==null||isTransition===!1)&&window.closeCallouts();var name=PersonCard.text.editRelsModalTitle.replace("{fullName}",$("#personCardContainer").find(".userCardTitle").html());$('<div class="modalPersonView modalEditRelationship form" id="editRelationshipsModal"><\/div>').modal({title:name,useCustomPadding:!1,width:"760",showLoading:!0,onOpen:function(){$.ajax({url:PersonCard.URL.editRelationships,data:{addedPid:addedPid,addedRelation:addedRelation},type:"GET",dataType:"jsonp",cache:!1,contentType:"application/json",success:function(response){$.modal.showLoading(!1);$(".modalEditRelationship").html(response.html);$.cachedScript(PersonCard.editRelationshipUrl).done(function(){response.data.addedPid=addedPid;window.editRelationship(response.data)})},error:function(){$.modal.showLoading(!1);var html='<div class="ancGrid ancGridPadded"><div class="ancCol w100"><p class="icon iconWarning">'+PersonCard.text.editRelationshipsError+"<\/p><\/div><\/div>";$(".modalEditRelationship").html(html);$.modal.center()}})},onClose:function(){$(".editRelModalTriggered").removeClass("editRelModalTriggered").focus();window.editRelationship&&window.editRelationship.updated&&(window.glue?window.glue.reload():location.reload());$.get("/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/relationship/log/modalclose")}})}function handleJSON(response){$(response.html).modal({title:PersonCard.text.saveToTreeTitle,width:"760",onOpen:function(){$.getScript(response.js).done(function(){}).fail(function(){})},onClose:function(){$(".savModalTriggered").removeClass("savModalTriggered").focus()}})}function reloadContent(){$(".pageHeader .tab.tabActive").click()}function clearNarrativeCache(){var ccUrl="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/clearnarrativecache";$.ajax({url:ccUrl,method:"GET",async:!1})}function updateHintCount(data){var $hintbubble=$("#tabHintCount"),n=data;n<=0?(n=0,$hintbubble.addClass("hideBadge")):$hintbubble.removeClass("hideBadge");n>99&&(n="99+");$hintbubble.text(n);$("#personTabs").tabs()}function setMediaViewerUrl(){ancestry.pub&&(ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId}),ancestry.pub.buildUrl().toGoTo("MediaViewer",{MediaId:PersonCard.primaryImageId,TreeId:PersonCard.treeId,PersonId:PersonCard.personId}).toComeBackToCurrent(!0).build(function(err,url){err||(window.location=url)}))}function setMediaViewerCropUrl(){ancestry.pub&&(ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId}),ancestry.pub.buildUrl().toGoTo("MediaViewer",{MediaId:PersonCard.primaryImageId,TreeId:PersonCard.treeId,PersonId:PersonCard.personId,ShowImageCropping:1}).toComeBackToCurrent(!0).build(function(err,url){err||(window.location=url)}))}function setLifeStoryMediaUploadWithHistoryUrl(clickAnchor,assertionId){if(ancestry.pub){var options={destInputs:{TreeId:PersonCard.treeId,PersonId:PersonCard.personId,AssertionId:assertionId,MediaType:"Photo"},currentPageIsStart:!0};ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId});ancestry.pub.getUrl("PersonFactMediaObjectUpload",options,function(e,url){if(!e)return window.location=url,!1})}}function setFactsMediaUploadWithHistoryUrl(clickAnchor,assertionId){if(ancestry.pub){var options={destInputs:{TreeId:PersonCard.treeId,PersonId:PersonCard.personId,AssertionId:assertionId,MediaType:"Media"},currentPageIsStart:!0};ancestry.pub.setCurrentPage("PersonFactsFactEdit",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId,AssertionId:assertionId,TabName:"Media"});ancestry.pub.getUrl("PersonFactMediaObjectUpload",options,function(e,url){e||(window.location=url)})}}function setCitationMediaUploadWithHistoryUrl(clickAnchor,citationId){ancestry.pub&&(ancestry.pub.setCurrentPage("PersonFactsCitationEdit",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId,CitationId:citationId,TabName:"Media"}),ancestry.pub.buildUrl().toGoTo("PersonCitationMediaObjectUpload",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId,CitationId:citationId,MediaType:"Photo"}).toComeBackToCurrent(!0).build(function(e,url){e||(window.location=url)}))}function setLifeStoryHistoryPoint(){var setHistoryPoint="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/setlifestoryhistorypoint";$.ajax({url:setHistoryPoint,method:"GET",success:function(){}})}function setSearchWithHistoryUrl(clickAnchor){if(ancestry.pub){var options={destInputs:{TreeId:PersonCard.treeId,PersonId:PersonCard.personId,SSRC:"pt"},currentPageIsStart:!0};ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId});ancestry.pub.getUrl("PersonRecordSearch",options,function(e,url){if(!e)return clickAnchor.href=url,window.location=url,!1})}}function setMergeDuplicateWithHistoryUrl(clickAnchor){if(ancestry.pub){var options={destInputs:{TreeId:PersonCard.treeId,PersonId:PersonCard.personId,PersonIdPrimary:PersonCard.personId},currentPageIsStart:!0};ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId});ancestry.pub.getUrl("PersonMergeDuplicatePickPerson",options,function(e,url){if(!e)return clickAnchor.href=url,window.location=url,!1})}}function setViewMediaWithHistoryUrl(clickAnchor){if(ancestry.pub){var options={destInputs:{TreeId:PersonCard.treeId,PersonId:PersonCard.personId,ObjectId:"pt"},currentPageIsStart:!0};ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId});ancestry.pub.getUrl("MediaObject",options,function(e,url){e||(clickAnchor.href=url)})}}function setHintsPubCurrentPage(data){var pair,key;if(ancestry.pub){var inputs={TreeId:PersonCard.treeId,PersonId:PersonCard.personId},pairs=location.search.slice(1).split("&"),index=0;try{if(pairs[index].length)for(index=0;index<pairs.length;index++)pair=pairs[index].split("="),pair&&pair[0].startsWith&&pair[0].startsWith("Hints.")&&(key=pair[0].replace("Hints.",""),key=key.charAt(0).toUpperCase()+key.slice(1),inputs[key]=decodeURIComponent(pair[1]||""))}catch(e){}ancestry.pub.setCurrentPage("PersonPageHintsView",inputs);window.acom&&window.acom.bus&&window.acom.bus.emit("csm::history::currentpagechange",data)}}function setGalleryPubCurrentPage(){ancestry.pub&&ancestry.pub.setCurrentPage("PersonViewMediaGallery",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId})}function setHintsWithHistoryUrl(){if(ancestry.pub&&(setHintsPubCurrentPage({}),acom&&acom.bus&&acom.bus.listeners("csm::history::statechange").length<1))acom.bus.on("csm::history::statechange",setHintsPubCurrentPage)}function setViewRecordImageHistory(clickAnchor,citationId){ancestry.pub&&ancestry.pub.setCurrentPage("PersonFactsCitationEdit",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId,CitationId:citationId})}function setViewRecordPageHistory(clickAnchor,citationId){ancestry.pub&&ancestry.pub.setCurrentPage("PersonFactsCitationEdit",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId,CitationId:citationId})}function setMemberConnectWithHistoryUrl(clickAnchor){if(ancestry.pub){var options={destInputs:{TreeId:PersonCard.treeId,PersonId:PersonCard.personId},currentPageIsStart:!0};ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId});ancestry.pub.getUrl("PersonMemberConnect",options,function(e,url){if(!e)return clickAnchor.href=url,window.location=url,!1})}}function setGalleryHistoryPoint(){var setHistoryPoint="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/setgalleryhistorypoint";$.ajax({url:setHistoryPoint,method:"GET",success:function(){}})}function setMilitaryWithHistoryUrl(clickAnchor){if(ancestry.pub){var options={destInputs:{TreeId:PersonCard.treeId,PersonId:PersonCard.personId},currentPageIsStart:!0};ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId});ancestry.pub.getUrl("PersonMilitaryPage",options,function(e,url){if(!e)return clickAnchor.href=url,window.location=url,!1})}}function setTreeLink(clickAnchor,pubName){var options={destInputs:{TreeId:PersonCard.treeId},currentPageIsStart:!1};ancestry.pub&&ancestry.pub.getUrl(pubName,options,function(e,url){if(e)window.console!=null&&console.err(e);else return clickAnchor.href=url,window.location=url,!1})}function getPersonHintsCount(){var hintsCountUrl="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/hintscount";$.ajax({url:hintsCountUrl,method:"GET",success:function(data){updateHintCount(data.PendingHintCount)}})}function actionComplete(){try{window.glue.reload(function(){window.lock.actionInProgress=!1})}catch(e){window.lock.actionInProgress=!1}}function closeNotes(){SaveController.SaveWithCheck();$("#savingChangesText").hide();window.onbeforeunload=null}function getClEditorTextDataArea(){return $(".cleditorMain iframe").contents().find("body")}function convertHtmlTags(htmlVal){return htmlVal.replace(/>/g,"&gt;").replace(/</g,"&lt;")}function clearChangesSavedText(){$("#savingChangesText").hide();$("#savingChangesText").html(PersonCard.text.savingChanges)}function getPersonNotes(callback){var getPersonNotesUrl="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/getPersonNotes";$.ajax({url:getPersonNotesUrl,method:"GET",cache:!1,success:function(data){var notesField,pFNotesField,notesValOriginal;data&&data.note!=null&&(notesField=$("#NotesTextAreaNoEditor"),pFNotesField=$("#printFriendlyNotes"),notesField.length>0&&(notesField.html(data.note),notesField.attr("data-notes-original",data.note),notesValOriginal=notesField.attr("data-notes-original"),(notesValOriginal.length!==notesField.html().length||notesValOriginal!==notesField.html())&&(window.onbeforeunload=function(evt){return SaveController.SaveWithCheck(),evt.returnValue=undefined,undefined})),pFNotesField.html(data.note),checkNotes());callback&&callback()},error:function(){personAnalyticsTrackClick("getPersonNotes-Failed");callback&&callback()}})}function savePersonNotes(callback){var notesField,pFNotesField,converted,savePersonNotesUrl;$("#savingChangesText").show();notesField=$("#NotesTextAreaNoEditor");pFNotesField=$("#printFriendlyNotes");notesField.length>0&&(converted=notesField.html(),savePersonNotesUrl="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/savePersonNotes",$.ajax({type:"POST",data:{note:converted},url:savePersonNotesUrl,timeout:2e4,success:function(data){typeof data.noteId!="undefined"&&data.noteId!=null&&($("#savingChangesText").text(PersonCard.text.changesSaved),notesField.html(converted),notesField.attr("data-notes-original",converted),pFNotesField.html(converted),checkNotes());callback&&callback()},error:function(){$("#savingChangesText").text(PersonCard.text.changesNotSaved);personAnalyticsTrackClick("savePersonNotes-Failed");callback&&callback()}}))}function saveUIState(selection,stateData){var $selection,selector,state;typeof selection!="undefined"&&(typeof selection=="string"&&(selection[0]=="#"||selection[0]==".")?(selector=selection,$selection=$(selection)):selection instanceof jQuery?($selection=selection,selector=$selection.attr("id"),selector?selector="#"+selector:(selector=$selection.attr("class"),selector&&(selector="."+selector))):window.console!=null&&console.warn("Could not save selector: "+selection),$selection.length&&(state={"selection-id":selector,"selection-rect":$selection[0].getBoundingClientRect(),"selection-offset":$selection.offset()},stateData&&$.extend(state,{"state-data":stateData}),$("html").data(state)))}function loadUIState(triggerEvent,setScrollPosition){var $html=$("html"),stateData,selection;if($html.data("selection-id"))return selection={id:$html.data("selection-id"),$el:$($html.data("selection-id")),rect:$html.data("selection-rect"),offset:$html.data("selection-offset")},$html.data("state-data")&&(stateData=$html.data("state-data")),selection.$el.length?(setScrollPosition&&$html.scrollTop(selection.$el.offset().top-selection.rect.top),selection.$el.trigger(triggerEvent||"focus"),$("."+$("html").data("saved-event-id")).focus()):setScrollPosition&&$html.scrollTop(selection.offset.top-selection.rect.top),$html.removeData("selection-id").removeData("selection-rect").removeData("selection-offset").removeData("state-data"),stateData}window.personScreenType=function(type){return type==="large-screen"?$(".responsiveFlag").css("text-align")==="center":type==="not-large-screen"?$(".responsiveFlag").css("text-align")==="left":type==="tablet-portrait"?$(".responsiveFlag").css("position")==="relative":type==="smart-phone"?$(".responsiveFlag").css("visibility")==="visible":type==="smart-phone-portrait"?$(".responsiveFlag").css("text-align")==="right":void 0};window.glue={};window.lock={actionInProgress:!1};$(function(){function getTabNameStringForPageTitle(tabName){switch(tabName){case"story":return PersonCard.text.lifeStoryTabName;case"facts":return PersonCard.text.factsTabName;case"gallery":return PersonCard.text.galleryTabName;case"hints":return PersonCard.text.hintsTabName}}function getTabData(tabName){var data={};switch(tabName){case"story":case"tabStory":data.tabId="tabStory";data.contentId="tabContentStory";data.url=PersonCard.URL.story;data.domId="personPageStory";data.key="story";data.queryValue="story";data.events={};break;case"facts":case"tabFacts":data.tabId="tabFacts";data.contentId="tabContentFacts";data.url=PersonCard.URL.facts;data.domId="personPageFacts";data.key="facts";data.queryValue="facts";data.events={};break;case"gallery":case"tabGallery":data.tabId="tabGallery";data.contentId="tabContentGallery";data.url=PersonCard.URL.gallery;data.domId="personPageGallery";data.key="gallery";data.queryValue="gallery";data.events={};break;case"hints":case"tabHints":data.tabId="tabHints";data.contentId="tabContentHints";data.url=PersonCard.URL.hints;data.domId="personPageHints";data.key="hints";data.queryValue="hints";data.events={"PersonHintTab::hintcount_change::pending":function(data){updateHintCount(data)}}}return data}function updateView($view){return(closeCallouts(),$view.removeClass("personPageError"),!$view.hasClass("loading"))?($view.addClass("loading loadingLarge").children().empty(),!0):!1}function changeView(tabId){renderView(tabId)}function showTabContent(options,$view){$view.removeClass("loading loadingLarge");checkForError($("#"+options.domId))}function gluePreProcess(tab){if(tab!=="csm"){var data=getTabData(tab),$view=$("#"+data.contentId),$tab=$("#"+data.tabId),$oldTab=$("a.tab.tabActive");$view.children()&&($view.hasClass("loading")||($("html").attr("data-page",tab),$oldTab.removeClass("tabActive"),$tab.addClass("tabActive"),$(".tabContent.tabActive").removeClass("tabActive"),$view.addClass("tabActive"),$view.find(".personPage").children().length===0?$tab.click():$view.load()));changeView($tab.attr("id"))}}function UpdateURL(history,data){var urlArray=history.url.split("?",2),newUrl=urlArray.join("").substring(0,urlArray[0].split("/",7).join("/").length)+"/"+PersonCard.tabName,event;urlArray.length>1&&(newUrl+="?"+urlArray[1]);for(event in data.events)acom.bus.on(event,data.events[event]);History.replaceState(data,HtmlDecode(PersonCard.name)+" - "+getTabNameStringForPageTitle(PersonCard.tabName),newUrl)}function HtmlDecode(s){var div=document.createElement("div");return div.innerHTML=s.replace(/<\/?[^>]+>/gi,""),div.childNodes[0]?div.childNodes[0].nodeValue:""}function checkForError($page){$page.find(".personPageUnavailable").length>0&&$page.addClass("personPageError")}function shouldWeCheckPageActions(){var isNotTheOwner=$(".treeOwnerAndRole").length>=1,isALargeScreen=window.personScreenType("large-screen"),isTherePlentyOfSpace=parseInt($(".pageCrumbs + .ancBtn").offset().left)-parseInt($(".pageCrumbs").css("width"))>375,isTreeOwnerAndRoleMini=$(".pageActions").hasClass("showingMiniTreeOwnerAndRole"),isDrawerOpen=$("html").hasClass("pageWrapDrawer"),toggleDrawerCheckPageActionsLoop;isNotTheOwner===!0&&isALargeScreen===!0&&isTherePlentyOfSpace===!1&&(isTreeOwnerAndRoleMini===!1&&isDrawerOpen===!1||isTreeOwnerAndRoleMini===!0&&isDrawerOpen===!0)&&(toggleDrawerCheckPageActionsLoop=setInterval(function(){checkPageActions()},25),setTimeout(function(){clearInterval(toggleDrawerCheckPageActionsLoop)},750))}var $TreesFunc,i,mediaQueryList;$(document).ready(function(){var defaultGlueOptions;loadScripts(PersonCard.jsAssets,getPersonHintsCount);defaultGlueOptions=typeof PersonCard!="undefined"?{key:PersonCard.tabName,queryValue:PersonCard.tabName,keyId:"#"+PersonCard.tabId,url:PersonCard.URL.current,domId:PersonCard.domId,combinatorPath:PersonCard.cacheUrl+"/lib/tgn/combo.ashx",options:$.extend({},{tab:PersonCard.tabName},getTabData(PersonCard.tabName))}:{key:"",queryValue:"",keyId:"#0",url:"",domId:"",combinatorPath:"",options:""};UpdateURL(History.getState(),defaultGlueOptions.options);var glue=new Glue(defaultGlueOptions),personHeader=$(".pageHeader"),htmlTag=$("html").attr("data-page",PersonCard.tabName);glue.preProcess=gluePreProcess;window.glue.reload=glue.reload;window.glue.fetch=glue.fetch});checkForError($(".tabContent.tabActive .personPage"));$("#personView .pageHeader .tabs .tab").on("click.personView",function(e){if(e.preventDefault(),!window.personScreenType("not-large-screen")||this.id!==$(".tabs .tab.tabActive").attr("id")){var options=getTabData(this.id),$view=$("#"+options.contentId);$("html").attr("data-page",options.queryValue);options.pushUrlState=!1;options.removeCacheFiles=!1;options.keyId="#"+this.id;options.callback=function(){showTabContent(options,$view,this)};updateView($view)&&glue.fetch(options);History.pushState({tab:options.queryValue,domId:$view.attr("id"),options:options},HtmlDecode(PersonCard.name)+" - "+getTabNameStringForPageTitle(options.queryValue),options.queryValue)}});$TreesFunc={FamilySearch:{loadWidget:function(callback){var qs=document.location.search||"";qs+=(qs?"&":"?")+"fsid="+$("#familySearchId").val();$.ajax({cache:!1,dataType:"jsonp",xhrFields:{withCredentials:!0},crossDomain:!0,url:PersonCard.domain.trees+"/tree/"+$("#treeId").val()+"/person/"+$("#personId").val()+"/fs/personwidget"+qs}).done(function(response){if(response!=null){$("#fsWidget").html(response.html);callback!=null&&callback();$("#fsCancelDisconnect").click(function(){$.modal.close()});$("#fsConfirmDisconnect").one("click",function(){$.ajax({cache:!1,dataType:"jsonp",xhrFields:{withCredentials:!0},crossDomain:!0,url:PersonCard.domain.trees+fsPerformDisconnectUrl}).done(function(jsonResponse){jsonResponse.success?($("#familySearchId").val(""),$("#fsOrdStatus").callout("close"),$.modal.close(),location.reload()):$("#fsDisconnectFail").modal({title:fsErrorDisconnecting})})});$("#fsDisconnect").click(function(){$("#fsDisconnectConfirm").modal({title:fsConfirmTitle})})}}).fail(function(){$("#fsWidget").parent(".familySearchTools").remove()})}}};bindProfileImageClick();$(".pageHeaderStory #researchTools .iconPrint").on("click",function(){$(this).addClass("myCanvasPrintModalTriggered");printFunction()});$(".pageHeaderFacts #researchTools .iconPrint").on("click",function(){$(this).addClass("printFriendlyViewTriggered");printFunction()});$("#treePagesList > li").length>0&&$(".treePagesButton").callout({type:"click",content:"#treePagesList",classes:"calloutMenu treePagesCallout"});$(".pageActions .badge.iconInfo").callout({type:"click",classes:"calloutOwner",content:"#yourRoleDomCalloutDomContent"});$(".researchToolsButton").callout({type:"click",classes:"calloutMenu calloutMenuResearchTools",content:"#researchToolsCalloutDomContent",onOpen:function(){$(".pageNav").hasClass("pageNavExpanded")?$(".researchToolsList .iconAfterCheck").addClass("calloutMenuChecked"):$(".researchToolsList .iconAfterCheck").addClass("calloutMenuUnchecked");loadCommentCount()},onAfterOpen:function(){$(".researchToolsList").one("click",".iconAfterCheck",function(){$(this).toggleClass("calloutMenuChecked calloutMenuUnchecked");researchToolbar();$(this).hasClass("calloutMenuChecked")?personAnalyticsTrackClick("showResearchToolbar"):personAnalyticsTrackClick("hideResearchToolbar")}).one("click",".myNotesBtn",function(){shouldWeCheckPageActions();toggleDrawerToTab("#myNotesTab")}).one("click",".personCommentsBtn",function(){shouldWeCheckPageActions();toggleDrawerToTab("#personCommentsTab")}).one("click",".iconPrint",function(){$(".researchToolsButton").addClass("printFriendlyViewTriggered");printFunction()});$(".pageHeader").hasClass("pageHeaderStory")||$(".pageHeader").hasClass("pageHeaderFacts")?$(".printOptionForLifeStoryAndFacts").removeClass("printOptionForLifeStoryAndFactsHidden"):$(".printOptionForLifeStoryAndFacts").addClass("printOptionForLifeStoryAndFactsHidden");$(document).on("click",".researchToolsList .iconPrint",function(){$(".pageActions .iconTools").addClass("myCanvasPrintModalTriggered")}).on("click",".researchToolsList .iconPlus",function(){$(".pageActions .iconTools").addClass("savModalTriggered")})},onClose:function(){$(".researchToolsList").off("click")}});loadCommentCount();$(".editToolsButton").callout({type:"click",classes:"calloutMenu calloutMenuEditTools",content:"#editToolsCalloutDomContent",onAfterOpen:function(){$(document).on("click",".editToolsList .iconTrash",function(){$(".pageActions .iconEdit").addClass("remModalTriggered")}).on("click",".editToolsList .iconFamily",function(){$(".pageActions .iconEdit").addClass("editRelModalTriggered")})}});$(".personToolsGuest").callout({type:"click",classes:"calloutMenu calloutMenuGuestTools",content:"#guestToolsCalloutDomContent",onOpen:function(){loadCommentCount()},onAfterOpen:function(){$(".guestToolsList").one("click",".iconPrint",function(){printFunction()}).one("click",".personCommentsBtn",function(){shouldWeCheckPageActions();loadComments();toggleDrawerToTab("#personCommentsTab")});$(".pageHeader").hasClass("pageHeaderStory")||$(".pageHeader").hasClass("pageHeaderFacts")?$(".printOptionForLifeStoryAndFacts").removeClass("printOptionForLifeStoryAndFactsHidden"):$(".printOptionForLifeStoryAndFacts").addClass("printOptionForLifeStoryAndFactsHidden")},onClose:function(){$(".guestToolsList").off("click",".personCommentsBtn")}});$(".drawerHeader").on("click","#personCommentsTab",loadComments);PersonCard.showFsWidget&&$TreesFunc.FamilySearch.loadWidget(function(){$("#fsOrdStatus, #fsConnectLink, #fsConnectingStatus, #fsNeedsSignIn").unwrap()});i=0;$(".relationshipLink").each(function(){var $this=$(this),url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/getrelationshiptext?page=unknown";$.ajax({url:url,type:"GET",dataType:"json",contentType:"application/json",success:function(data){data.content!=null&&$this.html(data.content)},error:function(){}})});$(".imageNeedsOrientation").each(function(i,e){var $item=$(e);if(parseInt($item.css("width"))+parseInt($item.css("height"))>0)addOrientationClasses(e);else $item.on("load",function(){addOrientationClasses(this)})});$(document).on("person.img.loaded",".imageNeedsOrientation",function(){var $this=$(this);$this.on("load",function(){addOrientationClasses(this)})}).ajaxSuccess(function(){$(".imageNeedsOrientation").trigger("person.img.loaded");$("html").hasClass("modalOpen")&&$.modal.center()}).on("click",".closeModal",function(){$.modal.close()}).on("click",".closeCallouts",function(){closeCallouts()}).on("click","#researchTools .saveToTree",function(){$(this).addClass("savModalTriggered")});$(".personView .card").on("focus",function(){var $this=$(this);$this.one("mousemove",function(){$this.blur()})});$(".pageHeader").off("click").on("click",".myNotesBtn",function(){shouldWeCheckPageActions();toggleDrawerToTab("#myNotesTab")}).on("click",".personCommentsBtn",function(){shouldWeCheckPageActions();toggleDrawerToTab("#personCommentsTab")}).on("click",".relLabel",function(){$(this).addClass("relModalTriggered")});$(".sideDrawer").on("click","#closeSideDrawerBtn",function(){shouldWeCheckPageActions();toggleDrawer();checkNotesAndComments()});PersonCard.showFindAPerson&&findAPersonTreeOptionsPersonCard();var params=window.location.search.substr(1).split("&"),p=params[0].split("="),p0=p[0];p[0]==="openTestQEModal"&&quickEdit();$(".tabContentComments").on("click",".comment .undo",function(){loadCommentCount()}).on("click",'.comment button[data-ng-click="deleteComment(comment)"]',function(){loadCommentCount()}).on("mouseup pointerup touchend click",'.comment button[data-ng-click="addComment()"]:not(.disabled)',function(){loadCommentCount()});$(window).resize(function(){$("html").addClass("windowIsResizing");setTimeout(function(){$("html").removeClass("windowIsResizing")},250)});window.onbeforeprint=beforePrint;window.onafterprint=afterPrint;window.matchMedia&&(mediaQueryList=window.matchMedia("print"),mediaQueryList.addListener(function(mql){mql.matches&&beforePrint()}));$("#myNotesTab").on("click",function(){showingComments=!1;showingNotes=!0;checkNotesAndComments()});$("#personCommentsTab").on("click",function(){showingNotes=!1;showingComments=!0;checkNotesAndComments()})});var commentWidgetHasLoaded=!1,cloneComments=!0,showingNotes=!1,showingComments=!1,customizeCalloutFocusOnFamilyEvents=!1,customizeCalloutFocusOnHistInsights=!1,customizeCalloutFocusOnAlternatives=!1;jQuery.cachedScript=function(url,options){return options=$.extend(options||{},{dataType:"script",cache:!0,url:url}),jQuery.ajax(options)};window.SaveController=function(){function triggerDelayedSave(delay,callback){clearChangesSavedText();delay||(delay=PersonCard.autoSaveTime);currentTimeout&&clearTimeout(currentTimeout);currentTimeout=setTimeout(checkSaveWithCallback(callback),delay)}function checkSaveWithCallback(callback){return function(){saveWithCheck(callback)}}function saveWithCheck(callback){var notesField=$("#NotesTextAreaNoEditor"),notesValOriginal,converted;notesField.length>0&&(notesValOriginal=notesField.attr("data-notes-original"),converted=notesField.html(),(notesValOriginal.length!==converted.length||notesValOriginal!==converted)&&savePersonNotes(callback))}var controller={TriggerDelayedSave:triggerDelayedSave,SaveWithCheck:saveWithCheck},currentTimeout;return controller}()