var AddPerson=function($){var _addPerson={cacheLoaded:!1,apmDefCallback:function(cbResponse){cbResponse.mode==="m"?$.modal.close():window.isCancelClicked||location.reload()},apsCallback:function(cbResponse){return cbResponse.newPid!=null&&cbResponse.status!=null&&(cbResponse.status==="success"?(window.glue.reload(),acom!=null&&acom.bus!=null&&acom.bus.emit("AddPerson::Notify::Success",cbResponse.message,cbResponse.title,!0)):cbResponse.status==="failure"&&acom!=null&&acom.bus!=null&&acom.bus.emit("AddPerson::Notify::Failure",cbResponse.message,cbResponse.title)),typeof AddPerson.apmCallback=="function"?AddPerson.apmCallback(cbResponse):AddPerson.apmDefCallback(cbResponse)},Modal:function(tid,pid,args,apmCallback,type){var url="http://"+addPersonUrl+"/modals/addPerson/tree/"+tid+"/person/"+pid,title=PersonCard.text.addPersonModalTitle,params;type==="edit"&&(url+="/edit",title=PersonCard.text.quickEditModalTitle);params={};typeof args=="object"?params=args:typeof args=="string"&&(params=JSON.parse(args));params.useNewVersion="5";params.isPageVersion=!1;$('<div id="AddPersonModal"><\/div>').modal({showLoading:!0,hideCloseBtn:!1,useCustomPadding:!0,closeOnBkgClick:!0,closeOnEscape:!0,isMarketing:!1,title:title,onOpen:function($this){$.ajax({url:url,xhrFields:{withCredentials:!0},crossDomain:!0,cache:!1,timeout:15e3,type:"GET",data:params,dataType:"jsonp",contentType:"application/json",success:function(response){if(response.hasexception){var html='<div class="ancGrid ancGridPadded"><div class="ancCol w100"><p class="icon iconWarning">'+PersonCard.text.addPersonErrorText+"<\/p><\/div><\/div>";$.modal.showLoading(!1);$this.html(html);$.modal.center()}else $.when(loadCacheFiles(response)).done(function(){if(AddPerson.cacheLoaded=!0,$.modal.resize(760),response.name){$.modal.title("");var profileHtml=response.imageUrl?'<div class="userCardImg"><img alt="'+response.title+'" src="'+response.imageUrl+'" style="vertical-align:middle;"><\/div>':'<div class="userCardImg userCardImgSquare icon icon'+response.gender+'" role="presentation"><\/div>',dateRangeHtml=response.dateRange?'&nbsp;<p class="userCardSubTitle" style="font-weight:normal;">'+response.dateRange+"<\/p>":"";$this.html('<div class="modalHeader modalHeaderUserCard" id="addPersonModalHeader"><div class="ancGrid full480"><div class="ancCol"><h4 class="modalTitle">'+response.title+'<\/h4><\/div><div class="ancCol ancColUserCard hide480"><div class="userCard userCardSize3" style="margin:4px 0 5px;">'+profileHtml+'<div class="userCardContent"><h6 class="userCardTitle">'+response.name+"<\/h6>"+dateRangeHtml+"<\/div><\/div><\/div><\/div><\/div>");$this.append(response.html);$.modal.showLoading(!1)}else $.modal.title(response.title),$this.html(response.html),$.modal.showLoading(!1);AddPerson.apmCallback=typeof apmCallback!="undefined"?apmCallback:AddPerson.apmDefCallback;typeof AddPersonModalInit=="function"&&window.AddPersonModalInit(tid,pid,args.history,AddPerson.apsCallback,"m")}).fail(function(file){$this.html(response.html);window&&window.console&&console.error("AddPerson: Unable to load"+file+".")})},error:function(){var html='<div class="ancGrid ancGridPadded"><div class="ancCol w100"><p class="icon iconWarning">'+PersonCard.text.addPersonErrorText+"<\/p><\/div><\/div>";$.modal.showLoading(!1);$this.html(html);$.modal.center()}})},onClose:function(){$(".addFamModalTriggered").removeClass("addFamModalTriggered").focus()}})},Add:function(tid,pid,args,onCloseCallback){typeof $.modal!="undefined"&&window.closeCallouts();AddPerson.Modal(tid,pid,args,onCloseCallback,"add")},Edit:function(tid,pid,args,onCloseCallback){typeof $.modal!="undefined"&&window.closeCallouts();typeof args=="string"?args=JSON.parse(args):typeof args=="undefined"&&(args={});typeof args=="object"&&(args.otid==null&&(args.otid=tid),args.opid==null&&(args.opid=pid));AddPerson.Modal(tid,pid,args,onCloseCallback,"edit")}},loadCacheFiles=function(response){var filesToLoad=[],deferred=$.Deferred();return AddPerson.cacheLoaded?deferred.resolve(!0):($(".add-person-css").remove(),$.each(response.css,function(i,css){$("head").append('<link class="add-person-css" rel="stylesheet" href="'+css+'" type="text/css" />')}),$.each(response.js,function(i,js){var def=new $.Deferred;$.ajax({dataType:"script",cache:!0,url:js,crossDomain:!0,success:function(){def.resolve(!0)},failure:function(){deferred.reject(js)}});filesToLoad.push(def)}),$.when.apply($,filesToLoad).done(function(){deferred.resolve(!0)})),deferred};return _addPerson}(jQuery)