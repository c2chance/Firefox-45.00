"use strict";function connectLines(el){var factItem=$(el),factItems=$(".factsSectionFactsAndSources .factItem."+el.id),animateLines=!0;$(".factItem[data-toggled-off]").length===1&&(animateLines=!1);factItem.belay(factItems,{animate:animateLines,strokeColor:"#897ea2",distinct:!0,callback:belayCallbackEndFacts});animateLines===!1&&(animateLines=!0);$(".factItem[data-toggled-off]").removeAttr("data-toggled-off")}function belayCallbackEndFacts(){var activeElement=$(".factItemSelected").attr("id"),$relatedElements=$("."+activeElement);$relatedElements.addClass("cardOutline2 factItemFocused")}function reconnectLines(){typeof Belay!="undefined"&&(Belay.off(),$(".factsSectionFactsAndSources .factItemSelected").each(function(){$("#"+this.id).belay($("."+this.id),{animate:!1,strokeColor:"#897ea2"})}),$(".factItem[data-toggled-off]").removeAttr("data-toggled-off"))}function checkFieldValidation(checkChanged,showBanner,dictionary){var modalEditEvent=$(".tabContent1"),selectedPerson=modalEditEvent.find(".selectedPerson"),requiredFields=0,emptyRequiredFields=0,fields=0,emptyFields=0,changed=!1,$checkBox,sid;return modalEditEvent.find(".factField").each(function(){var $field=$(this),fState=$field.data("state"),val=$field.val(),originalValue,currentValue,extra;$field.hasClass("requiredField")?requiredFields++:fields++;$field.attr("name")!=="gender"&&(val?(fState=="0"&&(fState=validateField($field.get(0))),fState=="4"||fState=="3"?showBanner&&(FactEditModal.validationWarningMessage=FactEditModal.validationWarningMessage.length===0?$field.data("msg"):FactEditModal.validationWarningMessage+" "+$field.data("msg"),fState=="3"?FactEditModal.hasValidationDateWarning=!0:fState=="4"&&(FactEditModal.hasValidationWarning=!0)):fState=="2"||fState=="1"):$field.hasClass("requiredField")?emptyRequiredFields++:emptyFields++);checkChanged&&($field.attr("name")!=="gender"||$field.is(":checked"))&&(originalValue=typeof $field.data("original-value")!="undefined"?$field.data("original-value"):"",currentValue=$field.val(),originalValue!=currentValue&&(changed=!0),extra=typeof $field.data("extra")!="undefined"?$field.data("extra"):"",dictionary[$field.attr("id")]={value:currentValue,origValue:originalValue,extra:extra})}),checkChanged&&($checkBox=modalEditEvent.find(".isPrimaryCheckbox"),$checkBox.length>0&&$checkBox.is(":checked")&&$checkBox.data("original-isprimary")==!1&&(changed=!0)),isRelationshipEventType()&&(typeof selectedPerson=="undefined"||selectedPerson.length===0?checkChanged&&!FactEditModal.isAddNewFact&&typeof FactEditModal.originalSpouseId!="undefined"&&FactEditModal.originalSpouseId.length>0?changed=!0:showBanner&&(FactEditModal.hasValidationWarningToSelectSpouse=!0):checkChanged&&(typeof FactEditModal.originalSpouseId=="undefined"||FactEditModal.originalSpouseId.length===0?changed=!0:(sid=selectedPerson.data("assertionid"),FactEditModal.originalSpouseId!=sid&&(changed=!0)))),(emptyRequiredFields>0||fields===emptyFields)&&(showBanner&&PersonResearch.hasEditRights&&(FactEditModal.validationErrorMessage=getWarningMessage(requiredFields>0&&requiredFields===emptyRequiredFields,fields===emptyFields)),FactEditModal.hasValidationError=!0,changed=!1),changed}function setFieldValidationValues(dictionary){var modalEditEvent=$(".tabContent1");modalEditEvent.find(".factField").each(function(){var $field=$(this),field;$field.attr("name")=="gender"?(field=dictionary[$field.attr("id")],field!="undefined"?($field.attr("checked",!0),$field.data("state",1),$field.val(field.value),$field.data("original-value",field.value)):($field.attr("checked",!1),$field.data("state",0),$field.val(""),$field.data("original-value",""))):(field=dictionary[$field.attr("id")],field!="undefined"?($field.data("state",field.value.length===0?0:1),$field.val(field.value),$field.data("original-value",field.value),field.extra.length>0&&$field.data("extra",field.extra)):($field.data("state",0),$field.val(""),$field.data("original-value",""),$field.data("extra","")))})}function resetValidationValues(){FactEditModal.hasValidationWarning=!1;FactEditModal.hasValidationDateWarning=!1;FactEditModal.validationWarningMessage="";FactEditModal.hasValidationError=!1;FactEditModal.validationErrorMessage="";FactEditModal.hasValidationWarningToSelectSpouse=!1}function setButtonBasedOnValidation(){!FactEditModal.hasValidationError&&(FactEditModal.hasValidationWarning||FactEditModal.hasValidationDateWarning||FactEditModal.hasValidationWarningToSelectSpouse)?(setupCreateOrSaveAnywayTextButton(),$(".editModalSaveButton").removeAttr("disabled")):(setupCreateOrSaveTextButton(),FactEditModal.hasValidationError?$(".editModalSaveButton").attr("disabled","disabled"):$(".editModalSaveButton").removeAttr("disabled"))}function setupCreateOrSaveTextButton(){FactEditModal.isAddNewFact?$(".editModalSaveButton").text(FactEditModal.text.create):$(".editModalSaveButton").text(FactEditModal.text.saveChanges)}function setupCreateOrSaveAnywayTextButton(){(isRelationshipEventType()||!isDatePlaceEventType())&&$(".editModalSaveButton").unbind("click");FactEditModal.isAddNewFact?$(".editModalSaveButton").text(FactEditModal.text.createAnyway):$(".editModalSaveButton").text(FactEditModal.text.saveAnyway);$(".editModalSaveButton").removeAttr("disabled")}function overrideValidation(){isRelationshipEventType()&&$(".editModalSaveButton").unbind("click");FactEditModal.warningMessage.length>0&&typeof $(".editModalSaveButton").attr("disabled")=="undefined"?setupCreateOrSaveAnywayTextButton():setupCreateOrSaveTextButton();resetValidationValues();FactEditModal.isAddNewFact&&setAddNewFactCreateAction();FactEditModal.warningMessage=""}function validationCheck(eventType,eventResults){var returnValues={hasValidationWarning:!1,validationMessage:""},dateMonthYear,dateSplit;return eventResults[0]!==0&&(returnValues.hasValidationWarning=!0,returnValues.validationMessage=FactEditModal.text.warnDateMayBeWrong),dateMonthYear=FactEditModal.person.dateStamp,dateMonthYear.length>0?(dateSplit=dateMonthYear.split(","),eventResults[2]!=null&&typeof eventResults[2]!="undefined"&&eventResults[1]===dateSplit[2]&&parseInt(eventResults[2])>parseInt(dateSplit[1])||eventResults[2]!=null&&typeof eventResults[2]!="undefined"&&eventResults[1]===dateSplit[2]&&parseInt(eventResults[2])===parseInt(dateSplit[1])&&eventResults[3]!=null&&parseInt(eventResults[3])>parseInt(dateSplit[0])?(returnValues.hasValidationWarning=!0,returnValues.validationMessage=FactEditModal.text.warnDateMayBeWrong+" "+FactEditModal.text.warnDateIsInFuture):eventResults[1].length>0&&(returnValues.validationMessage=returnValues.validationMessage.length>0?returnValues.validationMessage+" "+eventResults[1]:eventResults[1])):eventResults[1].length>0&&(returnValues.validationMessage=returnValues.validationMessage.length>0?returnValues.validationMessage+" "+eventResults[1]:eventResults[1]),returnValues}function setValidationWarningDateIsInFuture(returnValues){returnValues.eventChanged=!1;returnValues.hasValidationWarning=!0;returnValues.validationMessage=FactEditModal.text.warnDateMayBeWrong+" "+FactEditModal.text.warnDateIsInFuture}function addSourceModal(){$("#modalAddSource").modal({width:"410",title:PersonResearch.menu.sources.addSourceTitle,onOpen:function(){$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning)},onClose:function(){$(".addModalTriggered").removeClass("addModalTriggered").focus()}})}function factModalInitTypeAhead(treeId,locationField){locationField.autocomplete({source:"/suggest/place?treeId="+treeId+"&tad=none",key:"placeName",queryParameter:"term",dataType:"json",minLength:3,maxResults:12,customDisplay:function(data){return{value:data.value,display:data.display}},onItemSelect:function(itemData){var $this,$card;itemData!==""&&($this=$(this),itemData.PID!=""&&($card=$this.closest(".card"),$card.find(".erAddExistingData").data("itemData",itemData),$card.find(".erAddSave").prop("disabled",!1)))},onOpen:!1,onClose:!1})}function factEditModal(treeId,personId,assertionId,hasLifeStoryOptions,tabActivate,contentActivate,addPersonNewPID,saveEventData,isFromCreateEvent){var isValidNewAddPersonId=typeof addPersonNewPID!="undefined"&&addPersonNewPID!=null&&addPersonNewPID.length>0,dateFieldVal="",placeFieldVal="",descriptionFieldVal="",isPrimary=!1,eventType="",newPersonPid="",saveEventDataObj,url;PersonResearch.hasAddedNewSpouse=!1;PersonResearch.newAddedSpouseId="";isValidNewAddPersonId&&(newPersonPid=addPersonNewPID,PersonResearch.hasAddedNewSpouse=!0,PersonResearch.newAddedSpouseId=addPersonNewPID,typeof saveEventData!="undefined"&&saveEventData.length>0&&(saveEventDataObj=jQuery.parseJSON(saveEventData),eventType=saveEventDataObj.eventType,dateFieldVal=saveEventDataObj.dateField,placeFieldVal=saveEventDataObj.placeField,descriptionFieldVal=saveEventDataObj.descriptionField,isPrimary=!1,saveEventDataObj.isAddNewSpouse==="true"&&($(".editModalSaveButton").unbind("click"),ResetWarningsAndValues(),FactEditModal.isAddNewSpouse=!0)));url="/modals/factedit/tree/"+treeId+"/person/"+personId+"/assertionid/"+assertionId;$("<div>").modal({showLoading:!0,useCustomPadding:!0,onOpen:function($this){$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,data:{hasLifeStoryOptions:hasLifeStoryOptions,newPersonPid:newPersonPid},success:function(data){var spouseCount,dateField,placeField,descriptionField,$indvSpouseSelect,$sortingDivTopAlert,$sortingDivBottomAlert,locationField,openTab,modalHeader,cancelClose,factItem,modalEditEvent,selectedPerson,preferredStored,preferredEventStored,individualSpouseSelect,multipleSpouseSelect,displayLifeStory,displayLifeStoryVal;if(data.result){if($.modal.showLoading(!1),$.modal.resize(760),$this.html(data.html),$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning),sortingCardOutlineHover(),!isValidNewAddPersonId&&isRelationshipEventType()&&$(".editModalSaveButton").unbind("click"),spouseCount=parseInt(FactEditModal.person.spouseCount),isValidNewAddPersonId&&(dateField=$(".dateField"),dateField.length>0&&dateField.val(dateFieldVal),placeField=$(".placeField"),placeField.length>0&&placeField.val(placeFieldVal),descriptionField=$(".descriptionField"),descriptionField.length>0&&descriptionField.val(descriptionFieldVal),$("#individualSpouseSelect").show(),$("#selectedSpouse-individual").removeClass("selectedPerson"),$indvSpouseSelect=$(".existingSpouseIndividual"),$indvSpouseSelect.length>0&&$indvSpouseSelect.addClass("selectedPerson"),$("#multipleSpouseSelect").hide(),spouseCount>1?($("#changeSpouseButton").show().attr("onclick","showMultipleSpouseSelect();"),$("#chooseOtherButton").hide()):($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onclick","showSpouseTypeAheadSection();")),FactEditModal.warningMessage="",FactEditModal.hasValidationWarningToSelectSpouse=!1,FactEditModal.isAddNewSpouse=!1),typeof FactEditModal!="undefined"&&$(".modalEditEvent .iconRotateRight").callout({position:"left",type:"click",classes:"calloutGenerateNarrative",content:"#generateNarrativeCalloutDomContent",onAfterOpen:function(){$("#callout").on("click",".closeCallouts",function(){closeCallouts()})},style:"dark"}),$(".modalEditEvent .removeButton").callout({position:"top",style:"dark",type:"click",classes:"calloutRemoveEvent",content:"#removeEventCalloutDomContent",onAfterOpen:function(){$("#callout").on("click",".closeCallouts",function(){closeCallouts()})}}),sortingCardOutlineHover(),$sortingDivTopAlert=$("#source_sortingDivTop .alert"),$sortingDivBottomAlert=$("#source_sortingDivBottom .alert"),$sortingDivTopAlert.alert(personViewModalAlertSettingsNote),$sortingDivBottomAlert.alert(personViewModalAlertSettingsNote),$.cachedScript(PersonResearch.animateCardUrl).done(function(){$("#source_sortingDivBottom").animateCard({items:".card",animateMove:{afterAnimate:function(item){item.find(".sortingIcon").hasClass("iconAdd")?(item.removeClass("cardOutline2").addClass("attached"),PersonResearch.hasEditRights&&item.find(".sortingIcon").removeClass("iconAdd noHover").addClass("iconClose")):(item.removeClass("cardOutline2").removeClass("attached"),PersonResearch.hasEditRights&&item.find(".sortingIcon").removeClass("iconClose noHover").addClass("iconAdd"))},beforeAnimate:function(item){item.find(".card").addClass("cardOutline2")},connectWith:"#source_sortingDivTop",emptyContent:".alertNote"},onListEmpty:function(emptyList){emptyList.find(".alertNote").alert("open")},onEmptyListAdd:function(list){list.find(".alertNote").alert("close")}})}),$("#source_sortingDivTop .card").length===0&&$sortingDivTopAlert.alert("open"),$("#source_sortingDivBottom .card").length===0&&$sortingDivBottomAlert.alert("open"),locationField=$("#location"),locationField.length>0&&factModalInitTypeAhead(treeId,locationField),openTab=0,typeof PersonResearch.openOnLoadTab!="undefined"&&(openTab=parseInt(PersonResearch.openOnLoadTab)),PersonResearch.openOnLoadTab=0,(FactEditModal.isAddNewFact||typeof isFromCreateEvent!="undefined"&&isFromCreateEvent)&&(typeof tabActivate!="undefined"&&tabActivate!=null&&tabActivate.length>0&&typeof contentActivate!="undefined"&&contentActivate!=null&&contentActivate.length>0?(modalHeader=$("#modalHeader"),modalHeader.length>0&&modalHeader.remove(),tabActivate!=="factEditModalEvent"&&tabActivate!=="editModalSaveButton"&&($("#factEditModalEvent").removeClass("tabActive active"),$(".tabContent1").removeClass("tabActive active")),$("#"+tabActivate).hasClass("tabActive active")||$("#"+tabActivate).addClass("tabActive active"),contentActivate!=="tabContent1"&&$(".tabContent1").removeClass("tabActive active"),$("."+contentActivate).hasClass("tabActive active")||$("."+contentActivate).addClass("tabActive active"),PersonResearch.openOnLoadTab=contentActivate==="tabContent2"?1:contentActivate==="tabContent3"?2:0,openTab=PersonResearch.openOnLoadTab,cancelClose=$(".cancelClose"),cancelClose.length>0&&cancelClose.text(FactEditModal.text.close),setFactModalTabsClick(!0)):($("#factEditModalEvent").addClass("tabActive active"),$(".tabContent1").addClass("tabActive active"))),$("#modalContainer .tabs").tabs({activeIndex:openTab,onOpen:!1}),modalButtonClick(),setupFactModalUserCard(),factItem=$("#fi"+assertionId),modalEditEvent=$(".tabContent1"),modalEditEvent.length>0&&openTab===0)if(selectedPerson=modalEditEvent.find(".selectedPerson"),isRelationshipEventType()&&selectedPerson.length===0&&(selectedPerson=modalEditEvent.find(".selectedPerson")),!isValidNewAddPersonId&&isRelationshipEventType()&&FactEditModal.originalSpouseId.length===0&&selectedPerson.length>0&&resetIndividualSpouseNode(selectedPerson,0),(FactEditModal.eventType.toLowerCase()==="birth"||FactEditModal.eventType.toLowerCase()==="death"||FactEditModal.eventType.toLowerCase()==="name")&&(factItem.hasClass("preferredEvent"+FactEditModal.eventType)?(modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!0),modalEditEvent.find(".isPrimaryCheckbox").attr("data-original-isprimary","true"),$("#preferredEventButtonLabel").show(),FactEditModal.eventType.toLowerCase()!=="name"&&$("#factEditModalTimelineOptions").css("display","")):($("#preferredEventCheckbox").show(),modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!1))),retrieveStoredFactValues(factItem,".givenNameStored"+assertionId,modalEditEvent,"#givenName"),retrieveStoredFactValues(factItem,".surnameStored"+assertionId,modalEditEvent,"#surname"),retrieveStoredFactValues(factItem,".suffixStored"+assertionId,modalEditEvent,"#suffix"),preferredStored=factItem.find(".preferredStored"+assertionId),preferredStored.length>0&&(preferredStored.val()==="true"&&factItem.hasClass("preferredEvent"+FactEditModal.eventType)?modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!0):modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!1)),retrieveStoredFactValues(factItem,".dateStored"+assertionId,modalEditEvent,"#date"),retrieveStoredFactValues(factItem,".placeStored"+assertionId,modalEditEvent,"#location"),retrieveStoredFactValues(factItem,".descriptionStored"+assertionId,modalEditEvent,"#description"),preferredEventStored=factItem.find(".preferredEventStored"+assertionId),preferredEventStored.length>0&&(preferredEventStored.val()==="true"&&factItem.hasClass("preferredEvent"+FactEditModal.eventType)?modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!0):modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!1)),individualSpouseSelect=modalEditEvent.find("#individualSpouseSelect"),isRelationshipEventType()&&(typeof newPersonPid=="undefined"||typeof newPersonPid!="undefined"&&newPersonPid.length===0)&&FactEditModal.originalSpouseId.length===0)selectedPerson.length>0&&resetIndividualSpouseNode(selectedPerson,0),modalEditEvent.find(".eventAreaBannerWarning").alert("close"),ResetWarningsAndValues(),multipleSpouseSelect=modalEditEvent.find("#multipleSpouseSelect"),spouseCount===1?(individualSpouseSelect.hide(),multipleSpouseSelect.show(),$("#singleScenarioSpouseSelect").show(),$("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").hide(),$("#chooseOtherButton").show().attr("onclick","showSpouseTypeAheadSection();")):spouseCount>1?(individualSpouseSelect.hide(),$("#spouseText").hide(),$("#selectSpouseForEventText").show(),multipleSpouseSelect.show(),$("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").hide(),$("#chooseOtherButton").show().attr("onclick","showSpouseTypeAheadSection();")):($("#chooseOtherButton").hide(),$(".addRelationships").show(),showSpouseTypeAheadSection(),$(".erAddCancel").hide()),setEditModalSaveButtonClick();else if(isRelationshipEventType()&&typeof newPersonPid!="undefined"&&newPersonPid.length>0){if(spouseCount===1&&setIndividualSpouseData(modalEditEvent,".singleScenarioSpouseSelect"),!showIndividualSpouse())return;individualSpouseSelect=$(".existingSpouseIndividual");individualSpouseSelect.length>0&&individualSpouseSelect.addClass("selectedPerson");(spouseCount===0||spouseCount===1)&&($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onclick","showSpouseTypeAheadSection();"));setEditModalSaveButtonClick()}$(".tabContent4").find(".narrativeDataFields").hide();displayLifeStory=$(".tabContent4").find(".displayLifestory");displayLifeStory.length>0&&(displayLifeStoryVal=displayLifeStory.prop("checked"),displayLifeStory.data("original-displaylifestory",displayLifeStoryVal.toString()));FactEditModal.eventType==="Gender"?($(".editModalSaveButton").removeAttr("disabled"),setFactModalTabsClick(!0)):FactEditModal.eventType==="Name"?(modalEditEvent.find(".eventAreaBannerWarning").alert("close"),setFactModalTabsClick(!0)):typeof tabActivate!="undefined"&&tabActivate!=null&&tabActivate.length>0&&typeof contentActivate!="undefined"&&contentActivate!=null&&contentActivate.length>0||setButtonandBannerBasedOnValidation(!1);setButtonBasedOnValidation()}$("#modalClose").length===0&&$("#modalContents").prepend('<button type="button" title="Close modal" id="modalClose" class="closeBtn"><\/button>')}})},onClose:function(){$(".factItemSelected").focus()}})}function retrieveStoredFactValues(factItem,storedAccessor,modalArea,fieldId){var storedValue=factItem.find(storedAccessor);storedValue.length>0&&modalArea.find(fieldId).val(storedValue.val())}function sourceEditModal(treeId,personId,sourceId,formId){var url="/modals/sourceedit/tree/"+treeId+"/person/"+personId+"/sourceid/"+sourceId;$("<div>").modal({showLoading:!0,useCustomPadding:!0,onOpen:function($this){$.ajax({type:"GET",url:url,data:$("#FormSourceItem"+formId+" :input").serialize(),cache:!1,timeout:2e4,success:function(data){var $sortingDivTopAlert,$sortingDivBottomAlert,openTab;$.modal.showLoading(!1);$.modal.resize(760);$this.html(data);$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning);sortingCardOutlineHover();$sortingDivTopAlert=$("#fact_sortingDivTop .alert");$sortingDivBottomAlert=$("#fact_sortingDivBottom .alert");$sortingDivTopAlert.alert(personViewModalAlertSettingsNote);$sortingDivBottomAlert.alert(personViewModalAlertSettingsNote);$.cachedScript(PersonResearch.animateCardUrl).done(function(){$("#fact_sortingDivBottom").animateCard({animateMove:{afterAnimate:function(item){item.find(".sortingIcon").hasClass("iconAdd")?(item.removeClass("cardOutline2").addClass("attached"),PersonResearch.hasEditRights&&item.find(".sortingIcon").removeClass("iconAdd noHover").addClass("iconClose")):(item.removeClass("cardOutline2").removeClass("attached"),PersonResearch.hasEditRights&&item.find(".sortingIcon").removeClass("iconClose noHover").addClass("iconAdd"))},beforeAnimate:function(item){item.find(".card").addClass("cardOutline2")},connectWith:"#fact_sortingDivTop",emptyContent:".alertNote"},items:".card",onListEmpty:function(emptyList){emptyList.find(".alertNote").alert("open")},onEmptyListAdd:function(list){list.find(".alertNote").alert("close")}})});$("#fact_sortingDivTop .card").length===0&&$sortingDivTopAlert.alert("open");$("#fact_sortingDivBottom .card").length===0&&$sortingDivBottomAlert.alert("open");typeof SourceEditModal!="undefined"&&$(".modalEditSource .removeButton").callout({classes:"calloutRemoveSource",content:"#removeSourceCalloutDomContent",onAfterOpen:function(){$("#callout").on("click",".closeCallouts",function(){closeCallouts()})},position:"top",style:"dark",type:"click"});openTab=0;typeof PersonResearch.openOnLoadTab!="undefined"&&(openTab=parseInt(PersonResearch.openOnLoadTab));PersonResearch.tabName==="Media"&&(sourceEditModalAttachedMedia(PersonResearch.treeId,PersonResearch.personId,sourceId),openTab=SourceEditModal.hasRecord?3:2);$("#modalContainer .tabs").tabs({activeIndex:openTab,onOpen:!1});modalButtonClick();updateModalTitle($(".sourceEditModaltitle").val(),$(".citationDetailTitle").val(),$(".associatedFactsEventsTitle").val(),$(".attachedMediaTitle").val());$("#sourceEditModalFacts").on("click",function(){sourceEditModalFacts()});$("#sourceEditModalAttachMedia").on("click",function(){sourceEditModalAttachedMedia(PersonResearch.treeId,PersonResearch.personId,sourceId)})}})},onClose:function(){$(".factItemSelected").focus();PersonResearch.tabName==="Media"&&window.glue.reload()}})}function toggleShowFamilyEvents(treeId,personId){toggleFactsCheckedMenuItem("#factsFamilyEvents");var toggleUrl="/tree/"+treeId+"/person/"+personId+"/tab/facts/toggleShowFamilyEvents";$.ajax({url:toggleUrl,method:"GET",cache:!1,success:function(){window.glue.reload()}})}function toggleShowAlternateEvents(treeId,personId){toggleFactsCheckedMenuItem("#factsAlternateEvents");var toggleUrl="/tree/"+treeId+"/person/"+personId+"/toggleShowAlternateEvents";$.ajax({url:toggleUrl,method:"GET",cache:!1,success:function(){window.glue.reload()}})}function toggleShowHistoricalInsights(treeId,personId){toggleFactsCheckedMenuItem("#factsHistoricalInsights");var toggleUrl="/tree/"+treeId+"/person/"+personId+"/tab/facts/toggleShowHistoricalInsights";$.ajax({url:toggleUrl,method:"GET",cache:!1,success:function(){window.glue.reload()}})}function toggleFactsCheckedMenuItem(idVal){var factsMenuItem=$(idVal);factsMenuItem.hasClass("calloutMenuChecked")?(factsMenuItem.removeClass("calloutMenuChecked"),factsMenuItem.addClass("calloutMenuUnchecked loading loadingSmall loadingOnBlack")):(factsMenuItem.removeClass("calloutMenuUnchecked"),factsMenuItem.addClass("calloutMenuChecked loading loadingSmall loadingOnBlack"));factsMenuItem.closest(".factsOptionsMenu").addClass("factsOptionsMenuDisabled")}var personViewModalAlertSettingsNote={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"note"},personViewModalAlertSettingsInfo={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"info"},personViewModalAlertSettingsSuccess={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"success"},personViewModalAlertSettingsWarning={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"warning"},initialize=function(){$.extend(PersonResearch,{selected:null});$(".optionsButtonFacts.iconArrowSmallDownAfter").callout({type:"click",classes:"calloutMenu factsOptionsCallout",content:"#factsOptionsCalloutDomContent",style:"dark"});$(".calloutContent").hasClass("factsOptionsCallout")&&((window.personScreenType("not-large-screen")||window.personScreenType("large-screen"))&&$(".optionsButtonFacts.hide480").callout("close").callout("open"),window.personScreenType("smart-phone")&&$(".optionsButtonFacts.show480").callout("close").callout("open"),window.personScreenType("smart-phone-portrait")&&$(".optionsButtonFacts.show320").callout("close").callout("open"));$("button.optionsButtonSources:not(.disabled)").callout({type:"click",classes:"calloutMenu sourcesOptionsCallout",content:"#sourcesOptionscalloutDomContent",onAfterOpen:function(){$(".sourcesOptionsMenu").on("click",".addModalTrigger",function(){$(".optionsButtonSources").addClass("addModalTriggered")})},style:"dark"});$("button.optionsButtonFamily.optionsButton:not(.disabled)").callout({type:"click",classes:"familyOptionsCallout",content:"#familyOptionscalloutDomContent",onAfterOpen:function(){$(".familyOptionsMenu").on("click",".link",function(){$(".optionsButtonFamily.optionsButton").addClass("addFamModalTriggered")})},style:"dark"});$(".optionsButtonFamily:not(.optionsButton)").callout({type:"click",classes:"familyOptionsCallout",content:"#familyOptionscalloutDomContent",onAfterOpen:function(){$(".familyOptionsMenu").on("click",".link",function(){$(".optionsButtonFamily:not(.optionsButton)").addClass("addFamModalTriggered")})},position:"top",style:"dark"});var doubleClick=!1,enterPressed=!1;$(".personPageFacts").off("click").off("dblclick").on("belay.on",".connectFact",function(){var factItem=$(this);factItem.addClass("bgColor2 bgDark cardSelected factItemFocused factItemSelected").find(".cardActions a").addClass("bgDark");factItem.hasClass("factItemWeblink")||connectLines(factItem.get(0))}).on("belay.off",".connectFact",function(){$(".factItemFocused").removeClass("bgColor2 bgDark cardSelected factItemFocused factItemSelected cardOutline2").find(".cardActions a").removeClass("bgDark");typeof Belay!="undefined"&&Belay.off()}).on("mousedown",".cardHasSelectAction.connectFact.factItemSelected",function(e){e.preventDefault()}).on("keypress",".cardHasSelectAction.connectFact.factItemSelected",function(e){(e.which===13||e.which===32)&&(e.preventDefault(),enterPressed===!1?$(this).trigger("click.off"):$(this).trigger("dblclick"))}).on("keypress",".cardHasSelectAction.connectFact:not(.factItemSelected)",function(e){(e.which===13||e.which===32)&&(e.preventDefault(),enterPressed=!0,$(this).trigger("click.on"),setTimeout(function(){enterPressed=!1},300))}).on("click.off",".cardHasSelectAction.connectFact.factItemSelected",function(e){e.preventDefault();var factItem=$(this);setTimeout(function(){doubleClick===!1&&factItem.trigger("belay.off")},300)}).on("click.on",".cardHasSelectAction.connectFact:not(.factItemSelected)",function(e){e.preventDefault();var factItem=$(this);doubleClick=!1;$(".connectFact.factItemSelected").trigger("belay.off");PersonResearch.scriptLoaded?factItem.trigger("belay.on"):$.cachedScript(PersonResearch.cacheUrl+"/lib/d3/d3-3.4.11.min.js").done(function(){$.cachedScript(PersonResearch.belayFileUrl).done(function(){PersonResearch.scriptLoaded=!0;factItem.trigger("belay.on")})})}).on("dblclick",".cardHasSelectAction.connectFact",function(e){var factItem,allowEditOrView,hasLifeStoryOptions,formId;if(doubleClick=!0,setTimeout(function(){doubleClick=!1},1e3),factItem=$(this),factItem.hasClass("factItemWeblink"))editWebLinkModal(factItem);else{var factsSection=factItem.closest(".factsSection"),assertionId=factItem.attr("id").replace("fi",""),sourceid=factItem.attr("id").replace("si","");factsSection.hasClass("factsSectionFacts")&&(allowEditOrView=factItem.find(".allowEditOrView").val(),allowEditOrView==="true"&&typeof factEditModal!="undefined"&&(hasLifeStoryOptions=factItem.find(".hasLifestoryOptions").val(),assertionId==="UnknownGender"&&(assertionId="99"),newFactEditModal(PersonResearch,assertionId,hasLifeStoryOptions,"","",!1)));factsSection.hasClass("factsSectionSources")&&(formId=factItem.attr("id"),sourceid=sourceid.indexOf("0x")===-1?sourceid:"0",typeof sourceEditModal!="undefined"&&sourceEditModal(PersonResearch.treeId,PersonResearch.personId,sourceid,formId))}e.stopPropagation()}).on("keypress",".cardAction",function(e){(e.which===13||e.which===32)&&$(this).closest(".connectFact").trigger("dblclick")}).on("click",".cardAction",function(){$(this).closest(".connectFact").trigger("dblclick")}).on("keypress",".cardEmpty[onclick]",function(e){(e.which===13||e.which===32)&&(e.preventDefault(),$(this).get(0).click())});$(".factsSectionFacts").on("click",".editFact",function(event){var assertionId,allowEditOrView,hasLifeStoryOptions;$(this).closest(".factItem").attr("id").length>0&&(assertionId=$(this).closest(".factItem").attr("id").replace("fi",""),allowEditOrView=$(this).closest(".factItem").find(".allowEditOrView").val(),allowEditOrView==="true"&&typeof factEditModal!="undefined"&&(hasLifeStoryOptions=$(this).closest(".factItem").find(".hasLifestoryOptions").val(),assertionId==="UnknownGender"&&(assertionId="99"),newFactEditModal(PersonResearch,assertionId,hasLifeStoryOptions,"","",!1)));event.stopPropagation()}).on("keypress",".mediaItemsCount, .sourceCitationsCount",function(e){e.stopPropagation();(e.which===13||e.which===32)&&(e.preventDefault(),$(this).closest(".connectFact").trigger("dblclick"))}).on("click",'[onclick="addFactModal();"]',function(){$(this).addClass("addModalTriggered")}).on("click",".FocusPerson",function(e){e.stopPropagation()}).on("click",".sourceCitationsCount",function(){$(this).closest(".connectFact").trigger("dblclick");PersonResearch.openOnLoadTab=2}).on("click",".mediaItemsCount, .factThumb",function(){$(this).closest(".connectFact").trigger("dblclick");PersonResearch.openOnLoadTab=1});$(".factsSectionSources").on("click",".editFact",function(){if($(this).closest(".factItem").attr("id").length>0){var formId=$(this).closest(".factItem").attr("id"),sourceid=formId.replace("si",""),sourceId=sourceid.indexOf("0x")===-1?sourceid:"0";typeof sourceEditModal!="undefined"&&sourceEditModal(PersonResearch.treeId,PersonResearch.personId,sourceId,formId)}}).on("click",".openWebLinkModal",function(){$(this).addClass("openWebLinkModalTriggered")});$(".sourcesOptionsMenu").on("click",".openWebLinkModal",function(){$(".optionsButtonSources").addClass("openWebLinkModalTriggered")});$(".factItemSource").on("click dblclick",".userCardImg.photo",function(event){event.stopPropagation()});$(".factItemWeblink").on("click dblclick",".cardActions a",function(event){event.stopPropagation()});$(".personClick").on("click",function(){var factItem=$(this).closest(".factItem");factItem.length>0&&(factItem.removeClass("factItemSelected"),factItem.unbind("click"))});$(".factItemName").each(function(){var $this=$(this);$this.attr("data-classes",$this.attr("class")).removeAttr("class").attr("class","factItemName")});$(".factItemGender").each(function(){var $this=$(this);$this.attr("data-classes",$this.attr("class")).removeAttr("class").attr("class","factItemGender")});$(".factsSection").on("click","#toggleNameAndGenderButton",function(){function removeConnection(){$(".factItemName").each(function(){$(this).removeAttr("class").attr("class","factItemName")});$(".factItemGender").each(function(){$(this).removeAttr("class").attr("class","factItemGender")})}var $factsSection=$(".factsSectionFacts");$factsSection.hasClass("factsSectionFactsShowingNameAndGender")?($factsSection.removeClass("factsSectionFactsShowingNameAndGender"),$(".factItemFocused").hasClass("factItemName")||$(".factItemFocused").hasClass("factItemGender")?(($(".factItemSelected").hasClass("factItemName")||$(".factItemSelected").hasClass("factItemGender"))&&($(".factItemSelected").trigger("belay.off").attr("data-toggled-off","factItemToggledOff"),removeConnection()),($(".factItemFocused:not(.factItemSelected)").hasClass("factItemName")||$(".factItemFocused:not(.factItemSelected)").hasClass("factItemGender"))&&($(".factItemFocused:not(.factItemSelected)").attr("data-toggled-off","factItemToggledOff"),removeConnection(),reconnectLines())):(removeConnection(),reconnectLines())):($(".factItemName").each(function(){$(this).attr("class",$(this).attr("data-classes"))}),$(".factItemGender").each(function(){$(this).attr("class",$(this).attr("data-classes"))}),$factsSection.addClass("factsSectionFactsShowingNameAndGender"),$(".factItem[data-toggled-off]").length>=1&&$(".factItemSelected").length===0?$(".factItem[data-toggled-off]").trigger("belay.on"):$(".factsSectionSources .factItemSelected").length===1?$(".factsSectionSources .factItemSelected").trigger("belay.off").trigger("belay.on"):reconnectLines())});PersonCard.isAddSibling&&(PersonCard.isAddSibling=!1,$(".factsSectionFamily").addClass("factsSectionFamilyShowingSiblings"));$("#myCanvasLogoBtn").callout({type:"click",classes:"calloutMyCanvasLinks calloutMenu",content:"#myCanvasLinks"});$("#printFriendlyCustomizeBtn").callout({type:"click",classes:"calloutPrintFriendlyCustomize calloutMenu",content:"#printFriendlyCalloutDomContent",onOpen:function(){$("html").hasClass("pFNoFamily")?$("#printFamily").removeClass("calloutMenuChecked").addClass("calloutMenuUnchecked"):$("#printFamily").removeClass("calloutMenuUnchecked").addClass("calloutMenuChecked");$("#factsSection").hasClass("factsSectionFactsShowingNameAndGender")?($("#printNameandGender").removeClass("calloutMenuUnchecked").addClass("calloutMenuChecked"),$("html").addClass("pFShowingNameGender")):($("#printNameandGender").removeClass("calloutMenuChecked").addClass("calloutMenuUnchecked"),$("html").removeClass("pFShowingNameGender"));$("#familySection").hasClass("factsSectionFamilyShowingSiblings")?($("#printSiblings").removeClass("calloutMenuUnchecked").addClass("calloutMenuChecked"),$("html").addClass("pFShowingSiblings")):($("#printSiblings").removeClass("calloutMenuChecked").addClass("calloutMenuUnchecked"),$("html").removeClass("pFShowingSiblings"));$("html").hasClass("pFNoSources")?$("#printSources").removeClass("calloutMenuChecked").addClass("calloutMenuUnchecked"):$("#printSources").removeClass("calloutMenuUnchecked").addClass("calloutMenuChecked");$("html").hasClass("pFShowingNotes")?$("#printNotes").removeClass("calloutMenuUnchecked").addClass("calloutMenuChecked"):$("#printNotes").removeClass("calloutMenuChecked").addClass("calloutMenuUnchecked");$("html").hasClass("pFShowingComments")?$("#printComments").removeClass("calloutMenuUnchecked").addClass("calloutMenuChecked"):$("#printComments").removeClass("calloutMenuChecked").addClass("calloutMenuUnchecked")},style:"dark"});$("#printFacts").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked");$("html").toggleClass("pFNoFacts")});$("#printFamilyEvents").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked").addClass("loading loadingSmall loadingOnBlack");$(".printOptionsMenu").addClass("printOptionsMenuDisabled");$("#factsFamilyEvents").trigger("click");$("#printFriendlyCustomizeBtn").trigger("click");customizeCalloutFocusOnFamilyEvents=!0});$("#printHistInsights").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked").addClass("loading loadingSmall loadingOnBlack");$(".printOptionsMenu").addClass("printOptionsMenuDisabled");$("#factsHistoricalInsights").trigger("click");$("#printFriendlyCustomizeBtn").trigger("click");customizeCalloutFocusOnHistInsights=!0});$("#printNameandGender").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked");$("#toggleNameAndGenderButton").trigger("click");$("#printFriendlyCustomizeBtn").trigger("click");$(this).focus()});$("#printAlternatives").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked").addClass("loading loadingSmall loadingOnBlack");$(".printOptionsMenu").addClass("printOptionsMenuDisabled");$("#factsAlternateEvents").trigger("click");$("#printFriendlyCustomizeBtn").trigger("click");customizeCalloutFocusOnAlternatives=!0});$("#printFamily").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked");$("html").toggleClass("pFNoFamily")});$("#printSiblings").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked");$("#toggleSiblingsButton").trigger("click");$("#printFriendlyCustomizeBtn").trigger("click");$(this).focus()});$("#printSources").on("click",function(){$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked");$("html").toggleClass("pFNoSources")});$("#printNotes").on("click",function(){$("html").toggleClass("pFShowingNotes");$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked")});$("#printComments").on("click",function(){$("html").toggleClass("pFShowingComments");$(this).toggleClass("calloutMenuUnchecked calloutMenuChecked")});$("html").hasClass("printFriendly")&&($(".factsSectionFamily").insertAfter($(".factsSectionFacts")),checkNotesAndComments(),$("html").hasClass("pFShowingNameGender")&&$("#toggleNameAndGenderButton").trigger("click"),$("html").hasClass("pFShowingSiblings")&&$("#toggleSiblingsButton").trigger("click"),$("#printFriendlyCustomizeBtn").callout("close").callout("open"),customizeCalloutFocusOnFamilyEvents===!0?($("#printFamilyEvents").focus(),customizeCalloutFocusOnFamilyEvents=!1):customizeCalloutFocusOnAlternatives===!0?($("#printAlternatives").focus(),customizeCalloutFocusOnAlternatives=!1):customizeCalloutFocusOnHistInsights===!0&&($("#printHistInsights").focus(),customizeCalloutFocusOnHistInsights=!1));$(document).on("keydown",function(e){if(e.ctrlKey&&e.keyCode===80&&$(".pageHeader").hasClass("pageHeaderFacts"))if($("html").hasClass("printFriendly"))$("#printFriendlyPrintBtn").trigger("click");else return e.preventDefault(),printFunction(),!1})};$(function(){$("#tabContentFacts").load(function(){typeof Belay!="undefined"&&Belay.off();$(".cardOutline2").removeClass("cardOutline2")}).load();initialize();$("html").data("factItemNeedsRefocus")&&($("#"+$("html").data("factItemNeedsRefocus")+"").trigger("click"),$("html").removeData("factItemNeedsRefocus"));PersonResearch.showGuidance&&$(".personPageFacts .guidanceModalTrigger").click()});$(window).load(function(){var record,loadActionId,selectOnLoad,selectItem,openOnLoad,openItem;notifyRecordObject!=null&&(record=$(".record_"+notifyRecordObject.data.databaseId+"_"+notifyRecordObject.data.recordId),PersonResearch.selectOnLoad=record.attr("id").replace("si",""),PersonResearch.loadActionId=record.attr("id"));loadActionId=PersonResearch.loadActionId;selectOnLoad=PersonResearch.selectOnLoad;selectOnLoad!=="0"&&(selectItem=$("#"+loadActionId+".connectFact"),selectItem.length>0&&(window.personScreenType("smart-phone")&&$("#factsMobilePageTabs").tabs({activeIndex:1}),selectItem.trigger("click"),$(window).scrollTop(selectItem[0].offsetTop)));openOnLoad=PersonResearch.openOnLoad;openOnLoad!=="0"&&(openItem=$("#"+loadActionId+".connectFact"),openItem.length>0&&(window.personScreenType("smart-phone")&&$("#factsMobilePageTabs").tabs({activeIndex:1}),openItem.trigger("dblclick")))});$(window).resize(function(){window.personScreenType("large-screen")&&reconnectLines()})