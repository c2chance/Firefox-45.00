(function e(t,n,r){function s(o,u){var a,f,l;if(!n[o]){if(!t[o]){if(a=typeof require=="function"&&require,!u&&a)return a(o,!0);if(i)return i(o,!0);f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f;}l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i=typeof require=="function"&&require,o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module){module.exports={loc:{apiUrl:"//127.0.0.1:1111/",viewer:"//mvloc.ancestrydev{domain}:1112",IIV:"//interactive.ancestry{env}{domain}",treesURL:"//trees.ancestry{env}{domain}",PUBUrl:"//c.mfcreative{env}.com/APS_PUB/pub.js"},"default":{apiUrl:"//media.ajax.ancestry{env}.com/",viewer:"//mv.ancestry{env}{domain}",IIV:"//interactive.ancestry{env}{domain}",treesURL:"//trees.ancestry{env}{domain}",PUBUrl:"//c.mfcreative{env}.com/APS_PUB/pub.js"}}},{}],2:[function(require,module){var hogan=require("hogan"),BaseController=function(options){var option,evt;for(option in options)options.hasOwnProperty(option)&&(this[option]=options[option]);this.$el=this.$el||$("<div/>");this.template=this.template||hogan.compile("");this.events=this.events||{};this.model=this.model||{data:{urlParams:{}}};for(evt in this.events)if(typeof evt=="string"&&this.events.hasOwnProperty(evt)){var splitEvt=evt.split(":"),evtEl=splitEvt[0],evtType=splitEvt[1],handler=this[this.events[evt]].bind(this);if(evtEl)this.$el.on(evtType,evtEl,handler);else this.$el.on(evtType,handler)}};BaseController.prototype.render=function(){return this};BaseController.prototype.init=function(){return this};module.exports=BaseController},{hogan:16}],3:[function(require){function getGalleryType(){var type="gallery";return/apv/g.test(location.href)&&(type="apv"),type}function setFilterOptions(){var filters=util.getParameterByName("filter");this.model.setFilters(filters.split(","))}function setSortOption(){var sortMethod=util.getParameterByName("sort");sortMethod in mediaApp.sorters&&this.model.applySort(sortMethod)}var hogan=require("hogan"),BaseController=require("./baseController"),GalleryModel=require("../models/galleryModel"),galleryListController=require("./subcontrollers/galleryListController"),filterController=require("./subcontrollers/filterController"),sortController=require("./subcontrollers/sortController"),addMediaController=require("./subcontrollers/addMediaController"),template=hogan.compile('<section class="mediaGallery" id="AcomMediaGallery">\n    {{> galleryHeader }}\n    <div class="galleryContent"><!-- Gallery List goes here. --><\/div>\n<\/section>\n<script type="text/template" id="mediaGalleryFilterList">\n    <h5 class="calloutMenuTitle" data-i18n="mediaType">Media Type<\/h5>\n    <ul class="calloutMenu" id="mediaFilterType">\n        <li data-value="all">\n            <button class="link iconAfter iconAfterCheck icon iconGallery calloutMenuChecked"\n                  data-type="all" data-i18n="all" type="button">All<\/button>\n        <\/li>\n        <li data-value="portrait">\n            <button class="link iconAfter iconAfterCheck icon iconImage calloutMenuUnchecked"\n                  data-type="p" data-i18n="photos" type="button">Photos<\/button>\n        <\/li>\n        <li data-value="record media">\n            <button class="link iconAfter iconAfterCheck icon iconNote calloutMenuUnchecked"\n                  data-type="rm" data-i18n="records" type="button">Records<\/button>\n        <\/li>\n        <li data-value="story">\n            <button class="link iconAfter iconAfterCheck icon iconStory calloutMenuUnchecked"\n                  data-type="s" data-i18n="stories" type="button">Stories<\/button>\n        <\/li>\n        <li data-value="audio">\n            <button class="link iconAfter iconAfterCheck icon iconAudio calloutMenuUnchecked"\n                  data-type="a" data-i18n="audio" type="button">Audio<\/button>\n        <\/li>\n        <li data-value="video">\n            <button class="link iconAfter iconAfterCheck icon iconVideo calloutMenuUnchecked"\n                  data-type="v" data-i18n="video" type="button">Video<\/button>\n        <\/li>\n    <\/ul>\n<\/script>\n\n<script type="text/template" id="mediaGallerySortList">\n    <h5 class="calloutMenuTitle" data-i18n="sortBy">Sort By<\/h5>\n    <ul class="calloutMenu" id="mediaSortby">\n        <li>\n            <button class="sortBtn link iconAfter iconAfterCheck icon calloutMenuUnchecked" data-i18n="mediaType" data-sort="sortByMediaType" type="button">Media Type<\/button>\n        <\/li>\n        <li data-value="dateAddedAsc">\n            <button class="sortBtn link iconAfter iconAfterCheck icon calloutMenuUnchecked" data-i18n="dateAddedNewest" data-sort="sortByDateNewest" type="button">Date Added (Newest)<\/button>\n        <\/li>\n        <li data-value="dateAddedDesc">\n            <button class="sortBtn link iconAfter iconAfterCheck icon calloutMenuUnchecked" data-i18n="dateAddedOldest" data-sort="sortByDateOldest" type="button">Date Added (Oldest)<\/button>\n        <\/li>\n        <li data-value="titleAsc">\n            <button class="sortBtn link iconAfter iconAfterCheck icon calloutMenuUnchecked" data-i18n="titleAZ" data-sort="sortByTitleAZ" type="button">Title A-Z<\/button>\n        <\/li>\n        <li data-value="titleDesc">\n            <button class="sortBtn link iconAfter iconAfterCheck icon calloutMenuUnchecked" data-i18n="titleZA" data-sort="sortByTitleZA" type="button">Title Z-A<\/button>\n        <\/li>\n    <\/ul>\n<\/script>\n\n<script type="text/template" id="deleteCalloutContent">\n    <ul class="calloutMenu">\n        <li>\n            <button class="icon iconUnlink removeCard unlinkCard link" data-i18n="remove from gallery">Remove from Gallery<\/button>\n        <\/li>\n        <li>\n            <button class="icon iconTrash removeCard deleteCard link" data-i18n="delete from tree">Delete from Tree<\/button>\n        <\/li>\n    <\/ul>\n<\/script>\n\n<script type="text/template" id="mediaUploadOptions">\n    <ul id="addMediaMenu" class="calloutMenu">\n        <li>\n            <a href="{{photoUploadLink}}" class="link icon iconUpload" data-i18n="uploadPhotos" data-mediatype="photo"\n               data-uploadtype="photo" type="button">\n                Upload Photos\n            <\/a>\n        <\/li>\n        <li>\n            <a href="{{storyUploadLink}}" class="link icon iconUpload" data-i18n="uploadStory" data-mediatype="story"\n               data-uploadtype="upload-story" type="button">\n                Upload Story\n            <\/a>\n        <\/li>\n        <li>\n            <a href="{{storyCreationLink}}" class="link icon iconAdd" data-i18n="createStory" data-mediatype="story"\n               data-uploadtype="create-story" type="button">\n                Create Story\n            <\/a>\n        <\/li>\n    <\/ul>\n<\/script>\n'),galleryHeader=hogan.compile('    <form class="form">\n        <div class="ancGrid ancGridRow">\n            <div class="ancCol w50 filters">\n                {{^isEmptyGallery}}\n                <div class="galleryCallouts">\n                    <button class="mediaFilter ancBtn silver calloutTrigger iconAfter iconArrowSmallDownAfter" data-i18n="show" type="button">Show<\/button>\n                    <button class="mediaSort ancBtn silver calloutTrigger iconAfter iconArrowSmallDownAfter" data-i18n="sort" type="button">Sort<\/button>\n                <\/div>\n                {{/isEmptyGallery}}\n            <\/div>\n            <div class="ancCol w50 addEdit textRight">\n                {{#canEdit}}\n                <div class="galleryCallouts">\n                    <button class="icon ancBtn silver calloutTrigger iconAfter iconArrowSmallDownAfter mediaAddItem" data-i18n="add" type="button">Add<\/button>\n                    <button class="icon iconEdit ancBtn silver mediaEditItem" data-i18n="edit" type="button">Edit<\/button>\n                <\/div>\n                {{/canEdit}}\n            <\/div>\n        <\/div>\n    <\/form>\n\n'),mediaTranslator=require("../lib/translation"),util=require("../lib/utility")(),galleryController=new BaseController({$el:$("#gallery-container"),model:new GalleryModel,init:function(){this.$el.length||(this.$el=$("#apv-container"));window.mediaOmniture&&window.mediaOmniture.runOmniture();this.model.galleryType=getGalleryType();$(this.model).on("sync",this.render.bind(this));$(this.model).on("sync",setFilterOptions.bind(this));$(this.model).on("sync",setSortOption.bind(this));return this.model.fetch(),$.fn.toggleCheckmark=function(state){var inactiveClass="calloutMenuUnchecked",activeClass="calloutMenuChecked";$(this).each(function(){var $selector=$(this);state==="show"?$selector.removeClass(inactiveClass).addClass(activeClass):state==="hide"&&$selector.removeClass(activeClass).addClass(inactiveClass)})},this},render:function(){var that=this,subviews=[galleryListController,filterController,sortController,addMediaController],html=template.render(this.model.data,{galleryHeader:galleryHeader});return this.$el.html(mediaTranslator($(html)).translation).removeClass("loading loadingLarge"),$.each(subviews,function(idx,subview){subview.model=that.model;subview.$parentEl=that.$el;subview.init().render()}),this}});$(document).ready(function(){galleryController.init()})},{"../lib/translation":10,"../lib/utility":12,"../models/galleryModel":14,"./baseController":2,"./subcontrollers/addMediaController":4,"./subcontrollers/filterController":6,"./subcontrollers/galleryListController":7,"./subcontrollers/sortController":8,hogan:16}],4:[function(require,module){var BaseController=require("../baseController"),mediaTranslator=require("../../lib/translation");module.exports=new BaseController({render:function(){var html=$("#mediaUploadOptions").html(),$html=mediaTranslator($(html)).translation;return $(".mediaAddItem").callout({content:$html,keepContentInPlace:!0,onOpen:this.bindCalloutEvents.bind(this),style:"dark"}),this},bindCalloutEvents:function(){$("#calloutContent").off();$("#addMediaMenu .link").on("click",this.uploadListClick.bind(this));return this},uploadListClick:function(e){var $item=$(e.currentTarget),uploadType=$item.data("uploadtype"),mediaType=$item.data("mediatype"),urlParams=$.extend({},this.model.data.urlParams),pubUrlParams={TreeId:urlParams.treeId,PersonId:urlParams.personId};uploadType==="create-story"?getUrl("PersonStoryEdit",pubUrlParams,function(err,pubUrl){window.location.href=pubUrl||treesURLMakerWriteStory(urlParams)}):(pubUrlParams.MediaType=mediaType,getUrl("PersonMediaObjectUpload",pubUrlParams,function(err,pubUrl){window.location.href=pubUrl||treesURLMakerUploadMedia(urlParams,mediaType)}));e.preventDefault()}})},{"../../lib/translation":10,"../baseController":2}],5:[function(require,module){var BaseController=require("../baseController"),mediaTranslator=require("../../lib/translation");module.exports=new BaseController({render:function(){var html=$("#deleteCalloutContent").html(),$html=mediaTranslator($(html)).translation;return $(".deleteImageBtn").addClass("calloutTriggerNoArrow calloutPositionTop").on("click",function(e){e.preventDefault()}).callout({content:$html,style:"dark",onOpen:this.bindCalloutEvents.bind(this)}),this},bindCalloutEvents:function($clickedIcon){$("#calloutContent").off().on("click.removeCard","button.removeCard",this.removeCard.bind(this,$clickedIcon));return this},removeCard:function($clickedIcon,e){var $card=$clickedIcon.parents(".mediaObject"),id=$clickedIcon.data("objectid"),$target=$(e.target);return $target.hasClass("deleteCard")?this.model.deleteMedia(id):$target.hasClass("unlinkCard")&&this.model.unlinkMedia(id),$clickedIcon.off("click.deleteCard"),$card.addClass("fadeOut"),$clickedIcon.callout("close"),setTimeout(function(){$card.remove()},300),this}})},{"../../lib/translation":10,"../baseController":2}],6:[function(require,module){var BaseController=require("../baseController"),mediaTranslator=require("../../lib/translation");module.exports=new BaseController({render:function(){var html=$("#mediaGalleryFilterList").html();return $(".mediaFilter").callout({content:mediaTranslator($(html)).translation,style:"dark",keepContentInPlace:!0,onOpen:this.initMenu.bind(this)}),this},initMenu:function(){if(this.model.typeFilters.length!==0){var that=this,$buttons=$("#mediaFilterType").find("li .link"),$allButton=$buttons.filter('[data-type="all"]'),$filterButtons=$buttons.not('[data-type="all"]');$allButton.toggleCheckmark("hide");$filterButtons.each(function(){that.model.typeFilters.indexOf($(this).attr("data-type"))!==-1&&$(this).toggleCheckmark("show")})}return this.bindCalloutEvents.call(this),this},bindCalloutEvents:function(){$("#mediaFilterType").off().on("click",".link",this.toggleFilter.bind(this));return this},toggleFilter:function(e){var $target=$(e.currentTarget),type=$target.data().type,showAll=type==="all",$siblingButtons=$target.parents("ul").find("li .link"),$allButton=$siblingButtons.filter('[data-type="all"]'),$filterButtons=$siblingButtons.not('[data-type="all"]');return $target.hasClass("calloutMenuUnchecked")?(this.model.addFilter(type),showAll?($allButton.toggleCheckmark("show"),$filterButtons.toggleCheckmark("hide")):($target.toggleCheckmark("show"),$allButton.toggleCheckmark("hide"))):showAll||(this.model.removeFilter(type),$target.toggleCheckmark("hide"),$filterButtons.hasClass("calloutMenuChecked")||$allButton.toggleCheckmark("show")),this}})},{"../../lib/translation":10,"../baseController":2}],7:[function(require,module){var hogan=require("hogan"),BaseController=require("../baseController"),deleteImageController=require("./deleteImageController"),template=hogan.compile('<div class="gallery{{#isSelector}} selector{{/isSelector}}">\n    {{^serviceError}}\n        {{#objects}}\n            {{#active}}\n                {{#isStory}}\n                    {{> storyCard}}\n                {{/isStory}}\n                {{#isRecord}}\n                    {{> recordCard}}\n                {{/isRecord}}\n                {{#isPhoto}}\n                    {{> photoCard}}\n                {{/isPhoto}}\n                {{#isAudio}}\n                    {{> audioCard}}\n                {{/isAudio}}\n                {{#isVideo}}\n                    {{> videoCard}}\n                {{/isVideo}}\n            {{/active}}\n        {{/objects}}\n\n        <!--Empty selector message-->\n        {{#isSelector}}\n            {{#isEmptyGallery}}\n            <div class="emptyGallery">\n                <div class="cardEmptyAction icon iconGallery" data-i18n="emptySelectorGallery"><\/div>\n            <\/div>\n            {{/isEmptyGallery}}\n            {{^isEmptyGallery}}\n                {{#isEmptyWithFilters}}\n                    <div class="emptyGallery">\n                        <div class="cardEmptyAction icon iconGallery" data-i18n="emptySelectorGallery"><\/div>\n                    <\/div>\n                {{/isEmptyWithFilters}}\n            {{/isEmptyGallery}}\n        {{/isSelector}}\n\n        <!--Gallery-->\n        {{^isSelector}}\n            {{#isEmptyWithFilters}}\n                {{^isEmptyGallery}}\n                    <div class="emptyFilter">\n                        <div class="cardEmptyAction icon iconGallery" data-i18n="emptyFilter"\n                             data-i18n-options=\'{ "count": {{filterCount}} }\'>\n                        <\/div>\n                    <\/div>\n                {{/isEmptyGallery}}\n            {{/isEmptyWithFilters}}\n\n            <div class="hasEditingRights">\n                {{#canEdit}}\n                    {{#isEmptyGallery}}\n                        <a href="{{photoUploadLink}}" aria-pressed="false" class="emptyGallery card cardEmpty textCenter"\n                           role="button" tabindex="0" data-toggle-classes="cardSelected cardOutline2">\n                            <div class="cardEmptyAction textCenter icon iconGallery" data-i18n="emptyGallery"><\/div>\n                        <\/a>\n                    {{/isEmptyGallery}}\n\n                    {{^isEmptyWithFilters}}\n                        {{^isEmptyGallery}}\n                            <a href="{{photoUploadLink}}" aria-pressed="false" class="card cardEmpty textCenter cardSize1" role="button">\n                                <div class="cardEmptyAction textCenter icon iconGallery textxlrg" data-i18n="emptyGallery"><\/div>\n                            <\/a>\n                        {{/isEmptyGallery}}\n                    {{/isEmptyWithFilters}}\n                {{/canEdit}}\n\n                {{^canEdit}}\n                    {{#isEmptyGallery}}\n                        <div class="emptyGallery">\n                            <div class="cardEmptyAction icon iconGallery" data-i18n="noMedia"><\/div>\n                        <\/div>\n                    {{/isEmptyGallery}}\n                {{/canEdit}}\n            <\/div>\n        {{/isSelector}}\n    {{/serviceError}}\n\n    {{#serviceError}}\n        <div class="emptyGallery">\n            <div class="cardEmptyAction" data-i18n="serviceError"><\/div>\n        <\/div>\n    {{/serviceError}}\n<\/div>'),photoCard=hogan.compile('<a href="{{viewerUrl}}"\n   class="mediaObject card cardMedia cardMediaFull cardSize1 bgDark bgColor7 bgTexture3 fade{{#isSelected}} selectedCard selector{{/isSelected}}"\n    {{#previewBackgroundUrl}}style="background-image:url({{previewBackgroundUrl}});"{{/previewBackgroundUrl}}\n    role="button" aria-pressed="false" tabindex="0">\n\n{{> figureCaption}}\n<\/a>'),storyCard=hogan.compile('<a href="{{viewerUrl}}"\n   class="mediaObject card cardMedia cardMediaFull cardSize1 bgDark bgColor7 bgTexture3 fade icon iconStory\n        {{#fileFormat}} iconDocument{{fileFormat}} {{/fileFormat}}\n        {{#isSelected}} selectedCard selector {{/isSelected}}"\n   {{#previewBackgroundUrl}} style="background-image:url({{previewBackgroundUrl}});" {{/previewBackgroundUrl}}>\n    {{> figureCaption}}\n<\/a>'),audioCard=hogan.compile('<a href="{{viewerUrl}}" class="mediaObject icon iconAudio card cardMedia cardMediaFull cardSize1 bgDark bgColor7 bgTexture3 fade{{#isSelected}} selectedCard selector{{/isSelected}}"\n    {{#previewBackgroundUrl}}\n    style="background-image:url({{previewBackgroundUrl}});"\n    {{/previewBackgroundUrl}}>\n\n    {{> figureCaption}}\n<\/a>'),videoCard=hogan.compile('<a href="{{viewerUrl}}" class="mediaObject icon iconVideo card cardMedia cardMediaFull cardSize1 bgDark bgColor7 bgTexture3 fade{{#isSelected}} selectedCard selector{{/isSelected}}"\n    {{#previewBackgroundUrl}}\n    style="background-image:url({{previewBackgroundUrl}});"\n    {{/previewBackgroundUrl}}>\n\n    {{> figureCaption}}\n<\/a>'),recordCard=hogan.compile('<a href="{{viewerUrl}}" class="mediaObject card cardMedia cardMediaFull cardSize1 bgDark bgColor7 bgTexture3 fade"\n     {{#previewBackgroundUrl}}\n     style="background-image:url({{previewBackgroundUrl}});"\n     {{/previewBackgroundUrl}}>\n    <figure class="cardFigure">\n        <img class="mediaInfo screenReaderText" data-mediaid="{{id}}" data-mediatype="rm" alt="{{title}}" src="{{previewSourceUrl}}" />\n        {{> figureCaption}}\n    <\/figure>\n<\/a>'),figureCaption=hogan.compile('<div class="mediaInfo" data-media-id="{{id}}" data-media-type="{{type}}" data-crop-coords="{{cropCoords}}"><\/div>\n<div class="cardContentWrapper">\n    <span class="icon iconCheck"><\/span>\n    <figure class="cardFigure">\n        <figcaption class="cardCaption cardContent">\n            <h3 class="cardTitle">{{{title}}}<\/h3>\n            <p class="cardInfo">\n                {{#hasLikes}}\n                <small class="icon iconHeart noDisplay">{{meta.likes}}<\/small>\n                {{/hasLikes}}\n                {{#hasComments}}\n                <small class="icon iconChat noDisplay">{{meta.comments}}<\/small>\n                {{/hasComments}}\n                {{#canEdit}}\n                <button class="icon iconTrash link deleteImageBtn" data-objectId="{{id}}" type="button"><\/button>\n                {{/canEdit}}\n            <\/p>\n        <\/figcaption>\n    <\/figure>\n<\/div>\n\n'),mediaTranslator=require("../../lib/translation");module.exports=new BaseController({$el:null,template:template,init:function(){this.$el=this.$parentEl.find(".galleryContent");$(this.model).on("change",this.render.bind(this));return this.bindGalleryListEvents(),this},render:function(){var html=this.template.render(this.model.data,{photoCard:photoCard,recordCard:recordCard,storyCard:storyCard,audioCard:audioCard,videoCard:videoCard,figureCaption:figureCaption});return this.$el.html(mediaTranslator($(html)).translation),deleteImageController.model=this.model,deleteImageController.init().render(),this},bindGalleryListEvents:function(){this.$el.off().on("click",".cardFlippable .iconHelp",this.toggleFlippable.bind(this)).on("click",".cardFlippable .iconClose",this.toggleFlippable.bind(this)).on("click",".cardEmpty",this.navigateToUploadPhotos.bind(this)).on("click","a.mediaObject",this.handleCardClick.bind(this))},toggleFlippable:function(e){$(e.target).parents(".cardFlippable").first().toggleClass("cardFlipped")},navigateToUploadPhotos:function(e){var urlParams=$.extend({},this.model.data.urlParams),pubUrlParams={TreeId:urlParams.treeId,PersonId:urlParams.personId};pubUrlParams.MediaType="photo";getUrl("PersonMediaObjectUpload",pubUrlParams,function(err,pubUrl){window.location.href=pubUrl||treesURLMakerUploadMedia(urlParams,"photo")});e.preventDefault()},handleCardClick:function(e){var that=this;$(e.originalEvent.target).attr("href",function(){var viewerUrl=$(this).attr("href");return viewerUrl+that.model.getFilterSortQueryString(viewerUrl)})}})},{"../../lib/translation":10,"../baseController":2,"./deleteImageController":5,hogan:16}],8:[function(require,module){var BaseController=require("../baseController"),mediaTranslator=require("../../lib/translation");module.exports=new BaseController({render:function(){var html=$("#mediaGallerySortList").html(),$html=mediaTranslator($(html)).translation;return $(".mediaSort").callout({content:$html,style:"dark",onOpen:this.initMenu.bind(this)}),this},initMenu:function(){return $("#mediaSortby").find('[data-sort="'+this.model.sortType.current+'"]').toggleCheckmark("show"),this.bindCalloutEvents.call(this),this},bindCalloutEvents:function(){$("#calloutContent").off().on("click",".sortBtn",this.applySort.bind(this));return this},applySort:function(e){var $currTarget=$(e.currentTarget),$parents=$currTarget.parents("ul");$currTarget.hasClass("calloutMenuChecked")?$currTarget.data().sort!==this.model.sortType.default&&($currTarget.toggleCheckmark("hide"),this.model.applySort(this.model.sortType.default),$parents.find('li .sortBtn[data-sort="'+this.model.sortType.default+'"]').toggleCheckmark("show")):($parents.find("li .sortBtn").toggleCheckmark("hide"),this.model.applySort($currTarget.data().sort),$currTarget.toggleCheckmark("show"))}})},{"../../lib/translation":10,"../baseController":2}],9:[function(require,module){$.ajaxPrefilter("json",function(options){return options.crossDomain&&!$.support.cors?"jsonp":"json"});var urlMaker=require("./urlMaker")(),util=require("./utility")();module.exports=function(){function callApi(callback,Url,extraData,actionType,extraRequestSettings){callback=callback||$.noop;extraData=extraData||{};actionType=actionType||"GET";var ajaxDefaultSettings={url:Url,headers:{att:cookie.ATT||cookie.ANCATT||cookie.RMEATT,LCID:util.getLCID()},data:extraData,dataType:"json",crossDomain:!0,type:actionType,xhrFields:{withCredentials:!1},success:function(data){typeof data=="string"&&(data=JSON.parse(data));callback(data)},error:function(jqXhr){if(jqXhr.status===200){if(typeof jqXhr.responseText=="string"){var responseData={};try{responseData=JSON.parse(jqXhr.responseText)}catch(err){}callback(responseData)}}else callback(!1)},fail:function(){callback(!1)}};return $.ajax($.extend({},ajaxDefaultSettings,extraRequestSettings))}function getMediaList(callback,urlParams,extraRequestSettings){var mediaListUrl=urlMaker.baseURL().apiUrl+"v1/trees/"+urlParams.treeId+"/people/"+urlParams.personId;urlParams.collectionId&&(mediaListUrl+="?collectionId="+urlParams.collectionId);urlParams.excludeTypes&&(mediaListUrl+=/\?/.test(mediaListUrl)?"&":"?",mediaListUrl+="exclude="+urlParams.excludeTypes);util.getLCID()&&(mediaListUrl+=/\?/.test(mediaListUrl)?"&":"?",mediaListUrl+="lcid="+util.getLCID());callApi(callback,mediaListUrl,null,"GET",extraRequestSettings)}function deleteMedia(urlParams,objectId,cb){callApi(cb,urlMaker.baseURL().apiUrl+"api/trees/"+urlParams.treeId+"/media/"+objectId,{},"DELETE")}function unlinkMedia(urlParams,objectId,cb){callApi(cb,urlMaker.baseURL().apiUrl+"v1/person/"+urlParams.personId+"/"+objectId,{treeId:urlParams.treeId},"DELETE")}function getUsersLinkedToMedia(callback,data){callApi(callback,urlMaker.baseURL().apiUrl+"v1/trees/"+data.treeId+"/images/"+data.objectId+"/users")}function getObjectPeople(callback,data){callApi(callback,urlMaker.baseURL().apiUrl+"v1/trees/"+data.treeId+"/"+data.objectType+"/"+data.objectId+"/people")}function getUsersTreesList(cb){callApi(cb,urlMaker.baseURL().apiUrl+"v1/trees/")}function getTreesPeopleAutocompleteList(cb,data){callApi(cb,urlMaker.baseURL().apiUrl+"v1/trees/"+data.treeId+"/people/?startsWith="+data.startsWith)}var cookie=util.getCookie();return{getMediaList:getMediaList,deleteMedia:deleteMedia,unlinkMedia:unlinkMedia,getUsersLinkedToMedia:getUsersLinkedToMedia,getObjectPeople:getObjectPeople,getUsersTreesList:getUsersTreesList,getTreesPeopleAutocompleteList:getTreesPeopleAutocompleteList}}},{"./urlMaker":11,"./utility":12}],10:[function(require,module){var mediaTrans=JSON.parse($("#gallery-resourceStrings").html()||$("#selector-resourceStrings").html()||$("#apv-resourceStrings").html());module.exports=function($html){function translatePhrase(phrase){return mediaTrans[phrase]}var $selector=$("<div/>").html($html||$("body"));return $selector.find("[data-i18n]").each(function(){var $this=$(this),key=$this.data("i18n"),options=$this.data("i18nOptions");options&&options.count&&options.count!==1&&(key+="_plural");$this.text(translatePhrase(key))}),{translatePhrase:translatePhrase,translation:$selector}}},{}],11:[function(require,module){var util=require("./utility")(),urlTemplate=require("../config/endpoints.json"),baseURLS=null;module.exports=function(){function baseURL(){return baseURLS?baseURLS:baseURLS=formatURLTemplate(urlTemplate)}function iivURL(obj,backUrl,callback){var options={destInputs:{CollectionId:obj.collectionId,ImageId:obj.id,RecordId:obj.recordId,BackUrl:backUrl},useCurrentPageInfo:!0};window.ancestry&&window.ancestry.pub?ancestry.pub.getUrl("InteractiveImageViewer",options,function(error,url){error?(console.log("pub error: "+error),callback(error)):callback(null,url)}):(console.log("pub not used"),callback(null,baseURL().IIV+"/"+obj.collectionId+"/"+obj.id+"/"+obj.recordId+"?backurl="+encodeURIComponent(backUrl)))}function viewerURL(mediaId,urlParams,callback){var options={destInputs:{MediaId:mediaId,TreeId:urlParams.treeId,PersonId:urlParams.personId},useCurrentPageInfo:!0},pubUrl;window.ancestry&&window.ancestry.pub?ancestry.pub.getUrl("MediaViewer",options,function(error,url){if(error){console.log("pub error: "+error);callback(error);return}callback(null,setCollectionIdToUrl(url,urlParams))}):(pubUrl=getStaticViewerUrl(mediaId,urlParams),callback(null,setCollectionIdToUrl(pubUrl,urlParams)),console.log("pub not used"))}function getStaticViewerUrl(mediaId,urlParams){var url=baseURL().viewer+"/viewer/"+mediaId+"/"+urlParams.treeId+"/"+urlParams.personId;return urlParams.collectionId&&(url+="?collectionId="+urlParams.collectionId),url}function treesURLMakerUploadMedia(jsonData,mediaType){return treesURLMaker(jsonData)+"/"+mediaType+"/upload"}function treesURLMakerWriteStory(jsonData){return treesURLMaker(jsonData)+"/story/create"}function setCollectionIdToUrl(url,urlParams){return urlParams.collectionId&&(url+=url.split("?")[1].length?"&":"?",url+="collectionId="+urlParams.collectionId),url}function treesURLMaker(jsonData){return baseURL().treesURL+"/tree/"+jsonData.treeId+"/person/"+jsonData.personId}function formatURLTemplate(urlTemplate){var template=util.getEnvironment()==="loc"?"loc":"default",endpoints=urlTemplate[template];for(var prop in endpoints)endpoints[prop]=endpoints[prop].replace("{env}",environmentMap[util.getEnvironment()]).replace("{domain}",util.getDomain());return endpoints}var environmentMap={loc:"dev",development:"dev",acceptance:"stage",production:""};return{baseURL:baseURL,viewerURL:viewerURL,iivURL:iivURL,getStaticViewerUrl:getStaticViewerUrl,treesURLMakerUploadMedia:treesURLMakerUploadMedia,treesURLMakerWriteStory:treesURLMakerWriteStory}}},{"../config/endpoints.json":1,"./utility":12}],12:[function(require,module){var config=JSON.parse($("#gallery-config").html()||$("#selector-config").html()||$("#apv-config").html());module.exports=function(){function getCultureCode(){return config.culture}function getEnvironment(){return config.env}function getDomain(){return cultureDomainMap[config.culture]}function getLCID(){return config.lcid}function getSettings(configType){var settings=config.settings;return configType&&(settings=JSON.parse($("#"+configType+"-config").html()).settings),settings||{}}function getParameterByName(name){var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return results===null?"":decodeURIComponent(results[1])}function getCookie(){return function(parts){var cookieObj={};return parts.map(function(pair){return function(key,val){key&&val&&(cookieObj[key]=val)}.apply(null,pair)}),cookieObj}(document.cookie.split(";").map(function(x){return x.split("=").map(function(y){return y.trim()})}))}function getBigTreeId(){for(var bigTreeParts,componentName,basePath=decodeURIComponent(location.pathname),pathname=basePath.split("/"),personId,collectionId,treeId,i=0;i<pathname.length;i++)if(pathname[i].indexOf(":")!==-1&&(bigTreeParts=pathname[i].split(":"),pathname[i].split(":").length===3)){personId=bigTreeParts[0];collectionId=bigTreeParts[1];treeId=bigTreeParts[2];break}return personId&&treeId||pathname.forEach(function(fragment,idx){fragment==="tree"&&(treeId=pathname[idx+1]);fragment==="person"&&(personId=pathname[idx+1])}),componentName=EXISTING_COMPONENTS.filter(function(name){return pathname.indexOf(name)>-1})[0],personId&&treeId||!componentName||(treeId=pathname[pathname.indexOf(componentName)+1],personId=pathname[pathname.indexOf(componentName)+2],collectionId=getParameterByName("collectionId")),{personId:personId,collectionId:collectionId,treeId:treeId}}var cultureDomainMap={en:".com","en-US":".com","en-GB":".co.uk","en-CA":".ca","en-AU":".com.au",de:".de","de-DE":".de",sv:".se","sv-SE":".se",it:".it","it-IT":".it",fr:".fr","fr-FR":".fr","es-MX":".mx","fr-CA":".ca"},EXISTING_COMPONENTS=["gallery","selector","apv"];return{getCultureCode:getCultureCode,getCookie:getCookie,getLCID:getLCID,getEnvironment:getEnvironment,getParameterByName:getParameterByName,getDomain:getDomain,getBigTreeId:getBigTreeId,getSettings:getSettings}}},{}],13:[function(require,module){function MediaItemModel(rawData,options){$.extend(this,options);this.data=rawData;this.parse()}module.exports=MediaItemModel;MediaItemModel.prototype.parse=function(){this.setPreviewUrls();this.setImageAttributes();this.setMetaAttributes();this.setCropCoords();this.setViewerUrl()};MediaItemModel.prototype.setPreviewUrls=function(){var data=this.data;data.previewUrl&&(data.previewBackgroundUrl=data.previewUrl+(/\?/g.test(data.previewUrl)?"?client=Trees&MaxSide=1024":"&client=Trees&MaxSide=1024"),data.previewSourceUrl=data.previewUrl+(/\?/g.test(data.previewUrl)?"?client=Trees":"&client=Trees"))};MediaItemModel.prototype.setImageAttributes=function(){var data=this.data;data.type==="s"?(data.isStory=!0,data.ext==="msword"?data.fileFormat="Word":data.ext==="pdf"&&(data.fileFormat="Pdf")):data.type==="rm"?data.isRecord=!0:data.type==="p"?data.isPhoto=!0:data.type==="a"?data.isAudio=!0:data.type==="v"&&(data.isVideo=!0);data.isSelected=data.id===this.urlParams.selectedMediaId||this.urlParams.selectedMediaIds&&this.urlParams.selectedMediaIds.indexOf(data.id)!==-1;data.canEdit=data.type!=="rm"&&data.rights&&data.rights.canEdit;data.active=!0};MediaItemModel.prototype.setMetaAttributes=function(){var data=this.data;data.meta&&(isNaN(data.meta.likes)||(data.hasLikes=!0),isNaN(data.meta.comments)||(data.hasComments=!0))};MediaItemModel.prototype.setCropCoords=function(){var data=this.data,tag=data&&data.tags&&data.tags.length?data.tags[0]:null,currentPersonGID=[this.urlParams.personId,this.urlParams.collectionId||"1030",this.urlParams.treeId].join(":");data.cropCoords=tag&&tag.t==="primary"&&tag.tgid.v===currentPersonGID&&tag.rect?[tag.rect.x,tag.rect.y,tag.rect.w,tag.rect.h].join(","):""};MediaItemModel.prototype.setViewerUrl=function(){var data=this.data;data.viewerUrl=data.type==="rm"&&this.galleryType!=="apv"?this.iivTemplateUrl.url.replace(this.iivTemplateUrl.collectionId,data.collectionId).replace(this.iivTemplateUrl.id,data.id).replace(this.iivTemplateUrl.recordId,data.recordId):this.viewerTemplateUrl.url.replace(this.viewerTemplateUrl.mediaId,data.id)}},{}],14:[function(require,module){var GalleryItemModel=require("./galleryItemModel"),mediaService=require("../lib/mediaService")(),util=require("../lib/utility")(),urlMaker=require("../lib/urlMaker")();module.exports=function(){function getTemplateUrls(data,callback){var viewerTemplate={url:"",mediaId:"MEDIAID"};urlMaker.viewerURL(viewerTemplate.mediaId,data.urlParams,function(err,viewerUrl){if(!err){viewerTemplate.url=viewerUrl;var iivTemplate={url:"",collectionId:"COLLECTIONID",id:"ID",recordId:"RECORDID"},iivObj={collectionId:iivTemplate.collectionId,id:iivTemplate.id,recordId:iivTemplate.recordId};urlMaker.iivURL(iivObj,window.location.href,function(err,iivUrl){err||(iivTemplate.url=iivUrl,callback(null,viewerTemplate,iivTemplate))})}})}function canEdit(galleryType,treeRights){return galleryType!=="apv"&&treeRights&&treeRights.upload}var that=this,$this=$(this);this.mediaTypes=["p","rm","s","a","v"];this.typeFilters=[];this.sortType={"default":"sortByDateOldest",current:"sortByDateOldest"};this.data={};this.parse=function(data){var that=this,filteredMedia=[];return that.data=data,getTemplateUrls(data,function(err,viewerTemplateUrl,iivTemplateUrl){var options,item,i;if(data.objects&&data.objects.length){for(options={urlParams:data.urlParams,viewerTemplateUrl:viewerTemplateUrl,iivTemplateUrl:iivTemplateUrl,galleryType:that.galleryType,treeRights:data.treeRights},i=0;i<data.objects.length;i++)item=new GalleryItemModel(data.objects[i],options),filteredMedia.push(item.data);data.objects=filteredMedia;mediaApp&&mediaApp.sorters&&data.objects.sort(mediaApp.sorters[that.sortType.default]);data.isEmptyGallery=!1}else data.isEmptyGallery=!0;data.isEmptyWithFilters=!1;data.canEdit=canEdit(that.galleryType,data.treeRights);data.isSelector=that.galleryType==="selector";data&&data.urlParams&&(data.photoUploadLink=urlMaker.treesURLMakerUploadMedia(data.urlParams,"photo"),data.storyUploadLink=urlMaker.treesURLMakerUploadMedia(data.urlParams,"story"),data.storyCreationLink=urlMaker.treesURLMakerWriteStory(data.urlParams));$this.trigger("sync")}),that};this.fetch=function(callback){callback=callback||$.noop;var urlParams=util.getBigTreeId();return $.extend(urlParams,util.getSettings(this.galleryType)),mediaService.getMediaList(function(data){data?(data.urlParams=urlParams,that.parse(data),callback()):(that.data={serviceError:!0,isEmptyGallery:!0},$this.trigger("sync"),callback())},urlParams,{timeout:1e4}),this};this.addFilter=function(type){return type==="all"?this.typeFilters=[]:this.typeFilters.indexOf(type)===-1&&this.typeFilters.push(type),this.applyFilters(),this};this.setFilters=function(filters){var that=this;return this.typeFilters=filters.filter(function(filterType){return that.mediaTypes.indexOf(filterType)!==-1}),this.applyFilters(),this};this.removeFilter=function(type){return this.typeFilters.splice(this.typeFilters.indexOf(type),1),this.applyFilters(),this};this.applyFilters=function(){for(var showAll=!this.typeFilters.length,items=this.data.objects||[],i=0;i<items.length;i++)items[i].active=showAll||this.typeFilters.indexOf(items[i].type)!==-1;return this.data.isEmptyWithFilters=this.isEmptyWithFilters(),this.data.filterCount=this.typeFilters.length,$this.trigger("change"),this};this.deleteMedia=function(id){return this.removeItemById(id),mediaService.deleteMedia(this.data.urlParams,id),this};this.unlinkMedia=function(id){return this.removeItemById(id),mediaService.unlinkMedia(this.data.urlParams,id),this};this.removeItemById=function(id){var items=this.data.objects;return this.data.objects.some(function(item,idx){if(item.id===id)return items.splice(idx,1),!0}),this};this.setItemSelect=function(id,state){return this.data.objects.some(function(item){if(item.id===id)return item.isSelected=state,!0}),this};this.getSelected=function(){return this.data.objects.filter(function(item){if(item.isSelected)return item})};this.isEmptyWithFilters=function(){var items=this.data.objects||[];return!items.some(function(item){return item.active})};this.applySort=function(functionName){this.sortType.current=functionName;var items=this.data.objects||[];items.sort(mediaApp.sorters[functionName]);$this.trigger("change")};this.getFilterSortQueryString=function(viewerUrl){var connectorSymbol=viewerUrl.indexOf("?")===-1?"?":"&",params=[],paramString="";return this.typeFilters.length&&params.push("filter="+this.typeFilters.join(",")),this.sortType.current!==this.sortType.default&&params.push("sort="+this.sortType.current),params.length&&(paramString=connectorSymbol+params.join("&")),paramString}}},{"../lib/mediaService":9,"../lib/urlMaker":11,"../lib/utility":12,"./galleryItemModel":13}],15:[function(require,module,exports){(function(Hogan){function cleanTripleStache(token){token.n.substr(token.n.length-1)==="}"&&(token.n=token.n.substring(0,token.n.length-1))}function trim(s){return s.trim?s.trim():s.replace(/^\s*|\s*$/g,"")}function tagChange(tag,text,index){if(text.charAt(index)!=tag.charAt(0))return!1;for(var i=1,l=tag.length;i<l;i++)if(text.charAt(index+i)!=tag.charAt(i))return!1;return!0}function buildTree(tokens,kind,stack,customTags){for(var instructions=[],opener=null,tail=null,token=null,tail=stack[stack.length-1];tokens.length>0;){if(token=tokens.shift(),tail&&tail.tag=="<"&&!(token.tag in allowedInSuper))throw new Error("Illegal content in < super tag.");if(Hogan.tags[token.tag]<=Hogan.tags.$||isOpener(token,customTags))stack.push(token),token.nodes=buildTree(tokens,token.tag,stack,customTags);else{if(token.tag=="/"){if(stack.length===0)throw new Error("Closing tag without opener: /"+token.n);if(opener=stack.pop(),token.n!=opener.n&&!isCloser(token.n,opener.n,customTags))throw new Error("Nesting error: "+opener.n+" vs. "+token.n);return opener.end=token.i,instructions}token.tag=="\n"&&(token.last=tokens.length==0||tokens[0].tag=="\n")}instructions.push(token)}if(stack.length>0)throw new Error("missing closing tag: "+stack.pop().n);return instructions}function isOpener(token,tags){for(var i=0,l=tags.length;i<l;i++)if(tags[i].o==token.n)return token.tag="#",!0}function isCloser(close,open,tags){for(var i=0,l=tags.length;i<l;i++)if(tags[i].c==close&&tags[i].o==open)return!0}function stringifySubstitutions(obj){var items=[];for(var key in obj)items.push('"'+esc(key)+'": function(c,p,t,i) {'+obj[key]+"}");return"{ "+items.join(",")+" }"}function stringifyPartials(codeObj){var partials=[];for(var key in codeObj.partials)partials.push('"'+esc(key)+'":{name:"'+esc(codeObj.partials[key].name)+'", '+stringifyPartials(codeObj.partials[key])+"}");return"partials: {"+partials.join(",")+"}, subs: "+stringifySubstitutions(codeObj.subs)}function esc(s){return s.replace(rSlash,"\\\\").replace(rQuot,'\\"').replace(rNewline,"\\n").replace(rCr,"\\r").replace(rLineSep,"\\u2028").replace(rParagraphSep,"\\u2029")}function chooseMethod(s){return~s.indexOf(".")?"d":"f"}function createPartial(node,context){var prefix="<"+(context.prefix||""),sym=prefix+node.n+serialNo++;return context.partials[sym]={name:node.n,partials:{}},context.code+='t.b(t.rp("'+esc(sym)+'",c,p,"'+(node.indent||"")+'"));',sym}function tripleStache(node,context){context.code+="t.b(t.t(t."+chooseMethod(node.n)+'("'+esc(node.n)+'",c,p,0)));'}function write(s){return"t.b("+s+");"}var rIsWhitespace=/\S/,rQuot=/\"/g,rNewline=/\n/g,rCr=/\r/g,rSlash=/\\/g,rLineSep=/\u2028/,rParagraphSep=/\u2029/,allowedInSuper,serialNo;Hogan.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12};Hogan.scan=function(text,delimiters){function addBuf(){buf.length>0&&(tokens.push({tag:"_t",text:new String(buf)}),buf="")}function lineIsWhitespace(){for(var isAllWhitespace=!0,j=lineStart;j<tokens.length;j++)if(isAllWhitespace=Hogan.tags[tokens[j].tag]<Hogan.tags._v||tokens[j].tag=="_t"&&tokens[j].text.match(rIsWhitespace)===null,!isAllWhitespace)return!1;return isAllWhitespace}function filterLine(haveSeenTag,noNewLine){if(addBuf(),haveSeenTag&&lineIsWhitespace())for(var j=lineStart,next;j<tokens.length;j++)tokens[j].text&&((next=tokens[j+1])&&next.tag==">"&&(next.indent=tokens[j].text.toString()),tokens.splice(j,1));else noNewLine||tokens.push({tag:"\n"});seenTag=!1;lineStart=tokens.length}function changeDelimiters(text,index){var close="="+ctag,closeIndex=text.indexOf(close,index),delimiters=trim(text.substring(text.indexOf("=",index)+1,closeIndex)).split(" ");return otag=delimiters[0],ctag=delimiters[delimiters.length-1],closeIndex+close.length-1}var len=text.length,IN_TEXT=0,IN_TAG_TYPE=1,state=IN_TEXT,tagType=null,tag=null,buf="",tokens=[],seenTag=!1,i=0,lineStart=0,otag="{{",ctag="}}";for(delimiters&&(delimiters=delimiters.split(" "),otag=delimiters[0],ctag=delimiters[1]),i=0;i<len;i++)state==IN_TEXT?tagChange(otag,text,i)?(--i,addBuf(),state=IN_TAG_TYPE):text.charAt(i)=="\n"?filterLine(seenTag):buf+=text.charAt(i):state==IN_TAG_TYPE?(i+=otag.length-1,tag=Hogan.tags[text.charAt(i+1)],tagType=tag?text.charAt(i+1):"_v",tagType=="="?(i=changeDelimiters(text,i),state=IN_TEXT):(tag&&i++,state=2),seenTag=i):tagChange(ctag,text,i)?(tokens.push({tag:tagType,n:trim(buf),otag:otag,ctag:ctag,i:tagType=="/"?seenTag-otag.length:i+ctag.length}),buf="",i+=ctag.length-1,state=IN_TEXT,tagType=="{"&&(ctag=="}}"?i++:cleanTripleStache(tokens[tokens.length-1]))):buf+=text.charAt(i);return filterLine(seenTag,!0),tokens};allowedInSuper={_t:!0,"\n":!0,$:!0,"/":!0};Hogan.stringify=function(codeObj){return"{code: function (c,p,i) { "+Hogan.wrapMain(codeObj.code)+" },"+stringifyPartials(codeObj)+"}"};serialNo=0;Hogan.generate=function(tree,text,options){serialNo=0;var context={code:"",subs:{},partials:{}};return(Hogan.walk(tree,context),options.asString)?this.stringify(context,text,options):this.makeTemplate(context,text,options)};Hogan.wrapMain=function(code){return'var t=this;t.b(i=i||"");'+code+"return t.fl();"};Hogan.template=Hogan.Template;Hogan.makeTemplate=function(codeObj,text,options){var template=this.makePartials(codeObj);return template.code=new Function("c","p","i",this.wrapMain(codeObj.code)),new this.template(template,text,this,options)};Hogan.makePartials=function(codeObj){var key,template={subs:{},partials:codeObj.partials,name:codeObj.name};for(key in template.partials)template.partials[key]=this.makePartials(template.partials[key]);for(key in codeObj.subs)template.subs[key]=new Function("c","p","t","i",codeObj.subs[key]);return template};Hogan.codegen={"#":function(node,context){context.code+="if(t.s(t."+chooseMethod(node.n)+'("'+esc(node.n)+'",c,p,1),c,p,0,'+node.i+","+node.end+',"'+node.otag+" "+node.ctag+'")){t.rs(c,p,function(c,p,t){';Hogan.walk(node.nodes,context);context.code+="});c.pop();}"},"^":function(node,context){context.code+="if(!t.s(t."+chooseMethod(node.n)+'("'+esc(node.n)+'",c,p,1),c,p,1,0,0,"")){';Hogan.walk(node.nodes,context);context.code+="};"},">":createPartial,"<":function(node,context){var ctx={partials:{},code:"",subs:{},inPartial:!0},template;Hogan.walk(node.nodes,ctx);template=context.partials[createPartial(node,context)];template.subs=ctx.subs;template.partials=ctx.partials},$:function(node,context){var ctx={subs:{},code:"",partials:context.partials,prefix:node.n};Hogan.walk(node.nodes,ctx);context.subs[node.n]=ctx.code;context.inPartial||(context.code+='t.sub("'+esc(node.n)+'",c,p,i);')},"\n":function(node,context){context.code+=write('"\\n"'+(node.last?"":" + i"))},_v:function(node,context){context.code+="t.b(t.v(t."+chooseMethod(node.n)+'("'+esc(node.n)+'",c,p,0)));'},_t:function(node,context){context.code+=write('"'+esc(node.text)+'"')},"{":tripleStache,"&":tripleStache};Hogan.walk=function(nodelist,context){for(var func,i=0,l=nodelist.length;i<l;i++)func=Hogan.codegen[nodelist[i].tag],func&&func(nodelist[i],context);return context};Hogan.parse=function(tokens,text,options){return options=options||{},buildTree(tokens,"",[],options.sectionTags||[])};Hogan.cache={};Hogan.cacheKey=function(text,options){return[text,!!options.asString,!!options.disableLambda,options.delimiters,!!options.modelGet].join("||")};Hogan.compile=function(text,options){var key,template,partials,name;if(options=options||{},key=Hogan.cacheKey(text,options),template=this.cache[key],template){partials=template.partials;for(name in partials)delete partials[name].instance;return template}return template=this.generate(this.parse(this.scan(text,options.delimiters),text,options),text,options),this.cache[key]=template}})(typeof exports!="undefined"?exports:Hogan)},{}],16:[function(require,module){var Hogan=require("./compiler");Hogan.Template=require("./template").Template;Hogan.template=Hogan.Template;module.exports=Hogan},{"./compiler":15,"./template":17}],17:[function(require,module,exports){(function(Hogan){function findInScope(key,scope,doModelGet){var val;return scope&&typeof scope=="object"&&(scope[key]!==undefined?val=scope[key]:doModelGet&&scope.get&&typeof scope.get=="function"&&(val=scope.get(key))),val}function createSpecializedPartial(instance,subs,partials,stackSubs,stackPartials,stackText){function PartialTemplate(){}function Substitutions(){}PartialTemplate.prototype=instance;Substitutions.prototype=instance.subs;var key,partial=new PartialTemplate;partial.subs=new Substitutions;partial.subsText={};partial.buf="";stackSubs=stackSubs||{};partial.stackSubs=stackSubs;partial.subsText=stackText;for(key in subs)stackSubs[key]||(stackSubs[key]=subs[key]);for(key in stackSubs)partial.subs[key]=stackSubs[key];stackPartials=stackPartials||{};partial.stackPartials=stackPartials;for(key in partials)stackPartials[key]||(stackPartials[key]=partials[key]);for(key in stackPartials)partial.partials[key]=stackPartials[key];return partial}function coerceToString(val){return String(val===null||val===undefined?"":val)}function hoganEscape(str){return str=coerceToString(str),hChars.test(str)?str.replace(rAmp,"&amp;").replace(rLt,"&lt;").replace(rGt,"&gt;").replace(rApos,"&#39;").replace(rQuot,"&quot;"):str}var isArray;Hogan.Template=function(codeObj,text,compiler,options){codeObj=codeObj||{};this.r=codeObj.code||this.r;this.c=compiler;this.options=options||{};this.text=text||"";this.partials=codeObj.partials||{};this.subs=codeObj.subs||{};this.buf=""};Hogan.Template.prototype={r:function(){return""},v:hoganEscape,t:coerceToString,render:function(context,partials,indent){return this.ri([context],partials||{},indent)},ri:function(context,partials,indent){return this.r(context,partials,indent)},ep:function(symbol,partials){var partial=this.partials[symbol],template=partials[partial.name];if(partial.instance&&partial.base==template)return partial.instance;if(typeof template=="string"){if(!this.c)throw new Error("No compiler available.");template=this.c.compile(template,this.options)}if(!template)return null;if(this.partials[symbol].base=template,partial.subs){partials.stackText||(partials.stackText={});for(key in partial.subs)partials.stackText[key]||(partials.stackText[key]=this.activeSub!==undefined&&partials.stackText[this.activeSub]?partials.stackText[this.activeSub]:this.text);template=createSpecializedPartial(template,partial.subs,partial.partials,this.stackSubs,this.stackPartials,partials.stackText)}return this.partials[symbol].instance=template,template},rp:function(symbol,context,partials,indent){var partial=this.ep(symbol,partials);return partial?partial.ri(context,partials,indent):""},rs:function(context,partials,section){var tail=context[context.length-1],i;if(!isArray(tail)){section(context,partials,this);return}for(i=0;i<tail.length;i++)context.push(tail[i]),section(context,partials,this),context.pop()},s:function(val,ctx,partials,inverted,start,end,tags){var pass;return isArray(val)&&val.length===0?!1:(typeof val=="function"&&(val=this.ms(val,ctx,partials,inverted,start,end,tags)),pass=!!val,!inverted&&pass&&ctx&&ctx.push(typeof val=="object"?val:ctx[ctx.length-1]),pass)},d:function(key,ctx,partials,returnFound){var found,names=key.split("."),val=this.f(names[0],ctx,partials,returnFound),doModelGet=this.options.modelGet,cx=null,i;if(key==="."&&isArray(ctx[ctx.length-2]))val=ctx[ctx.length-1];else for(i=1;i<names.length;i++)found=findInScope(names[i],val,doModelGet),found!==undefined?(cx=val,val=found):val="";return returnFound&&!val?!1:(returnFound||typeof val!="function"||(ctx.push(cx),val=this.mv(val,ctx,partials),ctx.pop()),val)},f:function(key,ctx,partials,returnFound){for(var val=!1,v=null,found=!1,doModelGet=this.options.modelGet,i=ctx.length-1;i>=0;i--)if(v=ctx[i],val=findInScope(key,v,doModelGet),val!==undefined){found=!0;break}return found?(returnFound||typeof val!="function"||(val=this.mv(val,ctx,partials)),val):returnFound?!1:""},ls:function(func,cx,partials,text,tags){var oldTags=this.options.delimiters;return this.options.delimiters=tags,this.b(this.ct(coerceToString(func.call(cx,text)),cx,partials)),this.options.delimiters=oldTags,!1},ct:function(text,cx,partials){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(text,this.options).render(cx,partials)},b:function(s){this.buf+=s},fl:function(){var r=this.buf;return this.buf="",r},ms:function(func,ctx,partials,inverted,start,end,tags){var textSource,cx=ctx[ctx.length-1],result=func.call(cx);return typeof result=="function"?inverted?!0:(textSource=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(result,cx,partials,textSource.substring(start,end),tags)):result},mv:function(func,ctx,partials){var cx=ctx[ctx.length-1],result=func.call(cx);return typeof result=="function"?this.ct(coerceToString(result.call(cx)),cx,partials):result},sub:function(name,context,partials,indent){var f=this.subs[name];f&&(this.activeSub=name,f(context,partials,this,indent),this.activeSub=!1)}};var rAmp=/&/g,rLt=/</g,rGt=/>/g,rApos=/\'/g,rQuot=/\"/g,hChars=/[&<>\"\']/;isArray=Array.isArray||function(a){return Object.prototype.toString.call(a)==="[object Array]"}})(typeof exports!="undefined"?exports:{})},{}]},{},[3])