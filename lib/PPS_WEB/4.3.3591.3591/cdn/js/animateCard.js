(function($){"use strict";$.fn.animateCard=function(){for(var params,wrapEmptyContent,wrapCloseContent,cssAnimateCard,defaults=function(){return{animateAdd:{afterAdd:function(){},beforeAdd:function(){},duration:600,trigger:""},animateMove:{afterAnimate:function(){},beforeAnimate:function(){},closeOnAnimate:"",connectWith:null,duration:600,emptyContent:"",newPosition:"first",oneDirection:!1,trigger:""},animateRemove:{afterRemove:function(){},beforeRemove:function(){},emptyContent:"",duration:600,trigger:""},animationString:"animation",items:"*",keyframePrefix:"",onEmptyListAdd:function(){},onListEmpty:function(){},transformPrefix:""}},options=defaults(),animationType="move add remove",animationQueue={inProgress:!1},wrapper=function(item,type){return item.wrap(function(){switch(type){case"close":return'<div class="animatedListCloseContent"><\/div>';case"empty":return'<div class="animatedListEmptyContent"><\/div>';case"add":return'<div class="addTargetPosition" style="display:none;opacity:0.0;">';default:return'<div class="animatedListItem" style="padding-top:'+item.css("margin-top")+"; padding-bottom:"+item.css("margin-bottom")+';"><\/div>'}}).parent()},i=0;i<arguments.length;i++){if(arguments[i].constructor===String){animationType=arguments[i];continue}if(arguments[i].constructor===Object){params=arguments[i];options=$.extend(defaults(),params);params.animateMove&&(options.animateMove=$.extend(defaults().animateMove,params.animateMove));params.animateAdd&&(options.animateAdd=$.extend(defaults().animateAdd,params.animateAdd));params.animateRemove&&(options.animateRemove=$.extend(defaults().animateRemove,params.animateRemove));continue}}return wrapEmptyContent=function($item){return wrapper($item,"empty")},wrapCloseContent=function($item){return wrapper($item,"close")},$("style#animateCard").length==0&&(cssAnimateCard=document.createElement("style"),cssAnimateCard.id="animateCard",cssAnimateCard.type="text/css",cssAnimateCard.appendChild(document.createTextNode(".animatedListItem { -webkit-transform: translate3d(0, 0, 0);-moz-transform: translate3d(0, 0, 0);-ms-transform: translate3d(0, 0, 0);transform: translate3d(0, 0, 0);-webkit-backface-visibility: hidden;-moz-backface-visibility: hidden;-ms-backface-visibility: hidden;backface-visibility: hidden;-webkit-perspective: 1000;-moz-perspective: 1000;-ms-perspective: 1000;perspective: 1000; } @media screen and (-webkit-min-device-pixel-ratio:0) { .addTargetPosition { overflow: visible !important }  } .animatedListItem:first-child,.animatedListEmptyContent:first-child, .animatedListCloseContent:first-child { margin: 0; } .animatedListItem.moving { position: relative;z-index: 2; } .animatedListItem > .topSpacing { margin-top:0 !important; } ")),document.getElementsByTagName("head")[0].appendChild(cssAnimateCard)),$.fn.animateCardMove=function(moveEvent){var $this=$(this),$connector,$lists=$(this);moveEvent.connectWith&&($connector=$(moveEvent.connectWith).addClass("animatedList"),$connector.length&&(options.oneDirection||($lists=$lists.add($connector))));$lists.on("animateListItem.move "+moveEvent.trigger,options.items,function(event,data){var $pushItem,distance,postAnimate,pushKeyframes,closeKeyframes,Animation,margin;if(animationQueue.inProgress)return!1;animationQueue.inProgress=!0;var $listItem=$(this),$item=wrapper($listItem),itemRect=$item[0].getBoundingClientRect(),$originList=$(event.delegateTarget),$originEmptyContent=moveEvent.emptyContent?wrapEmptyContent($originList.children(moveEvent.emptyContent)):null,$originCloseContent=moveEvent.closeOnAnimate?wrapCloseContent($originList.children(moveEvent.closeOnAnimate)):null,$targetList=$connector&&event.delegateTarget!=$connector[0]?$connector:$this,$targetItems=$targetList.children(options.items),targetPosition=document.createElement("div"),newPosition=data&&data.position||moveEvent.newPosition,$targetPosition=$(targetPosition),$targetEmptyContent=moveEvent.emptyContent?wrapEmptyContent($targetList.children(moveEvent.emptyContent)):null,$targetCloseContent=moveEvent.closeOnAnimate?wrapCloseContent($targetList.children(moveEvent.closeOnAnimate)):null,emptyContentTargetHeight=0,closeContentTargetHeight=0,emptyContentOriginHeight=0,closeContentOriginHeight=0,contentToClose=null,cssAnimation=document.createElement("style");if(targetPosition.setAttribute("class","targetPosition"),newPosition==="first"&&(newPosition=0),typeof moveEvent.beforeAnimate=="function"&&moveEvent.beforeAnimate($item,$originList),newPosition==="last"||newPosition>=$targetItems.length)$targetList.append($targetPosition),newPosition=$targetItems.length;else{if($pushItem=$targetItems.eq(newPosition),$pushItem[0]==this)return animationQueue.inProgress=!1;!$connector&&newPosition!=0&&newPosition>$item.index()-1?$pushItem.after($targetPosition):$pushItem.before($targetPosition)}$connector&&$targetCloseContent&&$targetCloseContent.length&&$targetCloseContent.children(":first-child").is(":visible")&&(closeContentTargetHeight=parseInt($targetCloseContent.css("height")),$targetCloseContent.css("height","auto"));$targetEmptyContent&&$targetEmptyContent.length&&$targetList.children(options.items).length===0&&(emptyContentTargetHeight=parseInt($targetEmptyContent.css("height")),$targetPosition.prepend($targetEmptyContent.css("height","auto")));var targetPositionRect=targetPosition.getBoundingClientRect(),cardHeight=parseInt($item.css("height")),movingDown=targetPositionRect.top>itemRect.top,itemSpacing=movingDown?parseInt($item.css("padding-top")):parseInt($item.css("padding-bottom"));if($originCloseContent&&$originCloseContent.length&&$originCloseContent.children(":first-child").is(":visible")&&(closeContentOriginHeight=parseInt($originList.find(".animatedListCloseContent :first-child").css("height")),contentToClose=$originCloseContent.css("height",closeContentOriginHeight+"px").get(0)),$originEmptyContent&&$originEmptyContent.length&&$originList.children(options.items).length===0&&(emptyContentOriginHeight=parseInt($originList.find(".animatedListEmptyContent :first-child").css("height"))),distance={left:"",top:targetPositionRect.top-itemRect.top},distance.top=movingDown?distance.top-(cardHeight-(emptyContentOriginHeight-closeContentOriginHeight))-itemSpacing:distance.top+(emptyContentTargetHeight+closeContentTargetHeight)-(emptyContentOriginHeight-closeContentOriginHeight)-itemSpacing,$item.addClass("moving"),$targetList.children(options.items).length===0&&typeof options.onEmptyListAdd=="function")options.onEmptyListAdd($targetList);if(postAnimate=function(){if($connector&&$originList.children(options.items).length==0&&(emptyContentOriginHeight>0&&$originEmptyContent.css("height",emptyContentOriginHeight+"px"),typeof options.onListEmpty=="function"))options.onListEmpty($originList);targetPosition.appendChild($item[0]);$($originCloseContent).css("height","auto");animationQueue.inProgress=!1;$item.removeAttr("style").removeClass("moving").unwrap();$listItem.unwrap();$originEmptyContent&&$originEmptyContent.children(":first-child").unwrap();$targetEmptyContent&&$targetEmptyContent.children(":first-child").unwrap();$originCloseContent&&$originCloseContent.children(":first-child").unwrap();$targetCloseContent&&$targetCloseContent.children(":first-child").unwrap();$(cssAnimation).remove();typeof moveEvent.afterAnimate=="function"&&moveEvent.afterAnimate($listItem,$targetList)},options.animation===!1)postAnimate();else{targetPosition.style[options.animationString]="animate-push "+moveEvent.duration/1e3+"s linear forwards";pushKeyframes="@"+options.keyframePrefix+"keyframes animate-push { from { height: "+(emptyContentTargetHeight+closeContentTargetHeight)+"px; }to { height: "+cardHeight+"px; }}";contentToClose&&(contentToClose.style[options.animationString]="animate-close "+moveEvent.duration/1e3+"s linear forwards",closeKeyframes="@"+options.keyframePrefix+"keyframes animate-close { from { height: "+closeContentOriginHeight+"px; }to { height: 0px; }}");$item[0].style[options.animationString]="animate-card "+moveEvent.duration/1e3+"s linear forwards";Animation={};margin=movingDown?"margin-bottom: ":"margin-top: ";Animation["0%"]={translate:{X:"",Y:"0px"},scale:"1",pull:margin+"0px;"};Animation["50%"]={translate:{X:"",Y:distance.top/2+"px"},scale:"1.05",pull:margin+-((cardHeight-emptyContentOriginHeight)/2)+"px;"};Animation["100%"]={translate:{X:"",Y:distance.top+"px"},scale:"1",pull:margin+-(cardHeight-emptyContentOriginHeight)+"px;"};var cardKeyframes="@"+options.keyframePrefix+"keyframes animate-card { 0% { "+options.transformPrefix+"transform:translateY("+Animation["0%"].translate.Y+") scale("+Animation["0%"].scale+"); "+Animation["0%"].pull+" }50% { "+options.transformPrefix+"transform:translateY("+Animation["50%"].translate.Y+") scale("+Animation["50%"].scale+"); "+Animation["50%"].pull+" }100% { "+options.transformPrefix+"transform:translateY("+Animation["100%"].translate.Y+") scale("+Animation["100%"].scale+"); "+Animation["100%"].pull+" }}",pushKeyframeRules=document.createTextNode(pushKeyframes),cardKeyframeRules=document.createTextNode(cardKeyframes),closeKeyframeRules;closeKeyframes&&(closeKeyframeRules=document.createTextNode(closeKeyframes));cssAnimation.type="text/css";document.getElementsByTagName("head")[0].appendChild(cssAnimation);cssAnimation.appendChild(pushKeyframeRules);cssAnimation.appendChild(cardKeyframeRules);closeKeyframeRules&&cssAnimation.appendChild(closeKeyframeRules);$item.one("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",postAnimate)}});return $(this)},$.fn.animateCardAdd=function(addEvent){var $list=$(this);$list.on("animateListItem.add "+options.addEvent,function(event,newItem,data){var $list=$(this),delay=data&&data.delay||0,$targetPosition=wrapper(newItem,"add"),position=data&&data.position||addEvent.position,$previous=data&&data.previous||$list.children(options.items).eq(position),$emptyContent=addEvent.emptyContent?$list.children(addEvent.emptyContent):null,offset,height;typeof addEvent.beforeAdd=="function"&&addEvent.beforeAdd(newItem,$list,data);offset=0;position=="first"?$list.prepend($targetPosition):$previous.length?($previous.before($targetPosition),offset=parseInt(newItem.css("margin-top"))):($list.append($targetPosition),offset=parseInt(newItem.css("margin-top")));$list.children(options.items).length==0?$emptyContent&&$emptyContent.is(":visible")?$emptyContent.fadeOut(addEvent.duration,function(){$targetPosition.show().animate({opacity:"1.0"},addEvent.duration,function(){newItem.unwrap();typeof addEvent.afterAdd=="function"&&addEvent.afterAdd(newItem,$list,data)})}):$previous.length&&$previous.is(":visible")?$previous.fadeOut(addEvent.duration,function(){$targetPosition.fadeTo(addEvent.duration,1,function(){newItem.unwrap();typeof addEvent.afterAdd=="function"&&addEvent.afterAdd(newItem,$list,data)})}):$targetPosition.fadeIn(addEvent.duration,function(){newItem.unwrap();typeof addEvent.afterAdd=="function"&&addEvent.afterAdd(newItem,$list,data)}):(height=parseInt($targetPosition.css("height"))-offset,$targetPosition.css("height",0).show(),$targetPosition.delay(delay).animate({height:height},addEvent.duration,function(){$targetPosition.animate({opacity:"1.0"},addEvent.duration,function(){newItem.unwrap();typeof addEvent.afterAdd=="function"&&addEvent.afterAdd(newItem,$list,data)})}))});return $list},$.fn.animateCardRemove=function(removeEvent){var $list=$(this);$list.on("animateListItem.remove "+options.removeEvent,options.items,function(event,data){var $listItem=$(this),$item=wrapper($listItem),$emptyContent=$list.find(removeEvent.emptyContent);$emptyContent.length&&$list.find(options.items).length==1?$item.animate({opacity:"toggle"},removeEvent.duration,function(){$listItem.remove();$emptyContent.fadeIn(removeEvent.duration,function(){$item.remove();typeof removeEvent.afterRemove=="function"&&removeEvent.afterRemove($listItem,data)})}):$item.animate({opacity:"0.0"},removeEvent.duration,function(){typeof removeEvent.beforeRemove=="function"&&removeEvent.beforeRemove($listItem,data);$item.slideUp(removeEvent.duration,function(){$item.remove();typeof removeEvent.afterRemove=="function"&&removeEvent.afterRemove($listItem,data)})})});return $list},this.each(function(){var $this=$(this).addClass("animatedList"),$lists=$this,pfx="",i=0,domPrefixes="Webkit Moz O ms Khtml".split(" "),needsAnimationPrefix=$this[0].style.animationName===undefined,needsTransformPrefix=$this[0].style.transform===undefined;for(options.animation=!1,needsAnimationPrefix||needsTransformPrefix||(options.animation=!0);options.animation===!1;)if(pfx=domPrefixes[i++],needsAnimationPrefix&&$this[0].style[pfx+"AnimationName"]!==undefined&&(options.animationString=pfx+"Animation",options.keyframePrefix="-"+pfx.toLowerCase()+"-",needsAnimationPrefix=!1),needsTransformPrefix&&$this[0].style[pfx+"transform"]!==undefined&&(pfx=domPrefixes[i],options.transformPrefix="-"+pfx.toLowerCase()+"-",needsTransformPrefix=!1),needsAnimationPrefix||needsTransformPrefix){if(i==domPrefixes.length)break}else options.animation=!0;animationType=animationType||"move add remove";animationType.indexOf("move")!=-1&&$lists.animateCardMove(options.animateMove);animationType.indexOf("add")!=-1&&$lists.animateCardAdd(options.animateAdd);$lists.animateCardRemove(options.animateRemove)})}})(jQuery)