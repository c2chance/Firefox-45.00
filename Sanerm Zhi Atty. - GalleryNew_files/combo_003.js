(function($){"use strict";var shared={debounce:function(callback,delay,immediate){return this.throttle(callback,delay,undefined,!!immediate)},focusable:function(element,isTabIndexNotNaN){var nodeName=element.nodeName.toLowerCase();return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&this.visible(element)},getRandomNumber:function(min,max){return!isNaN(min)&&!isNaN(max)?Math.floor(Math.random()*(1+max-min)+min):Date.now().toString()+Math.floor(Math.random()*1e3+1)},isValidCallback:function(callback){return callback&&$.isFunction(callback)},lang:function(){var langAttr=$("html").attr("lang")||$("[lang]").first().attr("lang");return langAttr?langAttr.toLowerCase():"en"}(),localize:function(langSet,key){return langSet[this.lang]&&langSet[this.lang][key]?langSet[this.lang][key]:langSet[this.lang.substring(0,2)]&&langSet[this.lang.substring(0,2)][key]?langSet[this.lang.substring(0,2)][key]:langSet.en[key]||""},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&this.focusable(element,!isTabIndexNaN)},throttle:function(callback,delay,noTrail,immediate){var timeout,previous=0;return function(){function reset(){timeout=undefined}function execute(){previous=Date.now();callback.apply(self,args)}var self=this,elapsed=Date.now()-previous,args=arguments,timeoutCallback,timeoutDelay;immediate&&!timeout&&execute();timeout&&clearTimeout(timeout);immediate===undefined&&elapsed>delay?execute():noTrail!==!0&&(timeoutCallback=immediate?reset:execute,timeoutDelay=immediate===undefined?delay-elapsed:delay,timeout=setTimeout(timeoutCallback,timeoutDelay))}},timer:function(callback,delay){var timerId,remaining=delay,start,state="stopped",obj={pause:function(){state==="play"&&(clearTimeout(timerId),remaining-=new Date-start,state="pause")},stop:function(){state!=="stopped"&&(clearTimeout(timerId),remaining=delay,state="stopped")},play:function(){state!=="play"&&(start=new Date,clearTimeout(timerId),timerId=setTimeout(function(){callback();remaining=delay},remaining));state="play"}};return obj.play(),obj},visible:function(element){return $(element).is(":visible")&&!$(element).parents().andSelf().filter(function(){return $.css(this,"visibility")==="hidden"}).length},warn:function(msg,useAlert){window.console&&(console.warn(msg),useAlert&&/ancestry(?:stage|dev)/.test(window.location.hostname)&&alert(msg))}},alert={create:function($element,options){var instance=$element.data("alertInstance");if(instance&&instance.destroy(),instance=Object.create(this.proto),instance.$element=$element,instance.config=$.extend({},this.staticProperties.defaults,instance._getOptionsByClass(),options),instance.uniqueId=$element.attr("id")||shared.getRandomNumber(),instance.shouldAnimate=$("body").find(instance.$element).length&&!shared.visible($element[0])||!instance.config.open,instance.hasFocusableChildren=instance._hasTabbableElements(),instance.$element.attr(instance._getAttributes()),instance._initClasses(),instance.isOpen=!1,instance.bottomMargin=instance._getBottomMargin(),instance.config.display==="notification")instance.shouldAnimate=!0,instance._addOrRemoveNotification(),instance.config.closeable=!0,instance.config.removable=!0;else if(instance.config.display==="overlay"){instance.center();$(window).on("resize.alert."+instance.uniqueId+" orientationchange.alert."+instance.uniqueId,shared.debounce(function(){instance.center()},100));instance.config.closeable=!0}return instance.config.open&&instance.open(),instance.config.closeable&&instance._createCloseButton(),instance.$element.data("alertInstance",instance),instance},proto:{_addOrRemoveNotification:function(){$("#alertNotifications").length||$('<div id="alertNotifications" class="alertNotifications" aria-live="polite"><\/div>').appendTo("body");this.$element.parents("#alertNotifications").length||this.$element.prependTo("#alertNotifications")},center:function(){var width;this.config.display==="overlay"&&(this.$element.css({display:"inline-block",position:"relative",width:"auto"}),width=Math.ceil(this.$element[0].getBoundingClientRect().width),this.$element.css({display:"","margin-left":"-"+Math.floor(width/2)+"px",position:"",width:width}))},close:function(){var marginShouldAnimate,self=this;this.isOpen&&(this.$element.trigger("closing.alert"),marginShouldAnimate=this.$element.hasClass("alertSitewide")||this.$element.is(":first-child"),this.$element.addClass("alertHiding").css("margin-bottom",this.bottomMargin-this.$element.outerHeight(marginShouldAnimate)),setTimeout(function(){self.$element.addClass("alertHidden").css("margin-bottom","");shared.isValidCallback(self.config.onClose)&&self.config.onClose.apply(self.$element,[self.$element]);self.durationTimer&&self.durationTimer.stop();self.isOpen=!1;self.shouldAnimate=!0;self.$element.trigger("closed.alert");self.config.removable&&self.destroy()},410))},_createCloseButton:function(){var $closeBtn=this.$element.find(".alertCloseBtn"),self=this;$closeBtn.length?$closeBtn.addClass("closeBtn").empty():($closeBtn=$('<button class="closeBtn alertCloseBtn" type="button" title="'+shared.localize(alert.staticProperties.langSets,"closeBtn")+'"><\/button>'),this.$element.append($closeBtn));this.$element.addClass("alertCloseable");$closeBtn.on("click.alert",function(){self.close()})},destroy:function(){$(window).off(".alert."+this.uniqueId);this.config.removable?this.$element.remove():this.$element.off(".alert").removeData("alertInstance").removeClass("alertCloseable alertInfo alertNoIcon alertNotification alertOverlay alertSection alertSitewide alertSlim alertSuccess").find(".closeBtn").remove()},_getAttributes:function(){var attr={role:this.$element.attr("role"),"aria-label":this.$element.attr("aria-label")};return this.$element.attr("role")||(this.hasFocusableChildren?(attr.role="alertdialog",attr.tabindex=this.$element.attr("tabindex")||"-1"):attr.role=this.config.type==="warning"||this.config.type==="success"?"alert":"status"),this.$element.attr("aria-label")||(attr["aria-label"]=this.$element.contents().first().text()),attr},_getBottomMargin:function(){var bottomMargin=parseInt(this.$element.css("margin-bottom"),10);return isNaN(bottomMargin)?0:bottomMargin},_getOptionsByClass:function(){var options={};return this.$element.hasClass("alertSuccess")?options.type="success":(this.$element.hasClass("alertInfo")||this.$element.hasClass("alertNote"))&&(options.type="info"),this.$element.hasClass("alertSitewide")?options.display="sitewide":this.$element.hasClass("alertNotification")?options.display="notification":this.$element.hasClass("alertSection")?options.display="section":this.$element.hasClass("alertOverlay")&&(options.display="overlay"),this.$element.hasClass("alertSlim")&&(options.size="slim"),this.$element.hasClass("alertNoIcon")&&(options.noIcon=!0),this.$element.hasClass("alertHidden")&&(options.open=!1),this.$element.hasClass("alertCloseable")&&(options.closeable=!0),options},_hasTabbableElements:function(){var $elem=$(this.$element),tabElems=0;return $elem.children().each(function(){shared.tabbable(this)&&!$(this).hasClass("alertCloseBtn")&&(tabElems+=1)}),tabElems>0},_initClasses:function(){this.$element.addClass("alert").removeClass("alertCloseable alertInfo alertNoIcon alertNotification alertOverlay alertSection alertSitewide alertSlim alertSuccess");switch(this.config.display){case"notification":this.$element.addClass("alertNotification");break;case"overlay":this.$element.addClass("alertOverlay");break;case"section":this.$element.addClass("alertSection");break;case"sitewide":this.$element.addClass("alertSitewide")}switch(this.config.type){case"success":this.$element.addClass("alertSuccess");break;case"info":this.$element.addClass("alertInfo");break;case"note":this.$element.addClass("alertInfo")}this.config.closeable===!0&&this.$element.addClass("alertCloseable");this.config.noIcon===!0&&this.$element.addClass("alertNoIcon");this.config.size==="slim"&&this.$element.addClass("alertSlim");this.config.open?this.config.open&&this.$element.removeClass("alertHidden alertHiding"):this.$element.addClass("alertHidden alertHiding")},open:function(){var marginToHideAlert,self=this;this.isOpen||(this.$element.trigger("opening.alert"),this.shouldAnimate?(marginToHideAlert=this.$element.removeClass("alertHidden").outerHeight(!1),this.$element.addClass("alertNoTransition").css("margin-bottom",this.bottomMargin-marginToHideAlert),setTimeout(function(){self.$element.removeClass("alertNoTransition alertHiding").css("margin-bottom","")},10),setTimeout(function(){self._opened()},410)):this._opened())},_opened:function(){var self=this;if(this.hasFocusableChildren&&this.$element.focus(),this.config.duration>0){this.durationTimer=shared.timer(function(){self.close()},this.config.duration);this.$element.on("mouseenter.alert",function(){self.durationTimer.pause()}).on("mouseleave.alert",function(){self.durationTimer.play()})}shared.isValidCallback(this.config.onOpen)&&this.config.onOpen.apply(this.$element,[this.$element]);this.$element.trigger("opened.alert");this.isOpen=!0}},staticProperties:{defaults:{closeable:!1,display:"inline",duration:-1,removable:!1,noIcon:!1,onClose:!1,onOpen:!1,open:!0,type:"warning"},langSets:{de:{closeBtn:"Schlie&#223;en"},en:{closeBtn:"Close"},es:{closeBtn:"Cerrar"},fr:{closeBtn:"Fermer"},it:{closeBtn:"Chiudi"},sv:{closeBtn:"St&#228;ng"}}}},version=2,doubleIncluded=!!$.alert;if(doubleIncluded){if($.alert.version===version){shared.warn("ERROR: You are including alert.js multiple times");return}if(shared.warn("ERROR: You are including multiple versions of alert.js"),$.alert.version>version)return}$.fn.alert=function(options){var args=arguments,isMethodCall=typeof options=="string",returnValue=this;return this.each(function(){var self=$(this),instance=self.data("alertInstance"),methodValue;if(isMethodCall){if(!instance)return shared.warn('Cannot call methods on alert prior to initialization; attempted to call method "'+options+'".'),!1;if(!$.isFunction(instance[options])||options.indexOf("_")===0)return shared.warn('No such method "'+options+'" for alert.'),!1;if(methodValue=instance[options].apply(instance,Array.prototype.slice.call(args,1)),methodValue!==instance&&methodValue!==undefined)return returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue,!1}else alert.create(self,options)}),returnValue};$.alert={getTest:function(){return $.extend({},alert)},version:version};doubleIncluded||$(function(){$('.alert:not([data-auto-instantiate="off"])').alert()})})(jQuery);
(function($){"use strict";var shared={debounce:function(callback,delay,immediate){return this.throttle(callback,delay,undefined,!!immediate)},escapeRegExp:function(str){return str.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},focusable:function(element,isTabIndexNotNaN){var nodeName=element.nodeName.toLowerCase();return(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&this.visible(element)},isValidCallback:function(callback){return callback&&$.isFunction(callback)},lang:function(){var langAttr=$("html").attr("lang")||$("[lang]").first().attr("lang");return langAttr?langAttr.toLowerCase():"en"}(),localize:function(langSet,key){return langSet[this.lang]&&langSet[this.lang][key]?langSet[this.lang][key]:langSet[this.lang.substring(0,2)]&&langSet[this.lang.substring(0,2)][key]?langSet[this.lang.substring(0,2)][key]:langSet.en[key]||""},getTabbableElements:function($container){var self=this;return $container.find("input, select, textarea, button, a, object, [tabindex]").filter(function(){return self.tabbable(this)})},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&this.focusable(element,!isTabIndexNaN)},throttle:function(callback,delay,noTrail,immediate){var timeout,previous=0;return function(){function reset(){timeout=undefined}function execute(){previous=Date.now();callback.apply(self,args)}var self=this,elapsed=Date.now()-previous,args=arguments,timeoutCallback,timeoutDelay;immediate&&!timeout&&execute();timeout&&clearTimeout(timeout);immediate===undefined&&elapsed>delay?execute():noTrail!==!0&&(timeoutCallback=immediate?reset:execute,timeoutDelay=immediate===undefined?delay-elapsed:delay,timeout=setTimeout(timeoutCallback,timeoutDelay))}},visible:function(element){return $.expr.filters.visible(element)&&!$(element).parents().andSelf().filter(function(){return $.css(this,"visibility")==="hidden"}).length},warn:function(msg,useAlert){window.console&&(console.warn(msg),useAlert&&/ancestry(?:stage|dev)/.test(window.location.hostname)&&alert(msg))}},autocomplete={create:function($element,options){var instance=$element.data("autocompleteInstance"),id=$element.attr("id"),config;if(instance&&instance.destroy(),options.key){$("#autocomplete").length||$("body").append('<div id="autocomplete"><\/div>');instance=Object.create(this.proto);instance.config=$.extend({},this.staticProperties.defaults,options);config=instance.config;config.minLength=Math.max(1,config.minLength);instance.$element=$element;instance.cachedData={};instance.isOpen=!1;instance.results=[];instance.screenTouches={};instance.term="";instance.$autocomplete=$("#autocomplete");instance.$container=$('<div id = "'+id+'ResultCon" class="autocompleteCon" />');instance.$resultsList=$('<ul id="'+id+'Results" class="autocompleteResults loading" role="listbox" />');$element.addClass("autocompleteInput").attr({"aria-autocomplete":"list","aria-controls":id+"Results","aria-expanded":"false","aria-owns":id+"Results",autocomplete:"off",role:"combobox"});instance.$container.append(instance.$resultsList);instance.$autocomplete.append(instance.$container);instance.$container.on("click.autocomplete",function(){return instance._handleResultsClick()}).on("keydown.autocomplete",function(e){return instance._handleResultsKeydown(e)}).on("keyup.autocomplete",function(e){return instance._handleResultsKeyup(e)});$element.on("input.autocomplete",function(){$element.data("raw")&&($element.removeData("raw"),shared.isValidCallback(config.onChange)&&config.onChange.apply($element,[]));return}).on("keydown.autocomplete",function(e){return instance._handleInputKeydown(e)}).on("keyup.autocomplete",function(e){return instance._handleInputKeyup(e)}).on("focusin.autocomplete",function(){return instance._handleInputFocusin()});return $element.data("autocompleteInstance",instance),shared.isValidCallback(config.onCreate)&&config.onCreate.apply($element,[]),instance}},proto:{_ajaxRequest:function(){var self=this,config=this.config,overrides,params={},originalAjaxObject,updatedAjaxObject,haveFullDataset=!1;config.queryParameter&&(params[config.queryParameter]=this.term);originalAjaxObject={url:config.source,data:params,dataType:config.dataType,error:function(jqXHR,textStatus,errorThrown){shared.warn("Autocomplete Source "+config.source+" cannot be reached");shared.isValidCallback(config.onError)&&config.onError.apply(self.$element,[jqXHR,textStatus,errorThrown]);self.close()},success:function(data){var dirtyResults=[],cleanResults,parent;shared.isValidCallback(config.jsonConversion)?dirtyResults=config.jsonConversion.apply(self.$element,[data,config]):config.dataType==="xml"?(parent=$(data).find(config.key).parent(),parent.each(function(){var returnObj={};$(this).children().each(function(){returnObj[this.nodeName]=$(this).text()});dirtyResults.push(returnObj)})):dirtyResults=data;haveFullDataset&&(self.results=dirtyResults);cleanResults=self._cacheResults(dirtyResults);!cleanResults.length&&config.disableNoResultsMessage?self.close():(self._open(),self._populate(cleanResults))}};this.$resultsList.addClass("loading");overrides=shared.isValidCallback(config.ajaxOverride)?config.ajaxOverride.apply(this.$element,[{url:originalAjaxObject.url,data:originalAjaxObject.data,dataType:originalAjaxObject.dataType}]):config.ajaxOverride;updatedAjaxObject=$.extend({},originalAjaxObject,overrides);$.isEmptyObject(updatedAjaxObject.data)&&(haveFullDataset=!0);$.ajax(updatedAjaxObject)},_bindMouseEvents:function(){var self=this;this.$container.on("mouseenter.autocomplete",".autocompleteResult:not([aria-disabled]):not(.autocompleteNoResults)",function(e){return self.$focus=self._focusItem($(e.currentTarget)),!0}).on("mouseleave.autocomplete",".autocompleteResult:not([aria-disabled]):not(.autocompleteNoResults)",function(e){return e.relatedTarget&&self._clearFocus(),!0})},_buildResult:function(item,i,elementId){var self=this,config=this.config,$result="",attributes='tabindex="0"',classes="autocompleteResult",id=elementId+"Autocomplete"+i,itemData={term:this.term,value:item[config.key],display:this._getHighlightedValue(this.term,item[config.key]),raw:item};if(shared.isValidCallback(config.customDisplay)&&(itemData=config.customDisplay.apply(this.$element,[itemData])),itemData.checked===!0&&(classes+=" autocompleteChecked iconAfter iconAfterCheck"),itemData.disabled&&(attributes='aria-disabled="true"'),$result=$("<li "+attributes+' class="'+classes+'" role="option" aria-selected="false" id="'+id+'"><div class="textWrap">'+itemData.display+"<\/div><\/li>"),$result.data({raw:item,value:itemData.value}),!itemData.disabled)$result.on("click.autocomplete",function(e){return self._handleResultClick(e)});return $result},_cacheResults:function(dirtyResults){var self=this,cleanResults=[];return this.config.queryParameter?cleanResults=dirtyResults:dirtyResults.forEach(function(item){self._compare(item)&&cleanResults.push(item)}),this.cachedData[this.term.toLowerCase()]=cleanResults,cleanResults},_clearFocus:function(){this.$focus&&(this.$focus.removeAttr("aria-selected").removeClass("autocompleteSelected"),this.$focus=!1)},close:function(){var config=this.config,id=this.$element.attr("id");this.isOpen&&(shared.isValidCallback(config.onClose)&&config.onClose.apply(this.$element,[this.$container,this.$before,this.$after]),this.$before&&(this.$before.remove(),this.$before=!1),this.$after&&(this.$after.remove(),this.$after=!1),(this.inModal||this.inCallout)&&this.$autocomplete.appendTo("body"),$(window).add("html").add("body").off(".autocomplete."+id),this._clearFocus(),this.$container.off("mouseenter.autocomplete mouseleave.autocomplete").removeClass("autocompleteVisible autocompleteInModal autocompleteInCallout"),this.$resultsList.empty(),this.$autocomplete.css("max-height",""),this.$element.attr("aria-expanded","false").removeClass("autocompleteAttached autocompleteInputInCallout"),this.isOpen=!1,this.$element.trigger("closed.autocomplete"))},_compare:function(item){var config=this.config,regEx=new RegExp(shared.escapeRegExp(this.term),"gi"),termSearch=item[config.key].search(regEx);return config.matchBeginning&&termSearch===0||!config.matchBeginning&&termSearch!==-1},destroy:function(){this.close();this.$element.add(this.$container).add(this.$resultsList).off(".autocomplete");this.$element.removeClass("autocompleteInput").removeAttr("aria-autocomplete aria-controls aria-expanded aria-owns autocomplete role").removeData("autocompleteInstance raw");this.$container.remove()},flush:function(){this.cachedData={}},_focusItem:function($item){return this._clearFocus(),$item.addClass("autocompleteSelected").focus(),$item.closest(this.$resultsList).length&&$item.attr("aria-selected","true"),shared.isValidCallback(this.config.onFocus)&&this.config.onFocus.apply(this.$element,[$item]),$item},_getHighlightedValue:function(searchTerm,highlightedValue){var config=this.config,openPattern,closePattern,regex;return config.highlight&&(regex=new RegExp(shared.escapeRegExp(searchTerm),"gi"),config.highlight===!0?highlightedValue=highlightedValue.replace(regex,function(matched){return'<span class="autocompleteHighlighted">'+matched+"<\/span>"}):(openPattern=new RegExp(shared.escapeRegExp(config.highlight.open),"g"),closePattern=new RegExp(shared.escapeRegExp(config.highlight.close),"g"),highlightedValue=highlightedValue.replace(openPattern,'<span class="autocompleteHighlighted">').replace(closePattern,"<\/span>"))),highlightedValue},_handleBodyFocusin:function(e){var $target=$(e.target),targetInContainer=!!$target.closest(this.$container).length,targetIsCurrentCallout=this.inCallout&&$target.is("#calloutContent"),targetIsCurrentElement=$target.is(this.$element);return targetInContainer||targetIsCurrentCallout||targetIsCurrentElement||this.close(),!0},_handleHtmlTouchendOrClick:function(e){var $target=$(e.target),isLabel=$target.attr("for"),$input=isLabel?$("#"+isLabel):!1,isTapEvent=e.originalEvent.changedTouches?Math.max(Math.abs(this.screenTouches.x-e.originalEvent.changedTouches[0].pageX),Math.abs(this.screenTouches.y-e.originalEvent.changedTouches[0].pageY))<5:!1,targetInAutocomplete=!!$target.closest(this.$autocomplete).length,targetInElement=!!$target.closest(this.$element).length;return targetInElement||targetInAutocomplete||(!$input||$input.hasClass("autocompleteAttached"))&&($input||$target.hasClass("autocompleteAttached"))||(e.type==="click"||isTapEvent)&&this.close(),!0},_handleHtmlTouchstart:function(e){return this.screenTouches.x=e.originalEvent.touches?e.originalEvent.touches[0].pageX:e.pageX,this.screenTouches.y=e.originalEvent.touches?e.originalEvent.touches[0].pageY:e.pageY,!0},_handleInputFocusin:function(){return this.isOpen?this._clearFocus():this._retrieveResults(),!0},_handleInputKeydown:function(e){var key=e.which;if(key===9||key===27)this.close();else if(key===38||key===40)return!1;return!0},_handleInputKeyup:function(e){var key=e.which;return key===38||key===40?(this._navigateListItems(key===38),!1):(key!==9&&key!==13&&key!==16&&key!==27&&this.run(),!0)},_handleResultClick:function(e){var $result=$(e.currentTarget);return $result.attr("aria-disabled")?!1:(this._selectItem($result),!0)},_handleResultsClick:function(){return this.inModal&&$.modal&&$.modal.preventClosing(),!0},_handleResultsKeydown:function(e){var key=e.which,$result=$(e.target),isResult=!!$result.closest(this.$resultsList).length,tabOnResult=isResult&&key===9,enterOnResult=isResult&&key===13,shouldSelectResult=tabOnResult||enterOnResult,shouldStopEvent=enterOnResult||key===27||key===38||key===40,shouldClose=key===27||key===9&&!isResult,shouldFocusOnElement=shouldClose||!shouldStopEvent&&key!==13&&!$result.is("input, textarea");return shouldSelectResult?this._selectItem($result):shouldFocusOnElement&&this.$element.focus(),shouldClose&&this.close(),!shouldStopEvent},_handleResultsKeyup:function(e){var key=e.which;return(key===40||key===221)&&this._navigateListItems(),(key===38||key===219)&&this._navigateListItems(!0),!0},_navigateListItems:function(reverse){var currentIndex,targetIndex,$targetElement=!1,$endElement,$tabbable;if($tabbable=shared.getTabbableElements(this.$container),!$tabbable.length)return!1;this.$focus?($endElement=reverse?$tabbable.first():$tabbable.last(),this.$focus.is($endElement)||(currentIndex=$tabbable.index(this.$focus),targetIndex=reverse?currentIndex-1:currentIndex+1,$targetElement=$tabbable.eq(targetIndex))):$targetElement=reverse?$tabbable.last():$tabbable.first();$targetElement?this.$focus=this._focusItem($targetElement):this.$element.focus()},_open:function(){var self=this,config=this.config,id=this.$element.attr("id");if(this.inModal=this.$element.closest(".modal, #modal").length>0,this.inCallout=this.$element.closest("#callout").length>0,this.$resultsList.off("click.autocomplete.noResults").removeClass("loading autocompleteHasChecks").empty(),this.inCallout||this._positionAutocomplete(),!this.isOpen){if(shared.isValidCallback(config.onOpen)&&(this.$before=$('<div class="autocompleteBefore" />'),this.$after=$('<div class="autocompleteAfter" />'),config.onOpen.apply(this.$element,[this.$container,this.$before,this.$after]),this.$before.is(":empty")||this.$resultsList.before(this.$before),this.$after.is(":empty")||this.$resultsList.after(this.$after)),this.$element.addClass("autocompleteAttached").attr("aria-expanded","true"),this.$container.addClass("autocompleteVisible"),this.inCallout)this.$element.addClass("autocompleteInputInCallout"),this.$container.addClass("autocompleteInCallout"),this.$element.parent(".labelIconOnly").length?this.$autocomplete.insertAfter(this.$element.parent()):this.$autocomplete.insertAfter(this.$element);else{$(window).on("resize.autocomplete."+id,shared.debounce(function(){return self._positionAutocomplete(),!0},100));this.inModal&&(this.$container.addClass("autocompleteInModal"),this.$autocomplete.appendTo("#modal"))}$("html").on("touchstart.autocomplete."+id,function(e){return self._handleHtmlTouchstart(e)}).on("touchend.autocomplete."+id+" click.autocomplete."+id,function(e){return self._handleHtmlTouchendOrClick(e)});$("body").on("focusin.autocomplete."+id,function(e){return self._handleBodyFocusin(e)});this.isOpen=!0;this._bindMouseEvents();this.$element.trigger("opened.autocomplete")}},_populate:function(results){var self=this,elementId=self.$element.attr("id");if(shared.isValidCallback(this.config.onResponse)&&this.config.onResponse.apply(this.$element,[results]),results.length)results=results.slice(0,this.config.maxResults),results.forEach(function(item,i){var $result=self._buildResult(item,i,elementId);self.$resultsList.append($result)}),self.$resultsList.find(".autocompleteChecked").length&&self.$resultsList.addClass("autocompleteHasChecks");else{this.$resultsList.html('<li class="autocompleteResult autocompleteNoResults" role="alert" label="Search Results">'+shared.localize(autocomplete.staticProperties.langSets,"noMatches")+"<\/li>").on("click.autocomplete.noResults",function(){return!1});this.$element.removeData("raw")}this.$element.trigger("populated.autocomplete")},_positionAutocomplete:function(){var self=this;this._positionContainer();this.inModal&&setTimeout(function(){self._positionContainer()},300)},_positionContainer:function(){var offset=this.$element.offset(),top,modalPadding,$modal;this.$container.css("max-height","");top=Number(offset.top+this.$element.outerHeight(!1));this.inModal&&($modal=$("#modal"),$modal.css("position")==="absolute"?(modalPadding=parseInt($("#modalContents").css("padding"),10),this.$container.css("max-height",$("#modal").outerHeight(!0)-top-modalPadding)):$modal.css("position")==="fixed"&&(top-=$(document).scrollTop()));this.$container.css({top:top,left:offset.left,width:this.$element.outerWidth(!1)})},_retrieveResults:function(){var config=this.config,convertedData,enoughCharacters=!1,prevTerm=this.term,results;(this.term=this.$element.val(),this.term===prevTerm&&this.isOpen)||(enoughCharacters=this.term.length>=config.minLength,enoughCharacters?this.term!==this.$element.attr("placeholder")&&(shared.isValidCallback(config.onSearch)&&config.onSearch.apply(this.$element,[this.term]),Array.isArray(this.cachedData[this.term.toLowerCase()])?results=this.cachedData[this.term.toLowerCase()]:$.isFunction(config.source)?(convertedData=shared.isValidCallback(config.jsonConversion)?config.jsonConversion.apply(this.$element,[config.source.apply(this.$element,[this.term])]):config.source.apply(this.$element,[this.term]),results=convertedData):typeof config.source=="object"?(convertedData=shared.isValidCallback(config.jsonConversion)?config.jsonConversion.apply(this.$element,[config.source,config]):config.source,results=this._cacheResults(convertedData)):typeof config.source=="string"&&(this.results&&this.results.length?results=this._cacheResults(this.results):this._ajaxRequest()),results&&(!results.length&&config.disableNoResultsMessage?this.close():(this._open(),this._populate(results)))):config.alwaysOpenOnFocus&&!this.isOpen?this._open():!config.alwaysOpenOnFocus&&this.isOpen?this.close():this.$resultsList.empty())},run:shared.debounce(function(){this._retrieveResults()},200),_selectItem:function($item){var config=this.config,raw=$item.data("raw");$item&&this.$focus&&$item[0]===this.$focus[0]?(this.$element.data("raw",raw).val($item.data("value")),shared.isValidCallback(config.onResultSelect)&&(shared.warn('DEPRECATION NOTICE: Please replace "onResultSelect" with "onItemSelect"'),config.onResultSelect.apply(this.$element,[$item])),shared.isValidCallback(config.onItemSelect)&&config.onItemSelect.apply(this.$element,[raw])):this.$element.removeData("raw");this.$element.focus();this.close()}},staticProperties:{defaults:{ajaxOverride:{},alwaysOpenOnFocus:!1,customDisplay:!1,dataType:"json",disableNoResultsMessage:!1,highlight:!0,jsonConversion:!1,key:"",matchBeginning:!1,maxResults:20,minLength:3,onChange:!1,onClose:!1,onCreate:!1,onError:!1,onFocus:!1,onItemSelect:!1,onOpen:!1,onResponse:!1,onSearch:!1,queryParameter:!1,source:""},langSets:{de:{noMatches:"Keine &#220;bereinstimmungen gefunden"},en:{noMatches:"No matches found"},es:{noMatches:"No se encontraron concordancias"},fr:{noMatches:"Aucune correspondance trouv&#233;e"},it:{noMatches:"Nessuna corrispondenza trovata"},sv:{noMatches:"Inga matchningar hittades"}}}},version=2,doubleIncluded=!!$.autocomplete;if(doubleIncluded){if($.autocomplete.version===version){shared.warn("ERROR: You are including autocomplete.js multiple times");return}if(shared.warn("ERROR: You are including multiple versions of autocomplete.js"),$.autocomplete.version>version)return}$.fn.autocomplete=function(options){var isMethodCall=typeof options=="string",args=arguments,returnValue=this;return this.each(function(){var $this=$(this),instance=$this.data("autocompleteInstance"),methodValue;if(isMethodCall){if(!instance)return shared.warn('Cannot call methods on autocomplete prior to initialization; attempted to call method "'+options+'".'),!1;if(!$.isFunction(instance[options])||options.indexOf("_")===0)return shared.warn('No such method "'+options+'" for autocomplete.'),!1;if(methodValue=instance[options].apply(instance,Array.prototype.slice.call(args,1)),methodValue!==instance&&methodValue!==undefined)return returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue,!1}else autocomplete.create($this,options)}),returnValue};$.autocomplete={close:function(){var $autocompleteInput=$(".autocompleteAttached");$autocompleteInput.length&&$autocompleteInput.autocomplete("close")},getTest:function(){return $.extend({},autocomplete)},version:version}})(jQuery);
(function($){"use strict";function extractData(str){var i,parts=str.replace(/,/g," ").replace(/\//g," ").replace(/-/g," ").replace(/\./g," ").replace(/\s{2,}/g," ").trim().split(" "),terms=[],mods=[],unknowns=[],term,mod;if(parts.length)for(i=0;i<parts.length;i+=1)term=parts[i],mod=isModifier(term),mod?mods.push(mod):isUnknown(term)?unknowns.push(term):term!==""&&terms.push(processTerm(term));return{modifiers:mods,terms:terms,unknowns:unknowns}}function filterCalendarEra(str){var era,rex,match;for(var eraPattern in calendarEras)if(calendarEras.hasOwnProperty(eraPattern)&&(rex=new RegExp(eraPattern,"i"),match=rex.test(str),match)){str=str.replace(rex,"");era=calendarEras[eraPattern];break}return{era:era,str:str.trim()}}function formatDoubleYear(doubleYear){return doubleYear=(doubleYear%100).toString(),doubleYear.length<2&&(doubleYear="0"+doubleYear),doubleYear}function generate1TermDates(terms){var dates=[],term=terms[0];return term.month&&dates.push({month:term.month,monthAbbr:term.monthAbbr}),term.year&&dates.push({year:term.integer}),dates}function generate2TermDates(terms,nonUS){var dates=[],first=terms[0],second=terms[1],dm;return first.month&&second.day&&dates.push({day:second.integer,month:first.month,monthAbbr:first.monthAbbr}),first.day&&second.month&&(first.isOrdinal||first.integer!==second.integer)&&(dm={day:first.integer,month:second.month,monthAbbr:second.monthAbbr},nonUS?dates.unshift(dm):dates.push(dm)),first.month&&second.year&&dates.push({month:first.month,monthAbbr:first.monthAbbr,year:second.integer}),first.year&&isValidDoubleYear(first.integer,second.integer)&&dates.push({year:first.integer,doubleYear:formatDoubleYear(second.integer)}),first.year&&second.month&&first.integer!==second.integer&&dates.push({month:second.month,monthAbbr:second.monthAbbr,year:first.integer}),dates}function generate3TermDates(terms,nonUS){var dates=[],first=terms[0],second=terms[1],third=terms[2],dmy;return first.month&&second.day&&third.year&&dates.push({day:second.integer,month:first.month,monthAbbr:first.monthAbbr,year:third.integer}),first.day&&second.month&&third.year&&(first.isOrdinal||first.integer!==second.integer)&&(dmy={day:first.integer,month:second.month,monthAbbr:second.monthAbbr,year:third.integer},nonUS?dates.unshift(dmy):dates.push(dmy)),first.month&&second.year&&isValidDoubleYear(second.integer,third.integer,!1,first.month)&&dates.push({month:first.month,monthAbbr:first.monthAbbr,year:second.integer,doubleYear:formatDoubleYear(third.integer)}),first.year&&second.month&&third.day&&(third.isOrdinal||first.integer!==third.integer)&&dates.push({day:third.integer,month:second.month,monthAbbr:second.monthAbbr,year:first.integer}),dates}function generate4TermDates(terms,nonUS){var dates=[],first=terms[0],second=terms[1],third=terms[2],fourth=terms[3],dmyy;return first.month&&second.day&&third.year&&isValidDoubleYear(third.integer,fourth.integer,second.integer,first.month)&&dates.push({day:second.integer,month:first.month,monthAbbr:first.monthAbbr,year:third.integer,doubleYear:formatDoubleYear(fourth.integer)}),first.day&&second.month&&third.year&&isValidDoubleYear(third.integer,fourth.integer,first.integer,second.month)&&(first.isOrdinal||first.integer!==second.integer)&&(dmyy={day:first.integer,month:second.month,monthAbbr:second.monthAbbr,year:third.integer,doubleYear:formatDoubleYear(fourth.integer)},nonUS?dates.unshift(dmyy):dates.push(dmyy)),dates}function getGenealogicalDate(data){var dateString="";return data.mods&&data.mods.length&&(dateString+=data.mods[0]+" "),data.date.month&&(data.date.day&&(dateString+=data.date.day+" "),dateString+=data.date.monthAbbr),data.date.year&&(dateString+=data.date.month?" "+data.date.year:data.date.year,data.date.doubleYear?dateString+="/"+data.date.doubleYear:data.era&&(dateString+=" "+data.era)),dateString.length?dateString:!1}function getNumericMonth(str){var numericMonth=0;return!isNaN(str)&&str>0&&str<13?numericMonth=Number(str):isNaN(str)&&str!==!1&&(str=str.toLowerCase(),months.forEach(function(month,i){(str===month.abbr||str.length>3&&str===month.name.substr(0,str.length))&&(numericMonth=i+1)})),numericMonth}function isDayInMonth(day,month,year){var daysInMonth;return month=getNumericMonth(month),daysInMonth=month===2&&year&&!isLeapYear(year)?28:months[month-1].days,day>0&&day<=daysInMonth}function isFutureDate(date){var dateNow=new Date,future=!1;return date.year&&(date.year===dateNow.getFullYear()?date.month&&(date.month-1===dateNow.getMonth()?date.day&&(future=date.day>dateNow.getDate()):future=date.month-1>dateNow.getMonth()):future=date.year>dateNow.getFullYear()),future}function isLeapYear(year){return new Date(year,1,29).getMonth()===1}function isModifier(str){var match=!1,mod;if(str=str.toLowerCase(),modifiers.hasOwnProperty(str))match=modifiers[str];else if(str.length>3)for(mod in modifiers)modifiers.hasOwnProperty(mod)&&str===mod.substr(0,str.length)&&(match=modifiers[mod]);return match}function isOrdinal(str){var returnValue=!1;return typeof str=="string"&&str.length>=2&&(str=str.toLowerCase(),returnValue=ordinals.indexOf(str.substr(-2,2))>=0||ordinals.indexOf(str.substr(-3,3))>=0||ordinals.indexOf(str.substr(-4,4))>=0),returnValue}function isUnknown(str){return str=str.toLowerCase(),!isOrdinal(str)&&isNaN(Number(str))&&getNumericMonth(str)===0&&!isModifier(str)}function isValidDay(day){var dayNumber=Number(day),dayInteger=parseInt(day,10);return!isNaN(dayNumber)&&dayNumber>0&&dayNumber<32||isOrdinal(day)&&dayInteger>0&&dayInteger<32}function isValidDoubleYear(year1,year2,day,month){var valid=!1,valid4Digit,valid2Digit,valid1Digit,year2Length=year2.toString().length;return isYearInDoubleRange(year1)&&(valid4Digit=isYearInDoubleRange(year2)&&year2-year1==1,valid2Digit=year2Length===2&&year2-year1.toString().substr(-2)==1,valid1Digit=year2Length===1&&(year2-year1.toString().substr(-1)==1||year2-year1.toString().substr(-1)==-9),(valid4Digit||valid2Digit||valid1Digit)&&(valid=!0,month&&(valid=!1,month<=3&&(valid=day?month===3?day<25:isDayInMonth(day,month,year1):!0)))),valid}function isValidYear(year){return year=Number(year),!isNaN(year)&&year>=0&&year<2200}function isYearInDoubleRange(year){return year>1581&&year<1753}function processTerm(str){var numeric=getNumericMonth(str);return{day:isValidDay(str),integer:parseInt(str,10),isOrdinal:isOrdinal(str),month:numeric,monthAbbr:numeric?shared.ucfirst(months[numeric-1].abbr):undefined,year:isValidYear(str)}}var langSets={de:{calendarEras:{"v. Chr.":"v. Chr.","v.u.Z":"v.u.Z","v Chr":"v. Chr.",vuZ:"v.u.Z"},modifiers:{ungef:"ungef","ungefähr":"ungefähr",etwa:"etwa",circa:"circa",vor:"vor",nach:"nach"},months:[{name:"januar",abbr:"jan",days:31},{name:"februar",abbr:"feb",days:29},{name:"märz",abbr:"mär",days:31},{name:"april",abbr:"apr",days:30},{name:"mai",abbr:"mai",days:31},{name:"juni",abbr:"jun",days:30},{name:"juli",abbr:"jul",days:31},{name:"august",abbr:"aug",days:31},{name:"september",abbr:"sep",days:30},{name:"oktober",abbr:"okt",days:31},{name:"november",abbr:"nov",days:30},{name:"dezember",abbr:"dez",days:31}],ordinals:[]},en:{calendarEras:{"B.C.E.":"B.C.E.",BCE:"B.C.E.","B.C.":"B.C.",BC:"B.C."},modifiers:{abt:"abt",about:"abt",aft:"aft",after:"aft",around:"abt",bef:"bef",before:"bef",ca:"abt",circa:"abt",near:"abt"},months:[{name:"january",abbr:"jan",days:31},{name:"february",abbr:"feb",days:29},{name:"march",abbr:"mar",days:31},{name:"april",abbr:"apr",days:30},{name:"may",abbr:"may",days:31},{name:"june",abbr:"jun",days:30},{name:"july",abbr:"jul",days:31},{name:"august",abbr:"aug",days:31},{name:"september",abbr:"sep",days:30},{name:"october",abbr:"oct",days:31},{name:"november",abbr:"nov",days:30},{name:"december",abbr:"dec",days:31}],ordinals:["0th","1st","2nd","3rd","4th","5th","6th","7th","8th","9th","11th","12th","13th"]},es:{calendarEras:{"a. C.":"a. C.","a C":"a. C.",AEC:"AEC"},modifiers:{aproximadamente:"aproximadamente",aprox:"aprox",ca:"ca",c:"c",est:"est",ant:"ant",antes:"antes",dps:"dps","después":"después"},months:[{name:"enero",abbr:"ene",days:31},{name:"febrero",abbr:"feb",days:29},{name:"marzo",abbr:"mar",days:31},{name:"abril",abbr:"abr",days:30},{name:"mayo",abbr:"mayo",days:31},{name:"junio",abbr:"jun",days:30},{name:"julio",abbr:"jul",days:31},{name:"agosto",abbr:"ago",days:31},{name:"septiembre",abbr:"set",days:30},{name:"octubre",abbr:"oct",days:31},{name:"noviembre",abbr:"nov",days:30},{name:"diciembre",abbr:"dic",days:31}],ordinals:["0º","1º","2º","3º","4º","5º","6º","7º","8º","9º"]},fr:{calendarEras:{"av. J-C":"av. J-C","av J-C":"av. J-C",AEC:"AEC"},modifiers:{environ:"environ",c:"c",ca:"ca",cca:"cca",vers:"vers",avant:"avant","après":"après"},months:[{name:"janvier",abbr:"jan",days:31},{name:"février",abbr:"fév",days:29},{name:"mars",abbr:"mars",days:31},{name:"avril",abbr:"avr",days:30},{name:"mai",abbr:"mai",days:31},{name:"juin",abbr:"juin",days:30},{name:"juillet",abbr:"jul",days:31},{name:"août",abbr:"août",days:31},{name:"septembre",abbr:"sept",days:30},{name:"octobre",abbr:"oct",days:31},{name:"novembre",abbr:"nov",days:30},{name:"décembre",abbr:"déc",days:31}],ordinals:["1er","2e","3e","4e","5e","6e","7e","8e","9e","0e","1e"]},it:{calendarEras:{"a.C.":"a.C.",aC:"a.C.","a.e.v.":"a.e.v.",aev:"a.e.v."},modifiers:{circa:"circa",prima:"prima",dopo:"dopo"},months:[{name:"gennaio",abbr:"gen",days:31},{name:"febbraio",abbr:"feb",days:29},{name:"marzo",abbr:"mar",days:31},{name:"aprile",abbr:"apr",days:30},{name:"maggio",abbr:"mag",days:31},{name:"giugno",abbr:"giu",days:30},{name:"luglio",abbr:"lug",days:31},{name:"agosto",abbr:"ago",days:31},{name:"settembre",abbr:"set",days:30},{name:"ottobre",abbr:"ott",days:31},{name:"novembre",abbr:"nov",days:30},{name:"dicembre",abbr:"dic",days:31}],ordinals:["0º","1º","2º","3º","4º","5º","6º","7º","8º","9º"]},sv:{calendarEras:{"f.Kr.":"f.Kr.",fKr:"f.Kr.","f.v.t.":"f.v.t.",fvt:"f.v.t."},modifiers:{om:"om",circa:"circa",cirka:"cirka",f:"f","före":"före",e:"e",efter:"efter"},months:[{name:"januari",abbr:"jan",days:31},{name:"februari",abbr:"feb",days:29},{name:"mars",abbr:"mar",days:31},{name:"april",abbr:"apr",days:30},{name:"maj",abbr:"maj",days:31},{name:"juni",abbr:"juni",days:30},{name:"juli",abbr:"juli",days:31},{name:"augusti",abbr:"aug",days:31},{name:"september",abbr:"sep",days:30},{name:"oktober",abbr:"okt",days:31},{name:"november",abbr:"nov",days:30},{name:"december",abbr:"dec",days:31}],ordinals:[]}},shared={lang:function(){var langAttr=$("html").attr("lang")||$("[lang]").first().attr("lang");return langAttr?langAttr.toLowerCase():"en"}(),localize:function(langSet,key){return langSet[this.lang]&&langSet[this.lang][key]?langSet[this.lang][key]:langSet[this.lang.substring(0,2)]&&langSet[this.lang.substring(0,2)][key]?langSet[this.lang.substring(0,2)][key]:langSet.en[key]||""},ucfirst:function(str){return str.charAt(0).toUpperCase()+str.substr(1).toLowerCase()},warn:function(msg,useAlert){window.console&&(console.warn(msg),useAlert&&/ancestry(?:stage|dev)/.test(window.location.hostname)&&alert(msg))}},months=shared.localize(langSets,"months"),modifiers=shared.localize(langSets,"modifiers"),ordinals=shared.localize(langSets,"ordinals"),calendarEras=shared.localize(langSets,"calendarEras"),version=2,doubleIncluded=!!$.dateValidator;if(doubleIncluded){if($.dateValidator.version===version){shared.warn("ERROR: You are including date-validator.js multiple times");return}if(shared.warn("ERROR: You are including multiple versions of date-validator.js"),$.dateValidator.version>version)return}$.dateValidator=function(value){var variations=[],dates=[],filtered=filterCalendarEra(value),extracted=extractData(filtered.str),isValidFormat=!1,nonUS=shared.lang!=="en"&&shared.lang!=="en-us";switch(extracted.terms.length){case 1:variations=generate1TermDates(extracted.terms);break;case 2:variations=generate2TermDates(extracted.terms,nonUS);break;case 3:variations=generate3TermDates(extracted.terms,nonUS);break;case 4:variations=generate4TermDates(extracted.terms,nonUS)}return variations.forEach(function(variation){var genealogical,isValid=!0;variation.day&&variation.month&&!isDayInMonth(variation.day,variation.month,variation.year)&&(isValid=!1);isValid&&(genealogical=getGenealogicalDate({era:filtered.era,date:variation,mods:extracted.modifiers}),genealogical===value&&(isValidFormat=!0),dates.push({day:variation.day,month:variation.month,monthAbbr:variation.monthAbbr,year:variation.year,doubleYear:variation.doubleYear,genealogical:genealogical,isFuture:isFutureDate(variation)}))}),{dates:dates,explicit:dates.length===1&&dates[0].genealogical===value,modifiers:extracted.modifiers,original:value,termsLength:extracted.terms.length,unknowns:extracted.unknowns,valid:isValidFormat}};$.dateValidator.getTest=function(){return{extractData:extractData,filterCalendarEra:filterCalendarEra,formatDoubleYear:formatDoubleYear,generate1TermDates:generate1TermDates,generate2TermDates:generate2TermDates,generate3TermDates:generate3TermDates,generate4TermDates:generate4TermDates,getGenealogicalDate:getGenealogicalDate,getNumericMonth:getNumericMonth,isDayInMonth:isDayInMonth,isFutureDate:isFutureDate,isLeapYear:isLeapYear,isModifier:isModifier,isOrdinal:isOrdinal,isUnknown:isUnknown,isValidDay:isValidDay,isValidDoubleYear:isValidDoubleYear,isValidYear:isValidYear,isYearInDoubleRange:isYearInDoubleRange,processTerm:processTerm}};$.dateValidator.version=version})(jQuery);
(function($){"use strict";var defaults={allowClick:!1,style:"light",type:"click",content:"",classes:"",calloutClasses:"",disableAutofocusOnOpen:!1,position:"bottom",align:"center",hidePointer:!1,keepContentInPlace:!0,showDelay:100,hideDelay:100,onOpen:!1,onAfterOpen:!1,onClose:!1,debounceTime:250},closeTimer,showDelayTimer,isTouchDevice="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,$html=$("html"),scrollable=!1,version=1,doubleIncluded=!!$.callout;if(doubleIncluded){if($.callout.version===version){window.console&&console.warn("ERROR: You are including callout.js multiple times");return}if(window.console&&console.warn("ERROR: You are including multiple versions of callout.js"),$.callout.version>version)return}$.fn.callout=function(options){return this.each(function(){function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().andSelf().filter(function(){return $.css(this,"visibility")==="hidden"}).length}function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();return"area"===nodeName?(map=element.parentNode,mapName=map.name,!element.href||!mapName||map.nodeName.toLowerCase()!=="map")?!1:(img=$("img[usemap=#"+mapName+"]")[0],!!img&&visible(img)):(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function getTabbableElements($container){return $container.find("input, select, textarea, button, a, object, [tabindex]").filter(function(){return tabbable(this)})}function tabbable(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}function resetCalloutContent(){calloutWrap.add(calloutContent).add(calloutPointer).removeAttr("style class");calloutContent.removeAttr("role").off("keydown.callout").addClass("calloutContent");calloutWrap.addClass("callout");calloutPointer.addClass("calloutPointer");$("#modal, html").add(window).add(calloutWrap).off(".callout")}function hideCallout(runOnClose){var $openCalloutTrigger=$(".calloutTrigger.active"),openCalloutSettings=$openCalloutTrigger.data("callout-settings"),focusIsWithinCallout=calloutContent.find(":focus").length;if($openCalloutTrigger.length){if(runOnClose&&openCalloutSettings.onClose!==!1)openCalloutSettings.onClose($openCalloutTrigger);resetCalloutContent();openCalloutSettings.keepContentInPlace?$("#calloutContentPlaceholder").replaceWith($(openCalloutSettings.content)):calloutContent.children().remove();$openCalloutTrigger.removeClass("hover active").attr("aria-expanded",!1);scrollable&&$openCalloutTrigger.closest(".calloutScrollPane").off("scroll.callout");modalHeight!==!1&&($("html").hasClass("modalOpen")&&$("body, #modal").css("height",modalHeight),$("#modalCenter").css("height",""),modalHeight=!1,$("#modal").removeData("preventModalCenterOnResize"));focusIsWithinCallout&&$openCalloutTrigger.focus()}}function setModalHeightOnTouchDevices(){var $modalCenter=$("#modalCenter"),heightCurrentlyAvailable=$("body").outerHeight(!0),heightNeededToShowCallout=calloutWrap.offset().top+calloutContent.outerHeight(!0);heightCurrentlyAvailable<heightNeededToShowCallout&&(modalHeight=heightCurrentlyAvailable,$modalCenter.css("height",$modalCenter.css("height")),$("body, #modal").css("height",heightNeededToShowCallout),$("#modal").data("preventModalCenterOnResize",!0))}function setModalHeightOnNonTouchDevices(){var $modalContents=$("#modalContents"),heightNeededToShowCallout=calloutWrap.offset().top+calloutContent.outerHeight(!0),heightCurrentlyAvailable=$modalContents.outerHeight(!1)+$modalContents.offset().top,extraSpaceNeeded=Math.max(heightNeededToShowCallout-heightCurrentlyAvailable,0);$modalContents.css("margin-bottom",extraSpaceNeeded)}function positionCallout(position,align,lastRun){var windowWidth=$window.outerWidth(!1),triggerHeight=$trigger.outerHeight(!1),triggerWidth=$trigger.outerWidth(!1),triggerPos=$trigger.offset(),leftOfTrigger=triggerPos.left,centerOfTrigger=leftOfTrigger+triggerWidth/2,rightOfTrigger=leftOfTrigger+triggerWidth,topOfTrigger=triggerPos.top,bottomOfTrigger=topOfTrigger+triggerHeight,calloutTempWidth=calloutContent.outerWidth(!1),calloutInputOffset=16,calloutOffset=24,inModal=$trigger.closest("#modal").length>0,calloutContentHeight,calloutIsPastModalArea,minTriggerHeight=42;if(calloutWrap.removeClass("calloutPositionBottom calloutPositionTop calloutPositionLeft calloutPositionRight calloutAlignLeft calloutAlignCenter calloutAlignMiddle calloutAlignRight calloutAlignTop calloutAlignBottom").add(calloutContent).add(calloutPointer).removeAttr("style"),calloutContent.css({width:calloutDefaultWidth}),isInputField){var leftCorrect=0,minimumMaxWidth=180,widthAvailable=windowWidth-(leftOfTrigger+10);minimumMaxWidth>widthAvailable&&(leftCorrect=Math.min(minimumMaxWidth,calloutDefaultWidth)-widthAvailable);calloutContent.css({"max-width":Math.max(triggerWidth,minimumMaxWidth),width:calloutDefaultWidth});calloutWrap.addClass("calloutPositionBottom").css({left:leftOfTrigger-leftCorrect,top:bottomOfTrigger})}else if(settings.type==="cursor"){calloutContent.css("width",calloutTempWidth);$trigger.on("mousemove.callout",function(e){calloutWrap.css({left:Math.max(calloutInputOffset+windowPadding,Math.min(e.pageX,windowWidth-windowPadding-calloutContent.outerWidth(!1)+calloutInputOffset)),top:e.pageY});e.pageX>windowWidth+calloutInputOffset-calloutContent.outerWidth(!1)?calloutPointer.css({left:Math.min(e.pageX-calloutWrap.offset().left-calloutInputOffset/2,calloutContent.outerWidth(!1)-48)}):calloutPointer.css({left:0})});calloutWrap.addClass("calloutPositionBottom")}else{position||(position=settings.position);align||(align=settings.align);calloutWrap.css({left:centerOfTrigger});switch(align){case"left":calloutWrap.addClass("calloutAlignLeft");calloutContent.css({"max-width":Math.max(centerOfTrigger+calloutOffset-windowPadding,calloutMinWidth),right:triggerWidth<parseInt(calloutPointer.css("width"),10)?-calloutOffset:-triggerWidth/2});break;case"right":calloutWrap.addClass("calloutAlignRight");calloutContent.css({left:-triggerWidth/2,"max-width":Math.max(windowWidth-centerOfTrigger+calloutOffset-windowPadding,calloutMinWidth)});break;default:if(position==="left"||position==="right")switch(align){case"top":calloutWrap.addClass("calloutAlignTop");triggerHeight<minTriggerHeight?calloutWrap.css({top:topOfTrigger-(minTriggerHeight-triggerHeight)/2}):calloutWrap.css({top:topOfTrigger});break;case"bottom":calloutWrap.addClass("calloutAlignBottom");triggerHeight<minTriggerHeight?calloutWrap.css({top:bottomOfTrigger+(minTriggerHeight-triggerHeight)/2}):calloutWrap.css({top:bottomOfTrigger});break;default:calloutWrap.addClass("calloutAlignMiddle").css({top:topOfTrigger+triggerHeight/2-calloutWrap.outerHeight(!1)/2});calloutContent.css({top:"-"+calloutContent.outerHeight(!1)/2+"px"})}else calloutWrap.addClass("calloutAlignCenter"),calloutContent.css({left:-Math.abs(calloutContent.outerWidth(!1)/2)}),calloutContent.offset().left+calloutContent.outerWidth(!1)-$(document).scrollLeft()>windowWidth&&calloutContent.css({left:-Math.abs(calloutContent.outerWidth(!1)/2)+(windowWidth-calloutContent.offset().left-calloutContent.outerWidth(!1))+$(document).scrollLeft()-windowPadding,"max-width":windowWidth-windowPadding*2}),calloutContent.offset().left<0&&calloutContent.css({left:-Math.abs(leftOfTrigger)-triggerWidth/2+windowPadding,"max-width":windowWidth-windowPadding*2})}switch(position){case"left":calloutWrap.addClass("calloutPositionLeft").css({left:leftOfTrigger-calloutWrap.outerWidth(!1)});calloutContent.css({"max-width":Math.max(leftOfTrigger-windowPadding-parseInt(calloutContent.css("margin-left"),10)-parseInt(calloutContent.css("margin-right"),10),calloutMinWidth)});break;case"right":calloutWrap.addClass("calloutPositionRight").css({left:rightOfTrigger});calloutContent.css({"max-width":Math.max(windowWidth-rightOfTrigger-windowPadding-parseInt(calloutContent.css("margin-left"),10)-parseInt(calloutContent.css("margin-right"),10),calloutMinWidth)});break;case"top":calloutWrap.addClass("calloutPositionTop").css({top:topOfTrigger-calloutWrap.outerHeight(!1)});break;default:calloutWrap.addClass("calloutPositionBottom").css({top:bottomOfTrigger})}calloutContentHeight=calloutContent.outerHeight(!1);calloutContent.offset().top+calloutContentHeight>$window.scrollTop()+$window.outerHeight(!1)&&(position==="left"||position==="right")&&calloutContent.css({top:Math.max(parseInt(calloutContent.css("top"),10)-(calloutContent.offset().top+calloutContentHeight-$window.scrollTop()-$window.outerHeight(!1)+windowPadding),-Math.abs(calloutContentHeight-calloutOffset))});calloutContent.offset().top<$window.scrollTop()&&((position==="left"||position==="right")&&calloutContent.css({top:Math.min(parseInt(calloutContent.css("top"),10)+($window.scrollTop()-calloutContent.offset().top+windowPadding),-Math.abs(calloutOffset))}),position!=="top"||lastRun||positionCallout("bottom","center",!0));(calloutContent.offset().left<0||windowWidth<calloutContent.offset().left+calloutContent.outerWidth(!1))&&(lastRun||positionCallout(settings.position==="left"||settings.position==="right"?"bottom":settings.position,"center",!0));inModal&&!lastRun&&calloutWrap.hasClass("calloutPositionBottom")&&(isTouchDevice?(calloutIsPastModalArea=calloutContent.offset().top+calloutContent.outerHeight(!1)>$("#modal").height(),calloutIsPastModalArea&&setModalHeightOnTouchDevices()):(calloutIsPastModalArea=$("#modal").scrollTop()+calloutContent.offset().top+calloutContent.outerHeight(!1)-Math.max($("body").scrollTop(),$html.scrollTop())>Math.max($("#modal").outerHeight(!1),$("#modalContents").outerHeight(!1)),calloutIsPastModalArea&&setModalHeightOnNonTouchDevices()))}}function resetShowTimer(){showDelayTimer&&(clearTimeout(showDelayTimer),showDelayTimer=null)}function hideDelay(){hideDelayTimer=setTimeout(function(){$(".calloutTrigger").hasClass("hover")||calloutWrap.hasClass("hover")||(resetShowTimer(),hideCallout(!0))},settings.hideDelay)}function resetHideTimer(){hideDelayTimer&&(clearTimeout(hideDelayTimer),hideDelayTimer=null)}function handleTabPress(){$("#calloutContent").off("keydown.callout").on("keydown.callout",function(e){var tabbableElements,focusedElement,$this=$(this);e.keyCode===9&&(tabbableElements=getTabbableElements($this),focusedElement=$this.find(":focus")||$this,(e.shiftKey&&(focusedElement.get(0)===tabbableElements.first().get(0)||$("#calloutContent:focus").length)||!e.shiftKey&&focusedElement.get(0)===tabbableElements.last().get(0)||focusedElement.eq(0).is('[type="radio"]')&&(e.shiftKey&&focusedElement.eq(0).attr("name")===tabbableElements.first().eq(0).attr("name")||!e.shiftKey&&focusedElement.eq(0).attr("name")===tabbableElements.last().eq(0).attr("name")))&&($trigger.focus(),hideCallout(!0)))})}function focusOnCallout(){var newScrollTop,oldScrollTop,$body;$trigger.is("input, textarea")||($body=$("body"),oldScrollTop=Math.max($body.scrollTop(),$html.scrollTop()),$("#calloutContent").focus(),newScrollTop=Math.max($body.scrollTop(),$html.scrollTop()),newScrollTop!==oldScrollTop&&$("body, html").scrollTop(oldScrollTop))}function resetDefaultWidth(){return Math.ceil(calloutWrap.css({display:"block",left:"0",top:"0",width:"auto"}).find(calloutContent).css({position:"relative",width:"auto"})[0].getBoundingClientRect().width)}function debounce(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null;immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);callNow&&func.apply(context,args)}}function showCallout(){var preventClose=!1,$scrollableContainer;if(clearTimeout(closeTimer),$trigger.data("callout-settings",settings),settings.keepContentInPlace&&$trigger.data("callout-content").before('<span id="calloutContentPlaceholder" style="display:none;"><\/span>'),calloutContent.html($trigger.data("callout-content")),!calloutWrap.hasClass("calloutTypeCursor")&&settings.type!=="custom")$html.on("touchstart.callout",function(e){calloutTouches.x=e.originalEvent.touches?e.originalEvent.touches[0].pageX:e.pageX;calloutTouches.y=e.originalEvent.touches?e.originalEvent.touches[0].pageY:e.pageY}).on("click.callout touchend.callout",function(e){var triggerIsWithinCallout=$(e.srcElement||e.target||e.originalEvent.originalTarget).closest("#callout").length;preventClose||triggerIsWithinCallout||(e.type==="click"?hideCallout(!0):!isInputField&&Math.max(Math.abs(calloutTouches.x-e.originalEvent.changedTouches[0].pageX),Math.abs(calloutTouches.y-e.originalEvent.changedTouches[0].pageY))<5&&(closeTimer=setTimeout(function(){hideCallout(!0);preventClose=!1},500),preventClose=!0))});if(settings.type==="hover"||settings.type==="cursor")calloutWrap.on("mouseenter.callout",function(){calloutWrap.addClass("hover");resetHideTimer()}).on("mouseleave.callout",function(){calloutWrap.removeClass("hover");hideDelay()});if(settings.onOpen!==!1)settings.onOpen($trigger);if(settings.style==="dark"?calloutWrap.addClass("calloutStyleDark bgDark"):settings.style==="alt"?calloutWrap.addClass("calloutStyleAlt"):settings.style==="guidance"&&calloutWrap.addClass("calloutStyleGuidance"),settings.classes&&calloutContent.addClass(settings.classes),settings.calloutClasses&&calloutWrap.addClass(settings.calloutClasses),$trigger.attr("data-callout-classes")&&calloutContent.addClass($trigger.attr("data-callout-classes")),$trigger.attr("data-callout-wrap-classes")&&calloutContent.addClass($trigger.attr("data-callout-wrap-classes")),settings.hidePointer&&calloutWrap.addClass("calloutHidePointer"),(!calloutDefaultWidth||$trigger.data("callout-updated"))&&(isInputField&&calloutContent.css({"max-width":"none"}),calloutDefaultWidth=resetDefaultWidth(),calloutWrap.add(calloutContent).removeAttr("style"),$trigger.removeData("callout-updated")),calloutWrap.addClass("active"),isInputField&&calloutWrap.addClass("calloutTypeInput"),settings.type==="cursor"&&(calloutWrap.addClass("calloutTypeCursor"),calloutContent.css({width:Math.min(parseInt(calloutDefaultWidth,10),$window.outerWidth(!1)-windowPadding*2)})),positionCallout(),$trigger.closest("#modal").length>0){$("#modal").on("recentered",function(){positionCallout();adjustCalloutInModal()});adjustCalloutInModal();$("#modal").on("scroll.callout",function(){calloutWrap.css({"margin-top":-$(this).scrollTop()})})}if($trigger.addClass("hover active").attr("aria-expanded",!0),handleTabPress(),settings.onAfterOpen!==!1)settings.onAfterOpen($trigger);settings.disableAutofocusOnOpen!==!0&&(settings.type!=="hover"&&getTabbableElements(calloutContent).length?calloutContent.find(":focus").length||focusOnCallout():calloutContent.attr("role","alert"));$window.on((isTouchDevice?"orientationchange":"resize")+".callout",function(){calloutWrap.hasClass("active")&&!calloutWrap.hasClass("calloutStyleGuidance")&&hideCallout(!1)});if(scrollable){$scrollableContainer=$trigger.closest(".calloutScrollPane");$scrollableContainer.on("scroll.callout",debounce(function(){stillInView($trigger,$scrollableContainer)?positionCallout():hideCallout()},settings.debounceTime))}}function adjustCalloutInModal(){modalScrollPos=$("#modal").scrollTop();calloutWrap.css({"margin-top":-modalScrollPos,top:"+="+modalScrollPos,"z-index":1010})}function destroyCallout(){resetShowTimer();$trigger.hasClass("active")&&hideCallout(!0);!$(".calloutTrigger.active").length&&$("#callout.active").length&&$("#calloutContent:empty").length&&resetCalloutContent();$trigger.off(".callout").removeClass("calloutTrigger iconAfter iconArrowSmallDownAfter").removeData("callout-content").removeAttr("aria-expanded")}function showDelay(){showDelayTimer=setTimeout(function(){$(".calloutTrigger.active").not($trigger).length&&hideCallout(!0);!$trigger.hasClass("hover")||$trigger.hasClass("active")||calloutWrap.hasClass("active")||(resetHideTimer(),showCallout())},Math.max(100,settings.showDelay))}function stillInView($element,$container){var elementHeight=$element.outerHeight(!1),elementWidth=$element.outerWidth(!1),elementOffset=$element.offset(),containerHeight=$container.outerHeight(!1),containerWidth=$container.outerWidth(!1),containerOffset=$container.offset(),notAbove=elementOffset.top+elementHeight>=containerOffset.top,notBelow=elementOffset.top+elementHeight<=containerOffset.top+containerHeight,notLeft=elementOffset.left>=containerOffset.left,notRight=elementOffset.left+elementWidth<=containerOffset.left+containerWidth;return notAbove&&notBelow&&notLeft&&notRight}function addEvents(){var preventClick=!0;if(isInputField)$trigger.on(($trigger.is("select")?"mouseenter.callout ":"")+"focus.callout open.callout",function(){showCallout()}).on("blur.callout close.callout",function(){hideCallout(!0)}).on("click.callout",function(e){e.stopPropagation()});else if(settings.type==="custom")$trigger.on("open.callout",function(){showCallout()}).on("close.callout",function(){hideCallout(!0)});else if(settings.type==="hover"||settings.type==="cursor"){$trigger.on("mouseenter.callout open.callout",function(){$trigger.addClass("hover");showDelay();preventClick=!0;setTimeout(function(){preventClick=!1},600)}).on("mouseleave.callout",function(){$trigger.removeClass("hover");hideDelay()}).on("close.callout",function(){hideCallout(!0)});if(isTouchDevice)$trigger.on("click.callout",function(){if(preventClick)return!1})}else $trigger.on("click.callout",function(e){$trigger.hasClass("active")?(hideCallout(!0),settings.allowClick&&(preventClick=!1)):(calloutWrap.hasClass("active")&&hideCallout(!0),showCallout());preventClick&&(e.stopImmediatePropagation(),$trigger.is("a")&&e.preventDefault());preventClick=!0}).on("open.callout",function(){$trigger.hasClass("active")||(calloutWrap.hasClass("active")&&hideCallout(!0),showCallout())}).on("close.callout",function(){hideCallout(!0)});$trigger.on("destroy.callout",function(){destroyCallout()}).on("focusCallout.callout",function(){focusOnCallout()}).on("updateContent.callout",function(){calloutDefaultWidth=resetDefaultWidth();positionCallout()}).on("updateCalloutSettings.callout",function(e,newTrigger,position,align){$trigger=$(newTrigger);settings.position=position||"bottom";settings.align=align||"center";calloutDefaultWidth=resetDefaultWidth();positionCallout();$trigger.removeClass("hover active")}).on("position.callout",function(){positionCallout()})}function initCallout(){if(settings.style==="guidance"?($('<div id="calloutGuidance" class="callout"><div id="calloutGuidanceContent" class="calloutContent" tabindex="0"><\/div><div id="calloutGuidancePointer" class="calloutPointer"><div id="calloutPointerShadow" class="calloutPointerShadow"><\/div><\/div><\/div>').appendTo("body"),calloutWrap=$("#calloutGuidance"),calloutContent=$("#calloutGuidanceContent"),calloutPointer=$("#calloutGuidancePointer")):($("#callout").length||$('<div id="callout" class="callout"><div id="calloutContent" class="calloutContent" tabindex="-1"><\/div><div id="calloutPointer" class="calloutPointer"><div id="calloutPointerShadow" class="calloutPointerShadow"><\/div><\/div><\/div>').appendTo("body"),calloutWrap=$("#callout"),calloutContent=$("#calloutContent"),calloutPointer=$("#calloutPointer")),calloutMinWidth=Math.max(240,parseInt(calloutWrap.css("min-width"),10)),settings.content)try{$(settings.content).closest("body").length?($trigger.data("callout-content",$(settings.content)),$trigger.data("callout-content").addClass("calloutDomContent")):(settings.keepContentInPlace=!1,$trigger.data("callout-content",settings.content))}catch(e){settings.content="<div>"+settings.content+"<\/div>";settings.keepContentInPlace=!1;$trigger.data("callout-content",settings.content)}else $trigger.attr("data-callout")?(settings.keepContentInPlace=!1,$trigger.data("callout-content",$trigger.attr("data-callout"))):$trigger.attr("title")?(settings.keepContentInPlace=!1,$trigger.data("callout-content",$trigger.attr("title"))):$trigger.data("callout-content","&nbsp;");$trigger.off(".callout").addClass("calloutTrigger").attr("aria-expanded",!1).not(".calloutTooltip").not(".iconLeaf, .iconShakyLeaf, .iconBars, input, select, textarea, .calloutTriggerNoArrow").addClass("iconAfter iconArrowSmallDownAfter").not(".ancBtn").not(".photo").not(":empty").filter(function(){var $e=$(this),$c=$e.children(),$l=$c.length,$f=$c.first();return $l?!($l===1&&$f.is("span")&&$.trim($e.text())===$.trim($f.text())):$.trim($e.text())}).wrapInner("<span>");$trigger.is("input, select, textarea")&&(isInputField=!0,settings.style="dark",settings.hidePointer=!0,settings.position="bottom");$trigger.hasClass("calloutStyleDark")?settings.style="dark":$trigger.hasClass("calloutStyleAlt")&&(settings.style="alt");$trigger.hasClass("calloutTypeHover")?settings.type="hover":$trigger.hasClass("calloutTypeCursor")?settings.type="cursor":$trigger.hasClass("calloutTypeCustom")&&(settings.type="custom");$trigger.hasClass("calloutPositionTop")?settings.position="top":$trigger.hasClass("calloutPositionRight")?settings.position="right":$trigger.hasClass("calloutPositionLeft")&&(settings.position="left");$trigger.hasClass("calloutAlignLeft")?settings.align="left":$trigger.hasClass("calloutAlignRight")?settings.align="right":$trigger.hasClass("calloutAlignTop")?settings.align="top":$trigger.hasClass("calloutAlignBottom")&&(settings.align="bottom");$trigger.hasClass("calloutHidePointer")&&(settings.hidePointer=!0);$trigger.closest(".calloutScrollPane").length&&(scrollable=!0);$trigger.hasClass("calloutTooltip")&&$trigger.addClass("link iconAfter iconHelpAfter").not(":has(span)").not(":empty").wrapInner("<span>");addEvents()}var $trigger=$(this),$window=$(window),isInputField,hideDelayTimer,calloutWrap,calloutContent,calloutPointer,calloutDefaultWidth,calloutMinWidth,modalHeight=!1,modalScrollPos=0,windowPadding=8,calloutTouches={},settings=$.extend({},defaults,options);switch(options){case"destroy":$trigger.triggerHandler("destroy.callout");break;case"open":$trigger.triggerHandler("open.callout");break;case"close":$trigger.triggerHandler("close.callout");break;case"focus":$trigger.triggerHandler("focusCallout.callout");break;default:initCallout()}})};$.callout={close:function(){var $trigger=$(".calloutTrigger.active");$trigger.length&&$trigger.triggerHandler("close.callout")},content:function($trigger,newContent){$trigger.data("callout-content",newContent).data("callout-updated",!0);$trigger.hasClass("active")&&$("#calloutContent").html(newContent);$trigger.triggerHandler("updateContent.callout")},updateCalloutSettings:function($trigger,$newTrigger,newContent,position,align){newContent&&($trigger.data("callout-content",newContent).data("callout-updated",!0),$("#calloutGuidanceContent").html(newContent));$trigger.triggerHandler("updateCalloutSettings.callout",[$newTrigger,position,align])},positionCallout:function($trigger){$trigger.triggerHandler("position.callout")},version:version};doubleIncluded||$(function(){$('[data-callout]:not([data-auto-instantiate="off"])').callout()})})(jQuery);
(function($){"use strict";function setPositions($el){var settings=$el.data("carousel"),$inner=$el.data("$carouselInner"),$slides,$lastSlide,lastSlideIndex,carouselWidth,maxLeftPosition;settings.infinite&&$el.data("$carouselSlides",$el.find(".carouselSlide"));$slides=$el.data("$carouselSlides");$lastSlide=$slides.eq(-1);lastSlideIndex=$lastSlide.index();carouselWidth=$lastSlide.position().left+$lastSlide.outerWidth(!0);carouselWidth<=$el.outerWidth(!1)?$slides.data("carousel-position",0):settings.fullWidth?(maxLeftPosition=-$lastSlide.position().left-parseInt($lastSlide.css("margin-left"),10),$slides.each(function(){$(this).data("carousel-position",(-$(this).position().left-parseInt($(this).css("margin-left"),10))/$(this).outerWidth(!1)*100+"%")})):(maxLeftPosition=$inner.width()-carouselWidth,$slides.each(function(){return $(this).data("carousel-position",-$(this).position().left-parseInt($(this).css("margin-left"),10)),$(this).data("carousel-position")<=maxLeftPosition?($(this).data("carousel-position",maxLeftPosition),$lastSlide=$(this),lastSlideIndex=$(this).index(),!1):void 0}));settings.carouselHeight!=="auto"&&settings.carouselHeight!=="varied"&&$slides.css("min-height",settings.carouselHeight);$el.data("$carouselGoToSlideBtns")&&$el.data("$carouselGoToSlideBtns").each(function(){$(this).attr("data-carousel-slide")>lastSlideIndex?$(this).fadeOut():$(this).fadeIn()});$el.data("$lastSlide",$lastSlide).data("carousel-stage-width",carouselWidth)}function markCarousel($el,oldSlideIndex,newSlideIndex){var settings=$el.data("carousel"),$slides=$el.data("$carouselSlides"),$lastSlide=$el.data("$lastSlide"),lastSlideIndex=$lastSlide.index(),elMatchingIdAttr='[data-carousel-id="'+$el.attr("id")+'"]',$nextBtns,$previousBtns,$firstBtns,$lastBtns;$el.data("$currentSlide",$slides.eq(newSlideIndex));$slides.eq(oldSlideIndex).removeClass(settings.activeSlideClass).end().eq(newSlideIndex).addClass(settings.activeSlideClass);$el.removeClass("carouselAnimating");settings.continuous||settings.infinite||($nextBtns=$(elMatchingIdAttr+'[data-carousel-slide="next"]'),$previousBtns=$(elMatchingIdAttr+'[data-carousel-slide="previous"]'),$firstBtns=$(elMatchingIdAttr+'[data-carousel-slide="first"]'),$lastBtns=$(elMatchingIdAttr+'[data-carousel-slide="last"]'),$el.data("carousel-stage-width")<=$el.outerWidth(!1)?$nextBtns.add($previousBtns).add($firstBtns).add($lastBtns).addClass(settings.disabledBtnClass).attr("disabled","disabled"):newSlideIndex===0?($previousBtns.add($firstBtns).addClass(settings.disabledBtnClass).attr("disabled","disabled"),$nextBtns.add($lastBtns).removeClass(settings.disabledBtnClass).removeAttr("disabled")):newSlideIndex===lastSlideIndex?($nextBtns.add($lastBtns).addClass(settings.disabledBtnClass).attr("disabled","disabled"),$previousBtns.add($firstBtns).removeClass(settings.disabledBtnClass).removeAttr("disabled")):$nextBtns.add($previousBtns).add($firstBtns).add($lastBtns).removeClass(settings.disabledBtnClass).removeAttr("disabled"));settings.infinite||($(elMatchingIdAttr+'[data-carousel-slide="'+oldSlideIndex+'"]').removeClass(settings.activeBtnClass),$(elMatchingIdAttr+'[data-carousel-slide="'+newSlideIndex+'"]').addClass(settings.activeBtnClass))}function goToSlide($el,newSlideIndex,ignoreCallbacks){var settings=$el.data("carousel"),$inner=$el.data("$carouselInner"),$slides=$el.data("$carouselSlides"),$lastSlide=$el.data("$lastSlide"),lastSlideIndex=$lastSlide.index(),$currentSlide=$el.data("$currentSlide"),currentSlideIndex=$currentSlide.index(),currentSlidePosition=$currentSlide.data("carousel-position"),elWidth=$el.width(),leftPosition=0,positionOptions={},slidesToScroll=settings.slidesPerScroll==="page"?$slides.length:settings.slidesPerScroll,i;if($.type(newSlideIndex)==="string")if(newSlideIndex==="next"){if(settings.continuous&&currentSlideIndex>=lastSlideIndex)newSlideIndex=0;else if(newSlideIndex=currentSlideIndex+slidesToScroll,slidesToScroll>1)for(i=currentSlideIndex+1;i<=currentSlideIndex+slidesToScroll;){if(Math.abs($slides.eq(i).data("carousel-position"))+$slides.eq(i).width()-Math.abs(currentSlidePosition)>elWidth){newSlideIndex=Math.max(i,currentSlideIndex+1);break}i+=1}}else if(newSlideIndex==="previous"){if(settings.continuous&&currentSlideIndex<=0)newSlideIndex=lastSlideIndex;else if(newSlideIndex=currentSlideIndex-slidesToScroll,slidesToScroll>1)for(i=currentSlideIndex-1;i>=currentSlideIndex-slidesToScroll;){if(Math.abs(currentSlidePosition)-parseInt($slides.eq(currentSlideIndex-1).css("margin-right"),10)-parseInt($currentSlide.css("margin-left"),10)-Math.abs($slides.eq(i).data("carousel-position"))>elWidth){newSlideIndex=Math.min(i+1,currentSlideIndex-1);break}i-=1}}else newSlideIndex==="last"?newSlideIndex=lastSlideIndex:newSlideIndex==="first"&&(newSlideIndex=0);if(newSlideIndex=parseInt(newSlideIndex,10),newSlideIndex<0?newSlideIndex=0:newSlideIndex>lastSlideIndex&&(newSlideIndex=lastSlideIndex),!ignoreCallbacks){if(settings.onSlideEnd!==!1)settings.onSlideEnd(currentSlideIndex,$currentSlide);if(settings.onSlideStart!==!1)settings.onSlideStart(newSlideIndex,$slides.eq(newSlideIndex));if(settings.onSlideChange!==!1)settings.onSlideChange(newSlideIndex,$slides.eq(newSlideIndex),currentSlideIndex,$currentSlide)}if(settings.onSlideLoad!==!1&&!$slides.eq(newSlideIndex).data("carousel-loaded")){settings.onSlideLoad(newSlideIndex,$slides.eq(newSlideIndex));$slides.eq(newSlideIndex).data("carousel-loaded",!0)}leftPosition=$slides.eq(newSlideIndex).data("carousel-position");$el.addClass("carouselAnimating");settings.carouselHeight==="varied"&&(positionOptions.height=$slides.eq(newSlideIndex).outerHeight(!0));$inner.css(buildAnimation(leftPosition,positionOptions,settings));ignoreCallbacks||settings.onAfterSlideChange===!1||(setTimeout(function(){settings.infinite&&($el.data("$currentSlide",$slides.eq(settings.firstSlide-1)),$inner.css(buildAnimation($slides.eq(settings.firstSlide-1).data("carousel-position"),{"-webkit-transition":"none",transition:"none"},settings)));settings.onAfterSlideChange(newSlideIndex,$slides.eq(newSlideIndex),currentSlideIndex,$currentSlide)},settings.scrollTime),settings.infinite&&$inner.css({"-webkit-transition":settings.innerTransition,transition:settings.innerTransition}));markCarousel($el,currentSlideIndex,newSlideIndex)}function buildAnimation(leftPosition,cssObject,settings){return settings.useTransforms?cssObject.transform="translate3d("+leftPosition+", 0, 0)":cssObject.left=leftPosition,cssObject}function getLeftPosition($el,settings){var matrix,x;return settings.useTransforms?(matrix=window.getComputedStyle($el.data("$carouselInner")[0],null),matrix=matrix.transform.split(")")[0].split(", "),x=parseInt(matrix[12]||matrix[4],10)):x=parseInt($el.data("$carouselInner").css("left"),10),x}function playAutoscroll($el){var settings=$el.data("carousel"),$pausePlayBtns=$("."+settings.pausePlayBtnClass+'[data-carousel-id="'+$el.attr("id")+'"]');$el.removeClass("carouselPaused").addClass("carouselPlaying");$pausePlayBtns.removeClass("iconPlay").addClass("iconPause");$el.data("carousel-timer",setInterval(function(){goToSlide($el,"next")},settings.autoscroll+settings.scrollTime))}function pauseAutoscroll($el,forceStop){var settings=$el.data("carousel"),$pausePlayBtns=$("."+settings.pausePlayBtnClass+'[data-carousel-id="'+$el.attr("id")+'"]');$el.addClass("carouselPaused").removeClass("carouselPlaying");clearInterval($el.data("carousel-timer"));forceStop&&($el.data("carousel-timer",null).removeClass("carouselPaused carouselPlaying"),$pausePlayBtns.removeClass("iconPause").addClass("iconPlay"))}function addControlsHtml($el){var settings=$el.data("carousel"),elId=$el.attr("id"),lastSlideIndex=$el.data("$carouselSlides").eq(-1).index(),html="",$prevNextBtns,$pagination,$pausePlayBtns,$controlsWrap,i=0;if($el.find(".carouselControlsDefault").length||$('<menu class="carouselControlsDefault"><\/menu>').appendTo($el),$controlsWrap=$el.find(".carouselControlsDefault"),settings.showPausePlayBtns&&!$el.data("carousel-pause-play-loaded")&&($pausePlayBtns=$('<button class="'+settings.pausePlayBtnClass+' ancBtn icon iconPause silver sml" type="button" data-carousel-id="'+elId+'"><\/button>'),$pausePlayBtns.appendTo($controlsWrap),$el.data("carousel-pause-play-loaded",$pausePlayBtns)),settings.pagination&&!$el.data("carousel-pagination-loaded")){for($controlsWrap.addClass("carouselPagination carouselPagination"+settings.pagination.charAt(0).toUpperCase()+settings.pagination.slice(1)),i;i<=lastSlideIndex;i+=1)html+='<button class="ancBtn silver sml" type="button" data-carousel-slide="'+i+'" data-carousel-id="'+elId+'">',settings.pagination==="numbers"&&(html+=i+1),html+="<\/button>";$pagination=$(html);$pagination.appendTo($controlsWrap);$el.data("carousel-pagination-loaded",$pagination)}settings.showPrevNextBtns&&!$el.data("carousel-prev-next-loaded")&&($prevNextBtns=$('<button class="carouselPreviousBtn icon iconArrowLeft" type="button" data-carousel-slide="previous" data-carousel-id="'+elId+'"><\/button><button class="carouselNextBtn icon iconArrowRight" type="button" data-carousel-slide="next" data-carousel-id="'+elId+'"><\/button>'),$prevNextBtns.appendTo($controlsWrap),$controlsWrap.find(".carouselPreviousBtn").prependTo($controlsWrap),$el.data("carousel-prev-next-loaded",$prevNextBtns))}function getClosestSlide($el,fromWhatLeftPosition){var settings=$el.data("carousel"),$slides=$el.data("$carouselSlides"),$slide,closestSlidePosition=null,closestSlideIndex=null;return settings.fullWidth?!1:(fromWhatLeftPosition||(fromWhatLeftPosition=getLeftPosition($el,settings)),$.each($slides,function(slideIndex){$slide=$(this);(closestSlidePosition===null||Math.abs($slide.data("carousel-position")-fromWhatLeftPosition)<Math.abs(closestSlidePosition-fromWhatLeftPosition))&&(closestSlidePosition=$slide.data("carousel-position"),closestSlideIndex=slideIndex)}),closestSlideIndex)}function addTouchEvents($el){var settings=$el.data("carousel"),$inner=$el.data("$carouselInner"),$currentSlide,innerLeftPos,minDistance=15,startX=0,startY=0,change=0,currentX=0,currentY=0,currentXDistance,currentYDistance,isScrolling,newSlideIndex,touchStartTime,touchEndTime,touchSpeed;$inner.on("touchstart.carousel",function(e){$inner.css({"-webkit-transition":"none",transition:"none"});touchStartTime=(new Date).getTime();isScrolling=undefined;currentX=0;currentY=0;currentXDistance=0;currentYDistance=0;startX=e.originalEvent.touches?e.originalEvent.touches[0].pageX:e.pageX;startY=e.originalEvent.touches?e.originalEvent.touches[0].pageY:e.pageY;$currentSlide=$el.data("$currentSlide");innerLeftPos=settings.showPreviews?-$currentSlide.position().left-parseInt($currentSlide.css("margin-left"),10):settings.fullWidth?-$inner.width()*$currentSlide.index():getLeftPosition($el,settings)}).on("touchmove.carousel",function(e){currentX=e.originalEvent.touches?e.originalEvent.touches[0].pageX:e.pageX;currentY=e.originalEvent.touches?e.originalEvent.touches[0].pageY:e.pageY;change=currentX-startX;currentXDistance=startX===0?0:Math.abs(change);currentYDistance=startY===0?0:Math.abs(currentY-startY);$inner.css(buildAnimation(innerLeftPos+change+"px",{},settings));typeof isScrolling=="undefined"&&(isScrolling=!!(isScrolling||currentXDistance<currentYDistance));isScrolling||(e.preventDefault(),settings.autoscroll&&currentXDistance>minDistance&&pauseAutoscroll($el,!0))}).on("touchend.carousel",function(){if($inner.css({"-webkit-transition":settings.innerTransition,transition:settings.innerTransition}),!isScrolling&&currentXDistance>minDistance)if(touchEndTime=(new Date).getTime(),touchSpeed=Math.abs(touchEndTime-touchStartTime),settings.fullWidth||touchSpeed<340)currentX<startX?goToSlide($el,"next"):currentX>startX&&goToSlide($el,"previous");else return newSlideIndex=getClosestSlide($el),goToSlide($el,newSlideIndex),!1;else $inner.css(buildAnimation(innerLeftPos+change,{},settings));change=0;currentX=0;currentY=0;currentXDistance=0;currentYDistance=0;startX=0;startY=0})}function addEvents($el){var settings=$el.data("carousel"),elMatchingIdAttr='[data-carousel-id="'+$el.attr("id")+'"]',winWidth=$(window).width(),winHeight=$(window).height(),winNewWidth,winNewHeight,firstResize=!0;$(window).on("resize.carousel."+$el.attr("id"),function(){winNewWidth=$(window).width();winNewHeight=$(window).height();(winWidth!==winNewWidth||winHeight!==winNewHeight)&&(settings.autoscroll&&$el.hasClass("carouselPlaying")&&firstResize===!0&&(pauseAutoscroll($el),firstResize=!1),clearTimeout($el.data("carousel-resize-timer"+$el.attr("id"))),$el.data("carousel-resize-timer"+$el.attr("id"),setTimeout(function(){setPositions($el);goToSlide($el,$el.data("$currentSlide").index(),!0);settings.autoscroll&&$el.hasClass("carouselPaused")&&playAutoscroll($el);firstResize=!0},400)));winWidth=winNewWidth;winHeight=winNewHeight});if(settings.autoscroll)$el.on("mouseover.carousel",function(){$el.hasClass("carouselPlaying")&&pauseAutoscroll($el)}).on("mouseleave.carousel",function(){$el.hasClass("carouselPaused")&&playAutoscroll($el)});Carousel.isTouchDevice&&addTouchEvents($el);$el.find(".carouselNextBtn").attr("data-carousel-slide","next");$el.find(".carouselPreviousBtn").attr("data-carousel-slide","previous");$el.find("[data-carousel-slide]").attr("data-carousel-id",$el.attr("id"));bindControls($el,elMatchingIdAttr)}function bindControls($el,$controls,isCustomControls){var settings=$el.data("carousel");$($controls).each(function(){var $btn=$(this);if($btn.hasClass(settings.pausePlayBtnClass))if(settings.autoscroll){isCustomControls&&($("#"+$btn.attr("data-carousel-id")).hasClass("carouselPlaying")?$btn.addClass("iconPause").removeClass("iconPlay"):$btn.addClass("iconPlay").removeClass("iconPause"));$btn.on("click.carousel",function(){var $btns=$("."+settings.pausePlayBtnClass+'[data-carousel-id="'+$el.attr("id")+'"]');$btn.hasClass("iconPause")?($btns.removeClass("iconPause").addClass("iconPlay"),pauseAutoscroll($el,!0)):($btns.removeClass("iconPlay").addClass("iconPause"),$el.hasClass("carouselIsLastSlide")?goToSlide($el,0):goToSlide($el,$el.data("$currentSlide").index()+1),playAutoscroll($el))})}else return window.console&&console.warn("The carousel you are trying to bind a pause / play button to (#"+$el.attr("id")+") is not currently set to autoscroll. To make it autoscroll you will need to destroy and re-create it passing the 'autoscroll' setting."),!1;else $btn.on("click.carousel",function(){$el=$("#"+$btn.attr("data-carousel-id"));settings.autoscroll&&pauseAutoscroll($el,!0);goToSlide($el,$btn.attr("data-carousel-slide"))})})}function destroyCarousel($el){var settings=$el.data("carousel"),$slides=$el.data("$carouselSlides"),elMatchingIdAttr='[data-carousel-id="'+$el.attr("id")+'"]',$defaultControls=$el.find(".carouselControlsDefault");settings.autoscroll&&pauseAutoscroll($el,!0);$(elMatchingIdAttr).removeClass("active").addClass("disabled").attr("disabled","disabled").off(".carousel");$(window).off("resize.carousel."+$el.attr("id"));clearTimeout($el.data("carousel-resize-timer"+$el.attr("id")));$defaultControls.remove();$slides.removeData("carousel-position carousel-loaded");$el.removeClass(settings.activeSlideClass+" carouselAutoscroll carouselPlaying carouselPaused carouselIsFirstSlide carouselIsLastSlide").removeAttr("style").removeData("carousel $carouselInner $carouselSlides $currentSlide $carouselGoToSlideBtns $lastSlide carousel-timer carousel-prev-next-loaded carousel-pagination-loaded carousel-pause-play-loaded").off(".carousel")}function init($el,settings){var $inner,$slides,firstSlideIndex,elMatchingIdAttr='[data-carousel-id="'+$el.attr("id")+'"]',transitionType;if(settings=$el.data("carousel",$.extend({},Carousel.defaults,settings)).data("carousel"),settings.useTransforms=!!settings.fullWidth&&!settings.showPreviews,firstSlideIndex=settings.firstSlide-1,!$el.find(".carouselInner").length)if($el.find("ul").length)$el.find("ul").addClass("carouselInner").find("li").addClass("carouselSlide");else return window.console&&console.warn("There is no .carouselInner element inside of #"+$el.attr("id")+". Please make sure your markup is correct."),!1;$el.addClass("carousel").data("$carouselInner",$el.find(".carouselInner")).data("$carouselSlides",$el.find(".carouselSlide"));$inner=$el.data("$carouselInner");$slides=$el.data("$carouselSlides");$el.data("$currentSlide",$slides.eq(firstSlideIndex));$(".ie8").length&&$slides.eq(-1).addClass("carouselSlideLast");settings.fullWidth?($el.addClass("carouselFullWidth"),settings.slidesPerScroll=1,settings.carouselHeight==="varied"&&$el.addClass("carouselVariedHeight")):settings.carouselHeight==="varied"&&(settings.carouselHeight="auto");settings.showPreviews&&$el.addClass("carouselWithPreview");$(elMatchingIdAttr).removeAttr("disabled").removeClass("disabled "+settings.disabledBtnClass);transitionType=settings.useTransforms?"transform ":"left ";settings.innerTransition=transitionType+settings.scrollTime+"ms, height "+settings.scrollTime+"ms";$inner.css({"-webkit-transition":settings.innerTransition,transition:settings.innerTransition});setTimeout(function(){addControlsHtml($el);setPositions($el);addEvents($el);$el.removeClass("loading");goToSlide($el,firstSlideIndex,!0);settings.autoscroll&&(settings.playOnLoad?playAutoscroll($el):pauseAutoscroll($el,!0))},600)}var Carousel={},version=2,doubleIncluded=!!$.carousel;if(doubleIncluded){if($.carousel.version===version){window.console&&console.warn("ERROR: You are including carousel.js multiple times");return}if(window.console&&console.warn("ERROR: You are including multiple versions of carousel.js"),$.carousel.version>version)return}Carousel.defaults={fullWidth:!0,showPreviews:!1,carouselHeight:"auto",firstSlide:1,slidesPerScroll:"page",continuous:!1,infinite:!1,pagination:null,showPrevNextBtns:!0,showPausePlayBtns:!1,autoscroll:0,scrollTime:400,playOnLoad:!0,pausePlayBtnClass:"carouselPausePlayBtn",activeSlideClass:"carouselActiveSlide",activeBtnClass:"active",disabledBtnClass:"disabled",onSlideStart:!1,onSlideEnd:!1,onSlideLoad:!1,onSlideChange:!1,onAfterSlideChange:!1};Carousel.isTouchDevice="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;Carousel.isIpad=navigator.userAgent.match(/iPad/i)!==null;$.fn.carousel=function(options,params){return this.each(function(){var $this=$(this);$this.attr("id")||$this.attr("id","carousel-"+(new Date).getTime()+Math.ceil(Math.random()*1e4));options==="next"?goToSlide($this,"next"):options==="prev"||options==="previous"?goToSlide($this,"previous"):options==="goToSlide"?isNaN(params)?goToSlide($this,params):goToSlide($this,params-1):options==="stop"&&$this.data("carousel").autoscroll?pauseAutoscroll($this,!0):options==="play"&&$this.data("carousel").autoscroll?playAutoscroll($this):options==="fixDimensions"||options==="setPositions"?setPositions($this):options==="bindControls"?bindControls($this,params,!0):options==="destroy"?destroyCarousel($this):$this.data("carousel")||init($(this),options)})};$(function(){Carousel.isTouchDevice?$("html").addClass("touch"):$("html").addClass("noTouch")});$.carousel={version:version}})(jQuery);
(function($){"use strict";function log(msg){window.console&&console.log(msg)}var Form,Validator,localizer,version=1,doubleIncluded=!!$.validator;if(doubleIncluded){if($.validator.version===version){window.console&&console.warn("ERROR: You are including form.js multiple times");return}if(window.console&&console.warn("ERROR: You are including multiple versions of form.js"),$.validator.version>version)return}localizer={lang:function(){var langAttr=$("html").attr("lang")||$("[lang]").first().attr("lang");return langAttr?langAttr.toLowerCase():"en"}(),langSets:{de:{chooseFile:"Datei ausw&#228;hlen",chooseFiles:"W&#228;hle Dateien",errorMsg:"Es liegen Feldfehler vor:"},en:{chooseFile:"Choose file",chooseFiles:"Choose files",errorMsg:"There are errors on these fields:"},es:{chooseFile:"Selecciona un archivo",chooseFiles:"Seleccionar archivos",errorMsg:"Hay campos con errores:"},fr:{chooseFile:"Choisir le fichier",chooseFiles:"Choisir les fichiers",errorMsg:"Il y a d&#8217;erreurs dans ces champs:"},it:{chooseFile:"Scegli file",chooseFiles:"Scegli file",errorMsg:"Ci sono errori in questi campi:"},sv:{chooseFile:"V&#228;lj fil",chooseFiles:"V&#228;lja filer",errorMsg:"Det uppstod fel f&#246;r dessa f&#228;lt:"}},localize:function(key){return this.langSets[this.lang]&&this.langSets[this.lang][key]?this.langSets[this.lang][key]:this.langSets[this.lang.substring(0,2)]&&this.langSets[this.lang.substring(0,2)][key]?this.langSets[this.lang.substring(0,2)][key]:this.langSets.en[key]||""}};Form={};Form.isTouchDevice="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;Form.isPlaceholderSupported=typeof document.createElement("input").placeholder!="undefined";Form.handlePlaceholders=function($form){Form.isPlaceholderSupported||$form.find("input[placeholder], textarea[placeholder]").each(function(){var placeholder;if($(this).data("usesPlaceholderPolyfill")||$(this).attr("type")==="password")return!0;placeholder=$(this).attr("placeholder");Form.addPlaceholderValue($(this),placeholder);$(this).data("usesPlaceholderPolyfill",!0).on("blur.form",function(){$(this).val()===""?$(this).val(placeholder).addClass("placeholderPolyfill"):$(this).removeClass("placeholderPolyfill")}).on("focus.form",function(){$(this).removeClass("placeholderPolyfill");$(this).val()===placeholder&&$(this).val("")})})};Form.removePlaceholderValues=function($form){$form.find("input[placeholder]").each(function(){$(this).val()===$(this).attr("placeholder")&&$(this).val("")})};Form.addPlaceholderValues=function($form){$form.find('input[placeholder]:not([type="password"]), textarea[placeholder]').each(function(){Form.addPlaceholderValue($(this),$(this).attr("placeholder"))})};Form.addPlaceholderValue=function($field,placeholder){$field.val()===""&&$field.val(placeholder);$field.val()===placeholder&&$field.addClass("placeholderPolyfill")};Form.handleUrls=function($field){if($field.data("usesUrlPlaceholder"))return!0;$field.data("usesUrlPlaceholder",!0).on("blur.form",function(){$field.val()&&$field.val().indexOf("://")===-1&&$field.val()!==$field.attr("placeholder")&&$field.val("http://"+$field.val())})};Form.handleFileInputs=function($form){$form.find('input[type="file"]').each(function(){var $field=$(this),isMultiple=$field[0].hasAttribute("multiple"),browserVersion,ua,tem,M;if($field.data("usesFilePolyfill"))return!0;$field.data("usesFilePolyfill",!0).after('<label class="ancBtn fileBtn silver" for="'+$field.attr("id")+'">'+localizer.localize(isMultiple?"chooseFiles":"chooseFile")+'<\/label><span class="filename"><\/span>').on("change.form",function(){var fileNames=$.map($field[0].files,function(file){return file.name}).join(", ");fileNames?$field.siblings(".filename").html(fileNames):$field.siblings(".filename").html("");$field.blur()});if(navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(ua=navigator.userAgent,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[],/trident/i.test(M[1])?(tem=/\brv[ :]+(\d+(\.\d+)?)/g.exec(ua)||[],browserVersion="IE "+(tem[1]||"")):(M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"],(tem=ua.match(/version\/([\.\d]+)/i))!==null&&(M[2]=tem[1]),browserVersion=M.join(" ")),browserVersion=browserVersion.split(" "),browserVersion=browserVersion[1].split("."),browserVersion=parseInt(browserVersion[0],10),browserVersion<22))$('label[for="'+$field.attr("id")+'"]').on("click.form",function(){$field.click()})})};Validator={};Validator.defaults={validateOnSubmitHover:!1,submitButton:null,onSubmit:!1,fields:{}};Validator.patterns={match:function(value,match){return value===$("#"+match).val()},maxLength:function(value,maxLength){return value.length<=maxLength},minLength:function(value,minLength){return value.length>=minLength},extensions:function(values,extensions){var i,len;for(typeof values=="string"&&(values=[{name:values}]),i=0,len=values.length;i<len;i++)if($.inArray(values[i].name.split(".").pop().toLowerCase(),extensions)===-1)return!1;return!0},email:function(value){return!!value.match(/^[a-zA-Z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$/)},number:function(value){return!!value.match(/^[0-9]*(\.[0-9]+)?$/)},tel:function(value){return!!value.match(/^\(?(\d{3})\)?[- ]?(\d{3})[- ]?(\d{4})$/)},url:function(value){return!!value.match(/^(http|https|ftp):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i)}};Validator.validateCollection=function($collection,required){return Number(required)>$collection.filter(":checked").length?!1:!0};Validator.isValid=function($field,e){var value="",restrictions=$field.data("restrictions");if($field.val()&&!/^\s*$/.test($field.val())&&(value=$field.val()),$field.is('input[type="checkbox"], input[type="radio"]'))return Validator.validateCollection(restrictions.collection,restrictions.required);if($field.is('[type="file"]')&&(value=$field[0].files),restrictions.pattern&&$.isFunction(restrictions.pattern))return restrictions.pattern(value,$field,!!restrictions.required,e||{type:"validation"});if(restrictions.required||value.length){if(!value.length||restrictions.extensions&&!$.validator.extensions(value,restrictions.extensions)||restrictions.match&&!$.validator.match(value,restrictions.match)||restrictions.minLength&&!$.validator.minLength(value,restrictions.minLength)||restrictions.maxLength&&!$.validator.maxLength(value,restrictions.maxLength))return!1;if(restrictions.pattern)return $.validator[restrictions.pattern](value)}return!0};Validator.removeErrorAndSuccess=function($field){var $label=$field.data("$label");$field.removeClass("error success inform").removeAttr("aria-invalid");$label.removeClass("error success inform").parent().find(".errorMessage").remove();$field.data("restrictions").collection&&$field.data("restrictions").collection.removeClass("error success inform");$field.data("hasErrorCallout")&&jQuery().callout&&($field.data("hasErrorCallout",!1).callout("destroy"),$field.attr("data-callout")&&$field.callout())};Validator.updateValidationMessage=function($field,isValid){var errorClass,errorId,$label=$field.data("$label"),labelID,whichMessage=$label.attr("data-error-index")||0,restrictions=$field.data("restrictions"),errorMessage=$.trim(($label.attr("data-error")||"").split("|")[whichMessage]);Validator.removeErrorAndSuccess($field);isValid===!0?($field.data("restrictions").collection&&$field.data("restrictions").collection.removeAttr("aria-invalid aria-labelledby").addClass("success"),$field.removeAttr("aria-invalid aria-labelledby").addClass("success"),$label.addClass("success")):(isValid===!1||isValid==="info")&&(labelID=$label.attr("id"),labelID||(labelID=Validator.getRandomNumber()),errorClass=isValid==="info"?"inform":"error",errorId=labelID+"ErrorMessage",$field.data("restrictions").collection?$field.data("restrictions").collection.each(function(){var thisLabel=$('label[for="'+$(this).attr("id")+'"]'),thisLabelID=thisLabel.attr("id"),self=this;thisLabelID||(thisLabelID=Validator.getRandomNumber(),thisLabel.attr("id",thisLabelID));setTimeout(function(){$(self).attr("aria-labelledby",thisLabelID+" "+errorId)},50)}):setTimeout(function(){$field.attr("aria-labelledby",$label.attr("id")+" "+errorId)},50),$field.addClass(errorClass).attr("aria-invalid",!0),$label.addClass(errorClass),restrictions.errorLocation==="callout"&&jQuery().callout?($label.append('<span class="errorMessage icon iconWarning"><\/span>'),$field.data("restrictions").collection||$field.callout("destroy").data("hasErrorCallout",!0).callout({content:errorMessage,classes:"errorCallout"}),$label.parent().append('<div class="noDisplay" id="'+errorId+'">'+errorMessage+"<\/div>")):restrictions.errorLocation==="below"||restrictions.errorLocation==="callout"?$label.parent().append('<div class="errorMessage icon iconWarning" id="'+errorId+'">'+errorMessage+"<\/div>"):$label.append('<span class="errorMessage icon iconWarning">'+errorMessage+"<\/span>"));$label.removeAttr("data-error-index")};Validator.getRandomNumber=function(min,max){return!isNaN(min)&&!isNaN(max)?Math.floor(Math.random()*(1+max-min)+min):Date.now().toString()+Math.floor(Math.random()*1e3+1)};Validator.validateForm=function($form,scroll){var $firstErrorLabel=!1,$firstErrorInput=!1,result,validation={success:!0,errorFieldLabels:[]};return Form.isPlaceholderSupported||Form.removePlaceholderValues($form),$.each($form.data("fields"),function(key,$field){var $label=$field.data("$label");if($field.length===0)return delete $form.data("fields")[key],!0;result=Validator.isValid($field);result!=="delay"&&(result&&result!=="info"?$field.val().length&&Validator.updateValidationMessage($field,!0):($firstErrorLabel===!1&&($firstErrorLabel=$label,$firstErrorInput=$field),Validator.updateValidationMessage($field,result),validation.success=!1,$label.attr("data-error-label")?validation.errorFieldLabels.push($label.attr("data-error-label")):validation.errorFieldLabels.push($label.contents().filter(function(){return!$(this).is("a, b, button, i, em, span, strong")}).text())))}),!validation.success&&scroll&&($firstErrorLabel.offset().top<($("html").scrollTop()||$(document).scrollTop())&&$(document).scrollTop($firstErrorLabel.offset().top),$firstErrorInput.focus()),$form.data("onSubmit")&&(validation.success=$form.data("onSubmit")(validation.success,$form)?!0:!1),validation.success||Form.isPlaceholderSupported||Form.addPlaceholderValues($form),validation};Validator.handleValidationOnSubmitHover=function($form,settings){var hoverAlertTimer,spaceBetweenButtonAndAlert=8,$formAlert=$("#formAlert");if(settings.validateOnSubmitHover&&!Form.isTouchDevice)settings.submitButton.on("mouseenter.form focus.form",function(){var $submitButton=$(this),offset,validationResults=Validator.validateForm($form,!1);clearTimeout(hoverAlertTimer);!validationResults.success&&validationResults.errorFieldLabels.length&&(offset=$submitButton.offset(),$formAlert.css("opacity",1).html("<h4><strong>"+localizer.localize("errorMsg")+"<\/strong><\/h4><p>"+validationResults.errorFieldLabels.join(", ")+"<\/p>").addClass("alert alertOverlay formAlertActive").offset({left:offset.left+$submitButton.outerWidth(!1)+spaceBetweenButtonAndAlert,top:offset.top-($formAlert.outerHeight(!1)-$submitButton.outerHeight(!1))/2}));Form.isPlaceholderSupported||Form.addPlaceholderValues($form)}).on("mouseleave.form blur.form",function(){$formAlert.css("opacity",0);hoverAlertTimer=setTimeout(function(){$formAlert.removeClass("alert alertOverlay formAlertActive").removeAttr("style")},500)})};Validator.namespaceEvents=function(events){return events.split(" ").join(".form ")+".form"};Validator.validateInput=function($field,e){var result=Validator.isValid($field,e);result==="delay"||result==="info"?Validator.updateValidationMessage($field,result):result||$field.val()===$field.attr("placeholder")?$field.val()&&$field.val()!==$field.attr("placeholder")?Validator.updateValidationMessage($field,!0):Validator.removeErrorAndSuccess($field):Validator.updateValidationMessage($field,!1)};Validator.init=function($form,options){function getField($field){return $field.is("label, legend")&&($field=$form.data("fields")[$field.attr("id")]||$field),$field}var settings=$.extend({},Validator.defaults,options);if(settings.submitButton=settings.submitButton||$form.find('input[type="submit"]').first(),$form.data("allowSubmit",!0),!$form.data("fields")){$form.on("submit.form",function(){var validation=Validator.validateForm($form,!0);return validation.success&&$form.data("allowSubmit")?($form.data("allowSubmit",!1),settings.allowMultipleSubmissions&&setTimeout(function(){$form.data("allowSubmit",!0)},1e3),!0):!1});Validator.handleValidationOnSubmitHover($form,settings)}settings.onSubmit&&$form.data("onSubmit",settings.onSubmit);$form.data("fields")||$form.data("fields",{});$.each(settings.fields,function(key,restrictions){var $field=$form.find("#"+key),$label=$('label[for="'+key+'"]').first();if($field.length===0&&($field=$form.find('[name="'+key+'"]'),$field.length===0))return log("Invalid field ID: "+key),!0;if(restrictions.pattern==="url"&&Form.handleUrls($field),$field.is("label, legend")?($label=$field,$field=restrictions.collection,restrictions.when="blur change"):$field.is('input[type="checkbox"]')?(restrictions.collection=$field,restrictions.when="blur change"):restrictions.when||(restrictions.when="blur"),$field.data("hasFormEvents")&&$field.off(".form"),$field.data("hasFormEvents",!0).data("restrictions",restrictions).data("$label",$label),$form.data("fields")[key]=$field,restrictions.required===!0&&$field.attr("aria-required",!0),restrictions.when!=="submit")$field.on(Validator.namespaceEvents(restrictions.when),function(e){Validator.validateInput($(this),e)});$label.attr("data-error-index")?Validator.updateValidationMessage($field,!1):$field.val()&&!$field.is('input[type="checkbox"], input[type="radio"], input[type="submit"]')&&$field.val()!==$field.attr("placeholder")&&(Validator.isValid($field)?Validator.updateValidationMessage($field,!0):Validator.updateValidationMessage($field,!1));$field.on("showValidationMessage.form",function(e,isValid,indexOfErrorMessage){log('Deprecation Notice: Use $("selector").trigger("validation-message", [isValid, indexOfErrorMessage]); instead.');$(this).trigger("validation-message.form",[isValid,indexOfErrorMessage])})});$form.attr("novalidate","novalidate").off("polyfills.form").on("polyfills.form",function(){var $form=$(this);Form.handlePlaceholders($form);Form.handleFileInputs($form)}).off("validation-message.form").on("validation-message.form","input, label, legend, select, textarea",function(e,isValid,indexOfErrorMessage){var $field=getField($(this));if(!$field.data("hasFormEvents"))return!1;$field.data("$label").attr("data-error-index",indexOfErrorMessage);Validator.updateValidationMessage($field,isValid)}).off("validation-error-index.form").on("validation-error-index.form","input, label, legend, select, textarea",function(e,index){var $field=getField($(this));if(!$field.data("hasFormEvents"))return!1;$field.data("$label").attr("data-error-index",index)}).off("validation-remove.form").on("validation-remove.form","input, label, legend, select, textarea",function(){var $this=$(this),$fieldId=$this.attr("id"),$field=getField($this);if(!$field.data("hasFormEvents"))return!1;$field.trigger("validation-message.form","clear");$field.off(".form").data("hasFormEvents",!1);delete $form.data("fields")[$fieldId]}).off("validation.form").on("validation.form","input, label, legend, select, textarea",function(e){var $field=getField($(this));if(!$field.data("hasFormEvents"))return!1;Validator.validateInput($field,e)}).trigger("polyfills.form")};$.fn.validator=function(options){return this.is("label, legend, input, select, textarea")?(log('Deprecation Notice: Use $("selector").trigger("validation"); instead.'),Validator.validateInput(this)):Validator.init(this,options),this};$.fn.polyfill=$.fn.validator;$.validator=Validator.patterns;$.validator.setErrorIndex=function($field,index){log('Deprecation Notice: Use $("field-selector").trigger("validation-error-index", [0]); instead.');$field.data("$label").attr("data-error-index",index)};$.validator.version=version;$(function(){Form.isTouchDevice?$("html").addClass("touch"):$("html").addClass("noTouch");$("#formAlert").length||$('<div id="formAlert"><\/div>').appendTo("body")})})(jQuery);
(function($){"use strict";var Modal,version=3,isIe8=$("html").hasClass("ie8"),isIe9=$("html").hasClass("ie9"),localizer,$modal=!1,$modalContents=!1,$modalCenter=!1,$modalClose=!1,doubleIncluded=!!$.modal;if(doubleIncluded){if($.modal.version===version){window.console&&console.warn("ERROR: You are including modal.js multiple times");return}if(window.console&&console.warn("ERROR: You are including multiple versions of modal.js"),$.modal.version>version)return}localizer={lang:function(){var langAttr=$("html").attr("lang")||$("[lang]").first().attr("lang");return langAttr?langAttr.toLowerCase():"en"}(),langSets:{de:{closeBtn:"Schlie&#223;en"},en:{closeBtn:"Close"},es:{closeBtn:"Cerrar"},fr:{closeBtn:"Fermer"},it:{closeBtn:"Chiudi"},sv:{closeBtn:"St&#228;ng"}},localize:function(key){return this.langSets[this.lang]&&this.langSets[this.lang][key]?this.langSets[this.lang][key]:this.langSets[this.lang.substring(0,2)]&&this.langSets[this.lang.substring(0,2)][key]?this.langSets[this.lang.substring(0,2)][key]:this.langSets.en[key]||""}};Modal={};Modal.defaults={hideCloseBtn:!1,closeOnBkgClick:!0,closeOnEscape:!0,fade:200,isMarketing:!1,showLoading:!1,width:"",title:"",$trigger:!1,onOpen:function(){return},onClose:function(){return}};Modal.isOpen=!1;Modal.isTouchDevice="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch;Modal.paddingLeftRight=40;Modal.widthTransition=410;Modal.openButton=!1;Modal.addToPage=function(){$modal=$('<section id="modal"><div id="modalCenter"><\/div><div id="modalContents" aria-describedby="modalHeader" tabIndex="-1"><button class="closeBtn" id="modalClose" title="'+localizer.localize("closeBtn")+'" type="button"><\/button><\/div><\/section>');$modal.appendTo("body");$modalContents=$("#modalContents");$modalCenter=$("#modalCenter");$modalClose=$("#modalClose");$modalClose.on("click.modal",function(){$("body").trigger("closeModal.modal")});$modalContents.on("click.modal",function(){Modal.stopClosing=!0})};Modal.setTitle=function(title,$currentModalContents){$currentModalContents===!1&&($currentModalContents=$modalContents.find(".modalActive"));$modalContents.children("#modalHeader").remove();title&&$currentModalContents.before('<h4 id="modalHeader" class="modalHeader">'+title+"<\/h4>");title||$currentModalContents.find(".modalHeader").length?$modalContents.addClass("modalHasTitle"):$modalContents.removeClass("modalHasTitle")};Modal.centerModal=function(){var windowHeight=$("html").height(),modalHeight=$modalContents.outerHeight(!1);$modalCenter.css({"margin-bottom":-modalHeight/2+"px"});modalHeight+=parseInt($modalContents.css("margin-top"),10)+parseInt($modalContents.css("margin-bottom"),10);Modal.isTouchDevice&&(modalHeight<=windowHeight?$modal.add("body").height(windowHeight):$modal.add("body").height(modalHeight));$modal.scrollTop(0);setTimeout(function(){$modal.trigger("recentered")},Modal.widthTransition)};Modal.resizeModal=function(width){Modal.setWidth(width);isIe8?Modal.centerModal():setTimeout(Modal.centerModal,Modal.widthTransition)};Modal.setWidth=function(width){width&&String(width).indexOf("%")!==-1?$modalContents.css("width",width):width?($(window).width()<768&&!$modalContents.hasClass("modalCustomPadding")&&(Modal.paddingLeftRight=20),$modalContents.css("width",parseInt(width,10)+Modal.paddingLeftRight)):$modalContents.css("width","")};Modal.showLoading=function(loading){loading?$modalContents.addClass("loading"):$modalContents.removeClass("loading")};$.fn.modal=function(options){function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().andSelf().filter(function(){return $.css(this,"visibility")==="hidden"}).length}function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();return"area"===nodeName?(map=element.parentNode,mapName=map.name,!element.href||!mapName||map.nodeName.toLowerCase()!=="map")?!1:(img=$("img[usemap=#"+mapName+"]")[0],!!img&&visible(img)):(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function tabbable(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}var addEvents,closeModal,openModal,removeEvents,$this=this,settings=$.extend({},Modal.defaults,options);return settings.el=this,settings.windowPosition=[0,0],Modal.stopClosing=!1,Modal.isAnimating=!1,$this.attr("title")&&($this.attr("data-title",$this.attr("title")),$this.removeAttr("title")),!settings.title&&$this.attr("data-title")&&(settings.title=$this.attr("data-title")),settings.$trigger&&settings.$trigger.attr("aria-controls","modal"),addEvents=function(){var $body=$("body");$body.on("closeModal.modal",function(){$body.find(":focus").blur();$modal.animate({opacity:0},settings.fade/2,"linear",function(){closeModal()})});$(window).on("resize.modal orientationchange.modal",function(){$modal.data("preventModalCenterOnResize")!==!0&&setTimeout(Modal.centerModal,300)});if(settings.closeOnBkgClick)$modal.on("click.modal",function(){Modal.stopClosing||Modal.isAnimating||$body.trigger("closeModal.modal");Modal.stopClosing=!1});if(settings.closeOnEscape)$body.on("keydown.modal",function(event){if(!event.isDefaultPrevented()&&event.keyCode&&event.keyCode===27)return $body.find(":focus").blur(),$body.trigger("closeModal.modal"),event.preventDefault(),!1})},closeModal=function(alreadyOpen){alreadyOpen!==!0&&(Modal.isOpen=!1,$("html").removeClass("modalOpen"),$("body").css("padding-right","").height(""),$modal.removeAttr("style"),$modalCenter.removeClass("modalCentered"),$modalContents.removeAttr("style role"),Modal.showLoading(!1),window.scrollTo(settings.windowPosition[0],settings.windowPosition[1]),Modal.openButton&&Modal.openButton.removeAttr("aria-expanded").focus(),$modal.removeAttr("aria-expanded"),Modal.openButton=!1);removeEvents();Modal.previousSettings.el.data("dynamic")?Modal.previousSettings.el.remove():Modal.previousSettings.el.hide().removeClass("modalActive");Modal.previousSettings.onClose($this);return Modal.previousSettings.windowPosition},openModal=function(){var $modalImages,imageLength,screenWidth=$(window).width(),scrollbarWidth=0,imageCount=0;if($modal||Modal.addToPage(),settings.windowPosition=Modal.isOpen?closeModal(!0):$(document).scrollTop()>=$("html").scrollTop()?[$(document).scrollLeft(),$(document).scrollTop()]:[$("html").scrollLeft(),$("html").scrollTop()],Modal.isOpen||($modal.attr("aria-expanded","true"),settings.$trigger&&(Modal.openButton=settings.$trigger.attr("aria-expanded","true"))),$this===undefined||$this.length===0)return window.console&&console.warn("Modal contents not found. Check your selector."),!1;$("body").find($this).length>0?$this.data("dynamic",!1):$this.data("dynamic",!0);$this.parent()!==$modalContents&&$this.appendTo($modalContents);$this.show().addClass("modalActive");$("html").addClass("modalOpen");$modalContents.attr("role","alertdialog").focus().on("keydown.modal",function(e){var tabbableElements=$(this).find("*").filter(function(){return tabbable(this)||$(this).is(":focus")}),focusedElement=$(this).find(":focus");e.keyCode===9&&(e.shiftKey&&focusedElement.get(0)===tabbableElements.first().get(0)?(e.preventDefault(),tabbableElements.last().focus()):e.shiftKey||focusedElement.get(0)!==tabbableElements.last().get(0)?$modalContents.is(":focus")&&(e.preventDefault(),$modalClose.focus()):(e.preventDefault(),tabbableElements.first().focus()))});scrollbarWidth=$(window).width()-screenWidth;$("body").css("padding-right",parseInt($("body").css("padding-right"),10)+scrollbarWidth+"px");Modal.isTouchDevice?window.scrollTo(0,0):window.scrollTo(settings.windowPosition[0],settings.windowPosition[1]);Modal.setTitle(settings.title,$this);Modal.showLoading(settings.showLoading);settings.isMarketing||settings.useCustomPadding?($modalContents.addClass("modalCustomPadding"),Modal.paddingLeftRight=0):($modalContents.removeClass("modalCustomPadding"),Modal.paddingLeftRight=40);Modal.setWidth(settings.width);settings.hideCloseBtn?$modalContents.addClass("modalHideClose"):$modalContents.removeClass("modalHideClose");addEvents();settings.onOpen($this);(!Modal.isOpen||isIe8||isIe9)&&($modal.show(),Modal.centerModal());setTimeout(Modal.centerModal,Modal.widthTransition);$modalImages=$this.is("img")?$this:$this.find("img");imageLength=$modalImages.length;imageLength>0&&$modalImages.load(function(){imageCount+=1;imageCount===imageLength&&Modal.centerModal()});Modal.isAnimating=!0;setTimeout(function(){Modal.isAnimating=!1},settings.fade+300);$modal.animate({opacity:1},settings.fade,"linear",function(){$modalCenter.addClass("modalCentered");$modalContents.animate({opacity:1},settings.fade/2,"linear")});Modal.previousSettings=settings;Modal.isOpen=!0},removeEvents=function(){$modal.add("body").add(window).off(".modal")},openModal(),this};$(function(){Modal.isTouchDevice?$("html").addClass("touch"):$("html").addClass("noTouch")});$.modal={};$.modal.center=function(){$modal&&Modal.centerModal()};$.modal.close=function(){$modal&&$("body").trigger("closeModal.modal")};$.modal.showLoading=function(loading){$modal&&Modal.showLoading(loading)};$.modal.resize=function(width){$modal&&Modal.resizeModal(width)};$.modal.title=function(title){$modal&&Modal.setTitle(title,!1)};$.modal.preventClosing=function(){Modal.stopClosing=!0};$.modal.version=version})(jQuery);
var mboxTokens={toBeWritten:[],documentWrite:null,isOverridden:!1,overrideDocumentWrite:function(){var self=this;self.isOverridden||(self.isOverridden=!0,self.toBeWritten=[],self.documentWrite=document.write,document.write=function(html){self.toBeWritten.push(self.updateTokens(html))})},resetDocumentWrite:function(){var self=this,i;if(self.isOverridden){for(self.isOverridden=!1,document.write=self.documentWrite,i=0;i<self.toBeWritten.length;i++)document.write(self.toBeWritten[i]);self.toBeWritten=[]}},updateTokens:function(html){"use strict";var urlParts,http,https,replacements,i;http="http://";https="https://";try{urlParts=function(){var result={},regexParse=new RegExp("([a-z-0-9]{2,63}).([a-z.]{2,6})$"),urlParts=regexParse.exec(window.location.hostname);return result.sitename=urlParts[1],result.tld=urlParts[2],result.protocol=window.location.protocol,result.subdomain=window.location.hostname.replace(result.sitename+"."+result.tld,"").slice(0,-1),result.domain=result.sitename+"."+result.tld,result}()}catch(e){urlParts={}}for(urlParts.sitename!=="ancestrydev"&&urlParts.sitename!=="ancestrystage"&&urlParts.sitename!=="ancestry"&&(urlParts.sitename="ancestry",urlParts.domain="ancestry.com"),replacements=[["##AncestryTopDomain##",urlParts.domain],["##AncestryDomain##",http+"www."+urlParts.domain],["##TreesDomain##",http+"trees."+urlParts.domain],["##SearchDomain##",http+"search."+urlParts.domain],["##CommunityDomain##",http+"community."+urlParts.domain],["##SecureDomain##",https+"secure."+urlParts.domain],["##LearningDomain##",http+"learn."+urlParts.domain],["##WizDomain##",http+"wiz."+urlParts.domain],["##DnaDomain##",http+"dna."+urlParts.domain],["##HomeDomain##",http+"home."+urlParts.domain],["##StoreDomain##",http+"store.ancestry"+urlParts.sitename.replace("ancestry","")+".com"],["##OrderDomain##",https+"order."+urlParts.domain],["##CacheDomain##",window.location.protocol+"//c.mfcreative"+urlParts.sitename.replace("ancestry","")+".com"],["##CanaryDomain##",window.location.protocol+"//canary.mfcreative"+urlParts.sitename.replace("ancestry","")+".com"]],i=replacements.length-1;i>=0;i--)html=html.replace(new RegExp(replacements[i][0],"g"),replacements[i][1]);return html}},mboxCopyright,TNT;document.addEventListener("DOMContentLoaded",function(){window.ttMETA===undefined&&document.getElementsByClassName("mboxDefault").length>1&&(document.getElementById("mboxPreventFlicker").innerHTML=".mboxDefault { visibility:visible; }")});mboxCopyright="Copyright 1996-2014. Adobe Systems Incorporated. All rights reserved.";TNT=TNT||{};TNT.a=TNT.a||{};TNT.a.nestedMboxes=[];TNT.a.b={companyName:"Test&amp;Target",isProduction:!0,adminUrl:"http://admin9.testandtarget.omniture.com/admin",clientCode:"myfamilycominc",serverHost:"myfamilycominc.tt.omtrdc.net",mboxTimeout:15e3,mboxLoadedTimeout:16,mboxFactoryDisabledTimeout:3600,bodyPollingTimeout:16,sessionExpirationTimeout:1860,experienceManagerDisabledTimeout:1800,experienceManagerTimeout:5e3,tntIdLifetime:2592e3,crossDomain:"enabled",trafficDuration:10368e3,trafficLevelPercentage:100,clientSessionIdSupport:!0,clientTntIdSupport:!0,passPageParameters:!0,usePersistentCookies:!0,crossDomainEnabled:!0,crossDomainXOnly:!1,imsOrgId:"ED3301AC512D2A290A490D4C@AdobeOrg",includeExperienceManagerPlugin:!1,globalMboxName:"target-global-mbox",globalMboxLocationDomId:"",globalMboxAutoCreate:!1,experienceManagerPluginUrl:"//cdn.tt.omtrdc.net/cdn/target.js",siteCatalystPluginName:"tt",includeSiteCatalystPlugin:!1,mboxVersion:57,mboxIsSupportedFunction:function(){return navigator.userAgent.indexOf("MSIE 7.")==-1},parametersFunction:function(){function getOmnitureCookie(name){for(var c=document.cookie.split(";"),i=0;i<c.length;i++)if(c[i].indexOf(name+"=")!=-1)return c[i].substring(c[i].indexOf(name+"=")+(name+"=").length);return"TYPE=NRVisitor"}function ageCookie(name){for(var c=document.cookie.split(";"),i=0;i<c.length;i++)if(c[i].indexOf(name+"=")!=-1)return c[i].substring(c[i].indexOf(name+"=")+(name+"=").length);return"noAge"}var myCookies=document.cookie,myDemograph="",myIdx,ATTIdx,startATT,ATT,ATTval,cLoggedIn,baitArray,bait,wizAge;myCookies!=null&&(myCookies=unescape(myCookies),myIdx=myCookies.indexOf("BAIT"),myIdx!=-1&&(myDemograph=myCookies.substring(myIdx,myCookies.indexOf(" ",myIdx+1))),ATTIdx=myCookies.indexOf(" ATT"),ATTIdx!=-1?(startATT=myCookies.substring(ATTIdx),ATT=startATT.substring(5,startATT.indexOf(";")),ATTval=ATT==0||ATT==undefined?0:1,cLoggedIn="cLoggedIn="+ATTval):cLoggedIn="cLoggedIn=0");var myDemographData="",bait="",output="";if(myDemograph.indexOf("BAIT=")==0){for(myDemographData=myDemograph.substring(myDemograph.indexOf("BAIT=")+5),baitArray=myDemographData.split(";"),i=0;i<baitArray.length;i++)baitArray[i]=baitArray[i]+"&";baitArray.pop();bait=baitArray.join("");output=bait}else myDemographData="baitData=none",output=myDemographData;return wizAge=ageCookie("wizAge"),output+"&"+getOmnitureCookie("OMNITURE")+"&location="+location.host+location.pathname+"&force=&wizAge="+wizAge+"&"+cLoggedIn},cookieDomainFunction:function(){var dList=location.hostname.split(".");return dList.length>2&&dList[dList.length-1].length==2&&dList[dList.length-2].match("^(co|aero|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|xxx)$")?dList.slice(dList.length-3).join("."):dList.length>1?dList.slice(dList.length-2).join("."):dList[0]}};TNT.a.c={};TNT.a.c.d="mboxPage";TNT.a.c.e="mboxMCGVID";TNT.a.c.f="mboxMCGLH";TNT.a.c.g="mboxAAMB";TNT.a.c.h="mboxMCAVID";TNT.a.c.i="mboxMCSDID";TNT.a.c.j="mboxCount";TNT.a.c.k="mboxHost";TNT.a.c.l="mboxFactoryId";TNT.a.c.m="mboxPC";TNT.a.c.n="screenHeight";TNT.a.c.o="screenWidth";TNT.a.c.p="browserWidth";TNT.a.c.q="browserHeight";TNT.a.c.r="browserTimeOffset";TNT.a.c.s="colorDepth";TNT.a.c.t="mboxXDomain";TNT.a.c.u="mboxURL";TNT.a.c.v="mboxReferrer";TNT.a.c.w="mboxVersion";TNT.a.c.x="mbox";TNT.a.c.y="mboxId";TNT.a.c.z="mboxDOMLoaded";TNT.a.c.A="mboxTime";TNT.a.c.B="scPluginVersion";TNT.a.C={};TNT.a.C.D="mboxDisable";TNT.a.C.E="mboxSession";TNT.a.C.F="mboxEnv";TNT.a.C.G="mboxDebug";TNT.a.H={};TNT.a.H.D="disable";TNT.a.H.E="session";TNT.a.H.m="PC";TNT.a.H.I="level";TNT.a.H.J="check";TNT.a.H.G="debug";TNT.a.H.K="em-disabled";TNT.a.L={};TNT.a.L.M="default";TNT.a.L.N="mbox";TNT.a.L.O="mboxImported-";TNT.a.L.P=6e4;TNT.a.L.Q="mboxDefault";TNT.a.L.R="mboxMarker-";TNT.a.L.S=250;TNT.a.L.B=1;TNT.getGlobalMboxName=function(){return TNT.a.b.globalMboxName};TNT.getGlobalMboxLocation=function(){return TNT.a.b.globalMboxLocationDomId};TNT.isAutoCreateGlobalMbox=function(){return TNT.a.b.globalMboxAutoCreate};TNT.getClientMboxExtraParameters=function(){return TNT.a.b.parametersFunction()};TNT.a.T={};TNT.a.T.U=function(V){return V===void 0};TNT.a.T.W=function(V){return V===null};TNT.a.T.X=function(V){var T=TNT.a.T;return T.U(V)||T.W(V)?!0:V.length===0};TNT.a.T.Y=function(V){var Z={}.toString;return Z.call(V)==="[object Function]"};TNT.a.T._=function(V){var Z={}.toString;return Z.call(V)==="[object Array]"};TNT.a.T.ab=function(V){var Z={}.toString;return Z.call(V)==="[object String]"};TNT.a.T.bb=function(V){var Z={}.toString;return Z.call(V)==="[object Object]"};TNT.getTargetPageParameters=function(){var T=TNT.a.T,cb=window.targetPageParams,db;if(!T.Y(cb))return[];db=null;try{db=cb()}catch(eb){}return T.W(db)?[]:T._(db)?db:T.ab(db)&&!T.X(db)?TNT.a.fb(db):T.bb(db)?TNT.a.gb(db,[]):[]};TNT.a.fb=function(hb){for(var db=[],ib=/([^&=]+)=([^&]*)/g,jb=decodeURIComponent,kb=ib.exec(hb);kb;)db.push([jb(kb[1]),jb(kb[2])].join("=")),kb=ib.exec(hb);return db};TNT.a.gb=function(lb,mb){var T=TNT.a.T,db=[],nb,V;for(nb in lb)lb.hasOwnProperty(nb)&&(V=lb[nb],T.bb(V)?(mb.push(nb),db=db.concat(TNT.a.gb(V,mb)),mb.pop()):mb.length>0?db.push([mb.concat(nb).join("."),V].join("=")):db.push([nb,V].join("=")));return db};TNT.a.ob=function(){};TNT.a.ob.prototype.getType=function(){return"ajax"};TNT.a.ob.prototype.fetch=function(pb){pb.setServerType(this.getType());document.write('<script src="'+pb.buildUrl()+'"><\/script>')};TNT.a.ob.prototype.cancel=function(){};mboxUrlBuilder=function(qb,rb){this.qb=qb;this.rb=rb;this.sb=[];this.tb=function(u){return u};this.ub=null};mboxUrlBuilder.prototype.addNewParameter=function(vb,V){return this.sb.push({name:vb,value:V}),this};mboxUrlBuilder.prototype.addParameterIfAbsent=function(vb,V){var wb,xb;if(V){for(wb=0;wb<this.sb.length;wb++)if(xb=this.sb[wb],xb.name===vb)return this;return this.checkInvalidCharacters(vb),this.addNewParameter(vb,V)}};mboxUrlBuilder.prototype.addParameter=function(vb,V){var wb,xb;for(this.checkInvalidCharacters(vb),wb=0;wb<this.sb.length;wb++)if(xb=this.sb[wb],xb.name===vb)return xb.value=V,this;return this.addNewParameter(vb,V)};mboxUrlBuilder.prototype.addParameters=function(sb){var wb,yb;if(!sb)return this;for(wb=0;wb<sb.length;wb++)(yb=sb[wb].indexOf("="),yb!==-1&&yb!==0)&&this.addParameter(sb[wb].substring(0,yb),sb[wb].substring(yb+1,sb[wb].length));return this};mboxUrlBuilder.prototype.setServerType=function(zb){this.Ab=zb};mboxUrlBuilder.prototype.setBasePath=function(ub){this.ub=ub};mboxUrlBuilder.prototype.setUrlProcessAction=function(Bb){this.tb=Bb};mboxUrlBuilder.prototype.buildUrl=function(){for(var xb,Cb=this.ub?this.ub:"/m2/"+this.rb+"/mbox/"+this.Ab,Db=document.location.protocol=="file:"?"http:":document.location.protocol,u=Db+"//"+this.qb+Cb,Eb=u.indexOf("?")!=-1?"&":"?",wb=0;wb<this.sb.length;wb++)xb=this.sb[wb],u+=Eb+encodeURIComponent(xb.name)+"="+encodeURIComponent(xb.value),Eb="&";return this.Fb(this.tb(u))};mboxUrlBuilder.prototype.getParameters=function(){return this.sb};mboxUrlBuilder.prototype.setParameters=function(sb){this.sb=sb};mboxUrlBuilder.prototype.clone=function(){var Gb=new mboxUrlBuilder(this.qb,this.rb),wb;for(Gb.setServerType(this.Ab),Gb.setBasePath(this.ub),Gb.setUrlProcessAction(this.tb),wb=0;wb<this.sb.length;wb++)Gb.addParameter(this.sb[wb].name,this.sb[wb].value);return Gb};mboxUrlBuilder.prototype.Fb=function(Hb){return Hb.replace(/\"/g,"&quot;").replace(/>/g,"&gt;")};mboxUrlBuilder.prototype.checkInvalidCharacters=function(vb){var Ib=new RegExp("('|\")");if(Ib.exec(vb))throw"Parameter '"+vb+"' contains invalid characters";};mboxStandardFetcher=function(){};mboxStandardFetcher.prototype.getType=function(){return"standard"};mboxStandardFetcher.prototype.fetch=function(pb){pb.setServerType(this.getType());document.write('<script src="'+pb.buildUrl()+'"><\/script>')};mboxStandardFetcher.prototype.cancel=function(){};mboxAjaxFetcher=function(){};mboxAjaxFetcher.prototype.getType=function(){return"ajax"};mboxAjaxFetcher.prototype.fetch=function(pb){pb.setServerType(this.getType());var u=pb.buildUrl();this.Jb=document.createElement("script");this.Jb.src=u;document.body.appendChild(this.Jb)};mboxAjaxFetcher.prototype.cancel=function(){};mboxMap=function(){this.Kb={};this.mb=[]};mboxMap.prototype.put=function(nb,V){this.Kb[nb]||(this.mb[this.mb.length]=nb);this.Kb[nb]=V};mboxMap.prototype.get=function(nb){return this.Kb[nb]};mboxMap.prototype.remove=function(nb){var Lb,i;for(this.Kb[nb]=undefined,Lb=[],i=0;i<this.mb.length;i++)this.mb[i]!==nb&&Lb.push(this.mb[i]);this.mb=Lb};mboxMap.prototype.each=function(Bb){for(var nb,V,db,wb=0;wb<this.mb.length;wb++)if(nb=this.mb[wb],V=this.Kb[nb],V&&(db=Bb(nb,V),db===!1))break};mboxMap.prototype.isEmpty=function(){return this.mb.length===0};mboxFactory=function(Mb,rb,Nb){var b=TNT.a.b,H=TNT.a.H,C=TNT.a.C,L=TNT.a.L,Ob=b.mboxVersion,Tb,Ub,ic;this.Pb=!1;this.Nb=Nb;this.Qb=new mboxList;mboxFactories.put(Nb,this);this.Rb=b.mboxIsSupportedFunction()&&typeof(window.attachEvent||document.addEventListener||window.addEventListener)!="undefined";this.Sb=this.Rb&&mboxGetPageParameter(C.D,!0)===null;Tb=Nb==L.M;Ub=L.N+(Tb?"":"-"+Nb);this.Vb=new mboxCookieManager(Ub,b.cookieDomainFunction());b.crossDomainXOnly&&(this.Sb=this.Sb&&this.Vb.isEnabled());this.Sb=this.Sb&&TNT.a.T.W(this.Vb.getCookie(H.D))&&TNT.a.T.W(this.Vb.getCookie(H.K));this.isAdmin()&&this.enable();this.Wb();this.Xb=mboxGenerateId();this.Yb=mboxScreenHeight();this.Zb=mboxScreenWidth();this._b=mboxBrowserWidth();this.ac=mboxBrowserHeight();this.bc=mboxScreenColorDepth();this.cc=mboxBrowserTimeOffset();this.dc=new mboxSession(this.Xb,C.E,H.E,b.sessionExpirationTimeout,this.Vb);this.ec=new mboxPC(H.m,b.tntIdLifetime,this.Vb);this.pb=new mboxUrlBuilder(Mb,rb);this.fc(this.pb,Tb,Ob);this.gc=(new Date).getTime();this.hc=this.gc;ic=this;this.addOnLoad(function(){ic.hc=(new Date).getTime()});this.Rb&&(this.addOnLoad(function(){ic.Pb=!0;ic.getMboxes().each(function(jc){jc.kc();jc.setFetcher(new mboxAjaxFetcher);jc.finalize()});TNT.a.nestedMboxes=[]}),this.Sb?(this.limitTraffic(b.trafficLevelPercentage,b.trafficDuration),this.lc(),this.mc=new mboxSignaler(this)):b.isProduction||this.isAdmin()&&(this.isEnabled()?alert("It looks like your browser will not allow "+b.companyName+" to set its administrative cookie. To allow setting the cookie please lower the privacy settings of your browser.\n(this message will only appear in administrative mode)"):alert("mbox disabled, probably due to timeout\nReset your cookies to re-enable\n(this message will only appear in administrative mode)")))};mboxFactory.prototype.forcePCId=function(nc){TNT.a.b.clientTntIdSupport&&this.ec.forceId(nc)&&this.dc.forceId(mboxGenerateId())};mboxFactory.prototype.forceSessionId=function(nc){TNT.a.b.clientSessionIdSupport&&this.dc.forceId(nc)};mboxFactory.prototype.isEnabled=function(){return this.Sb};mboxFactory.prototype.getDisableReason=function(){return this.Vb.getCookie(TNT.a.H.D)};mboxFactory.prototype.isSupported=function(){return this.Rb};mboxFactory.prototype.disable=function(oc,pc){typeof oc=="undefined"&&(oc=3600);typeof pc=="undefined"&&(pc="unspecified");this.isAdmin()||(this.Sb=!1,this.Vb.setCookie(TNT.a.H.D,pc,oc))};mboxFactory.prototype.enable=function(){this.Sb=!0;this.Vb.deleteCookie(TNT.a.H.D)};mboxFactory.prototype.isAdmin=function(){return document.location.href.indexOf(TNT.a.C.F)!=-1};mboxFactory.prototype.limitTraffic=function(qc,oc){if(TNT.a.b.trafficLevelPercentage!=100){if(qc==100)return;var rc=!0;parseInt(this.Vb.getCookie(TNT.a.H.I))!=qc&&(rc=Math.random()*100<=qc);this.Vb.setCookie(TNT.a.H.I,qc,oc);rc||this.disable(3600,"limited by traffic")}};mboxFactory.prototype.addOnLoad=function(sc){if(this.isDomLoaded())sc();else{var tc=!1,uc=function(){tc||(tc=!0,sc())};this.vc.push(uc);this.isDomLoaded()&&!tc&&uc()}};mboxFactory.prototype.getEllapsedTime=function(){return this.hc-this.gc};mboxFactory.prototype.getEllapsedTimeUntil=function(A){return A-this.gc};mboxFactory.prototype.getMboxes=function(){return this.Qb};mboxFactory.prototype.get=function(x,y){return this.Qb.get(x).getById(y||0)};mboxFactory.prototype.update=function(x,sb){if(this.isEnabled()){var ic=this;if(!this.isDomLoaded()){this.addOnLoad(function(){ic.update(x,sb)});return}if(this.Qb.get(x).length()===0)throw"Mbox "+x+" is not defined";this.Qb.get(x).each(function(jc){var pb=jc.getUrlBuilder();pb.addParameter(TNT.a.c.d,mboxGenerateId());ic.wc(pb);ic.xc(pb,x);ic.setVisitorIdParameters(pb,x);jc.load(sb)})}};mboxFactory.prototype.setVisitorIdParameters=function(u,x){var visitor,addVisitorValueToUrl;typeof Visitor!="undefined"&&TNT.a.b.imsOrgId&&(visitor=Visitor.getInstance(TNT.a.b.imsOrgId),visitor.isAllowed()&&(addVisitorValueToUrl=function(param,getter,mboxName){if(visitor[getter]){var callback=function(value){value&&u.addParameter(param,value)},value;value=typeof mboxName!="undefined"?visitor[getter]("mbox:"+mboxName):visitor[getter](callback);callback(value)}},addVisitorValueToUrl(TNT.a.c.e,"getMarketingCloudVisitorID"),addVisitorValueToUrl(TNT.a.c.f,"getAudienceManagerLocationHint"),addVisitorValueToUrl(TNT.a.c.g,"getAudienceManagerBlob"),addVisitorValueToUrl(TNT.a.c.h,"getAnalyticsVisitorID"),addVisitorValueToUrl(TNT.a.c.i,"getSupplementalDataID",x)))};mboxFactory.prototype.create=function(x,sb,yc){var y,Ac,jc,ic;if(!this.isSupported())return null;var zc=new Date,A=zc.getTime()-zc.getTimezoneOffset()*TNT.a.L.P,pb=this.pb.clone();if(pb.addParameter(TNT.a.c.j,this.Qb.length()+1),pb.addParameter(TNT.a.c.A,A),pb.addParameters(sb),this.wc(pb),this.xc(pb,x),this.setVisitorIdParameters(pb,x),yc)Ac=new mboxLocatorNode(yc);else{if(this.Pb)throw"The page has already been loaded, can't write marker";Ac=new mboxLocatorDefault(this.Bc(x))}try{y=this.Qb.get(x).length();jc=new mbox(x,y,pb,Ac,this.Cc(x),this);this.Sb&&jc.setFetcher(this.Pb?new mboxAjaxFetcher:new mboxStandardFetcher);ic=this;jc.setOnError(function(Dc){jc.setMessage(Dc);jc.activate();jc.isActivated()||(ic.disable(TNT.a.b.mboxFactoryDisabledTimeout,Dc),window.location.hostname.indexOf("order.ancestry")===-1&&window.location.reload(!1))});this.Qb.add(jc)}catch(Ec){this.disable();throw'Failed creating mbox "'+x+'", the error was: '+Ec;}return jc};mboxFactory.prototype.wc=function(pb){var m=this.ec.getId();m&&pb.addParameter(TNT.a.c.m,m)};mboxFactory.prototype.xc=function(pb,x){var Fc=!TNT.isAutoCreateGlobalMbox()&&TNT.getGlobalMboxName()===x;Fc&&pb.addParameters(TNT.getTargetPageParameters())};mboxFactory.prototype.getCookieManager=function(){return this.Vb};mboxFactory.prototype.getPageId=function(){return this.Xb};mboxFactory.prototype.getPCId=function(){return this.ec};mboxFactory.prototype.getSessionId=function(){return this.dc};mboxFactory.prototype.getSignaler=function(){return this.mc};mboxFactory.prototype.getUrlBuilder=function(){return this.pb};mboxFactory.prototype.Gc=function(x){return this.Nb+"-"+x+"-"+this.Qb.get(x).length()};mboxFactory.prototype.Bc=function(x){return TNT.a.L.R+this.Gc(x)};mboxFactory.prototype.Cc=function(x){return TNT.a.L.O+this.Gc(x)};mboxFactory.prototype.fc=function(pb,Tb,Ob){pb.addParameter(TNT.a.c.k,document.location.hostname);pb.addParameter(TNT.a.c.d,this.Xb);pb.addParameter(TNT.a.c.n,this.Yb);pb.addParameter(TNT.a.c.o,this.Zb);pb.addParameter(TNT.a.c.p,this._b);pb.addParameter(TNT.a.c.q,this.ac);pb.addParameter(TNT.a.c.r,this.cc);pb.addParameter(TNT.a.c.s,this.bc);pb.addParameter(TNT.a.C.E,this.dc.getId());Tb||pb.addParameter(TNT.a.c.l,this.Nb);this.wc(pb);TNT.a.b.crossDomainEnabled&&pb.addParameter(TNT.a.c.t,TNT.a.b.crossDomain);var c=TNT.getClientMboxExtraParameters();c&&pb.addParameters(c.split("&"));pb.setUrlProcessAction(function(u){if(TNT.a.b.passPageParameters){u+="&";u+=TNT.a.c.u;u+="="+encodeURIComponent(document.location);var v=encodeURIComponent(document.referrer);u.length+v.length<2e3&&(u+="&",u+=TNT.a.c.v,u+="="+v)}return u+="&",u+=TNT.a.c.w,u+("="+Ob)})};mboxFactory.prototype.lc=function(){document.write('<style id="mboxPreventFlicker">.'+TNT.a.L.Q+" { visibility:hidden; }<\/style>")};mboxFactory.prototype.isDomLoaded=function(){return this.Pb};mboxFactory.prototype.Wb=function(){if(!this.vc){this.vc=[];var ic=this;(function(){var Hc=document.addEventListener?"DOMContentLoaded":"onreadystatechange",Ic=!1,Jc=function(){if(!Ic){Ic=!0;for(var i=0;i<ic.vc.length;++i)ic.vc[i]()}},Kc;document.addEventListener?(document.addEventListener(Hc,function(){document.removeEventListener(Hc,arguments.callee,!1);Jc()},!1),window.addEventListener("load",function(){document.removeEventListener("load",arguments.callee,!1);Jc()},!1)):document.attachEvent&&(self!==self.top?document.attachEvent(Hc,function(){document.readyState==="complete"&&(document.detachEvent(Hc,arguments.callee),Jc())}):(Kc=function(){try{document.documentElement.doScroll("left");Jc()}catch(Lc){setTimeout(Kc,13)}},Kc()));document.readyState==="complete"&&Jc()})()}};mboxSignaler=function(Mc){this.Nc=document;this.Mc=Mc};mboxSignaler.prototype.signal=function(Oc,x){var Pc,jc,pb;this.Mc.isEnabled()&&(Pc=this.Qc(this.Mc.Bc(x)),this.Rc(this.Nc.body,Pc),jc=this.Mc.create(x,mboxShiftArray(arguments),Pc),pb=jc.getUrlBuilder(),pb.addParameter(TNT.a.c.d,mboxGenerateId()),jc.load())};mboxSignaler.prototype.Qc=function(Sc){var db=this.Nc.createElement("DIV");return db.id=Sc,db.style.visibility="hidden",db.style.display="none",db};mboxSignaler.prototype.Rc=function(Tc,Uc){Tc.appendChild(Uc)};mboxList=function(){this.Qb=[]};mboxList.prototype.add=function(jc){var T=TNT.a.T;T.U(jc)||T.W(jc)||(this.Qb[this.Qb.length]=jc)};mboxList.prototype.get=function(x){for(var jc,db=new mboxList,wb=0;wb<this.Qb.length;wb++)jc=this.Qb[wb],jc.getName()==x&&db.add(jc);return db};mboxList.prototype.getById=function(Vc){return this.Qb[Vc]};mboxList.prototype.length=function(){return this.Qb.length};mboxList.prototype.each=function(Bb){if(typeof Bb!="function")throw"Action must be a function, was: "+typeof Bb;for(var wb=0;wb<this.Qb.length;wb++)Bb(this.Qb[wb])};mboxLocatorDefault=function(Wc){this.Wc=Wc;document.write('<div id="'+this.Wc+'" style="visibility:hidden;display:none">&nbsp;<\/div>')};mboxLocatorDefault.prototype.locate=function(){for(var Uc=document.getElementById(this.Wc);Uc;){if(Uc.nodeType==1&&Uc.className=="mboxDefault")return Uc;Uc=Uc.previousSibling}return null};mboxLocatorDefault.prototype.force=function(){var Yc=document.createElement("div"),Zc;return Yc.className="mboxDefault",Zc=document.getElementById(this.Wc),Zc&&Zc.parentNode.insertBefore(Yc,Zc),Yc};mboxLocatorNode=function(Uc){this.Uc=Uc};mboxLocatorNode.prototype.locate=function(){return typeof this.Uc=="string"?document.getElementById(this.Uc):this.Uc};mboxLocatorNode.prototype.force=function(){return null};mboxCreate=function(x){var jc=mboxFactoryDefault.create(x,mboxShiftArray(arguments));return jc&&mboxFactoryDefault.isEnabled()&&jc.load(),jc};mboxDefine=function(yc,x){return mboxFactoryDefault.create(x,mboxShiftArray(mboxShiftArray(arguments)),yc)};mboxUpdate=function(x){mboxFactoryDefault.update(x,mboxShiftArray(arguments))};mbox=function(vb,Sc,pb,_c,ad,Mc){this.bd=null;this.cd=0;this.Ac=_c;this.ad=ad;this.dd=null;this.ed=new mboxOfferContent;this.Yc=null;this.pb=pb;this.message="";this.fd={};this.gd=0;this.Sc=Sc;this.vb=vb;this.hd();pb.addParameter(TNT.a.c.x,vb);pb.addParameter(TNT.a.c.y,Sc);this.id=function(){};this.jd=function(){};this.kd=null;this.ld=document.documentMode>=10&&!Mc.isDomLoaded();this.ld&&(this.md=TNT.a.nestedMboxes,this.md.push(this.vb))};mbox.prototype.getId=function(){return this.Sc};mbox.prototype.hd=function(){var maxLength=TNT.a.L.S;if(this.vb.length>maxLength)throw"Mbox Name "+this.vb+" exceeds max length of "+maxLength+" characters.";else if(this.vb.match(/^\s+|\s+$/g))throw"Mbox Name "+this.vb+" has leading/trailing whitespace(s).";};mbox.prototype.getName=function(){return this.vb};mbox.prototype.getParameters=function(){for(var sb=this.pb.getParameters(),db=[],wb=0;wb<sb.length;wb++)sb[wb].name.indexOf("mbox")!==0&&(db[db.length]=sb[wb].name+"="+sb[wb].value);return db};mbox.prototype.setOnLoad=function(Bb){return this.jd=Bb,this};mbox.prototype.setMessage=function(Dc){return this.message=Dc,this};mbox.prototype.setOnError=function(id){return this.id=id,this};mbox.prototype.setFetcher=function(nd){return this.dd&&this.dd.cancel(),this.dd=nd,this};mbox.prototype.getFetcher=function(){return this.dd};mbox.prototype.load=function(sb){var pb,ic;return this.dd===null?this:(this.setEventTime("load.start"),this.cancelTimeout(),this.cd=0,pb=sb&&sb.length>0?this.pb.clone().addParameters(sb):this.pb,this.dd.fetch(pb),ic=this,this.od=setTimeout(function(){ic.id("browser timeout",ic.dd.getType())},TNT.a.b.mboxTimeout),this.setEventTime("load.end"),mboxTokens.overrideDocumentWrite(),this)};mbox.prototype.loaded=function(ignoreReset){if(ignoreReset!==!0&&mboxTokens.resetDocumentWrite(),this.cancelTimeout(),!this.activate()){var ic=this;setTimeout(function(){ic.loaded(!0)},TNT.a.b.mboxLoadedTimeout)}};mbox.prototype.activate=function(){return this.cd?this.cd:(this.setEventTime("activate"+ ++this.gd+".start"),this.ld&&this.md[this.md.length-1]!==this.vb)?this.cd:(this.show()&&(this.cancelTimeout(),this.cd=1),this.setEventTime("activate"+this.gd+".end"),this.ld&&this.md.pop(),this.cd)};mbox.prototype.isActivated=function(){return this.cd};mbox.prototype.setOffer=function(ed){var pd=ed&&ed.show&&ed.setOnLoad,qd,rd;if(!pd)throw"Invalid offer";return(qd=TNT.a.b.globalMboxName===this.vb,qd=qd&&ed instanceof mboxOfferDefault,qd=qd&&this.dd!==null,qd=qd&&this.dd.getType()==="ajax",!qd)?(this.ed=ed,this):(rd=this.ed.jd,this.ed=ed,this.ed.setOnLoad(rd),this)};mbox.prototype.getOffer=function(){return this.ed};mbox.prototype.show=function(){this.setEventTime("show.start");var db=this.ed.show(this);return this.setEventTime(db==1?"show.end.ok":"show.end"),db};mbox.prototype.showContent=function(sd){return mbox.td(sd)?(this.Yc=mbox.ud(this,this.Yc),this.Yc===null)?0:mbox.vd(document.body,this.Yc)?this.Yc===sd?(this.wd(this.Yc),this.jd(),1):(this.xd(this.Yc),this.xd(sd),mbox.yd(this,sd),this.wd(this.Yc),this.jd(),1):0:0};mbox.td=function(sd){return sd!==undefined&&sd!==null};mbox.vd=function(zd,Ad){var Bd=zd.contains!==undefined;return Bd?zd!==Ad&&zd.contains(Ad):Boolean(zd.compareDocumentPosition(Ad)&16)};mbox.ud=function(jc,Yc){return Yc!==undefined&&Yc!==null&&mbox.vd(document.body,Yc)?Yc:jc.getDefaultDiv()};mbox.yd=function(jc,Cd){jc.Yc.parentNode.replaceChild(Cd,jc.Yc);jc.Yc=Cd};mbox.prototype.hide=function(){this.setEventTime("hide.start");var db=this.showContent(this.getDefaultDiv());return this.setEventTime(db==1?"hide.end.ok":"hide.end.fail"),db};mbox.prototype.finalize=function(){this.setEventTime("finalize.start");this.cancelTimeout();this.getDefaultDiv()||(this.Ac.force()?this.setMessage("No default content, an empty one has been added"):this.setMessage("Unable to locate mbox"));this.activate()||(this.hide(),this.setEventTime("finalize.end.hide"));this.setEventTime("finalize.end.ok")};mbox.prototype.cancelTimeout=function(){this.od&&clearTimeout(this.od);this.dd&&this.dd.cancel()};mbox.prototype.getDiv=function(){return this.Yc};mbox.prototype.getDefaultDiv=function(){return this.kd===null&&(this.kd=this.Ac.locate()),this.kd};mbox.prototype.setEventTime=function(Dd){this.fd[Dd]=(new Date).getTime()};mbox.prototype.getEventTimes=function(){return this.fd};mbox.prototype.getImportName=function(){return this.ad};mbox.prototype.getURL=function(){return this.pb.buildUrl()};mbox.prototype.getUrlBuilder=function(){return this.pb};mbox.prototype.Ed=function(Yc){return Yc.style.display!="none"};mbox.prototype.wd=function(Yc){this.Fd(Yc,!0)};mbox.prototype.xd=function(Yc){this.Fd(Yc,!1)};mbox.prototype.Fd=function(Yc,Gd){Yc.style.visibility=Gd?"visible":"hidden";Yc.style.display=Gd?"block":"none"};mbox.prototype.kc=function(){this.ld=!1};mbox.prototype.relocateDefaultDiv=function(){this.kd=this.Ac.locate()};mboxOfferContent=function(){this.jd=function(){}};mboxOfferContent.prototype.show=function(jc){var db=jc.showContent(document.getElementById(jc.getImportName()));return db==1&&this.jd(),db};mboxOfferContent.prototype.setOnLoad=function(jd){this.jd=jd};mboxOfferAjax=function(sd){this.sd=sd;this.jd=function(){}};mboxOfferAjax.prototype.setOnLoad=function(jd){this.jd=jd};mboxOfferAjax.prototype.show=function(jc){var Hd=document.createElement("div"),db;return Hd.id=jc.getImportName(),Hd.innerHTML=this.sd,db=jc.showContent(Hd),db==1&&this.jd(),db};mboxOfferDefault=function(){this.jd=function(){}};mboxOfferDefault.prototype.setOnLoad=function(jd){this.jd=jd};mboxOfferDefault.prototype.show=function(jc){var db=jc.hide();return db==1&&this.jd(),db};mboxCookieManager=function(vb,Id){this.vb=vb;this.Id=Id===""||Id.indexOf(".")===-1?"":"; domain="+Id;this.Jd=new mboxMap;this.loadCookies()};mboxCookieManager.prototype.isEnabled=function(){return this.setCookie(TNT.a.H.J,"true",60),this.loadCookies(),this.getCookie(TNT.a.H.J)=="true"};mboxCookieManager.prototype.setCookie=function(vb,V,oc){if(typeof vb!="undefined"&&typeof V!="undefined"&&typeof oc!="undefined"){var Kd={};Kd.name=vb;Kd.value=encodeURIComponent(V);Kd.expireOn=Math.ceil(oc+(new Date).getTime()/1e3);this.Jd.put(vb,Kd);this.saveCookies()}};mboxCookieManager.prototype.getCookie=function(vb){var Kd=this.Jd.get(vb);return Kd?decodeURIComponent(Kd.value):null};mboxCookieManager.prototype.deleteCookie=function(vb){this.Jd.remove(vb);this.saveCookies()};mboxCookieManager.prototype.getCookieNames=function(Ld){var Md=[];return this.Jd.each(function(vb){vb.indexOf(Ld)===0&&(Md[Md.length]=vb)}),Md};mboxCookieManager.prototype.saveCookies=function(){var Nd=TNT.a.b.crossDomainXOnly,Od=TNT.a.H.D,Pd=[],Qd=0,Rd,Sd;this.Jd.each(function(vb,Kd){Nd&&vb!==Od||(Pd[Pd.length]=vb+"#"+Kd.value+"#"+Kd.expireOn,Qd<Kd.expireOn&&(Qd=Kd.expireOn))});Rd=new Date(Qd*1e3);Sd=[];Sd.push(this.vb,"=",Pd.join("|"));TNT.a.b.usePersistentCookies&&Sd.push("; expires=",Rd.toGMTString());Sd.push("; path=/",this.Id);document.cookie=Sd.join("")};mboxCookieManager.prototype.loadCookies=function(){var Td,Ud,Vd,Wd,wb,Kd,Xd;if(this.Jd=new mboxMap,Td=document.cookie.indexOf(this.vb+"="),Td!=-1)for(Ud=document.cookie.indexOf(";",Td),Ud==-1&&(Ud=document.cookie.indexOf(",",Td),Ud==-1&&(Ud=document.cookie.length)),Vd=document.cookie.substring(Td+this.vb.length+1,Ud).split("|"),Wd=Math.ceil((new Date).getTime()/1e3),wb=0;wb<Vd.length;wb++)Kd=Vd[wb].split("#"),Wd<=Kd[2]&&(Xd={},Xd.name=Kd[0],Xd.value=Kd[1],Xd.expireOn=Kd[2],this.Jd.put(Xd.name,Xd))};mboxSession=function(Yd,Zd,Ub,_d,Vb){this.Zd=Zd;this.Ub=Ub;this._d=_d;this.Vb=Vb;this.Sc=typeof mboxForceSessionId!="undefined"?mboxForceSessionId:mboxGetPageParameter(this.Zd,!0);(this.Sc===null||this.Sc.length===0)&&(this.Sc=Vb.getCookie(Ub),(this.Sc===null||this.Sc.length===0)&&(this.Sc=Yd));this.Vb.setCookie(Ub,this.Sc,_d)};mboxSession.prototype.getId=function(){return this.Sc};mboxSession.prototype.forceId=function(nc){this.Sc=nc;this.Vb.setCookie(this.Ub,this.Sc,this._d)};mboxPC=function(Ub,_d,Vb){this.Ub=Ub;this._d=_d;this.Vb=Vb;this.Sc=typeof mboxForcePCId!="undefined"?mboxForcePCId:Vb.getCookie(Ub);this.Sc&&Vb.setCookie(Ub,this.Sc,_d)};mboxPC.prototype.getId=function(){return this.Sc};mboxPC.prototype.forceId=function(nc){return this.Sc!=nc?(this.Sc=nc,this.Vb.setCookie(this.Ub,this.Sc,this._d),!0):!1};mboxGetPageParameter=function(vb,ae){var be,db,ce;return ae=ae||!1,be=ae?new RegExp("\\?[^#]*"+vb+"=([^&;#]*)","i"):new RegExp("\\?[^#]*"+vb+"=([^&;#]*)"),db=null,ce=be.exec(document.location),ce&&ce.length>=2&&(db=ce[1]),db};mboxSetCookie=function(vb,V,oc){return mboxFactoryDefault.getCookieManager().setCookie(vb,V,oc)};mboxGetCookie=function(vb){return mboxFactoryDefault.getCookieManager().getCookie(vb)};mboxCookiePageDomain=function(){var Id=/([^:]*)(:[0-9]{0,5})?/.exec(document.location.host)[1],ee;return/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/.exec(Id)||(ee=/([^\.]+\.[^\.]{3}|[^\.]+\.[^\.]+\.[^\.]{2})$/.exec(Id),ee&&(Id=ee[0],Id.indexOf("www.")===0&&(Id=Id.substr(4)))),Id?Id:""};mboxShiftArray=function(fe){for(var db=[],wb=1;wb<fe.length;wb++)db[db.length]=fe[wb];return db};mboxGenerateId=function(){return(new Date).getTime()+"-"+Math.floor(Math.random()*999999)};mboxScreenHeight=function(){return screen.height};mboxScreenWidth=function(){return screen.width};mboxBrowserWidth=function(){return window.innerWidth?window.innerWidth:document.documentElement?document.documentElement.clientWidth:document.body.clientWidth};mboxBrowserHeight=function(){return window.innerHeight?window.innerHeight:document.documentElement?document.documentElement.clientHeight:document.body.clientHeight};mboxBrowserTimeOffset=function(){return-(new Date).getTimezoneOffset()};mboxScreenColorDepth=function(){return screen.pixelDepth};mboxVizTargetUrl=function(x){var sb;if(mboxFactoryDefault.isEnabled()){var c=TNT.a.c,P=TNT.a.L.P,rb=TNT.a.b.clientCode,zc=new Date,ge=zc.getTimezoneOffset()*P,pb=mboxFactoryDefault.getUrlBuilder().clone();return pb.setBasePath("/m2/"+rb+"/viztarget"),pb.addParameter(c.x,x),pb.addParameter(c.y,0),pb.addParameter(c.j,mboxFactoryDefault.getMboxes().length()+1),pb.addParameter(c.A,zc.getTime()-ge),pb.addParameter(c.d,mboxGenerateId()),pb.addParameter(c.z,mboxFactoryDefault.isDomLoaded()),sb=mboxShiftArray(arguments),sb&&sb.length>0&&pb.addParameters(sb),mboxFactoryDefault.wc(pb),mboxFactoryDefault.xc(pb,x),mboxFactoryDefault.setVisitorIdParameters(pb,x),pb.buildUrl()}};TNT.createGlobalMbox=function(){var he=TNT.getGlobalMboxName(),ie=TNT.getGlobalMboxLocation(),je,ke,le,me;ie||(ie="mbox-"+he+"-"+mboxGenerateId(),je=document.createElement("div"),je.className="mboxDefault",je.id=ie,je.style.visibility="hidden",je.style.display="none",ke=setInterval(function(){document.body&&(clearInterval(ke),document.body.insertBefore(je,document.body.firstChild))},TNT.a.b.bodyPollingTimeout));le=TNT.getTargetPageParameters();me=mboxFactoryDefault.create(he,le,ie);me&&mboxFactoryDefault.isEnabled()&&(me.setFetcher(new TNT.a.ob),me.load())};TNT.a.ne=function(Vb,oe,pe){return mboxGetPageParameter(oe,!0)||Vb.getCookie(pe)};TNT.a.qe=function(b){setTimeout(function(){typeof mboxDebugLoaded=="undefined"&&alert("Could not load the remote debug.\nPlease check your connection to "+b.companyName+" servers")},3600);var u=b.adminUrl+"/mbox/mbox_debug.jsp?mboxServerHost="+b.serverHost+"&clientCode="+b.clientCode;document.write('<script src="'+u+'"><\/script>')};TNT.a.re=function(b){var T=TNT.a.T;return!T.U(b)&&!T.W(b)&&T.bb(b)};TNT.a.se=function(b,te){var T=TNT.a.T,ue,ve,V;for(var nb in b)ue=b.hasOwnProperty(nb)&&te.hasOwnProperty(nb),V=b[nb],ve=!T.U(V)&&!T.W(V),ue&&ve&&(te[nb]=V);return te};TNT.a.we=function(){var b=window.targetGlobalSettings;TNT.a.re(b)&&(TNT.a.b=TNT.a.se(b,TNT.a.b));var Ob=TNT.a.b.mboxVersion,xe=TNT.a.b.serverHost,rb=TNT.a.b.clientCode,M=TNT.a.L.M,oe=TNT.a.C.G,pe=TNT.a.H.G;typeof mboxVersion=="undefined"&&(window.mboxFactories=new mboxMap,window.mboxFactoryDefault=new mboxFactory(xe,rb,M),window.mboxVersion=Ob);TNT.a.ne(mboxFactoryDefault.getCookieManager(),oe,pe)&&TNT.a.qe(TNT.a.b)};TNT.a.we();TNT.isAutoCreateGlobalMbox()&&TNT.createGlobalMbox();
/**
 * @license
 * lodash 4.6.1 (Custom Build) lodash.com/license | Underscore.js 1.8.3 underscorejs.org/LICENSE
 * Build: `lodash core -o ./dist/lodash.core.js`
 */
(function(){function n(n,t){for(var r=-1,e=t.length,u=n.length;++r<e;)n[u+r]=t[r];return n}function t(n,t,r){for(var o,i,c,f,e=-1,u=n.length;++e<u;)o=n[e],i=t(o),null!=i&&(c===an?i===i:r(i,c))&&(c=i,f=o);return f}function r(n,t,r){var e;return r(n,function(n,r,u){if(t(n,r,u))return(e=n,!1)}),e}function e(n,t,r,e,u){return u(n,function(n,u,o){r=e?(e=!1,n):t(r,n,u,o)}),r}function u(n,t){return O(t,function(t){return n[t]})}function o(n){return n&&n.Object===Object?n:null}function i(n){return vn[n]}function c(n){var t=!1;if(null!=n&&typeof n.toString!="function")try{t=!!(n+"")}catch(r){}return t}function f(n,t){return n=typeof n=="number"||hn.test(n)?+n:-1,n>-1&&0==n%1&&(null==t?9007199254740991:t)>n}function a(n){if(Y(n)&&!Pn(n)){if(n instanceof l)return n;if(An.call(n,"__wrapped__")){var t=new l(n.__wrapped__,n.__chain__);return t.__actions__=N(n.__actions__),t}}return new l(n)}function l(n,t){this.__wrapped__=n;this.__actions__=[];this.__chain__=!!t}function p(n,t,r,e){var u;return(u=n===an)||(u=xn[r],u=(n===u||n!==n&&u!==u)&&!An.call(e,r)),u?t:n}function s(n){return X(n)?Fn(n):{}}function h(n,t,r){if(typeof n!="function")throw new TypeError("Expected a function");return setTimeout(function(){n.apply(an,r)},t)}function v(n,t){var r=!0;return $n(n,function(n,e,u){return r=!!t(n,e,u)}),r}function y(n,t){var r=[];return $n(n,function(n,e,u){t(n,e,u)&&r.push(n)}),r}function _(t,r,e,u){var o,i,c;for(u||(u=[]),o=-1,i=t.length;++o<i;)c=t[o],r>0&&Y(c)&&L(c)&&(e||Pn(c)||K(c))?r>1?_(c,r-1,e,u):n(u,c):e||(u[u.length]=c);return u}function b(n,t){return n&&qn(n,t,en)}function g(n,t){return y(t,function(t){return Q(n[t])})}function j(n,t,r,e,u){return n===t?!0:null==n||null==t||!X(n)&&!Y(t)?n!==n&&t!==t:d(n,t,j,r,e,u)}function d(n,t,r,e,u,o){var i=Pn(n),f=Pn(t),a="[object Array]",l="[object Array]",s;i||(a=kn.call(n),a="[object Arguments]"==a?"[object Object]":a);f||(l=kn.call(t),l="[object Arguments]"==l?"[object Object]":l);var p="[object Object]"==a&&!c(n),f="[object Object]"==l&&!c(t),l=a==l;return o||(o=[]),s=J(o,function(t){return t[0]===n}),s&&s[1]?s[1]==t:(o.push([n,t]),l&&!p?(t=i||isTypedArray(n)?I(n,t,r,e,u,o):$(n,t,a),o.pop(),t):2&u||(i=p&&An.call(n,"__wrapped__"),a=f&&An.call(t,"__wrapped__"),!i&&!a)?l?(t=q(n,t,r,e,u,o),o.pop(),t):!1:(t=r(i?n.value():n,a?t.value():t,e,u,o),o.pop(),t))}function m(n){var t=typeof n;return"function"==t?n:null==n?cn:("object"==t?x:E)(n)}function w(n){n=null==n?n:Object(n);var t,r=[];for(t in n)r.push(t);return r}function O(n,t){var r=-1,e=L(n)?Array(n.length):[];return $n(n,function(n,u,o){e[++r]=t(n,u,o)}),e}function x(n){var t=en(n);return function(r){var e=t.length,u;if(null==r)return!e;for(r=Object(r);e--;)if(u=t[e],!(u in r&&j(n[u],r[u],an,3)))return!1;return!0}}function A(n,t){return n=Object(n),P(t,function(t,r){return r in n&&(t[r]=n[r]),t},{})}function E(n){return function(t){return null==t?an:t[n]}}function k(n,t,r){var e=-1,u=n.length;for(0>t&&(t=-t>u?0:u+t),r=r>u?u:r,0>r&&(r+=u),u=t>r?0:r-t>>>0,t>>>=0,r=Array(u);++e<u;)r[e]=n[e+t];return r}function N(n){return k(n,0,n.length)}function S(n,t){var r;return $n(n,function(n,e,u){return r=t(n,e,u),!r}),!!r}function T(t,r){return P(r,function(t,r){return r.func.apply(r.thisArg,n([t],r.args))},t)}function F(n,t,r,e){var u,o;for(r||(r={}),u=-1,o=t.length;++u<o;){var i=t[u],c=e?e(r[i],n[i],i,r,n):n[i],f=r,a=f[i];An.call(f,i)&&(a===c||a!==a&&c!==c)&&(c!==an||i in f)||(f[i]=c)}return r}function R(n){return V(function(t,r){var e=-1,u=r.length,o=u>1?r[u-1]:an,o=typeof o=="function"?(u--,o):an,i;for(t=Object(t);++e<u;)i=r[e],i&&n(t,i,e,o);return t})}function B(n){return function(){var t=arguments,r=s(n.prototype),t=n.apply(r,t);return X(t)?t:r}}function D(n,t,r){function e(){for(var o=-1,i=arguments.length,c=-1,f=r.length,a=Array(f+i),l=this&&this!==wn&&this instanceof e?u:n;++c<f;)a[c]=r[c];for(;i--;)a[c++]=arguments[++o];return l.apply(t,a)}if(typeof n!="function")throw new TypeError("Expected a function");var u=B(n);return e}function I(n,t,r,e,u,o){var i=-1,c=1&u,f=n.length,a=t.length,l,p;if(f!=a&&!(2&u&&a>f))return!1;for(a=!0;++i<f;){if(l=n[i],p=t[i],void 0!==an){a=!1;break}if(c){if(!S(t,function(n){return l===n||r(l,n,e,u,o)})){a=!1;break}}else if(l!==p&&!r(l,p,e,u,o)){a=!1;break}}return a}function $(n,t,r){switch(r){case"[object Boolean]":case"[object Date]":return+n==+t;case"[object Error]":return n.name==t.name&&n.message==t.message;case"[object Number]":return n!=+n?t!=+t:n==+t;case"[object RegExp]":case"[object String]":return n==t+""}return!1}function q(n,t,r,e,u,o){var i=2&u,c=en(n),f=c.length,a=en(t).length,l,p;if(f!=a&&!i)return!1;for(l=f;l--;)if(p=c[l],!(i?p in t:An.call(t,p)))return!1;for(a=!0;++l<f;){var p=c[l],s=n[p],h=t[p];if(void 0!==an||s!==h&&!r(s,h,e,u,o)){a=!1;break}i||(i="constructor"==p)}return a&&!i&&(r=n.constructor,e=t.constructor,r!=e&&"constructor"in n&&"constructor"in t&&!(typeof r=="function"&&r instanceof r&&typeof e=="function"&&e instanceof e)&&(a=!1)),a}function z(n){var t=n?n.length:an,r,e;if(W(t)&&(Pn(n)||nn(n)||K(n))){for(n=String,r=-1,e=Array(t);++r<t;)e[r]=n(r);t=e}else t=null;return t}function C(n){var t=n&&n.constructor;return n===(typeof t=="function"&&t.prototype||xn)}function G(n){return n?n[0]:an}function J(n,t){return r(n,m(t),$n)}function M(n,t){return $n(n,typeof t=="function"?t:cn)}function P(n,t,r){return e(n,m(t),r,3>arguments.length,$n)}function U(n,t){var r;if(typeof t!="function")throw new TypeError("Expected a function");return n=Un(n),function(){return 0<--n&&(r=t.apply(this,arguments)),1>=n&&(t=an),r}}function V(n){var t;if(typeof n!="function")throw new TypeError("Expected a function");return t=In(t===an?n.length-1:Un(t),0),function(){for(var r=arguments,e=-1,u=In(r.length-t,0),o=Array(u);++e<u;)o[e]=r[t+e];for(u=Array(t+1),e=-1;++e<t;)u[e]=r[e];return u[t]=o,n.apply(this,u)}}function H(n,t){return n>t}function K(n){return Y(n)&&L(n)&&An.call(n,"callee")&&(!Rn.call(n,"callee")||"[object Arguments]"==kn.call(n))}function L(n){return null!=n&&W(zn(n))&&!Q(n)}function Q(n){return n=X(n)?kn.call(n):"","[object Function]"==n||"[object GeneratorFunction]"==n}function W(n){return typeof n=="number"&&n>-1&&0==n%1&&9007199254740991>=n}function X(n){var t=typeof n;return!!n&&("object"==t||"function"==t)}function Y(n){return!!n&&typeof n=="object"}function Z(n){return typeof n=="number"||Y(n)&&"[object Number]"==kn.call(n)}function nn(n){return typeof n=="string"||!Pn(n)&&Y(n)&&"[object String]"==kn.call(n)}function tn(n,t){return t>n}function rn(n){return typeof n=="string"?n:null==n?"":n+""}function en(n){var t=C(n);if(!t&&!L(n))return Dn(Object(n));var r,e=z(n),u=!!e,e=e||[],o=e.length;for(r in n)!An.call(n,r)||u&&("length"==r||f(r,o))||t&&"constructor"==r||e.push(r);return e}function un(n){for(var a,t=-1,r=C(n),e=w(n),u=e.length,o=z(n),i=!!o,o=o||[],c=o.length;++t<u;)a=e[t],i&&("length"==a||f(a,c))||"constructor"==a&&(r||!An.call(n,a))||o.push(a);return o}function on(n){return n?u(n,en(n)):[]}function cn(n){return n}function fn(t,r,e){var u=en(r),o=g(r,u),i,c;return null!=e||X(r)&&(o.length||!u.length)||(e=r,r=t,t=this,o=g(r,en(r))),i=X(e)&&"chain"in e?e.chain:!0,c=Q(t),$n(o,function(e){var u=r[e];t[e]=u;c&&(t.prototype[e]=function(){var r=this.__chain__,e;return i||r?(e=t(this.__wrapped__),(e.__actions__=N(this.__actions__)).push({func:u,args:arguments,thisArg:t}),e.__chain__=r,e):u.apply(t,n([this.value()],arguments))})}),t}var an,ln=1/0,pn=/[&<>"'`]/g,sn=RegExp(pn.source),hn=/^(?:0|[1-9]\d*)$/,vn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},yn={"function":!0,object:!0},_n=yn[typeof exports]&&exports&&!exports.nodeType?exports:an,bn=yn[typeof module]&&module&&!module.nodeType?module:an,gn=bn&&bn.exports===_n?_n:an,jn=o(yn[typeof self]&&self),dn=o(yn[typeof window]&&window),mn=o(yn[typeof this]&&this),wn=o(_n&&bn&&typeof global=="object"&&global)||dn!==(mn&&mn.window)&&dn||jn||mn||Function("return this")(),On=Array.prototype,xn=Object.prototype,An=xn.hasOwnProperty,En=0,kn=xn.toString,Nn=wn._,Sn=wn.Reflect,Tn=Sn?Sn.f:an,Fn=Object.create,Rn=xn.propertyIsEnumerable,Bn=wn.isFinite,Dn=Object.keys,In=Math.max,$n=function(n,t){return function(r,e){if(null==r)return r;if(!L(r))return n(r,e);for(var u=r.length,o=t?u:-1,i=Object(r);(t?o--:++o<u)&&!1!==e(i[o],o,i););return r}}(b),qn=function(n){return function(t,r,e){var u=-1,o=Object(t),i,c;for(e=e(t),i=e.length;i--;)if(c=e[n?i:++u],!1===r(o[c],c,o))break;return t}}();Tn&&!Rn.call({valueOf:1},"valueOf")&&(w=function(n){n=Tn(n);for(var t,r=[];!(t=n.next()).done;)r.push(t.value);return r});var zn=E("length"),Cn=V(function(t,r){return Pn(t)||(t=null==t?[]:[Object(t)]),_(r,1),n(N(t),on)}),Gn=V(function(n,t,r){return D(n,t,r)}),Jn=V(function(n,t){return h(n,1,t)}),Mn=V(function(n,t,r){return h(n,Vn(t)||0,r)}),Pn=Array.isArray,Un=Number,Vn=Number,Hn=R(function(n,t){F(t,en(t),n)}),Kn=R(function(n,t){F(t,un(t),n)}),Ln=R(function(n,t,r,e){F(t,un(t),n,e)}),Qn=V(function(n){return n.push(an,p),Ln.apply(an,n)}),Wn=V(function(n,t){return null==n?{}:A(n,_(t,1))}),Xn=m;l.prototype=s(a.prototype);l.prototype.constructor=l;a.assignIn=Kn;a.before=U;a.bind=Gn;a.chain=function(n){return n=a(n),n.__chain__=!0,n};a.compact=function(n){return y(n,Boolean)};a.concat=Cn;a.create=function(n,t){var r=s(n);return t?Hn(r,t):r};a.defaults=Qn;a.defer=Jn;a.delay=Mn;a.filter=function(n,t){return y(n,m(t))};a.flatten=function(n){return n&&n.length?_(n,1):[]};a.flattenDeep=function(n){return n&&n.length?_(n,ln):[]};a.iteratee=Xn;a.keys=en;a.map=function(n,t){return O(n,m(t))};a.matches=function(n){return x(Hn({},n))};a.mixin=fn;a.negate=function(n){if(typeof n!="function")throw new TypeError("Expected a function");return function(){return!n.apply(this,arguments)}};a.once=function(n){return U(2,n)};a.pick=Wn;a.slice=function(n,t,r){var e=n?n.length:0;return r=r===an?e:+r,e?k(n,null==t?0:+t,r):[]};a.sortBy=function(n,t){var r=0;return t=m(t),O(O(n,function(n,e,u){return{c:n,b:r++,a:t(n,e,u)}}).sort(function(n,t){var r,e;n:{if(r=n.a,e=t.a,r!==e){var u=null===r,o=r===an,i=r===r,c=null===e,f=e===an,a=e===e;if(r>e&&!c||!i||u&&!f&&a||o&&a){r=1;break n}if(e>r&&!u||!a||c&&!o&&i||f&&i){r=-1;break n}}r=0}return r||n.b-t.b}),E("c"))};a.tap=function(n,t){return t(n),n};a.thru=function(n,t){return t(n)};a.toArray=function(n){return L(n)?n.length?N(n):[]:on(n)};a.values=on;a.extend=Kn;fn(a,a);a.clone=function(n){return X(n)?Pn(n)?N(n):F(n,en(n)):n};a.escape=function(n){return(n=rn(n))&&sn.test(n)?n.replace(pn,i):n};a.every=function(n,t,r){return t=r?an:t,v(n,m(t))};a.find=J;a.forEach=M;a.has=function(n,t){return null!=n&&An.call(n,t)};a.head=G;a.identity=cn;a.indexOf=function(n,t,r){var e=n?n.length:0,u,o;for(r=typeof r=="number"?0>r?In(e+r,0):r:0,r=(r||0)-1,u=t===t;++r<e;)if(o=n[r],u?o===t:o!==o)return r;return-1};a.isArguments=K;a.isArray=Pn;a.isBoolean=function(n){return!0===n||!1===n||Y(n)&&"[object Boolean]"==kn.call(n)};a.isDate=function(n){return Y(n)&&"[object Date]"==kn.call(n)};a.isEmpty=function(n){if(L(n)&&(Pn(n)||nn(n)||Q(n.splice)||K(n)))return!n.length;for(var t in n)if(An.call(n,t))return!1;return!0};a.isEqual=function(n,t){return j(n,t)};a.isFinite=function(n){return typeof n=="number"&&Bn(n)};a.isFunction=Q;a.isNaN=function(n){return Z(n)&&n!=+n};a.isNull=function(n){return null===n};a.isNumber=Z;a.isObject=X;a.isRegExp=function(n){return X(n)&&"[object RegExp]"==kn.call(n)};a.isString=nn;a.isUndefined=function(n){return n===an};a.last=function(n){var t=n?n.length:0;return t?n[t-1]:an};a.max=function(n){return n&&n.length?t(n,cn,H):an};a.min=function(n){return n&&n.length?t(n,cn,tn):an};a.noConflict=function(){return wn._===this&&(wn._=Nn),this};a.noop=function(){};a.reduce=P;a.result=function(n,t,r){return t=null==n?an:n[t],t===an&&(t=r),Q(t)?t.call(n):t};a.size=function(n){return null==n?0:(n=L(n)?n:en(n),n.length)};a.some=function(n,t,r){return t=r?an:t,S(n,m(t))};a.uniqueId=function(n){var t=++En;return rn(n)+t};a.each=M;a.first=G;fn(a,function(){var n={};return b(a,function(t,r){An.call(a.prototype,r)||(n[r]=t)}),n}(),{chain:!1});a.VERSION="4.6.1";$n("pop join replace reverse split push shift sort splice unshift".split(" "),function(n){var t=(/^(?:replace|split)$/.test(n)?String.prototype:On)[n],r=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",e=/^(?:pop|join|replace|shift)$/.test(n);a.prototype[n]=function(){var n=arguments;return e&&!this.__chain__?t.apply(this.value(),n):this[r](function(r){return t.apply(r,n)})}});a.prototype.toJSON=a.prototype.valueOf=a.prototype.value=function(){return T(this.__wrapped__,this.__actions__)};(dn||jn||{})._=a;typeof define=="function"&&typeof define.amd=="object"&&define.amd?define(function(){return a}):_n&&bn?(gn&&((bn.exports=a)._=a),_n._=a):wn._=a}).call(this);
/**
 * @license
 * lodash 4.6.1 (Custom Build) lodash.com/license | Underscore.js 1.8.3 underscorejs.org/LICENSE
 * Build: `lodash -o ./dist/lodash.js`
 */
(function(){function n(n,t){return n.set(t[0],t[1]),n}function t(n,t){return n.add(t),n}function r(n,t,r){switch(r.length){case 0:return n.call(t);case 1:return n.call(t,r[0]);case 2:return n.call(t,r[0],r[1]);case 3:return n.call(t,r[0],r[1],r[2])}return n.apply(t,r)}function e(n,t,r,e){for(var i,u=-1,o=n.length;++u<o;)i=n[u],t(e,i,r(i),n);return e}function u(n,t){for(var r=-1,e=n.length;++r<e&&!1!==t(n[r],r,n););return n}function o(n,t){for(var r=-1,e=n.length;++r<e;)if(!t(n[r],r,n))return!1;return!0}function i(n,t){for(var i,r=-1,e=n.length,u=0,o=[];++r<e;)i=n[r],t(i,r,n)&&(o[u++]=i);return o}function f(n,t){return!!n.length&&-1<d(n,t,0)}function c(n,t,r){for(var e=-1,u=n.length;++e<u;)if(r(t,n[e]))return!0;return!1}function a(n,t){for(var r=-1,e=n.length,u=Array(e);++r<e;)u[r]=t(n[r],r,n);return u}function l(n,t){for(var r=-1,e=t.length,u=n.length;++r<e;)n[u+r]=t[r];return n}function s(n,t,r,e){var u=-1,o=n.length;for(e&&o&&(r=n[++u]);++u<o;)r=t(r,n[u],u,n);return r}function h(n,t,r,e){var u=n.length;for(e&&u&&(r=n[--u]);u--;)r=t(r,n[u],u,n);return r}function p(n,t){for(var r=-1,e=n.length;++r<e;)if(t(n[r],r,n))return!0;return!1}function _(n,t,r){for(var o,i,f,c,e=-1,u=n.length;++e<u;)o=n[e],i=t(o),null!=i&&(f===q?i===i:r(i,f))&&(f=i,c=o);return c}function v(n,t,r,e){var u;return r(n,function(n,r,o){if(t(n,r,o))return(u=e?r:n,!1)}),u}function g(n,t,r){for(var e=n.length,u=r?e:-1;r?u--:++u<e;)if(t(n[u],u,n))return u;return-1}function d(n,t,r){if(t!==t)return C(n,r);--r;for(var e=n.length;++r<e;)if(n[r]===t)return r;return-1}function y(n,t,r,e){--r;for(var u=n.length;++r<u;)if(e(n[r],t))return r;return-1}function b(n,t,r,e,u){return u(n,function(n,u,o){r=e?(e=!1,n):t(r,n,u,o)}),r}function x(n,t){var r=n.length;for(n.sort(t);r--;)n[r]=n[r].c;return n}function j(n,t){for(var r,o,e=-1,u=n.length;++e<u;)o=t(n[e]),o!==q&&(r=r===q?o:r+o);return r}function m(n,t){for(var r=-1,e=Array(n);++r<n;)e[r]=t(r);return e}function w(n,t){return a(t,function(t){return[t,n[t]]})}function A(n){return function(t){return n(t)}}function O(n,t){return a(t,function(t){return n[t]})}function k(n,t){for(var r=-1,e=n.length;++r<e&&-1<d(t,n[r],0););return r}function E(n,t){for(var r=n.length;r--&&-1<d(t,n[r],0););return r}function I(n){return n&&n.Object===Object?n:null}function S(n,t){if(n!==t){var r=null===n,e=n===q,u=n===n,o=null===t,i=t===q,f=t===t;if(n>t&&!o||!u||r&&!i&&f||e&&f)return 1;if(t>n&&!r||!f||o&&!e&&u||i&&u)return-1}return 0}function R(n){return zn[n]}function W(n){return Mn[n]}function B(n){return"\\"+Fn[n]}function C(n,t,r){var e=n.length,u;for(t+=r?0:-1;r?t--:++t<e;)if(u=n[t],u!==u)return t;return-1}function U(n){var t=!1;if(null!=n&&typeof n.toString!="function")try{t=!!(n+"")}catch(r){}return t}function z(n,t){return n=typeof n=="number"||bn.test(n)?+n:-1,n>-1&&0==n%1&&(null==t?9007199254740991:t)>n}function M(n){for(var t,r=[];!(t=n.next()).done;)r.push(t.value);return r}function L(n){var t=-1,r=Array(n.size);return n.forEach(function(n,e){r[++t]=[e,n]}),r}function $(n,t){for(var i,r=-1,e=n.length,u=0,o=[];++r<e;)i=n[r],i!==t&&"__lodash_placeholder__"!==i||(n[r]="__lodash_placeholder__",o[u++]=r);return o}function F(n){var t=-1,r=Array(n.size);return n.forEach(function(n){r[++t]=n}),r}function N(n){if(!n||!In.test(n))return n.length;for(var t=En.lastIndex=0;En.test(n);)t++;return t}function D(n){return Ln[n]}function Z(I){function bn(n){if(we(n)&&!qo(n)&&!(n instanceof On)){if(n instanceof An)return n;if(lu.call(n,"__wrapped__"))return Pr(n)}return new An(n)}function wn(){}function An(n,t){this.__wrapped__=n;this.__actions__=[];this.__chain__=!!t;this.__index__=0;this.__values__=q}function On(n){this.__wrapped__=n;this.__actions__=[];this.__dir__=1;this.__filtered__=!1;this.__iteratees__=[];this.__takeCount__=4294967295;this.__views__=[]}function zn(){}function Mn(n){var t=-1,r=n?n.length:0,e;for(this.clear();++t<r;)e=n[t],this.set(e[0],e[1])}function Ln(n){var t=-1,r=n?n.length:0;for(this.__data__=new Mn;++t<r;)this.push(n[t])}function $n(n,t){var r=n.__data__;return $r(t)?(r=r.__data__,"__lodash_hash_undefined__"===(typeof t=="string"?r.string:r.hash)[t]):r.has(t)}function Fn(n){var t=-1,r=n?n.length:0,e;for(this.clear();++t<r;)e=n[t],this.set(e[0],e[1])}function Zn(n,t){var r=Tn(n,t);return 0>r?!1:(r==n.length-1?n.pop():Iu.call(n,r,1),!0)}function qn(n,t){var r=Tn(n,t);return 0>r?q:n[r][1]}function Tn(n,t){for(var r=n.length;r--;)if(pe(n[r][0],t))return r;return-1}function Kn(n,t,r){var e=Tn(n,t);0>e?n.push([t,r]):n[e][1]=r}function Gn(n,t,r,e){return n===q||pe(n,cu[r])&&!lu.call(e,r)?t:n}function Yn(n,t,r){(r===q||pe(n[t],r))&&(typeof t!="number"||r!==q||t in n)||(n[t]=r)}function Hn(n,t,r){var e=n[t];lu.call(n,t)&&pe(e,r)&&(r!==q||t in n)||(n[t]=r)}function Qn(n,t,r,e){return Qu(n,function(n,u,o){t(e,n,r(n),o)}),e}function Xn(n,t){return n&&tr(t,De(t),n)}function nt(n,t){for(var r=-1,e=null==n,u=t.length,o=Array(u);++r<u;)o[r]=e?q:$e(n,t[r]);return o}function tt(n){return de(n)?n:[]}function rt(n){return typeof n=="function"?n:Ye}function et(n){return qo(n)?n:qr(n)}function ut(n,t,r){return n===n&&(r!==q&&(n=n>r?r:n),t!==q&&(n=t>n?t:n)),n}function ot(n,t,r,e,o,i,f){var c,a,l;if(e&&(c=i?e(n,o,i,f):e(n)),c!==q)return c;if(!me(n))return n;if(o=qo(n)){if(c=Br(n),!t)return nr(n,c)}else{if(a=Rr(n),l="[object Function]"==a||"[object GeneratorFunction]"==a,Po(n))return Yt(n,t);if("[object Object]"==a||"[object Arguments]"==a||l&&!i){if(U(n))return i?n:{};if(c=Cr(l?{}:n),!t)return c=Xn(c,n),r?er(n,c):c}else{if(!Un[a])return i?n:{};c=Ur(n,a,t)}}return f||(f=new Fn),(i=f.get(n))?i:(f.set(n,c),(o?u:_t)(n,function(u,o){Hn(c,o,ot(u,t,r,e,o,n,f))}),r&&!o?er(n,c):c)}function it(n){var t=De(n),r=t.length;return function(e){var u;if(null==e)return!r;for(u=r;u--;){var o=t[u],i=n[o],f=e[o];if(f===q&&!(o in Object(e))||!i(f))return!1}return!0}}function ft(n){return me(n)?Ou(n):{}}function ct(n,t,r){if(typeof n!="function")throw new iu("Expected a function");return Eu(function(){n.apply(q,r)},t)}function at(n,t,r,e){var u=-1,o=f,i=!0,l=n.length,s=[],h=t.length,p,_,v;if(!l)return s;r&&(t=a(t,A(r)));e?(o=c,i=!1):t.length>=200&&(o=$n,i=!1,t=new Ln(t));n:for(;++u<l;)if(p=n[u],_=r?r(p):p,i&&_===_){for(v=h;v--;)if(t[v]===_)continue n;s.push(p)}else o(t,_,e)||s.push(p);return s}function lt(n,t){var r=!0;return Qu(n,function(n,e,u){return r=!!t(n,e,u)}),r}function st(n,t){var r=[];return Qu(n,function(n,e,u){t(n,e,u)&&r.push(n)}),r}function ht(n,t,r,e){var u,o,i;for(e||(e=[]),u=-1,o=n.length;++u<o;)i=n[u],t>0&&de(i)&&(r||qo(i)||ve(i))?t>1?ht(i,t-1,r,e):l(e,i):r||(e[e.length]=i);return e}function pt(n,t){null==n||no(n,t,Ze)}function _t(n,t){return n&&no(n,t,De)}function vt(n,t){return n&&to(n,t,De)}function gt(n,t){return i(t,function(t){return be(n[t])})}function dt(n,t){t=Lr(t,n)?[t+""]:et(t);for(var r=0,e=t.length;null!=n&&e>r;)n=n[t[r++]];return r&&r==e?n:q}function yt(n,t){return lu.call(n,t)||typeof n=="object"&&t in n&&null===mu(n)}function bt(n,t){return t in Object(n)}function xt(n,t,r){for(var p,g,d,y,e=r?c:f,u=n[0].length,o=n.length,i=o,l=Array(o),s=1/0,h=[];i--;)p=n[i],i&&t&&(p=a(p,A(t))),s=zu(p.length,s),l[i]=r||!t&&(120>u||120>p.length)?q:new Ln(i&&p);var p=n[0],_=-1,v=l[0];n:for(;++_<u&&s>h.length;)if(g=p[_],d=t?t(g):g,v?!$n(v,d):!e(h,d,r)){for(i=o;--i;)if(y=l[i],y?!$n(y,d):!e(n[i],d,r))continue n;v&&v.push(d);h.push(g)}return h}function jt(n,t,r){var e={};return _t(n,function(n,u,o){t(e,r(n),u,o)}),e}function mt(n,t,e){return Lr(t,n)||(t=et(t),n=Zr(n,t),t=Vr(t)),t=null==n?n:n[t],null==t?q:r(t,n,e)}function wt(n,t,r,e,u){var a,i,l,s,_;if(n===t)n=!0;else if(null!=n&&null!=t&&(me(n)||we(t)))n:{var o=qo(n),i=qo(t),f="[object Array]",c="[object Array]";if(o||(f=Rr(n),f="[object Arguments]"==f?"[object Object]":f),i||(c=Rr(t),c="[object Arguments]"==c?"[object Object]":c),a="[object Object]"==f&&!U(n),i="[object Object]"==c&&!U(t),(c=f==c)&&!a)u||(u=new Fn),n=o||Re(n)?wr(n,t,wt,r,e,u):Ar(n,t,f,wt,r,e,u);else{if(!(2&e)&&(o=a&&lu.call(n,"__wrapped__"),f=i&&lu.call(t,"__wrapped__"),o||f)){u||(u=new Fn);n=wt(o?n.value():n,f?t.value():t,r,e,u);break n}if(c)t:if(u||(u=new Fn),o=2&e,f=De(n),i=f.length,c=De(t).length,i==c||o){for(a=i;a--;)if(l=f[a],!(o?l in t:yt(t,l))){n=!1;break t}if(c=u.get(n))n=c==t;else{for(c=!0,u.set(n,t),s=o;++a<i;){var l=f[a],h=n[l],p=t[l];if(r&&(_=o?r(p,h,l,t,n,u):r(h,p,l,n,t,u)),_===q?h!==p&&!wt(h,p,r,e,u):!_){c=!1;break}s||(s="constructor"==l)}c&&!s&&(r=n.constructor,e=t.constructor,r!=e&&"constructor"in n&&"constructor"in t&&!(typeof r=="function"&&r instanceof r&&typeof e=="function"&&e instanceof e)&&(c=!1));u["delete"](n);n=c}}else n=!1;else n=!1}}else n=n!==n&&t!==t;return n}function At(n,t,r,e){var u=r.length,o=u,i=!e,f;if(null==n)return!o;for(n=Object(n);u--;)if(f=r[u],i&&f[2]?f[1]!==n[f[0]]:!(f[0]in n))return!1;for(;++u<o;){var f=r[u],c=f[0],a=n[c],l=f[1];if(i&&f[2]){if(a===q&&!(c in n))return!1}else if(f=new Fn,c=e?e(a,l,c,n,t,f):q,c===q?!wt(l,a,e,3,f):!c)return!1}return!0}function Ot(n){var t=typeof n;return"function"==t?n:null==n?Ye:"object"==t?qo(n)?St(n[0],n[1]):It(n):nu(n)}function kt(n){n=null==n?n:Object(n);var t,r=[];for(t in n)r.push(t);return r}function Et(n,t){var r=-1,e=ge(n)?Array(n.length):[];return Qu(n,function(n,u,o){e[++r]=t(n,u,o)}),e}function It(n){var t=Er(n),r,e;return 1==t.length&&t[0][2]?(r=t[0][0],e=t[0][1],function(n){return null==n?!1:n[r]===e&&(e!==q||r in Object(n))}):function(r){return r===n||At(r,n,t)}}function St(n,t){return function(r){var e=$e(r,n);return e===q&&e===t?Ne(r,n):wt(t,e,q,3)}}function Rt(n,t,r,e,o){if(n!==t){var i=qo(t)||Re(t)?q:Ze(t);u(i||t,function(u,f){var h,p;if(i&&(f=u,u=t[f]),me(u)){o||(o=new Fn);var c=f,a=o,l=n[c],s=t[c],h=a.get(s);h?Yn(n,c,h):(h=e?e(l,s,c+"",n,t,a):q,p=h===q,p&&(h=s,qo(s)||Re(s)?qo(l)?h=l:de(l)?h=nr(l):(p=!1,h=ot(s,!e)):ke(s)||ve(s)?ve(l)?h=Me(l):!me(l)||r&&be(l)?(p=!1,h=ot(s,!e)):h=l:p=!1),a.set(s,h),p&&Rt(h,s,r,e,a),a["delete"](s),Yn(n,c,h))}else c=e?e(n[f],u,f+"",n,t,o):q,c===q&&(c=u),Yn(n,f,c)})}}function Wt(n,t,r){var e=-1;return t=a(t.length?t:Array(1),kr()),n=Et(n,function(n){return{a:a(t,function(t){return t(n)}),b:++e,c:n}}),x(n,function(n,t){var e,c;n:{e=-1;for(var u=n.a,o=t.a,i=u.length,f=r.length;++e<i;)if(c=S(u[e],o[e]),c){e=f>e?c*("desc"==r[e]?-1:1):c;break n}e=n.b-t.b}return e})}function Bt(n,t){return n=Object(n),s(t,function(t,r){return r in n&&(t[r]=n[r]),t},{})}function Ct(n,t){var r={};return pt(n,function(n,e){t(n,e)&&(r[e]=n)}),r}function Ut(n){return function(t){return null==t?q:t[n]}}function zt(n){return function(t){return dt(t,n)}}function Mt(n,t,r,e){var u=e?y:d,o=-1,i=t.length,f=n;for(r&&(f=a(n,A(r)));++o<i;)for(var c=0,l=t[o],l=r?r(l):l;-1<(c=u(f,l,c,e));)f!==n&&Iu.call(f,c,1),Iu.call(n,c,1);return n}function Lt(n,t){for(var o,u,i,r=n?t.length:0,e=r-1;r--;)u=t[r],(e==r||u!=o)&&(o=u,z(u)?Iu.call(n,u,1):Lr(u,n)?delete n[u]:(u=et(u),i=Zr(n,u),null!=i&&delete i[Vr(u)]))}function $t(n,t){return n+Ru(Lu()*(t-n+1))}function Ft(n,t,r,e){var c,l,a;t=Lr(t,n)?[t+""]:et(t);for(var u=-1,o=t.length,i=o-1,f=n;null!=f&&++u<o;)c=t[u],me(f)&&(a=r,u!=i&&(l=f[c],a=e?e(l,c,f):q,a===q&&(a=null==l?z(t[u+1])?[]:{}:l)),Hn(f,c,a)),f=f[c];return n}function Nt(n,t,r){var e=-1,u=n.length;for(0>t&&(t=-t>u?0:u+t),r=r>u?u:r,0>r&&(r+=u),u=t>r?0:r-t>>>0,t>>>=0,r=Array(u);++e<u;)r[e]=n[e+t];return r}function Dt(n,t){var r;return Qu(n,function(n,e,u){return r=t(n,e,u),!r}),!!r}function Zt(n,t,r){var e=0,u=n?n.length:e,o,i;if(typeof t=="number"&&t===t&&2147483647>=u){for(;u>e;)o=e+u>>>1,i=n[o],(r?t>=i:t>i)&&null!==i?e=o+1:u=o;return u}return qt(n,t,Ye,r)}function qt(n,t,r,e){t=r(t);for(var u=0,o=n?n.length:0,i=t!==t,f=null===t,c=t===q;o>u;){var a=Ru((u+o)/2),l=r(n[a]),s=l!==q,h=l===l;(i?h||e:f?h&&s&&(e||null!=l):c?h&&(e||s):null==l?0:e?t>=l:t>l)?u=a+1:o=a}return zu(o,4294967294)}function Pt(n,t){for(var r=0,e=n.length,u=n[0],o=t?t(u):u,i=o,f=1,c=[u];++r<e;)u=n[r],o=t?t(u):u,pe(o,i)||(i=o,c[f++]=u);return c}function Tt(n,t,r){var e=-1,u=f,o=n.length,i=!0,a=[],l=a,s,h,p;if(r)i=!1,u=c;else if(o<200)l=t?[]:a;else{if(u=t?null:eo(n))return F(u);i=!1;u=$n;l=new Ln}n:for(;++e<o;)if(s=n[e],h=t?t(s):s,i&&h===h){for(p=l.length;p--;)if(l[p]===h)continue n;t&&l.push(h);a.push(s)}else u(l,h,r)||(l!==a&&l.push(h),a.push(s));return a}function Kt(n,t,r,e){for(var u=n.length,o=e?u:-1;(e?o--:++o<u)&&t(n[o],o,n););return r?Nt(n,e?0:o,e?o+1:u):Nt(n,e?o+1:0,e?u:o)}function Gt(n,t){var r=n;return r instanceof On&&(r=r.value()),s(t,function(n,t){return t.func.apply(t.thisArg,l([n],t.args))},r)}function Vt(n,t,r){for(var o,e=-1,u=n.length;++e<u;)o=o?l(at(o,n[e],t,r),at(n[e],o,t,r)):n[e];return o&&o.length?Tt(o,t,r):[]}function Jt(n,t,r){for(var e=-1,u=n.length,o=t.length,i={};++e<u;)r(i,n[e],o>e?t[e]:q);return i}function Yt(n,t){if(t)return n.slice();var r=new n.constructor(n.length);return n.copy(r),r}function Ht(n){var t=new n.constructor(n.byteLength);return new bu(t).set(new bu(n)),t}function Qt(n,t,r,e){var u=-1,o=n.length,i=r.length,f=-1,c=t.length,a=Uu(o-i,0),l=Array(c+a);for(e=!e;++f<c;)l[f]=t[f];for(;++u<i;)(e||o>u)&&(l[r[u]]=n[u]);for(;a--;)l[f++]=n[u++];return l}function Xt(n,t,r,e){var u=-1,o=n.length,i=-1,f=r.length,c=-1,a=t.length,l=Uu(o-f,0),s=Array(l+a);for(e=!e;++u<l;)s[u]=n[u];for(l=u;++c<a;)s[l+c]=t[c];for(;++i<f;)(e||o>u)&&(s[l+r[i]]=n[u++]);return s}function nr(n,t){var r=-1,e=n.length;for(t||(t=Array(e));++r<e;)t[r]=n[r];return t}function tr(n,t,r){return rr(n,t,r)}function rr(n,t,r,e){var u,o,i,f;for(r||(r={}),u=-1,o=t.length;++u<o;)i=t[u],f=e?e(r[i],n[i],i,r,n):n[i],Hn(r,i,f);return r}function er(n,t){return tr(n,io(n),t)}function ur(n,t){return function(r,u){var o=qo(r)?e:Qn,i=t?t():{};return o(r,n,kr(u),i)}}function or(n){return he(function(t,r){var e=-1,u=r.length,o=u>1?r[u-1]:q,i=u>2?r[2]:q,o=typeof o=="function"?(u--,o):q;for(i&&Mr(r[0],r[1],i)&&(o=3>u?q:o,u=1),t=Object(t);++e<u;)(i=r[e])&&n(t,i,e,o);return t})}function ir(n,t){return function(r,e){if(null==r)return r;if(!ge(r))return n(r,e);for(var u=r.length,o=t?u:-1,i=Object(r);(t?o--:++o<u)&&!1!==e(i[o],o,i););return r}}function fr(n){return function(t,r,e){var u=-1,o=Object(t),i,f;for(e=e(t),i=e.length;i--;)if(f=e[n?i:++u],!1===r(o[f],f,o))break;return t}}function cr(n,t,r){function e(){return(this&&this!==Vn&&this instanceof e?o:n).apply(u?r:this,arguments)}var u=1&t,o=sr(n);return e}function ar(n){return function(t){t=Le(t);var r=In.test(t)?t.match(En):q,e=r?r[0]:t.charAt(0);return t=r?r.slice(1).join(""):t.slice(1),e[n]()+t}}function lr(n){return function(t){return s(Ve(Ke(t)),n,"")}}function sr(n){return function(){var t=arguments,r;switch(t.length){case 0:return new n;case 1:return new n(t[0]);case 2:return new n(t[0],t[1]);case 3:return new n(t[0],t[1],t[2]);case 4:return new n(t[0],t[1],t[2],t[3]);case 5:return new n(t[0],t[1],t[2],t[3],t[4]);case 6:return new n(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}return r=ft(n.prototype),t=n.apply(r,t),me(t)?t:r}}function hr(n,t,e){function u(){for(var i=arguments.length,f=Array(i),c=i,a=Sr(u);c--;)f[c]=arguments[c];return c=3>i&&f[0]!==a&&f[i-1]!==a?[]:$(f,a),i-=c.length,e>i?xr(n,t,_r,u.placeholder,q,f,c,q,q,e-i):r(this&&this!==Vn&&this instanceof u?o:n,this,f)}var o=sr(n);return u}function pr(n){return he(function(t){var o,i;t=ht(t,1);var r=t.length,e=r,u=An.prototype.thru;for(n&&t.reverse();e--;){if(o=t[e],typeof o!="function")throw new iu("Expected a function");u&&!i&&"wrapper"==Or(o)&&(i=new An([],!0))}for(e=i?e:r;++e<r;)var o=t[e],u=Or(o),f="wrapper"==u?uo(o):q,i=f&&Fr(f[0])&&424==f[1]&&!f[4].length&&1==f[9]?i[Or(f[0])].apply(i,f[3]):1==o.length&&Fr(o)?i[u]():i.thru(o);return function(){var n=arguments,e=n[0],u;if(i&&1==n.length&&qo(e)&&e.length>=200)return i.plant(e).value();for(u=0,n=r?t[u].apply(this,n):e;++u<r;)n=t[u].call(this,n);return n}})}function _r(n,t,r,e,u,o,i,f,c,a){function l(){for(var x,j,m,w,A,d=arguments.length,y=d,b=Array(d);y--;)b[y]=arguments[y];if(_)for(j=Sr(l),y=b.length,x=0;y--;)b[y]===j&&x++;if(e&&(b=Qt(b,e,u,_)),o&&(b=Xt(b,o,i,_)),d-=x,_&&a>d)return j=$(b,j),xr(n,t,_r,l.placeholder,r,b,j,f,c,a-d);if(j=h?r:this,y=p?j[n]:n,d=b.length,f)for(x=b.length,m=zu(f.length,x),w=nr(b);m--;)A=f[m],b[m]=z(A,x)?w[A]:q;else v&&d>1&&b.reverse();return s&&d>c&&(b.length=c),this&&this!==Vn&&this instanceof l&&(y=g||sr(y)),y.apply(j,b)}var s=128&t,h=1&t,p=2&t,_=24&t,v=512&t,g=p?q:sr(n);return l}function vr(n,t){return function(r,e){return jt(r,n,t(e))}}function gr(n){return he(function(t){return t=a(ht(t,1),kr()),he(function(e){var u=this;return n(t,function(n){return r(n,u,e)})})})}function dr(n,t,r){return t=Ce(t),n=N(n),t&&t>n?(t-=n,r=r===q?" ":r+"",n=Ge(r,Su(t/N(r))),In.test(r)?n.match(En).slice(0,t).join(""):n.slice(0,t)):""}function yr(n,t,e,u){function o(){for(var t=-1,c=arguments.length,a=-1,l=u.length,s=Array(l+c),h=this&&this!==Vn&&this instanceof o?f:n;++a<l;)s[a]=u[a];for(;c--;)s[a++]=arguments[++t];return r(h,i?e:this,s)}var i=1&t,f=sr(n);return o}function br(n){return function(t,r,e){var u,o;for(e&&typeof e!="number"&&Mr(t,r,e)&&(r=e=q),t=ze(t),t=t===t?t:0,r===q?(r=t,t=0):r=ze(r)||0,e=e===q?r>t?1:-1:ze(e)||0,u=-1,r=Uu(Su((r-t)/(e||1)),0),o=Array(r);r--;)o[n?r:++u]=t,t+=e;return o}}function xr(n,t,r,e,u,o,i,f,c,a){var l=8&t,s,h;return f=f?nr(f):q,s=l?i:q,i=l?q:i,h=l?o:q,o=l?q:o,t=(t|(l?32:64))&~(l?64:32),4&t||(t&=-4),t=[n,t,u,h,s,o,i,f,c,a],r=r.apply(q,t),Fr(n)&&fo(r,t),r.placeholder=e,r}function jr(n){var t=uu[n];return function(n,r){if(n=ze(n),r=Ce(r)){var e=(Le(n)+"e").split("e"),e=t(e[0]+"e"+(+e[1]+r)),e=(Le(e)+"e").split("e");return+(e[0]+"e"+(+e[1]-r))}return t(n)}}function mr(n,t,r,e,u,o,i,f){var c=2&t,a,l,s,h;if(!c&&typeof n!="function")throw new iu("Expected a function");return a=e?e.length:0,(a||(t&=-97,e=u=q),i=i===q?i:Uu(Ce(i),0),f=f===q?f:Ce(f),a-=u?u.length:0,64&t)&&(l=e,s=u,e=u=q),h=c?q:uo(n),o=[n,t,r,e,u,l,s,o,i,f],h&&(r=o[1],n=h[1],t=r|n,e=128==n&&8==r||128==n&&256==r&&h[8]>=o[7].length||384==n&&h[8]>=h[7].length&&8==r,131>t||e)&&(1&n&&(o[2]=h[2],t|=1&r?0:4),(r=h[3])&&(e=o[3],o[3]=e?Qt(e,r,h[4]):nr(r),o[4]=e?$(o[3],"__lodash_placeholder__"):nr(h[4])),(r=h[5])&&(e=o[5],o[5]=e?Xt(e,r,h[6]):nr(r),o[6]=e?$(o[5],"__lodash_placeholder__"):nr(h[6])),(r=h[7])&&(o[7]=nr(r)),128&n&&(o[8]=null==o[8]?h[8]:zu(o[8],h[8])),null==o[9]&&(o[9]=h[9]),o[0]=h[0],o[1]=t),n=o[0],t=o[1],r=o[2],e=o[3],u=o[4],f=o[9]=null==o[9]?c?0:n.length:Uu(o[9]-a,0),!f&&24&t&&(t&=-25),(h?ro:fo)(t&&1!=t?8==t||16==t?hr(n,t,f):32!=t&&33!=t||u.length?_r.apply(q,o):yr(n,t,r,e):cr(n,t,r),o)}function wr(n,t,r,e,u,o){var i=-1,f=2&u,c=1&u,a=n.length,l=t.length,s,h,_;if(!(a==l||f&&l>a))return!1;if(l=o.get(n))return l==t;for(l=!0,o.set(n,t);++i<a;){if(s=n[i],h=t[i],e&&(_=f?e(h,s,i,t,n,o):e(s,h,i,n,t,o)),_!==q){if(_)continue;l=!1;break}if(c){if(!p(t,function(n){return s===n||r(s,n,e,u,o)})){l=!1;break}}else if(s!==h&&!r(s,h,e,u,o)){l=!1;break}}return o["delete"](n),l}function Ar(n,t,r,e,u,o,i){switch(r){case"[object ArrayBuffer]":if(n.byteLength!=t.byteLength||!e(new bu(n),new bu(t)))break;return!0;case"[object Boolean]":case"[object Date]":return+n==+t;case"[object Error]":return n.name==t.name&&n.message==t.message;case"[object Number]":return n!=+n?t!=+t:n==+t;case"[object RegExp]":case"[object String]":return n==t+"";case"[object Map]":var f=L;case"[object Set]":if(f||(f=F),n.size!=t.size&&!(2&o))break;return(r=i.get(n))?r==t:wr(f(n),f(t),e,u,1|o,i.set(n,t));case"[object Symbol]":if(Yu)return Yu.call(n)==Yu.call(t)}return!1}function Or(n){for(var u,o,t=n.name+"",r=Tu[t],e=lu.call(Tu,t)?r.length:0;e--;)if(u=r[e],o=u.func,null==o||o==n)return u.name;return t}function kr(){var n=bn.iteratee||He,n=n===He?Ot:n;return arguments.length?n(arguments[0],arguments[1]):n}function Er(n){var t,r;for(n=qe(n),t=n.length;t--;)r=n[t][1],n[t][2]=r===r&&!me(r);return n}function Ir(n,t){var r=n[t];return Ae(r)?r:q}function Sr(n){return(lu.call(bn,"placeholder")?bn:n).placeholder}function Rr(n){return pu.call(n)}function Wr(n,t,r){if(null==n)return!1;var e=r(n,t);return e||Lr(t)||(t=et(t),n=Zr(n,t),null!=n&&(t=Vr(t),e=r(n,t))),r=n?n.length:q,e||!!r&&je(r)&&z(t,r)&&(qo(n)||Ie(n)||ve(n))}function Br(n){var t=n.length,r=n.constructor(t);return t&&"string"==typeof n[0]&&lu.call(n,"index")&&(r.index=n.index,r.input=n.input),r}function Cr(n){return typeof n.constructor!="function"||Nr(n)?{}:ft(mu(n))}function Ur(r,e,u){var o=r.constructor;switch(e){case"[object ArrayBuffer]":return Ht(r);case"[object Boolean]":case"[object Date]":return new o(+r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return e=u?Ht(r.buffer):r.buffer,new r.constructor(e,r.byteOffset,r.length);case"[object Map]":return s(L(r),n,new r.constructor);case"[object Number]":case"[object String]":return new o(r);case"[object RegExp]":return e=new r.constructor(r.source,pn.exec(r)),e.lastIndex=r.lastIndex,e;case"[object Set]":return s(F(r),t,new r.constructor);case"[object Symbol]":return Yu?Object(Yu.call(r)):{}}}function zr(n){var t=n?n.length:q;return je(t)&&(qo(n)||Ie(n)||ve(n))?m(t,String):null}function Mr(n,t,r){if(!me(r))return!1;var e=typeof t;return("number"==e?ge(r)&&z(t,r.length):"string"==e&&t in r)?pe(r[t],n):!1}function Lr(n,t){return typeof n=="number"?!0:!qo(n)&&(en.test(n)||!rn.test(n)||null!=t&&n in Object(t))}function $r(n){var t=typeof n;return"number"==t||"boolean"==t||"string"==t&&"__proto__"!=n||null==n}function Fr(n){var t=Or(n),r=bn[t];return typeof r=="function"&&t in On.prototype?n===r?!0:(t=uo(r),!!t&&n===t[0]):!1}function Nr(n){var t=n&&n.constructor;return n===(typeof t=="function"&&t.prototype||cu)}function Dr(n,t,r,e,u,o){return me(n)&&me(t)&&Rt(n,t,q,Dr,o.set(t,n)),n}function Zr(n,t){return 1==t.length?n:$e(n,Nt(t,0,-1))}function qr(n){var t=[];return Le(n).replace(un,function(n,r,e,u){t.push(e?u.replace(sn,"$1"):r||n)}),t}function Pr(n){if(n instanceof On)return n.clone();var t=new An(n.__wrapped__,n.__chain__);return t.__actions__=nr(n.__actions__),t.__index__=n.__index__,t.__values__=n.__values__,t}function Tr(n,t,r){var e=n?n.length:0;return e?(t=r||t===q?1:Ce(t),Nt(n,0>t?0:t,e)):[]}function Kr(n,t,r){var e=n?n.length:0;return e?(t=r||t===q?1:Ce(t),t=e-t,Nt(n,0,0>t?0:t)):[]}function Gr(n){return n?n[0]:q}function Vr(n){var t=n?n.length:0;return t?n[t-1]:q}function Jr(n,t){return n&&n.length&&t&&t.length?Mt(n,t):n}function Yr(n){return n?$u.call(n):n}function Hr(n){if(!n||!n.length)return[];var t=0;return n=i(n,function(n){if(de(n))return(t=Uu(n.length,t),!0)}),m(t,function(t){return a(n,Ut(t))})}function Qr(n,t){if(!n||!n.length)return[];var e=Hr(n);return null==t?e:a(e,function(n){return r(t,q,n)})}function Xr(n){return n=bn(n),n.__chain__=!0,n}function ne(n,t){return t(n)}function te(){return this}function re(n,t){return typeof t=="function"&&qo(n)?u(n,t):Qu(n,rt(t))}function ee(n,t){var r;if(typeof t=="function"&&qo(n)){for(r=n.length;r--&&!1!==t(n[r],r,n););r=n}else r=Xu(n,rt(t));return r}function ue(n,t){return(qo(n)?a:Et)(n,kr(t,3))}function oe(n,t){var r=-1,e=Be(n),u=e.length,o=u-1,i;for(t=ut(Ce(t),0,u);++r<t;)u=$t(r,o),i=e[u],e[u]=e[r],e[r]=i;return e.length=t,e}function ie(n,t,r){return t=r?q:t,t=n&&null==t?n.length:t,mr(n,128,q,q,q,q,t)}function fe(n,t){var r;if(typeof t!="function")throw new iu("Expected a function");return n=Ce(n),function(){return 0<--n&&(r=t.apply(this,arguments)),1>=n&&(t=q),r}}function ce(n,t,r){return t=r?q:t,n=mr(n,8,q,q,q,q,q,t),n.placeholder=ce.placeholder,n}function ae(n,t,r){return t=r?q:t,n=mr(n,16,q,q,q,q,q,t),n.placeholder=ae.placeholder,n}function le(n,t,r){function e(){p&&xu(p);a&&xu(a);v=0;c=a=h=p=_=q}function u(t,r){r&&xu(r);a=p=_=q;t&&(v=Uo(),l=n.apply(h,c),p||a||(c=h=q))}function o(){var n=t-(Uo()-s);0>=n||n>t?u(_,a):p=Eu(o,n)}function i(){u(y,p)}function f(){var r,e,u;return(c=arguments,s=Uo(),h=this,_=y&&(p||!g),!1===d)?r=g&&!p:(v||a||g||(v=s),e=d-(s-v),u=(0>=e||e>d)&&(g||a),u?(a&&(a=xu(a)),v=s,l=n.apply(h,c)):a||(a=Eu(i,e))),u&&p?p=xu(p):p||t===d||(p=Eu(o,t)),r&&(u=!0,l=n.apply(h,c)),!u||p||a||(c=h=q),l}var c,a,l,s,h,p,_,v=0,g=!1,d=!1,y=!0;if(typeof n!="function")throw new iu("Expected a function");return t=ze(t)||0,me(r)&&(g=!!r.leading,d="maxWait"in r&&Uu(ze(r.maxWait)||0,t),y="trailing"in r?!!r.trailing:y),f.cancel=e,f.flush=function(){return(p&&_||a&&y)&&(l=n.apply(h,c)),e(),l},f}function se(n,t){function r(){var e=arguments,u=t?t.apply(this,e):e[0],o=r.cache;return o.has(u)?o.get(u):(e=n.apply(this,e),r.cache=o.set(u,e),e)}if(typeof n!="function"||t&&typeof t!="function")throw new iu("Expected a function");return r.cache=new se.Cache,r}function he(n,t){if(typeof n!="function")throw new iu("Expected a function");return t=Uu(t===q?n.length-1:Ce(t),0),function(){for(var e=arguments,u=-1,o=Uu(e.length-t,0),i=Array(o);++u<o;)i[u]=e[t+u];switch(t){case 0:return n.call(this,i);case 1:return n.call(this,e[0],i);case 2:return n.call(this,e[0],e[1],i)}for(o=Array(t+1),u=-1;++u<t;)o[u]=e[u];return o[t]=i,r(n,this,o)}}function pe(n,t){return n===t||n!==n&&t!==t}function _e(n,t){return n>t}function ve(n){return de(n)&&lu.call(n,"callee")&&(!ku.call(n,"callee")||"[object Arguments]"==pu.call(n))}function ge(n){return null!=n&&je(oo(n))&&!be(n)}function de(n){return we(n)&&ge(n)}function ye(n){return we(n)?"[object Error]"==pu.call(n)||typeof n.message=="string"&&typeof n.name=="string":!1}function be(n){return n=me(n)?pu.call(n):"","[object Function]"==n||"[object GeneratorFunction]"==n}function xe(n){return typeof n=="number"&&n==Ce(n)}function je(n){return typeof n=="number"&&n>-1&&0==n%1&&9007199254740991>=n}function me(n){var t=typeof n;return!!n&&("object"==t||"function"==t)}function we(n){return!!n&&typeof n=="object"}function Ae(n){return null==n?!1:be(n)?vu.test(au.call(n)):we(n)&&(U(n)?vu:dn).test(n)}function Oe(n){return typeof n=="number"||we(n)&&"[object Number]"==pu.call(n)}function ke(n){return!we(n)||"[object Object]"!=pu.call(n)||U(n)?!1:(n=mu(n),null===n?!0:(n=n.constructor,typeof n=="function"&&n instanceof n&&au.call(n)==hu))}function Ee(n){return me(n)&&"[object RegExp]"==pu.call(n)}function Ie(n){return typeof n=="string"||!qo(n)&&we(n)&&"[object String]"==pu.call(n)}function Se(n){return typeof n=="symbol"||we(n)&&"[object Symbol]"==pu.call(n)}function Re(n){return we(n)&&je(n.length)&&!!Cn[pu.call(n)]}function We(n,t){return t>n}function Be(n){if(!n)return[];if(ge(n))return Ie(n)?n.match(En):nr(n);if(Au&&n[Au])return M(n[Au]());var t=Rr(n);return("[object Map]"==t?L:"[object Set]"==t?F:Pe)(n)}function Ce(n){if(!n)return 0===n?n:0;if(n=ze(n),n===P||n===-P)return 17976931348623157e292*(0>n?-1:1);var t=n%1;return n===n?t?n-t:n:0}function Ue(n){return n?ut(Ce(n),0,4294967295):0}function ze(n){if(me(n)&&(n=be(n.valueOf)?n.valueOf():n,n=me(n)?n+"":n),typeof n!="string")return 0===n?n:+n;n=n.replace(cn,"");var t=gn.test(n);return t||yn.test(n)?Dn(n.slice(2),t?2:8):vn.test(n)?T:+n}function Me(n){return tr(n,Ze(n))}function Le(n){if(typeof n=="string")return n;if(null==n)return"";if(Se(n))return Hu?Hu.call(n):"";var t=n+"";return"0"==t&&1/n==-P?"-0":t}function $e(n,t,r){return n=null==n?q:dt(n,t),n===q?r:n}function Fe(n,t){return Wr(n,t,yt)}function Ne(n,t){return Wr(n,t,bt)}function De(n){var t=Nr(n);if(!t&&!ge(n))return Cu(Object(n));var r,e=zr(n),u=!!e,e=e||[],o=e.length;for(r in n)!yt(n,r)||u&&("length"==r||z(r,o))||t&&"constructor"==r||e.push(r);return e}function Ze(n){for(var c,t=-1,r=Nr(n),e=kt(n),u=e.length,o=zr(n),i=!!o,o=o||[],f=o.length;++t<u;)c=e[t],i&&("length"==c||z(c,f))||"constructor"==c&&(r||!lu.call(n,c))||o.push(c);return o}function qe(n){return w(n,De(n))}function Pe(n){return n?O(n,De(n)):[]}function Te(n){return ai(Le(n).toLowerCase())}function Ke(n){return(n=Le(n))&&n.replace(xn,R).replace(kn,"")}function Ge(n,t){n=Le(n);t=Ce(t);var r="";if(!n||1>t||t>9007199254740991)return r;do t%2&&(r+=n),t=Ru(t/2),n+=n;while(t);return r}function Ve(n,t,r){return n=Le(n),t=r?q:t,t===q&&(t=Wn.test(n)?Rn:Sn),n.match(t)||[]}function Je(n){return function(){return n}}function Ye(n){return n}function He(n){return Ot(typeof n=="function"?n:ot(n,!0))}function Qe(n,t,r){var e=De(t),o=gt(t,e),i,f;return null!=r||me(t)&&(o.length||!e.length)||(r=t,t=n,n=this,o=gt(t,De(t))),i=me(r)&&"chain"in r?r.chain:!0,f=be(n),u(o,function(r){var e=t[r];n[r]=e;f&&(n.prototype[r]=function(){var t=this.__chain__,r;return i||t?(r=n(this.__wrapped__),(r.__actions__=nr(this.__actions__)).push({func:e,args:arguments,thisArg:n}),r.__chain__=t,r):e.apply(n,l([this.value()],arguments))})}),n}function Xe(){}function nu(n){return Lr(n)?Ut(n):zt(n)}function tu(n){return n&&n.length?j(n,Ye):0}I=I?Jn.defaults({},I,Jn.pick(Vn,Bn)):Vn;var ru=I.Date,eu=I.Error,uu=I.Math,ou=I.RegExp,iu=I.TypeError,fu=I.Array.prototype,cu=I.Object.prototype,au=I.Function.prototype.toString,lu=cu.hasOwnProperty,su=0,hu=au.call(Object),pu=cu.toString,_u=Vn._,vu=ou("^"+au.call(lu).replace(on,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),gu=Pn?I.Buffer:q,du=I.Reflect,yu=I.Symbol,bu=I.Uint8Array,xu=I.clearTimeout,ju=du?du.f:q,mu=Object.getPrototypeOf,wu=Object.getOwnPropertySymbols,Au=typeof(Au=yu&&yu.iterator)=="symbol"?Au:q,Ou=Object.create,ku=cu.propertyIsEnumerable,Eu=I.setTimeout,Iu=fu.splice,Su=uu.ceil,Ru=uu.floor,Wu=I.isFinite,Bu=fu.join,Cu=Object.keys,Uu=uu.max,zu=uu.min,Mu=I.parseInt,Lu=uu.random,$u=fu.reverse,Fu=Ir(I,"Map"),Nu=Ir(I,"Set"),Du=Ir(I,"WeakMap"),Zu=Ir(Object,"create"),qu=Du&&new Du,Pu=!ku.call({valueOf:1},"valueOf"),Tu={},Ku=Fu?au.call(Fu):"",Gu=Nu?au.call(Nu):"",Vu=Du?au.call(Du):"",Ju=yu?yu.prototype:q,Yu=Ju?Ju.valueOf:q,Hu=Ju?Ju.toString:q;bn.templateSettings={escape:X,evaluate:nn,interpolate:tn,variable:"",imports:{_:bn}};var Qu=ir(_t),Xu=ir(vt,!0),no=fr(),to=fr(!0);ju&&!ku.call({valueOf:1},"valueOf")&&(kt=function(n){return M(ju(n))});var ro=qu?function(n,t){return qu.set(n,t),n}:Ye,eo=Nu&&2===new Nu([1,2]).size?function(n){return new Nu(n)}:Xe,uo=qu?function(n){return qu.get(n)}:Xe,oo=Ut("length"),io=wu||function(){return[]};(Fu&&"[object Map]"!=Rr(new Fu)||Nu&&"[object Set]"!=Rr(new Nu)||Du&&"[object WeakMap]"!=Rr(new Du))&&(Rr=function(n){var t=pu.call(n);if(n="[object Object]"==t?n.constructor:null,n=typeof n=="function"?au.call(n):"")switch(n){case Ku:return"[object Map]";case Gu:return"[object Set]";case Vu:return"[object WeakMap]"}return t});var fo=function(){var n=0,t=0;return function(r,e){var u=Uo(),o=16-(u-t);if(t=u,o>0){if(150<=++n)return r}else n=0;return ro(r,e)}}(),co=he(function(n,t){qo(n)||(n=null==n?[]:[Object(n)]);t=ht(t,1);for(var r=n,e=t,u=-1,o=r.length,i=-1,f=e.length,c=Array(o+f);++u<o;)c[u]=r[u];for(;++i<f;)c[u++]=e[i];return c}),ao=he(function(n,t){return de(n)?at(n,ht(t,1,!0)):[]}),lo=he(function(n,t){var r=Vr(t);return de(r)&&(r=q),de(n)?at(n,ht(t,1,!0),kr(r)):[]}),so=he(function(n,t){var r=Vr(t);return de(r)&&(r=q),de(n)?at(n,ht(t,1,!0),q,r):[]}),ho=he(function(n){var t=a(n,tt);return t.length&&t[0]===n[0]?xt(t):[]}),po=he(function(n){var t=Vr(n),r=a(n,tt);return t===Vr(r)?t=q:r.pop(),r.length&&r[0]===n[0]?xt(r,kr(t)):[]}),_o=he(function(n){var t=Vr(n),r=a(n,tt);return t===Vr(r)?t=q:r.pop(),r.length&&r[0]===n[0]?xt(r,q,t):[]}),vo=he(Jr),go=he(function(n,t){t=a(ht(t,1),String);var r=nt(n,t);return Lt(n,t.sort(S)),r}),yo=he(function(n){return Tt(ht(n,1,!0))}),bo=he(function(n){var t=Vr(n);return de(t)&&(t=q),Tt(ht(n,1,!0),kr(t))}),xo=he(function(n){var t=Vr(n);return de(t)&&(t=q),Tt(ht(n,1,!0),q,t)}),jo=he(function(n,t){return de(n)?at(n,t):[]}),mo=he(function(n){return Vt(i(n,de))}),wo=he(function(n){var t=Vr(n);return de(t)&&(t=q),Vt(i(n,de),kr(t))}),Ao=he(function(n){var t=Vr(n);return de(t)&&(t=q),Vt(i(n,de),q,t)}),Oo=he(Hr),ko=he(function(n){var t=n.length,t=t>1?n[t-1]:q,t=typeof t=="function"?(n.pop(),t):q;return Qr(n,t)}),Eo=he(function(n){function t(t){return nt(t,n)}n=ht(n,1);var r=n.length,e=r?n[0]:0,u=this.__wrapped__;return 1>=r&&!this.__actions__.length&&u instanceof On&&z(e)?(u=u.slice(e,+e+(r?1:0)),u.__actions__.push({func:ne,args:[t],thisArg:q}),new An(u,this.__chain__).thru(function(n){return r&&!n.length&&n.push(q),n})):this.thru(t)}),Io=ur(function(n,t,r){lu.call(n,r)?++n[r]:n[r]=1}),So=ur(function(n,t,r){lu.call(n,r)?n[r].push(t):n[r]=[t]}),Ro=he(function(n,t,e){var u=-1,o=typeof t=="function",i=Lr(t),f=ge(n)?Array(n.length):[];return Qu(n,function(n){var c=o?t:i&&null!=n?n[t]:q;f[++u]=c?r(c,n,e):mt(n,t,e)}),f}),Wo=ur(function(n,t,r){n[r]=t}),Bo=ur(function(n,t,r){n[r?0:1].push(t)},function(){return[[],[]]}),Co=he(function(n,t){if(null==n)return[];var r=t.length;return r>1&&Mr(n,t[0],t[1])?t=[]:r>2&&Mr(t[0],t[1],t[2])&&(t.length=1),Wt(n,ht(t,1),[])}),Uo=ru.now,zo=he(function(n,t,r){var e=1,u;return r.length&&(u=$(r,Sr(zo)),e=32|e),mr(n,e,t,r,u)}),Mo=he(function(n,t,r){var e=3,u;return r.length&&(u=$(r,Sr(Mo)),e=32|e),mr(t,e,n,r,u)}),Lo=he(function(n,t){return ct(n,1,t)}),$o=he(function(n,t,r){return ct(n,ze(t)||0,r)}),Fo=he(function(n,t){t=a(ht(t,1),kr());var e=t.length;return he(function(u){for(var o=-1,i=zu(u.length,e);++o<i;)u[o]=t[o].call(this,u[o]);return r(n,this,u)})}),No=he(function(n,t){var r=$(t,Sr(No));return mr(n,32,q,t,r)}),Do=he(function(n,t){var r=$(t,Sr(Do));return mr(n,64,q,t,r)}),Zo=he(function(n,t){return mr(n,256,q,q,q,ht(t,1))}),qo=Array.isArray,Po=gu?function(n){return n instanceof gu}:Je(!1),To=or(function(n,t){if(Pu||Nr(t)||ge(t))tr(t,De(t),n);else for(var r in t)lu.call(t,r)&&Hn(n,r,t[r])}),Ko=or(function(n,t){if(Pu||Nr(t)||ge(t))tr(t,Ze(t),n);else for(var r in t)Hn(n,r,t[r])}),Go=or(function(n,t,r,e){rr(t,Ze(t),n,e)}),Vo=or(function(n,t,r,e){rr(t,De(t),n,e)}),Jo=he(function(n,t){return nt(n,ht(t,1))}),Yo=he(function(n){return n.push(q,Gn),r(Go,q,n)}),Ho=he(function(n){return n.push(q,Dr),r(ri,q,n)}),Qo=vr(function(n,t,r){n[t]=r},Je(Ye)),Xo=vr(function(n,t,r){lu.call(n,t)?n[t].push(r):n[t]=[r]},kr),ni=he(mt),ti=or(function(n,t,r){Rt(n,t,r)}),ri=or(function(n,t,r,e){Rt(n,t,r,e)}),ei=he(function(n,t){return null==n?{}:(t=a(ht(t,1),String),Bt(n,at(Ze(n),t)))}),ui=he(function(n,t){return null==n?{}:Bt(n,ht(t,1))}),oi=lr(function(n,t,r){return t=t.toLowerCase(),n+(r?Te(t):t)}),ii=lr(function(n,t,r){return n+(r?"-":"")+t.toLowerCase()}),fi=lr(function(n,t,r){return n+(r?" ":"")+t.toLowerCase()}),ci=ar("toLowerCase"),ai=ar("toUpperCase"),li=lr(function(n,t,r){return n+(r?"_":"")+t.toLowerCase()}),si=lr(function(n,t,r){return n+(r?" ":"")+Te(t)}),hi=lr(function(n,t,r){return n+(r?" ":"")+t.toUpperCase()}),pi=he(function(n,t){try{return r(n,q,t)}catch(e){return ye(e)?e:new eu(e)}}),_i=he(function(n,t){return u(ht(t,1),function(t){n[t]=zo(n[t],n)}),n}),vi=pr(),gi=pr(!0),di=he(function(n,t){return function(r){return mt(r,n,t)}}),yi=he(function(n,t){return function(r){return mt(n,r,t)}}),bi=gr(a),xi=gr(o),ji=gr(p),mi=br(),wi=br(!0),Ai=jr("ceil"),Oi=jr("floor"),ki=jr("round");return bn.prototype=wn.prototype,bn.prototype.constructor=bn,An.prototype=ft(wn.prototype),An.prototype.constructor=An,On.prototype=ft(wn.prototype),On.prototype.constructor=On,zn.prototype=Zu?Zu(null):cu,Mn.prototype.clear=function(){this.__data__={hash:new zn,map:Fu?new Fu:[],string:new zn}},Mn.prototype["delete"]=function(n){var t=this.__data__;return $r(n)?(t=typeof n=="string"?t.string:t.hash,n=(Zu?t[n]!==q:lu.call(t,n))&&delete t[n]):n=Fu?t.map["delete"](n):Zn(t.map,n),n},Mn.prototype.get=function(n){var t=this.__data__;return $r(n)?(t=typeof n=="string"?t.string:t.hash,Zu?(n=t[n],n="__lodash_hash_undefined__"===n?q:n):n=lu.call(t,n)?t[n]:q):n=Fu?t.map.get(n):qn(t.map,n),n},Mn.prototype.has=function(n){var t=this.__data__;return $r(n)?(t=typeof n=="string"?t.string:t.hash,n=Zu?t[n]!==q:lu.call(t,n)):n=Fu?t.map.has(n):-1<Tn(t.map,n),n},Mn.prototype.set=function(n,t){var r=this.__data__;return $r(n)?(typeof n=="string"?r.string:r.hash)[n]=Zu&&t===q?"__lodash_hash_undefined__":t:Fu?r.map.set(n,t):Kn(r.map,n,t),this},Ln.prototype.push=function(n){var t=this.__data__;$r(n)?(t=t.__data__,(typeof n=="string"?t.string:t.hash)[n]="__lodash_hash_undefined__"):t.set(n,"__lodash_hash_undefined__")},Fn.prototype.clear=function(){this.__data__={array:[],map:null}},Fn.prototype["delete"]=function(n){var t=this.__data__,r=t.array;return r?Zn(r,n):t.map["delete"](n)},Fn.prototype.get=function(n){var t=this.__data__,r=t.array;return r?qn(r,n):t.map.get(n)},Fn.prototype.has=function(n){var t=this.__data__,r=t.array;return r?-1<Tn(r,n):t.map.has(n)},Fn.prototype.set=function(n,t){var r=this.__data__,e=r.array;return e&&(199>e.length?Kn(e,n,t):(r.array=null,r.map=new Mn(e))),(r=r.map)&&r.set(n,t),this},se.Cache=Mn,bn.after=function(n,t){if(typeof t!="function")throw new iu("Expected a function");return n=Ce(n),function(){if(1>--n)return t.apply(this,arguments)}},bn.ary=ie,bn.assign=To,bn.assignIn=Ko,bn.assignInWith=Go,bn.assignWith=Vo,bn.at=Jo,bn.before=fe,bn.bind=zo,bn.bindAll=_i,bn.bindKey=Mo,bn.castArray=function(){if(!arguments.length)return[];var n=arguments[0];return qo(n)?n:[n]},bn.chain=Xr,bn.chunk=function(n,t){var r;if(t=Uu(Ce(t),0),r=n?n.length:0,!r||1>t)return[];for(var e=0,u=0,o=Array(Su(r/t));r>e;)o[u++]=Nt(n,e,e+=t);return o},bn.compact=function(n){for(var o,t=-1,r=n?n.length:0,e=0,u=[];++t<r;)o=n[t],o&&(u[e++]=o);return u},bn.concat=co,bn.cond=function(n){var t=n?n.length:0,e=kr();return n=t?a(n,function(n){if("function"!=typeof n[1])throw new iu("Expected a function");return[e(n[0]),n[1]]}):[],he(function(e){for(var o,u=-1;++u<t;)if(o=n[u],r(o[0],this,e))return r(o[1],this,e)})},bn.conforms=function(n){return it(ot(n,!0))},bn.constant=Je,bn.countBy=Io,bn.create=function(n,t){var r=ft(n);return t?Xn(r,t):r},bn.curry=ce,bn.curryRight=ae,bn.debounce=le,bn.defaults=Yo,bn.defaultsDeep=Ho,bn.defer=Lo,bn.delay=$o,bn.difference=ao,bn.differenceBy=lo,bn.differenceWith=so,bn.drop=Tr,bn.dropRight=Kr,bn.dropRightWhile=function(n,t){return n&&n.length?Kt(n,kr(t,3),!0,!0):[]},bn.dropWhile=function(n,t){return n&&n.length?Kt(n,kr(t,3),!0):[]},bn.fill=function(n,t,r,e){var u=n?n.length:0;if(!u)return[];for(r&&typeof r!="number"&&Mr(n,t,r)&&(r=0,e=u),u=n.length,r=Ce(r),0>r&&(r=-r>u?0:u+r),e=e===q||e>u?u:Ce(e),0>e&&(e+=u),e=r>e?0:Ue(e);e>r;)n[r++]=t;return n},bn.filter=function(n,t){return(qo(n)?i:st)(n,kr(t,3))},bn.flatMap=function(n,t){return ht(ue(n,t),1)},bn.flatten=function(n){return n&&n.length?ht(n,1):[]},bn.flattenDeep=function(n){return n&&n.length?ht(n,P):[]},bn.flattenDepth=function(n,t){return n&&n.length?(t=t===q?1:Ce(t),ht(n,t)):[]},bn.flip=function(n){return mr(n,512)},bn.flow=vi,bn.flowRight=gi,bn.fromPairs=function(n){for(var u,t=-1,r=n?n.length:0,e={};++t<r;)u=n[t],e[u[0]]=u[1];return e},bn.functions=function(n){return null==n?[]:gt(n,De(n))},bn.functionsIn=function(n){return null==n?[]:gt(n,Ze(n))},bn.groupBy=So,bn.initial=function(n){return Kr(n,1)},bn.intersection=ho,bn.intersectionBy=po,bn.intersectionWith=_o,bn.invert=Qo,bn.invertBy=Xo,bn.invokeMap=Ro,bn.iteratee=He,bn.keyBy=Wo,bn.keys=De,bn.keysIn=Ze,bn.map=ue,bn.mapKeys=function(n,t){var r={};return t=kr(t,3),_t(n,function(n,e,u){r[t(n,e,u)]=n}),r},bn.mapValues=function(n,t){var r={};return t=kr(t,3),_t(n,function(n,e,u){r[e]=t(n,e,u)}),r},bn.matches=function(n){return It(ot(n,!0))},bn.matchesProperty=function(n,t){return St(n,ot(t,!0))},bn.memoize=se,bn.merge=ti,bn.mergeWith=ri,bn.method=di,bn.methodOf=yi,bn.mixin=Qe,bn.negate=function(n){if(typeof n!="function")throw new iu("Expected a function");return function(){return!n.apply(this,arguments)}},bn.nthArg=function(n){return n=Ce(n),function(){return arguments[n]}},bn.omit=ei,bn.omitBy=function(n,t){return t=kr(t),Ct(n,function(n,r){return!t(n,r)})},bn.once=function(n){return fe(2,n)},bn.orderBy=function(n,t,r,e){return null==n?[]:(qo(t)||(t=null==t?[]:[t]),r=e?q:r,qo(r)||(r=null==r?[]:[r]),Wt(n,t,r))},bn.over=bi,bn.overArgs=Fo,bn.overEvery=xi,bn.overSome=ji,bn.partial=No,bn.partialRight=Do,bn.partition=Bo,bn.pick=ui,bn.pickBy=function(n,t){return null==n?{}:Ct(n,kr(t))},bn.property=nu,bn.propertyOf=function(n){return function(t){return null==n?q:dt(n,t)}},bn.pull=vo,bn.pullAll=Jr,bn.pullAllBy=function(n,t,r){return n&&n.length&&t&&t.length?Mt(n,t,kr(r)):n},bn.pullAllWith=function(n,t,r){return n&&n.length&&t&&t.length?Mt(n,t,q,r):n},bn.pullAt=go,bn.range=mi,bn.rangeRight=wi,bn.rearg=Zo,bn.reject=function(n,t){var r=qo(n)?i:st;return t=kr(t,3),r(n,function(n,r,e){return!t(n,r,e)})},bn.remove=function(n,t){var r=[],i;if(!n||!n.length)return r;var e=-1,u=[],o=n.length;for(t=kr(t,3);++e<o;)i=n[e],t(i,e,n)&&(r.push(i),u.push(e));return Lt(n,u),r},bn.rest=he,bn.reverse=Yr,bn.sampleSize=oe,bn.set=function(n,t,r){return null==n?n:Ft(n,t,r)},bn.setWith=function(n,t,r,e){return e=typeof e=="function"?e:q,null==n?n:Ft(n,t,r,e)},bn.shuffle=function(n){return oe(n,4294967295)},bn.slice=function(n,t,r){var e=n?n.length:0;return e?(r&&typeof r!="number"&&Mr(n,t,r)?(t=0,r=e):(t=null==t?0:Ce(t),r=r===q?e:Ce(r)),Nt(n,t,r)):[]},bn.sortBy=Co,bn.sortedUniq=function(n){return n&&n.length?Pt(n):[]},bn.sortedUniqBy=function(n,t){return n&&n.length?Pt(n,kr(t)):[]},bn.split=function(n,t,r){return Le(n).split(t,r)},bn.spread=function(n,t){if(typeof n!="function")throw new iu("Expected a function");return t=t===q?0:Uu(Ce(t),0),he(function(e){var u=e[t];return e=e.slice(0,t),u&&l(e,u),r(n,this,e)})},bn.tail=function(n){return Tr(n,1)},bn.take=function(n,t,r){return n&&n.length?(t=r||t===q?1:Ce(t),Nt(n,0,0>t?0:t)):[]},bn.takeRight=function(n,t,r){var e=n?n.length:0;return e?(t=r||t===q?1:Ce(t),t=e-t,Nt(n,0>t?0:t,e)):[]},bn.takeRightWhile=function(n,t){return n&&n.length?Kt(n,kr(t,3),!1,!0):[]},bn.takeWhile=function(n,t){return n&&n.length?Kt(n,kr(t,3)):[]},bn.tap=function(n,t){return t(n),n},bn.throttle=function(n,t,r){var e=!0,u=!0;if(typeof n!="function")throw new iu("Expected a function");return me(r)&&(e="leading"in r?!!r.leading:e,u="trailing"in r?!!r.trailing:u),le(n,t,{leading:e,maxWait:t,trailing:u})},bn.thru=ne,bn.toArray=Be,bn.toPairs=qe,bn.toPairsIn=function(n){return w(n,Ze(n))},bn.toPath=function(n){return qo(n)?a(n,String):qr(n)},bn.toPlainObject=Me,bn.transform=function(n,t,r){var e=qo(n)||Re(n),o;return(t=kr(t,4),null==r)&&(e||me(n)?(o=n.constructor,r=e?qo(n)?new o:[]:be(o)?ft(mu(n)):{}):r={}),(e?u:_t)(n,function(n,e,u){return t(r,n,e,u)}),r},bn.unary=function(n){return ie(n,1)},bn.union=yo,bn.unionBy=bo,bn.unionWith=xo,bn.uniq=function(n){return n&&n.length?Tt(n):[]},bn.uniqBy=function(n,t){return n&&n.length?Tt(n,kr(t)):[]},bn.uniqWith=function(n,t){return n&&n.length?Tt(n,q,t):[]},bn.unset=function(n,t){var r,e;return null==n?r=!0:(r=n,e=t,e=Lr(e,r)?[e+""]:et(e),r=Zr(r,e),e=Vr(e),r=null!=r&&Fe(r,e)?delete r[e]:!0),r},bn.unzip=Hr,bn.unzipWith=Qr,bn.update=function(n,t,r){return null==n?n:Ft(n,t,rt(r)(dt(n,t)),void 0)},bn.updateWith=function(n,t,r,e){return e=typeof e=="function"?e:q,null!=n&&(n=Ft(n,t,rt(r)(dt(n,t)),e)),n},bn.values=Pe,bn.valuesIn=function(n){return null==n?[]:O(n,Ze(n))},bn.without=jo,bn.words=Ve,bn.wrap=function(n,t){return t=null==t?Ye:t,No(t,n)},bn.xor=mo,bn.xorBy=wo,bn.xorWith=Ao,bn.zip=Oo,bn.zipObject=function(n,t){return Jt(n||[],t||[],Hn)},bn.zipObjectDeep=function(n,t){return Jt(n||[],t||[],Ft)},bn.zipWith=ko,bn.extend=Ko,bn.extendWith=Go,Qe(bn,bn),bn.add=function(n,t){var r;return n===q&&t===q?0:(n!==q&&(r=n),t!==q&&(r=r===q?t:r+t),r)},bn.attempt=pi,bn.camelCase=oi,bn.capitalize=Te,bn.ceil=Ai,bn.clamp=function(n,t,r){return r===q&&(r=t,t=q),r!==q&&(r=ze(r),r=r===r?r:0),t!==q&&(t=ze(t),t=t===t?t:0),ut(ze(n),t,r)},bn.clone=function(n){return ot(n,!1,!0)},bn.cloneDeep=function(n){return ot(n,!0,!0)},bn.cloneDeepWith=function(n,t){return ot(n,!0,!0,t)},bn.cloneWith=function(n,t){return ot(n,!1,!0,t)},bn.deburr=Ke,bn.endsWith=function(n,t,r){n=Le(n);t=typeof t=="string"?t:t+"";var e=n.length;return r=r===q?e:ut(Ce(r),0,e),r-=t.length,r>=0&&n.indexOf(t,r)==r},bn.eq=pe,bn.escape=function(n){return(n=Le(n))&&Q.test(n)?n.replace(Y,W):n},bn.escapeRegExp=function(n){return(n=Le(n))&&fn.test(n)?n.replace(on,"\\$&"):n},bn.every=function(n,t,r){var e=qo(n)?o:lt;return r&&Mr(n,t,r)&&(t=q),e(n,kr(t,3))},bn.find=function(n,t){if(t=kr(t,3),qo(n)){var r=g(n,t);return r>-1?n[r]:q}return v(n,t,Qu)},bn.findIndex=function(n,t){return n&&n.length?g(n,kr(t,3)):-1},bn.findKey=function(n,t){return v(n,kr(t,3),_t,!0)},bn.findLast=function(n,t){if(t=kr(t,3),qo(n)){var r=g(n,t,!0);return r>-1?n[r]:q}return v(n,t,Xu)},bn.findLastIndex=function(n,t){return n&&n.length?g(n,kr(t,3),!0):-1},bn.findLastKey=function(n,t){return v(n,kr(t,3),vt,!0)},bn.floor=Oi,bn.forEach=re,bn.forEachRight=ee,bn.forIn=function(n,t){return null==n?n:no(n,rt(t),Ze)},bn.forInRight=function(n,t){return null==n?n:to(n,rt(t),Ze)},bn.forOwn=function(n,t){return n&&_t(n,rt(t))},bn.forOwnRight=function(n,t){return n&&vt(n,rt(t))},bn.get=$e,bn.gt=_e,bn.gte=function(n,t){return n>=t},bn.has=Fe,bn.hasIn=Ne,bn.head=Gr,bn.identity=Ye,bn.includes=function(n,t,r,e){return n=ge(n)?n:Pe(n),r=r&&!e?Ce(r):0,e=n.length,0>r&&(r=Uu(e+r,0)),Ie(n)?e>=r&&-1<n.indexOf(t,r):!!e&&-1<d(n,t,r)},bn.indexOf=function(n,t,r){var e=n?n.length:0;return e?(r=Ce(r),0>r&&(r=Uu(e+r,0)),d(n,t,r)):-1},bn.inRange=function(n,t,r){return t=ze(t)||0,r===q?(r=t,t=0):r=ze(r)||0,n=ze(n),n>=zu(t,r)&&n<Uu(t,r)},bn.invoke=ni,bn.isArguments=ve,bn.isArray=qo,bn.isArrayBuffer=function(n){return we(n)&&"[object ArrayBuffer]"==pu.call(n)},bn.isArrayLike=ge,bn.isArrayLikeObject=de,bn.isBoolean=function(n){return!0===n||!1===n||we(n)&&"[object Boolean]"==pu.call(n)},bn.isBuffer=Po,bn.isDate=function(n){return we(n)&&"[object Date]"==pu.call(n)},bn.isElement=function(n){return!!n&&1===n.nodeType&&we(n)&&!ke(n)},bn.isEmpty=function(n){if(ge(n)&&(qo(n)||Ie(n)||be(n.splice)||ve(n)))return!n.length;for(var t in n)if(lu.call(n,t))return!1;return!0},bn.isEqual=function(n,t){return wt(n,t)},bn.isEqualWith=function(n,t,r){var e=(r=typeof r=="function"?r:q)?r(n,t):q;return e===q?wt(n,t,r):!!e},bn.isError=ye,bn.isFinite=function(n){return typeof n=="number"&&Wu(n)},bn.isFunction=be,bn.isInteger=xe,bn.isLength=je,bn.isMap=function(n){return we(n)&&"[object Map]"==Rr(n)},bn.isMatch=function(n,t){return n===t||At(n,t,Er(t))},bn.isMatchWith=function(n,t,r){return r=typeof r=="function"?r:q,At(n,t,Er(t),r)},bn.isNaN=function(n){return Oe(n)&&n!=+n},bn.isNative=Ae,bn.isNil=function(n){return null==n},bn.isNull=function(n){return null===n},bn.isNumber=Oe,bn.isObject=me,bn.isObjectLike=we,bn.isPlainObject=ke,bn.isRegExp=Ee,bn.isSafeInteger=function(n){return xe(n)&&n>=-9007199254740991&&9007199254740991>=n},bn.isSet=function(n){return we(n)&&"[object Set]"==Rr(n)},bn.isString=Ie,bn.isSymbol=Se,bn.isTypedArray=Re,bn.isUndefined=function(n){return n===q},bn.isWeakMap=function(n){return we(n)&&"[object WeakMap]"==Rr(n)},bn.isWeakSet=function(n){return we(n)&&"[object WeakSet]"==pu.call(n)},bn.join=function(n,t){return n?Bu.call(n,t):""},bn.kebabCase=ii,bn.last=Vr,bn.lastIndexOf=function(n,t,r){var e=n?n.length:0,u;if(!e)return-1;if(u=e,r!==q&&(u=Ce(r),u=(0>u?Uu(e+u,0):zu(u,e-1))+1),t!==t)return C(n,u,!0);for(;u--;)if(n[u]===t)return u;return-1},bn.lowerCase=fi,bn.lowerFirst=ci,bn.lt=We,bn.lte=function(n,t){return t>=n},bn.max=function(n){return n&&n.length?_(n,Ye,_e):q},bn.maxBy=function(n,t){return n&&n.length?_(n,kr(t),_e):q},bn.mean=function(n){return tu(n)/(n?n.length:0)},bn.min=function(n){return n&&n.length?_(n,Ye,We):q},bn.minBy=function(n,t){return n&&n.length?_(n,kr(t),We):q},bn.noConflict=function(){return Vn._===this&&(Vn._=_u),this},bn.noop=Xe,bn.now=Uo,bn.pad=function(n,t,r){n=Le(n);t=Ce(t);var e=N(n);return t&&t>e?(e=(t-e)/2,t=Ru(e),e=Su(e),dr("",t,r)+n+dr("",e,r)):n},bn.padEnd=function(n,t,r){return n=Le(n),n+dr(n,t,r)},bn.padStart=function(n,t,r){return n=Le(n),dr(n,t,r)+n},bn.parseInt=function(n,t,r){return r||null==t?t=0:t&&(t=+t),n=Le(n).replace(cn,""),Mu(n,t||(_n.test(n)?16:10))},bn.random=function(n,t,r){if(r&&typeof r!="boolean"&&Mr(n,t,r)&&(t=r=q),r===q&&(typeof t=="boolean"?(r=t,t=q):typeof n=="boolean"&&(r=n,n=q)),n===q&&t===q?(n=0,t=1):(n=ze(n)||0,t===q?(t=n,n=0):t=ze(t)||0),n>t){var e=n;n=t;t=e}return r||n%1||t%1?(r=Lu(),zu(n+r*(t-n+Nn("1e-"+((r+"").length-1))),t)):$t(n,t)},bn.reduce=function(n,t,r){var e=qo(n)?s:b,u=3>arguments.length;return e(n,kr(t,4),r,u,Qu)},bn.reduceRight=function(n,t,r){var e=qo(n)?h:b,u=3>arguments.length;return e(n,kr(t,4),r,u,Xu)},bn.repeat=Ge,bn.replace=function(){var n=arguments,t=Le(n[0]);return 3>n.length?t:t.replace(n[1],n[2])},bn.result=function(n,t,r){if(Lr(t,n))e=null==n?q:n[t];else{t=et(t);var e=$e(n,t);n=Zr(n,t)}return e===q&&(e=r),be(e)?e.call(n):e},bn.round=ki,bn.runInContext=Z,bn.sample=function(n){n=ge(n)?n:Pe(n);var t=n.length;return t>0?n[$t(0,t-1)]:q},bn.size=function(n){if(null==n)return 0;if(ge(n)){var t=n.length;return t&&Ie(n)?N(n):t}return De(n).length},bn.snakeCase=li,bn.some=function(n,t,r){var e=qo(n)?p:Dt;return r&&Mr(n,t,r)&&(t=q),e(n,kr(t,3))},bn.sortedIndex=function(n,t){return Zt(n,t)},bn.sortedIndexBy=function(n,t,r){return qt(n,t,kr(r))},bn.sortedIndexOf=function(n,t){var r=n?n.length:0,e;return r&&(e=Zt(n,t),r>e&&pe(n[e],t))?e:-1},bn.sortedLastIndex=function(n,t){return Zt(n,t,!0)},bn.sortedLastIndexBy=function(n,t,r){return qt(n,t,kr(r),!0)},bn.sortedLastIndexOf=function(n,t){if(n&&n.length){var r=Zt(n,t,!0)-1;if(pe(n[r],t))return r}return-1},bn.startCase=si,bn.startsWith=function(n,t,r){return n=Le(n),r=ut(Ce(r),0,n.length),n.lastIndexOf(t,r)==r},bn.subtract=function(n,t){var r;return n===q&&t===q?0:(n!==q&&(r=n),t!==q&&(r=r===q?t:r-t),r)},bn.sum=tu,bn.sumBy=function(n,t){return n&&n.length?j(n,kr(t)):0},bn.template=function(n,t,r){var e=bn.templateSettings,a,l;r&&Mr(n,t,r)&&(t=q);n=Le(n);t=Go({},t,e,Gn);r=Go({},t.imports,e.imports,Gn);var u,o,i=De(r),f=O(r,i),c=0;if(r=t.interpolate||jn,a="__p+='",r=ou((t.escape||jn).source+"|"+r.source+"|"+(r===tn?hn:jn).source+"|"+(t.evaluate||jn).source+"|$","g"),l="sourceURL"in t?"//# sourceURL="+t.sourceURL+"\n":"",n.replace(r,function(t,r,e,i,f,l){return e||(e=i),a+=n.slice(c,l).replace(mn,B),r&&(u=!0,a+="'+__e("+r+")+'"),f&&(o=!0,a+="';"+f+";\n__p+='"),e&&(a+="'+((__t=("+e+"))==null?'':__t)+'"),c=l+t.length,t}),a+="';",(t=t.variable)||(a="with(obj){"+a+"}"),a=(o?a.replace(K,""):a).replace(G,"$1").replace(V,"$1;"),a="function("+(t||"obj")+"){"+(t?"":"obj||(obj={});")+"var __t,__p=''"+(u?",__e=_.escape":"")+(o?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+a+"return __p}",t=pi(function(){return Function(i,l+"return "+a).apply(q,f)}),t.source=a,ye(t))throw t;return t},bn.times=function(n,t){if(n=Ce(n),1>n||n>9007199254740991)return[];var r=4294967295,e=zu(n,4294967295);for(t=rt(t),n-=4294967295,e=m(e,t);++r<n;)t(r);return e},bn.toInteger=Ce,bn.toLength=Ue,bn.toLower=function(n){return Le(n).toLowerCase()},bn.toNumber=ze,bn.toSafeInteger=function(n){return ut(Ce(n),-9007199254740991,9007199254740991)},bn.toString=Le,bn.toUpper=function(n){return Le(n).toUpperCase()},bn.trim=function(n,t,r){return(n=Le(n))?r||t===q?n.replace(cn,""):(t+="")?(n=n.match(En),t=t.match(En),n.slice(k(n,t),E(n,t)+1).join("")):n:n},bn.trimEnd=function(n,t,r){return(n=Le(n))?r||t===q?n.replace(ln,""):(t+="")?(n=n.match(En),n.slice(0,E(n,t.match(En))+1).join("")):n:n},bn.trimStart=function(n,t,r){return(n=Le(n))?r||t===q?n.replace(an,""):(t+="")?(n=n.match(En),n.slice(k(n,t.match(En))).join("")):n:n},bn.truncate=function(n,t){var r=30,e="...",i,o,f,c;if(me(t))var u="separator"in t?t.separator:u,r="length"in t?Ce(t.length):r,e="omission"in t?Le(t.omission):e;if(n=Le(n),o=n.length,In.test(n)&&(i=n.match(En),o=i.length),r>=o)return n;if(o=r-N(e),1>o)return e;if(r=i?i.slice(0,o).join(""):n.slice(0,o),u===q)return r+e;if(i&&(o+=r.length-o),Ee(u)){if(n.slice(o).search(u)){for(f=r,u.global||(u=ou(u.source,Le(pn.exec(u))+"g")),u.lastIndex=0;i=u.exec(f);)c=i.index;r=r.slice(0,c===q?o:c)}}else n.indexOf(u,o)!=o&&(u=r.lastIndexOf(u),u>-1&&(r=r.slice(0,u)));return r+e},bn.unescape=function(n){return(n=Le(n))&&H.test(n)?n.replace(J,D):n},bn.uniqueId=function(n){var t=++su;return Le(n)+t},bn.upperCase=hi,bn.upperFirst=ai,bn.each=re,bn.eachRight=ee,bn.first=Gr,Qe(bn,function(){var n={};return _t(bn,function(t,r){lu.call(bn.prototype,r)||(n[r]=t)}),n}(),{chain:!1}),bn.VERSION="4.6.1",u("bind bindKey curry curryRight partial partialRight".split(" "),function(n){bn[n].placeholder=bn}),u(["drop","take"],function(n,t){On.prototype[n]=function(r){var e=this.__filtered__,u;return e&&!t?new On(this):(r=r===q?1:Uu(Ce(r),0),u=this.clone(),e?u.__takeCount__=zu(r,u.__takeCount__):u.__views__.push({size:zu(r,4294967295),type:n+(0>u.__dir__?"Right":"")}),u)};On.prototype[n+"Right"]=function(t){return this.reverse()[n](t).reverse()}}),u(["filter","map","takeWhile"],function(n,t){var r=t+1,e=1==r||3==r;On.prototype[n]=function(n){var t=this.clone();return t.__iteratees__.push({iteratee:kr(n,3),type:r}),t.__filtered__=t.__filtered__||e,t}}),u(["head","last"],function(n,t){var r="take"+(t?"Right":"");On.prototype[n]=function(){return this[r](1).value()[0]}}),u(["initial","tail"],function(n,t){var r="drop"+(t?"":"Right");On.prototype[n]=function(){return this.__filtered__?new On(this):this[r](1)}}),On.prototype.compact=function(){return this.filter(Ye)},On.prototype.find=function(n){return this.filter(n).head()},On.prototype.findLast=function(n){return this.reverse().find(n)},On.prototype.invokeMap=he(function(n,t){return typeof n=="function"?new On(this):this.map(function(r){return mt(r,n,t)})}),On.prototype.reject=function(n){return n=kr(n,3),this.filter(function(t){return!n(t)})},On.prototype.slice=function(n,t){n=Ce(n);var r=this;return r.__filtered__&&(n>0||0>t)?new On(r):(0>n?r=r.takeRight(-n):n&&(r=r.drop(n)),t!==q&&(t=Ce(t),r=0>t?r.dropRight(-t):r.take(t-n)),r)},On.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},On.prototype.toArray=function(){return this.take(4294967295)},_t(On.prototype,function(n,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),e=/^(?:head|last)$/.test(t),u=bn[e?"take"+("last"==t?"Right":""):t],o=e||/^find/.test(t);u&&(bn.prototype[t]=function(){function t(n){return n=u.apply(bn,l([n],f)),e&&h?n[0]:n}var i=this.__wrapped__,f=e?[1]:arguments,c=i instanceof On,a=f[0],s=c||qo(i);s&&r&&typeof a=="function"&&1!=a.length&&(c=s=!1);var h=this.__chain__,p=!!this.__actions__.length,a=o&&!h,c=c&&!p;return!o&&s?(i=c?i:new On(this),i=n.apply(i,f),i.__actions__.push({func:ne,args:[t],thisArg:q}),new An(i,h)):a&&c?n.apply(this,f):(i=this.thru(t),a?e?i.value()[0]:i.value():i)})}),u("pop push shift sort splice unshift".split(" "),function(n){var t=fu[n],r=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",e=/^(?:pop|shift)$/.test(n);bn.prototype[n]=function(){var n=arguments;return e&&!this.__chain__?t.apply(this.value(),n):this[r](function(r){return t.apply(r,n)})}}),_t(On.prototype,function(n,t){var r=bn[t],e;r&&(e=r.name+"",(Tu[e]||(Tu[e]=[])).push({name:t,func:r}))}),Tu[_r(q,2).name]=[{name:"wrapper",func:q}],On.prototype.clone=function(){var n=new On(this.__wrapped__);return n.__actions__=nr(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=nr(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=nr(this.__views__),n},On.prototype.reverse=function(){if(this.__filtered__){var n=new On(this);n.__dir__=-1;n.__filtered__=!0}else n=this.clone(),n.__dir__*=-1;return n},On.prototype.value=function(){var n,t=this.__wrapped__.value(),r=this.__dir__,e=qo(t),u=0>r,o=e?t.length:0,l,s;n=o;for(var i=this.__views__,f=0,c=-1,a=i.length;++c<a;){l=i[c];s=l.size;switch(l.type){case"drop":f+=s;break;case"dropRight":n-=s;break;case"take":n=zu(n,f+s);break;case"takeRight":f=Uu(f,n-s)}}if(n={start:f,end:n},i=n.start,f=n.end,n=f-i,u=u?f:i-1,i=this.__iteratees__,f=i.length,c=0,a=zu(n,this.__takeCount__),!e||200>o||o==n&&a==n)return Gt(t,this.__actions__);e=[];n:for(;n--&&a>c;){for(u+=r,o=-1,l=t[u];++o<f;){var h=i[o],s=h.type,h=h.iteratee(l);if(2==s)l=h;else if(!h){if(1==s)continue n;break n}}e[c++]=l}return e},bn.prototype.at=Eo,bn.prototype.chain=function(){return Xr(this)},bn.prototype.commit=function(){return new An(this.value(),this.__chain__)},bn.prototype.flatMap=function(n){return this.map(n).flatten()},bn.prototype.next=function(){this.__values__===q&&(this.__values__=Be(this.value()));var n=this.__index__>=this.__values__.length,t=n?q:this.__values__[this.__index__++];return{done:n,value:t}},bn.prototype.plant=function(n){for(var t,e,u,r=this;r instanceof wn;)e=Pr(r),e.__index__=0,e.__values__=q,t?u.__wrapped__=e:t=e,u=e,r=r.__wrapped__;return u.__wrapped__=n,t},bn.prototype.reverse=function(){var n=this.__wrapped__;return n instanceof On?(this.__actions__.length&&(n=new On(this)),n=n.reverse(),n.__actions__.push({func:ne,args:[Yr],thisArg:q}),new An(n,this.__chain__)):this.thru(Yr)},bn.prototype.toJSON=bn.prototype.valueOf=bn.prototype.value=function(){return Gt(this.__wrapped__,this.__actions__)},Au&&(bn.prototype[Au]=te),bn}var q,P=1/0,T=NaN,K=/\b__p\+='';/g,G=/\b(__p\+=)''\+/g,V=/(__e\(.*?\)|\b__t\))\+'';/g,J=/&(?:amp|lt|gt|quot|#39|#96);/g,Y=/[&<>"'`]/g,H=RegExp(J.source),Q=RegExp(Y.source),X=/<%-([\s\S]+?)%>/g,nn=/<%([\s\S]+?)%>/g,tn=/<%=([\s\S]+?)%>/g,rn=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,en=/^\w*$/,un=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]/g,on=/[\\^$.*+?()[\]{}|]/g,fn=RegExp(on.source),cn=/^\s+|\s+$/g,an=/^\s+/,ln=/\s+$/,sn=/\\(\\)?/g,hn=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,pn=/\w*$/,_n=/^0x/i,vn=/^[-+]0x[0-9a-f]+$/i,gn=/^0b[01]+$/i,dn=/^\[object .+?Constructor\]$/,yn=/^0o[0-7]+$/i,bn=/^(?:0|[1-9]\d*)$/,xn=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,jn=/($^)/,mn=/['\n\r\u2028\u2029\\]/g,wn="[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?)*",An="(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])"+wn,kn=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]","g"),En=RegExp("\\ud83c[\\udffb-\\udfff](?=\\ud83c[\\udffb-\\udfff])|(?:[^\\ud800-\\udfff][\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]?|[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\ud800-\\udfff])"+wn,"g"),In=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),Sn=/[a-zA-Z0-9]+/g,Rn=RegExp(["[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2018\\u2019\\u201c\\u201d \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde]|$)|(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2018\\u2019\\u201c\\u201d \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2018\\u2019\\u201c\\u201d \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde](?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2018\\u2019\\u201c\\u201d \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])|$)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?(?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2018\\u2019\\u201c\\u201d \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+|[A-Z\\xc0-\\xd6\\xd8-\\xde]+|\\d+",An].join("|"),"g"),Wn=/[a-z][A-Z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Bn="Array Buffer Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Map Math Object Reflect RegExp Set String Symbol TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap _ clearTimeout isFinite parseInt setTimeout".split(" "),Cn={},Un;Cn["[object Float32Array]"]=Cn["[object Float64Array]"]=Cn["[object Int8Array]"]=Cn["[object Int16Array]"]=Cn["[object Int32Array]"]=Cn["[object Uint8Array]"]=Cn["[object Uint8ClampedArray]"]=Cn["[object Uint16Array]"]=Cn["[object Uint32Array]"]=!0;Cn["[object Arguments]"]=Cn["[object Array]"]=Cn["[object ArrayBuffer]"]=Cn["[object Boolean]"]=Cn["[object Date]"]=Cn["[object Error]"]=Cn["[object Function]"]=Cn["[object Map]"]=Cn["[object Number]"]=Cn["[object Object]"]=Cn["[object RegExp]"]=Cn["[object Set]"]=Cn["[object String]"]=Cn["[object WeakMap]"]=!1;Un={};Un["[object Arguments]"]=Un["[object Array]"]=Un["[object ArrayBuffer]"]=Un["[object Boolean]"]=Un["[object Date]"]=Un["[object Float32Array]"]=Un["[object Float64Array]"]=Un["[object Int8Array]"]=Un["[object Int16Array]"]=Un["[object Int32Array]"]=Un["[object Map]"]=Un["[object Number]"]=Un["[object Object]"]=Un["[object RegExp]"]=Un["[object Set]"]=Un["[object String]"]=Un["[object Symbol]"]=Un["[object Uint8Array]"]=Un["[object Uint8ClampedArray]"]=Un["[object Uint16Array]"]=Un["[object Uint32Array]"]=!0;Un["[object Error]"]=Un["[object Function]"]=Un["[object WeakMap]"]=!1;var zn={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},Mn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Ln={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},$n={"function":!0,object:!0},Fn={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Nn=parseFloat,Dn=parseInt,Zn=$n[typeof exports]&&exports&&!exports.nodeType?exports:q,qn=$n[typeof module]&&module&&!module.nodeType?module:q,Pn=qn&&qn.exports===Zn?Zn:q,Tn=I($n[typeof self]&&self),Kn=I($n[typeof window]&&window),Gn=I($n[typeof this]&&this),Vn=I(Zn&&qn&&typeof global=="object"&&global)||Kn!==(Gn&&Gn.window)&&Kn||Tn||Gn||Function("return this")(),Jn=Z();(Kn||Tn||{})._=Jn;typeof define=="function"&&typeof define.amd=="object"&&define.amd?define(function(){return Jn}):Zn&&qn?(Pn&&((qn.exports=Jn)._=Jn),Zn._=Jn):Vn._=Jn}).call(this);
"use strict";function loadScripts(scriptsToLoad,callback){var remainingScriptsToLoad=scriptsToLoad.slice(),scriptToLoad;remainingScriptsToLoad.length===0?callback&&callback():(scriptToLoad=remainingScriptsToLoad.splice(0,1)[0],$.cachedScript(scriptToLoad,{success:function(){loadScripts(remainingScriptsToLoad,callback)}}))}function checkForError($page){$page.find(".personPageUnavailable").length>0&&$page.addClass("personPageError")}function HtmlDecode(s){var div=document.createElement("div");return div.innerHTML=s.replace(/<\/?[^>]+>/gi,""),div.childNodes[0]?div.childNodes[0].nodeValue:""}function getTabNameStringForPageTitle(tabName){switch(tabName){case"story":return window.PersonCard.text.lifeStoryTabName;case"facts":return window.PersonCard.text.factsTabName;case"gallery":return window.PersonCard.text.galleryTabName;case"hints":return window.PersonCard.text.hintsTabName}}function updateView($view){return(closeCallouts(),$view.removeClass("personPageError"),!$view.hasClass("loading"))?($view.addClass("loading loadingLarge").children().empty(),!0):!1}function changeView(tabId){renderView(tabId)}function gluePreProcess(tab){if(tab!=="csm"){var data=getTabData(tab),$view=$("#"+data.contentId),$tab=$("#"+data.tabId),$oldTab=$("a.tab.tabActive");$view.children()&&($view.hasClass("loading")||($("html").attr("data-page",tab),$oldTab.removeClass("tabActive"),$tab.addClass("tabActive"),$(".tabContent.tabActive").removeClass("tabActive"),$view.addClass("tabActive"),$view.find(".personPage").children().length===0?$tab.click():$view.load()));changeView($tab.attr("id"))}}function checkNotesAndComments(){$("html").hasClass("printFriendly")?((!$("html").hasClass("pFHasNotes")&&showingNotes===!1||$("html").hasClass("pFHasNotes")&&$("#printFriendlyNotes").children().length===0)&&getPersonNotes(),checkComments()):$("html").hasClass("pageWrapDrawer")?(showingNotes===!0&&($("html").removeClass("pFShowingComments"),$("html").addClass("pFShowingNotes"),checkNotes()),showingComments===!0&&($("html").removeClass("pFShowingNotes"),$("html").addClass("pFShowingComments")),checkComments()):$("html").removeClass("pFShowingComments pFShowingNotes")}function checkNotes(){$("#printFriendlyNotes").text().length>0?$("html").addClass("pFHasNotes"):$("html").removeClass("pFHasNotes")}function checkComments(){$("html").hasClass("pFHasComments")&&(commentWidgetHasLoaded===!1?loadComments():cloneCommentsForPrinting())}function beforePrint(){closeBeforePrint();$("html").addClass("pFNoTransitions");$(".pageHeader").hasClass("pageHeaderFacts")&&($("html").hasClass("printFriendly")&&$(".factsSectionSources").insertAfter($(".factsSectionFamily")),checkNotesAndComments())}function afterPrint(){$("html").removeClass("pFNoTransitions");$(".pageHeader").hasClass("pageHeaderFacts")&&($("html").hasClass("printFriendly")&&($(".factsSectionSources").insertAfter($(".factsSectionFacts")),clearPrintFriendly(),typeof checkMiniProfile=="function"&&checkMiniProfile()),$(".printFriendlyViewTriggered").length>0&&$(".printFriendlyViewTriggered").removeClass("printFriendlyViewTriggered").focus())}function closeBeforePrint(){$("html").hasClass("modalOpen")&&$.modal.close();$(".callout").hasClass("active")&&closeCallouts()}function clearPrintFriendly(){$("html").removeClass("printFriendly pFNoTransitions pFNoFacts pFNoFamily pFNoSources pFShowingNameGender pFShowingSiblings");checkNotesAndComments()}function printFunction(){window.PersonCard.showMyCanvas?$(".pageHeader").hasClass("pageHeaderFacts")?($("html").addClass("printFriendly"),beforePrint()):window.PersonCard.hasEditRights?printPersonViewModal():(closeBeforePrint(),setTimeout(function(){window.print()},200)):(closeBeforePrint(),setTimeout(function(){window.print()},200))}function cloneCommentsForPrinting(){cloneComments===!0&&(cloneComments=!1,$("#printFriendlyComments").empty(),$("#personCommentsSection .comment.userCard:not(.addComment):not(.signIn)").each(function(){var $this=$(this),userCardContent=$this.find(".userCardContent"),userCardName=$this.find(".userCardName").text(),userCardComment=$this.find(".userCardName + span").text(),userCardInfo=$this.find(".userCardInfo small > span:first-child").text();userCardContent.length>0&&$('<div class="userCard userCardSize3 printFriendlyUserCard"><div class="userCardImg icon iconPerson"><\/div><div class="userCardContent"><p class="userCardComment"><strong>'+userCardName+"<\/strong> "+userCardComment+'<\/p><div class="userCardInfo"><small>'+userCardInfo+"<\/small><\/div><\/div><\/div>").appendTo("#printFriendlyComments")}),cloneComments=!0)}function printPersonViewModal(){$("#printPersonViewModal").modal({width:"410",title:window.PersonCard.text.printingOptionsTitle,useCustomPadding:!0,onOpen:function(){$(".printPersonViewModal").off("click").on("click",".iconPrint",function(){closeBeforePrint();setTimeout(function(){window.print()},200)})},onClose:function(){$(".myCanvasPrintModalTriggered").removeClass("myCanvasPrintModalTriggered").focus()}})}function findAPersonTreeOptionsPersonCard(){$(".treeOptions").callout({type:"click",classes:"treeOptionsCallout",content:"#personLookup",onOpen:function(){personTypeAheadNameField($("#personLookupField"),"",null,"personCard",!0)},onAfterOpen:function(){$("#personLookupField").focus()},onClose:function(){$(".treeOptions").focus()}})}function resetTypeAhead(fieldName){var typeAheadField=$(fieldName);typeAheadField.val().length===0&&$(".autocompleteCon").removeClass("autocompleteVisible")}function personTypeAheadNameField($typeAhead,excludepids,typeAheadSaveButton,section,showExtra){var hasSection=typeof section!="undefined"&&section!=null&&section.length>0,treeId=window.PersonCard.treeId;typeof typeAheadSaveButton!="undefined"&&typeAheadSaveButton!=null&&typeAheadSaveButton.length>0&&typeAheadSaveButton.attr("disabled","disabled");$typeAhead.autocomplete({alwaysOpenOnFocus:!0,source:"/suggest/person?treeId="+treeId+"&serviceDown=none&excludePids="+excludepids,key:"name",queryParameter:"term",dataType:"json",minLength:3,maxResults:20,customDisplay:function(data){var displayText=data.display;return(data.raw.birth!==""||data.raw.death!=="")&&(displayText+=" "+data.raw.birth+" - "+data.raw.death),{value:data.value,display:displayText}},onOpen:function($resultContainer,$before,$after){showExtra&&$after.html($("#findPersonActions").html())},onItemSelect:function(itemData){var pageUrl,$this,$card;if(itemData!==""){if(hasSection&&section==="personCard"){pageUrl=window.PersonCard.URL.storyHref;switch($(".tabActive").attr("id")){case"tabFacts":pageUrl=window.PersonCard.URL.factsHref;break;case"tabGallery":pageUrl=window.PersonCard.URL.galleryHref;break;case"tabHints":pageUrl=window.PersonCard.URL.hintsHref}typeof itemData.PID!="undefined"&&(pageUrl=pageUrl.replace(window.PersonCard.personId,itemData.PID));window.location=pageUrl}$this=$(this);$this.length>0&&($this.addClass("selectedPerson"),itemData.PID!==""&&($card=$this.closest(".card"),$card.find(".erAddExistingData").data("itemData",itemData)));typeof typeAheadSaveButton!="undefined"&&typeAheadSaveButton!=null&&typeAheadSaveButton.length>0&&typeAheadSaveButton.removeAttr("disabled")}}});$typeAhead.on("input",function(){$(this).removeClass("selectedPerson")})}function toggleDrawer(){var toggleDrawerElement=$("html"),toggleDrawerInterval;if(toggleDrawerElement.hasClass("pageWrapDrawer")){toggleDrawerInterval=setInterval(function(){toggleDrawerElement.hasClass("pFShowingNotes")||toggleDrawerElement.hasClass("pFShowingComments")?togglingDrawer():clearInterval(toggleDrawerInterval)},10);toggleDrawerElement.removeClass("noTransitionsForPageWrap pageWrapDrawer").one("webkitTransitionEnd transitionend",function(){toggleDrawerElement.removeClass("pFShowingNotes pFShowingComments");togglingDrawer()})}else{toggleDrawerInterval=setInterval(function(){toggleDrawerElement.hasClass("noTransitionsForPageWrap")?clearInterval(toggleDrawerInterval):togglingDrawer()},10);toggleDrawerElement.addClass("pageWrapDrawer").one("webkitTransitionEnd transitionend",function(){toggleDrawerElement.addClass("noTransitionsForPageWrap");togglingDrawer()})}drawerIsOpen()?getPersonNotes():closeNotes()}function togglingDrawer(){window.personScreenType("smart-phone")||togglingDrawerNotSmartPhone();typeof checkMiniProfile=="function"&&checkMiniProfile()}function togglingDrawerNotSmartPhone(){$(".pageHeader").hasClass("pageHeaderFacts")&&$(".factItemFocused").length>=2&&reconnectLines();$(".pageHeader").hasClass("pageHeaderStory")&&setBelayLines(!1)}function toggleDrawerToTab(tabSelector){closeCallouts();drawerIsOpen()?$(tabSelector).hasClass("tabActive")?toggleDrawer():$(tabSelector).click():(toggleDrawer(),$(tabSelector).click())}function drawerIsOpen(){return $("html").hasClass("pageWrapDrawer")}function loadCommentCount(){var url="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/commentcount";$.ajax({url:url,cache:!1,timeout:2e4,success:function(data){if(typeof data!="undefined"&&typeof data.count!="undefined"){var count=data.count<1?"":data.count>99?"99+":data.count;count!==""?($(".personCommentsBtn .badge").text(count).removeClass("hideBadge"),$("html").addClass("pFHasComments")):($(".personCommentsBtn .badge").addClass("hideBadge"),$("html").removeClass("pFHasComments pFShowingComments"))}}})}function loadComments(){function loadScriptTagWithCallback(scriptSrc,callback){var scriptTag=$("<script />",{src:scriptSrc,type:"text/javascript"})[0];scriptTag.onload=callback;document.getElementsByTagName("head")[0].appendChild(scriptTag)}commentWidgetHasLoaded=!1;$("comment-widget").length>0&&$(".tabContentComments.loading").length===0&&($(".tabContentComments").addClass("loading loadingLarge"),$.get("http://"+window.PersonCard.domain.comments+"/ui/comment/cssfile?includeDomain=true",function(commentCssUrl){$("head").append($("<link />",{href:commentCssUrl,type:"text/css",rel:"stylesheet"}))}),loadScriptTagWithCallback(window.PersonCard.URL.angular,function(){$.get("http://"+window.PersonCard.domain.comments+"/ui/comment/jsfile?includeDomain=true",function(commentJsUrl){loadScriptTagWithCallback(commentJsUrl,function(){if(angular.bootstrap($("comment-widget"),["community"]),$(".tabContentComments").removeClass("loading loadingLarge"),$("html").hasClass("pFHasComments")&&$("html").hasClass("printFriendly"))var hasCommentsLoaded=setInterval(function(){$("#personCommentsSection .comment").length>=1&&(clearInterval(hasCommentsLoaded),cloneCommentsForPrinting())},50);commentWidgetHasLoaded=!0})})}))}function researchToolbar(){var curView="",tUrl;$(".pageNav").hasClass("pageNavCollapsed")?($(".pageNav").removeClass("pageNavCollapsed").addClass("pageNavExpanded"),curView="Expanded"):($(".pageNav").removeClass("pageNavExpanded").addClass("pageNavCollapsed"),curView="Collapsed");closeCallouts();tUrl="/northstar/personview/researchtoolbar?view="+curView;$.ajax({cache:!1,url:tUrl}).done(function(){})}function closeCallouts(){$(".calloutTrigger.active").callout("close")}function renderView(tabId){var $personHeader=$(".pageHeader"),$currentTab=$(".tabActive"),$newTab=$("#"+tabId),currentId=$currentTab.attr("id");$personHeader.removeClass("pageHeader"+getCurrentViewName(currentId));tabId!=="tabStory"?$personHeader.removeClass("pageHeaderStory").addClass("pageHeaderNotStory pageHeader"+getCurrentViewName(tabId)):$personHeader.removeClass("pageHeaderNotStory pageHeaderFacts pageHeaderGallery pageHeaderHints").addClass("pageHeaderStory");$("html").hasClass("printFriendly")&&clearPrintFriendly()}function getCurrentViewName(id){switch(id){case"tabFacts":return"Facts";case"tabGallery":return"Gallery";case"tabHints":return"Hints";default:return"Story"}}function CheckTextAreaLength(textBox,maxLength){var textBoxEl=$("#"+textBox.id);textBoxEl.length>0&&textBoxEl.val().length>maxLength&&textBoxEl.val(textBoxEl.val().substring(0,maxLength))}function CheckTextElementLength(textBox,maxLength){textBox.innerText.length>maxLength&&(textBox.innerText=textBox.innerText.substring(0,maxLength))}function updateModalTitle(tabContent1Val,tabContent2Val,tabContent3Val,tabContent4Val,tabContent5Val){$(".tabContent1").hasClass("tabActive")&&$.modal.title(tabContent1Val);$(".tabContent2").hasClass("tabActive")&&$.modal.title(tabContent2Val);$(".tabContent3").hasClass("tabActive")&&$.modal.title(tabContent3Val);$(".tabContent4").hasClass("tabActive")&&$.modal.title(tabContent4Val);$(".tabContent5").hasClass("tabActive")&&$.modal.title(tabContent5Val)}function modalButtonClick(){$("#modalContents").on("click",".tab",function(){if($("#modal").hasClass("modalEditEvent")){var displayLifeStory=$(".tabContent4").find(".displayLifestory"),displayLifeStoryVal=displayLifeStory.prop("checked");displayLifeStory.data("original-displaylifestory",displayLifeStoryVal.toString())}$("#modal").hasClass("modalEditSource")&&updateModalTitle($(".title").val(),$(".citationDetailTitle").val(),$(".associatedFactsEventsTitle").val(),$(".attachedMediaTitle").val());$.modal.center()})}function removePersonModal(){closeCallouts();$("#modalRemovePerson").modal({title:window.PersonCard.text.removePersonTitle,onOpen:function(){$("#documentReturnURL").val(document.URL)},onClose:function(){$(".remModalTriggered").removeClass("remModalTriggered").focus()}})}function removePerson(){$.ajax({url:window.PersonCard.URL.removePerson,type:"POST",data:{name:window.PersonCard.name},success:function(data){data&&data.success?location.href=data.returnUrl:($.modal.close(),acom.bus.emit("FamilySearch::Notify::Failure",data.message,window.PersonCard.text.removePersonTitle))},error:function(){}})}function detachMediaFromCitation(citationId,mediaId,callback){var url="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/citationId/"+citationId+"/mediaid/"+mediaId+"/detachmediafromcitation";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){data.result&&typeof callback=="function"&&callback(data)},error:function(){window.lock.actionInProgress=!1;personAnalyticsTrackClick("detachMediaFromCitation-Failed")}})}function detachMediaFromEvent(assertionId,mediaId,callback){var url="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/assertionid/"+assertionId+"/mediaid/"+mediaId+"/detachmediafromevent";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){typeof callback=="function"&&callback(data,"#"+assertionId+"mediaListCount")},error:function(){window.lock.actionInProgress=!1;personAnalyticsTrackClick("detachMediaFromEvent-Failed")}})}function bindProfileImageClick(){if(PersonCard&&window.PersonCard.hasEditRights&&window.PersonCard.isProfileImageCropEnabled){var userCard=$("#personCard .userCardImg");if(window.PersonCard.primaryImageId)userCard.off().callout("destroy").callout({type:"click",style:"dark",classes:"calloutMenu",content:"#profileImageCalloutDomContent"});else userCard.callout("destroy").off().on("click",showChooseProfileImageModal)}}function updatePersonProfileImage(mediaId,cropRect){var url="http://"+window.PersonCard.domain.mediaAPI+"/api/trees/"+window.PersonCard.treeId+"/persons/"+window.PersonCard.personId,requestData={mediaId:mediaId||""},readCookie=function(name){for(var c,nameEQ=name+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(c=ca[i];c.charAt(0)===" ";)c=c.substring(1,c.length);if(c.indexOf(nameEQ)===0)return c.substring(nameEQ.length,c.length)}return null};$.ajax({type:"PUT",url:url,data:JSON.stringify(requestData),contentType:"application/json",beforeSend:function(request){request.setRequestHeader("ATT",readCookie("ATT"))},success:function(){window.PersonCard.primaryImageId=requestData.mediaId;window.PersonCard.primaryImageCropRect=cropRect||"";loadProfileImage()},error:function(){window.acom!=null&&window.acom.bus!=null&&window.acom.bus.emit("RemoveProfileImage::Notify::Failure",window.PersonCard.text.removeProfileImageError,window.PersonCard.text.removeProfileImageTitle)}})}function loadProfileImage(){var userCardImage=$("#personCard .userCardImg");window.PersonCard.primaryImageId?(userCardImage.removeClass("icon iconMale iconFemale iconPerson").find("img").attr("src",getProfileImageUrl),setMediaViewerCropUrl()):userCardImage.addClass("icon icon"+window.PersonCard.gender);bindProfileImageClick()}function getProfileImageUrl(){var url=window.PersonCard.domain.mediaSvc+"/v2/image/namespaces/1093/media/"+window.PersonCard.primaryImageId+"?client=PersonUI&maxSide=280";return window.PersonCard.primaryImageCropRect&&(url+="&ImageQuality=UltraHighQuality&scaleUpToMax=true&prescalecroprect="+window.PersonCard.primaryImageCropRect),url}function showChooseProfileImageModal(){function onMediaClick(mediaIds){var mediaItem=mediaIds[0];updatePersonProfileImage(mediaItem.id,mediaItem.cropRect);$.modal.close()}function selectorLoad(){$.modal.center()}if(window.acom&&window.acom.bus){window.acom.bus.on("Selector::selectionUpdated",onMediaClick);window.acom.bus.on("Selector::loaded",selectorLoad)}var modalContainer=$("#chooseProfileImageModalContainer"),url="http://"+PersonCard.domain.mediaUI+"/component/selector/"+PersonCard.treeId+"/"+PersonCard.personId+"/1030"+"?selectedMediaIds{selectedIds}=&filter=p".replace("{selectedIds}",PersonCard.primaryImageId);modalContainer.modal({onOpen:function(){var glueOptions;window.ancestry&&window.ancestry.pub&&window.ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:PersonCard.treeId,PersonId:PersonCard.personId},!0);glueOptions={domId:"chooseProfileImageModalContainer",url:url};window.glue.fetch(glueOptions);var $modalHeader=$("#modalHeader"),$modalContents=$("#modalContents"),minHeight=$(window).height()-parseInt($modalContents.css("margin-top"),10)*2-$modalHeader.outerHeight(!1)-parseInt($modalHeader.css("margin-bottom"),10)*2;$modalContents.css({"min-height":minHeight})},onClose:function(){modalContainer.empty();window.acom&&window.acom.bus&&(window.acom.bus.off("Selector::selectionUpdated",onMediaClick),window.acom.bus.off("Selector::loaded",selectorLoad))},title:window.PersonCard.text.chooseProfileImageModalTitle.replace("{personName}",window.PersonCard.name),width:"100%"})}function showAddMediaToLifeStoryModal(){function filterMediaToAddToTimeline(items){var attachedIds=[],filtered=_.filter(PersonStory.timeline.events,function(event){return event.EventMedia.length>0}),attachedIds=_.map(filtered,function(event){return event.EventMedia[0].Id});_.forEach(items,function(item){(item.date||attachedIds.indexOf(item.id)!=-1||!item.rights.canEdit)&&(item.active=!1)})}function mediaOnClick(items){var media=items[0];showAddMediaLifestoryDetails(media)}function selectorLoad(){$.modal.center()}if(window.acom&&window.acom.bus){window.acom.bus.on("Selector::filterItems",filterMediaToAddToTimeline);window.acom.bus.on("Selector::selectionUpdated",mediaOnClick);window.acom.bus.on("Selector::loaded",selectorLoad)}$('<div id="addTimelineMedia">').modal({onOpen:function(){var url="http://"+PersonCard.domain.mediaUI+"/component/selector/"+PersonCard.treeId+"/"+PersonCard.personId+"/1030?filter=p&upload=1",glueOptions;window.ancestry&&window.ancestry.pub&&window.ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId});glueOptions={domId:"addTimelineMedia",url:url};window.glue.fetch(glueOptions)},onClose:function(){window.acom&&window.acom.bus&&(window.acom.bus.off("Selector::selectionUpdated",mediaOnClick),window.acom.bus.off("Selector::filterItems",filterMediaToAddToTimeline),window.acom.bus.off("Selector::loaded",selectorLoad))},title:window.PersonCard.text.addMediaToLifeStoryModalTitle,width:"100%"})}function showAddMediaLifestoryDetails(media){function addMediaToLifeStory(response){response||acom.bus.emit("AddMediaToLifeStory::Notify::Failure",PersonCard.text.addMediaToLifeStoryError,PersonCard.text.addMediaToLifeStoryModalTitle);$.modal.close();window.glue.reload()}if(window.acom&&window.acom.bus){window.acom.bus.on("Details::onSave",addMediaToLifeStory);window.acom.bus.on("Details::onCancel",showAddMediaToLifeStoryModal)}var url="http://"+PersonCard.domain.mediaUI+"/component/details/"+PersonCard.treeId+"/"+PersonCard.personId+"/"+media.id;$('<div id="addTimelineMediaDetails">').modal({onOpen:function(){var glueOptions={domId:"addTimelineMediaDetails",url:url};window.glue.fetch(glueOptions)},onClose:function(){window.acom&&window.acom.bus&&(window.acom.bus.off("Details::onSave",addMediaToLifeStory),window.acom.bus.off("Details::onCancel",showAddMediaToLifeStoryModal))},width:"760"})}function attachMediaToCitation(citationId,mediaId,callback){var url="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/citationId/"+citationId+"/mediaid/"+mediaId+"/attachmediatocitation";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){typeof callback=="function"&&callback(data)},error:function(){window.lock.actionInProgress=!1;personAnalyticsTrackClick("attachMediaToCitation-Failed")}})}function attachMediaToEvent(assertionId,mediaId,callback){var url="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/assertionid/"+assertionId+"/mediaid/"+mediaId+"/attachmediatoevent";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){typeof callback=="function"&&callback(data)},error:function(){window.lock.actionInProgress=!1;personAnalyticsTrackClick("attachMediaToEvent-Failed")}})}function detachSourceFromEvent(assertionId,sourceId,selector,callback){var url="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/assertionid/"+assertionId+"/sourceid/"+sourceId+"/detachsourcefromevent";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){typeof callback=="function"&&callback(data)},error:function(){window.lock.actionInProgress=!1;window.updateSourceAttachDetachState(assertionId,sourceId,!0,selector);personAnalyticsTrackClick("detachSourceFromEvent-Failed")}})}function attachSourceToEvent(assertionId,sourceId,selector,callback){var url="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/assertionid/"+assertionId+"/sourceid/"+sourceId+"/attachsourcetoevent";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,success:function(data){typeof callback=="function"&&callback(data)},error:function(){window.updateSourceAttachDetachState(assertionId,sourceId,!1,selector);personAnalyticsTrackClick("attachSourceToEvent-Failed")}})}function saveToTree(){window.closeCallouts();$.ajax({url:window.PersonCard.URL.saveToTree,type:"GET",dataType:"jsonp",contentType:"application/json",jsonpCallback:"handleJSON",success:function(){},error:function(){var html="<div><p>"+window.PersonCard.text.saveToTreeError+"<\/p><\/div>";$(html).modal({title:window.PersonCard.text.saveToTreeTitle,width:"760",onOpen:function(){}})}})}function quickEdit(){var apmCallback=function(cbResponse){return cbResponse.reqRefresh===!0?(location.reload(),!1):(cbResponse.mode==="m"&&$.modal.close(),cbResponse.status==="success"&&(window.personAnalyticsTrackClick("QuickEditPersonSaved"),window.getPersonCard()),!0)};AddPerson.Edit(window.PersonCard.treeId,window.PersonCard.personId,{},apmCallback)}function addFamilyMember(tid,pid,args){var apmCallback=function(cbResponse){return cbResponse.status==="success"&&(window.personAnalyticsTrackClick("QuickEditPersonSaved"),window.getPersonCard()),cbResponse.mode==="m"&&$.modal.close(),!0};AddPerson.Add(tid,pid,args,apmCallback)}function getPersonCard(){$.ajax({url:window.PersonCard.URL.getPersonCard,type:"GET",dataType:"json",contentType:"application/json",jsonpCallback:"handleJSON",success:function(response){var pcc=$("#personCardContainer");pcc.length>0&&response.html!==""&&(pcc.html(response.html),typeof response.js!="undefined"&&typeof personCardLoaded=="undefined"&&$.getScript(response.js).done(function(){}).fail(function(){}),bindProfileImageClick())},error:function(){}})}function editRelationships(addedPid,addedRelation,isTransition){(isTransition===null||isTransition===!1)&&window.closeCallouts();var name=window.PersonCard.text.editRelsModalTitle.replace("{fullName}",$("#personCardContainer").find(".userCardTitle").html());$('<div class="modalPersonView modalEditRelationship form" id="editRelationshipsModal"><\/div>').modal({title:name,useCustomPadding:!1,width:"760",showLoading:!0,onOpen:function(){$.ajax({url:window.PersonCard.URL.editRelationships,data:{addedPid:addedPid,addedRelation:addedRelation},type:"GET",dataType:"jsonp",cache:!1,contentType:"application/json",success:function(response){$.modal.showLoading(!1);$(".modalEditRelationship").html(response.html);$.cachedScript(window.PersonCard.editRelationshipUrl).done(function(){response.data.addedPid=addedPid;window.editRelationship(response.data)})},error:function(){$.modal.showLoading(!1);var html='<div class="ancGrid ancGridPadded"><div class="ancCol w100"><p class="icon iconWarning">'+window.PersonCard.text.editRelationshipsError+"<\/p><\/div><\/div>";$(".modalEditRelationship").html(html);$.modal.center()}})},onClose:function(){$(".editRelModalTriggered").removeClass("editRelModalTriggered").focus();window.editRelationship&&window.editRelationship.updated&&(window.glue?window.glue.reload():location.reload());$.get("/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/relationship/log/modalclose")}})}function handleJSON(response){$(response.html).modal({title:window.PersonCard.text.saveToTreeTitle,width:"760",onOpen:function(){$.getScript(response.js).done(function(){}).fail(function(){})},onClose:function(){$(".savModalTriggered").removeClass("savModalTriggered").focus()}})}function reloadContent(){$(".pageHeader .tab.tabActive").click()}function clearNarrativeCache(){var ccUrl="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/clearnarrativecache";$.ajax({url:ccUrl,method:"GET",async:!1})}function updateHintCount(data){var $hintbubble=$("#tabHintCount"),n=data;n<=0?(n=0,$hintbubble.addClass("hideBadge")):$hintbubble.removeClass("hideBadge");n>99&&(n="99+");$hintbubble.text(n);$("#personTabs").tabs()}function setMediaViewerUrl(){window.ancestry.pub&&(window.ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId}),window.ancestry.pub.buildUrl().toGoTo("MediaViewer",{MediaId:window.PersonCard.primaryImageId,TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId}).toComeBackToCurrent(!0).build(function(err,url){err||(window.location=url)}))}function setMediaViewerCropUrl(){window.ancestry.pub&&(window.ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId}),window.ancestry.pub.buildUrl().toGoTo("MediaViewer",{MediaId:window.PersonCard.primaryImageId,TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId,ShowImageCropping:1}).toComeBackToCurrent(!0).build(function(err,url){err||(window.location=url)}))}function setLifeStoryMediaUploadWithHistoryUrl(clickAnchor,assertionId){if(window.ancestry.pub){var options={destInputs:{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId,AssertionId:assertionId,MediaType:"Photo"},currentPageIsStart:!0};window.ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId});window.ancestry.pub.getUrl("PersonFactMediaObjectUpload",options,function(e,url){if(!e)return window.location=url,!1})}}function setFactsMediaUploadWithHistoryUrl(clickAnchor,assertionId){if(window.ancestry.pub){var options={destInputs:{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId,AssertionId:assertionId,MediaType:"Media"},currentPageIsStart:!0};window.ancestry.pub.setCurrentPage("PersonFactsFactEdit",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId,AssertionId:assertionId,TabName:"Media"});window.ancestry.pub.getUrl("PersonFactMediaObjectUpload",options,function(e,url){e||(window.location=url)})}}function setCitationMediaUploadWithHistoryUrl(clickAnchor,citationId){window.ancestry.pub&&(window.ancestry.pub.setCurrentPage("PersonFactsCitationEdit",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId,CitationId:citationId,TabName:"Media"}),window.ancestry.pub.buildUrl().toGoTo("PersonCitationMediaObjectUpload",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId,CitationId:citationId,MediaType:"Media"}).toComeBackToCurrent(!0).build(function(e,url){e||(window.location=url)}))}function setLifeStoryHistoryPoint(){var setHistoryPoint="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/setlifestoryhistorypoint";$.ajax({url:setHistoryPoint,method:"GET",success:function(){}})}function setSearchWithHistoryUrl(clickAnchor){if(window.ancestry.pub){var options={destInputs:{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId,SSRC:"pt"},currentPageIsStart:!0};window.ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId});window.ancestry.pub.getUrl("PersonRecordSearch",options,function(e,url){if(!e)return clickAnchor.href=url,window.location=url,!1})}}function setMergeDuplicateWithHistoryUrl(clickAnchor){if(window.ancestry.pub){var options={destInputs:{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId,PersonIdPrimary:window.PersonCard.personId},currentPageIsStart:!0};window.ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId});window.ancestry.pub.getUrl("PersonMergeDuplicatePickPerson",options,function(e,url){if(!e)return clickAnchor.href=url,window.location=url,!1})}}function setViewMediaWithHistoryUrl(clickAnchor){if(window.ancestry.pub){var options={destInputs:{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId,ObjectId:"pt"},currentPageIsStart:!0};window.ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId});window.ancestry.pub.getUrl("MediaObject",options,function(e,url){e||(clickAnchor.href=url)})}}function setHintsPubCurrentPage(data){var pair,key;if(window.ancestry.pub){var inputs={TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId},pairs=location.search.slice(1).split("&"),index=0;try{if(pairs[index].length)for(index=0;index<pairs.length;index++)pair=pairs[index].split("="),pair&&pair[0].startsWith&&pair[0].startsWith("Hints.")&&(key=pair[0].replace("Hints.",""),key=key.charAt(0).toUpperCase()+key.slice(1),inputs[key]=decodeURIComponent(pair[1]||""))}catch(e){}window.ancestry.pub.setCurrentPage("PersonPageHintsView",inputs);window.acom&&window.acom.bus&&window.acom.bus.emit("csm::history::currentpagechange",data)}}function setGalleryPubCurrentPage(){window.ancestry.pub&&window.ancestry.pub.setCurrentPage("PersonViewMediaGallery",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId})}function setHintsWithHistoryUrl(){if(window.ancestry.pub&&(setHintsPubCurrentPage({}),acom&&acom.bus&&acom.bus.listeners("csm::history::statechange").length<1))acom.bus.on("csm::history::statechange",setHintsPubCurrentPage)}function setViewRecordImageHistory(clickAnchor,citationId){window.ancestry.pub&&window.ancestry.pub.setCurrentPage("PersonFactsCitationEdit",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId,CitationId:citationId})}function setViewRecordPageHistory(clickAnchor,citationId){window.ancestry.pub&&window.ancestry.pub.setCurrentPage("PersonFactsCitationEdit",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId,CitationId:citationId})}function setMemberConnectWithHistoryUrl(clickAnchor){if(window.ancestry.pub){var options={destInputs:{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId},currentPageIsStart:!0};window.ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId});window.ancestry.pub.getUrl("PersonMemberConnect",options,function(e,url){if(!e)return clickAnchor.href=url,window.location=url,!1})}}function setGalleryHistoryPoint(){var setHistoryPoint="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/setgalleryhistorypoint";$.ajax({url:setHistoryPoint,method:"GET",success:function(){}})}function setMilitaryWithHistoryUrl(clickAnchor){if(window.ancestry.pub){var options={destInputs:{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId},currentPageIsStart:!0};window.ancestry.pub.setCurrentPage("CurrentPersonView",{TreeId:window.PersonCard.treeId,PersonId:window.PersonCard.personId});window.ancestry.pub.getUrl("PersonMilitaryPage",options,function(e,url){if(!e)return clickAnchor.href=url,window.location=url,!1})}}function setTreeLink(clickAnchor,pubName){var options={destInputs:{TreeId:window.PersonCard.treeId},currentPageIsStart:!1};window.ancestry.pub&&window.ancestry.pub.getUrl(pubName,options,function(e,url){if(e)window.console!=null&&console.err(e);else return clickAnchor.href=url,window.location=url,!1})}function getPersonHintsCount(){var hintsCountUrl="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/hintscount";$.ajax({url:hintsCountUrl,method:"GET",success:function(data){updateHintCount(data.PendingHintCount)}})}function actionComplete(){try{window.glue.reload(function(){window.lock.actionInProgress=!1})}catch(e){window.lock.actionInProgress=!1}}function closeNotes(){SaveController.SaveWithCheck();$("#savingChangesText").hide();window.onbeforeunload=null}function getClEditorTextDataArea(){return $(".cleditorMain iframe").contents().find("body")}function convertHtmlTags(htmlVal){return htmlVal.replace(/>/g,"&gt;").replace(/</g,"&lt;")}function clearChangesSavedText(){$("#savingChangesText").hide();$("#savingChangesText").html(window.PersonCard.text.savingChanges)}function getPersonNotes(callback){var getPersonNotesUrl="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/getPersonNotes";$.ajax({url:getPersonNotesUrl,method:"GET",cache:!1,success:function(data){var notesField,pFNotesField,notesValOriginal;data&&data.note!=null&&(notesField=$("#NotesTextAreaNoEditor"),pFNotesField=$("#printFriendlyNotes"),notesField.length>0&&(notesField.html(data.note),notesField.attr("data-notes-original",data.note),typeof data.noteId!="undefined"&&data.noteId!=null?notesField.attr("data-notes-original-id",data.noteId):notesField.attr("data-notes-original-id",""),notesValOriginal=notesField.attr("data-notes-original"),(notesValOriginal.length!==notesField.html().length||notesValOriginal!==notesField.html())&&(window.onbeforeunload=function(evt){return SaveController.SaveWithCheck(),evt.returnValue=undefined,undefined})),pFNotesField.html(data.note),checkNotes());callback&&callback()},error:function(){personAnalyticsTrackClick("getPersonNotes-Failed");callback&&callback()}})}function savePersonNotes(callback){var notesField,pFNotesField;if($("#savingChangesText").show(),notesField=$("#NotesTextAreaNoEditor"),pFNotesField=$("#printFriendlyNotes"),notesField.length>0){var converted=notesField.html(),id=notesField.attr("data-notes-original-id"),savePersonNotesUrl="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/savePersonNotes";$.ajax({type:"POST",data:{note:converted,noteId:id},url:savePersonNotesUrl,timeout:2e4,success:function(data){typeof data.noteId!="undefined"&&data.noteId!=null&&($("#savingChangesText").text(window.PersonCard.text.changesSaved),notesField.html(converted),notesField.attr("data-notes-original",converted),typeof data.noteId!="undefined"&&data.noteId!=null?notesField.attr("data-notes-original-id",data.noteId):notesField.attr("data-notes-original-id",""),pFNotesField.html(converted),checkNotes());callback&&callback()},error:function(){$("#savingChangesText").text(window.PersonCard.text.changesNotSaved);personAnalyticsTrackClick("savePersonNotes-Failed");callback&&callback()}})}}function saveUIState(selection,stateData){var $selection,selector,state;typeof selection!="undefined"&&(typeof selection=="string"&&(selection[0]==="#"||selection[0]===".")?(selector=selection,$selection=$(selection)):selection instanceof jQuery?($selection=selection,$selection.length>0&&(selector=$selection.attr("id"),selector?selector="#"+selector:(selector=$selection.attr("class"),selector&&(selector="."+selector)))):window.console!=null&&console.warn("Could not save selector: "+selection),$selection!=null&&$selection.length&&selector!=null&&(state={"selection-id":selector,"selection-rect":$selection[0].getBoundingClientRect(),"selection-offset":$selection.offset()},stateData&&$.extend(state,{"state-data":stateData}),$("html").data(state)))}function loadUIState(triggerEvent,setScrollPosition){var $html=$("html"),stateData,selection;if($html.data("selection-id"))return selection={id:$html.data("selection-id"),$el:$($html.data("selection-id")),rect:$html.data("selection-rect"),offset:$html.data("selection-offset")},$html.data("state-data")&&(stateData=$html.data("state-data")),selection.$el.length?(setScrollPosition&&$html.scrollTop(selection.$el.offset().top-selection.rect.top),selection.$el.trigger(triggerEvent||"focus"),$("."+$("html").data("saved-event-id")).focus()):setScrollPosition&&$html.scrollTop(selection.offset.top-selection.rect.top),$html.removeData("selection-id").removeData("selection-rect").removeData("selection-offset").removeData("state-data"),stateData}function detachCallback(){}function toggleCheckedMenuItem(idVal){$(idVal).toggleClass("calloutMenuUnchecked calloutMenuChecked").addClass("loading loadingSmall loadingOnBlack").closest("ul").addClass("calloutCheckedMenuItemsDisabled")}var commentWidgetHasLoaded=!1,cloneComments=!0,showingNotes=!1,showingComments=!1,customizeCalloutFocusOnFamilyEvents=!1,customizeCalloutFocusOnHistInsights=!1,customizeCalloutFocusOnAlternatives=!1;$(function(){function showTabContent(options,$view){$view.removeClass("loading loadingLarge");checkForError($("#"+options.domId))}var personHeader=$(".pageHeader"),htmlTag=$("html").attr("data-page",window.PersonCard.tabName),$TreesFunc,i,mediaQueryList;$("#personTabs .tab").on("click.personView",function(e){if(e.preventDefault(),!window.personScreenType("not-large-screen")||this.id!==$(".tabs .tab.tabActive").attr("id")){var options=getTabData(this.id),$view=$("#"+options.contentId);$("html").attr("data-page",options.queryValue);window.PersonCard.tabName=options.queryValue;options.pushUrlState=!1;options.removeCacheFiles=!1;options.keyId="#"+this.id;options.callback=function(){showTabContent(options,$view,this)};updateView($view)&&glue.fetch(options);History.pushState({tab:options.queryValue,domId:$view.attr("id"),options:options},HtmlDecode(window.PersonCard.name)+" - "+getTabNameStringForPageTitle(options.queryValue),options.queryValue)}});$TreesFunc={FamilySearch:{loadWidget:function(callback){var qs=document.location.search||"";qs+=(qs?"&":"?")+"fsid="+$("#familySearchId").val();$.ajax({cache:!1,dataType:"jsonp",xhrFields:{withCredentials:!0},crossDomain:!0,url:window.PersonCard.domain.trees+"/tree/"+$("#treeId").val()+"/person/"+$("#personId").val()+"/fs/personwidget"+qs}).done(function(response){if(response!=null){$("#fsWidget").html(response.html);callback!=null&&callback();$("#fsCancelDisconnect").click(function(){$.modal.close()});$("#fsConfirmDisconnect").one("click",function(){$.ajax({cache:!1,dataType:"jsonp",xhrFields:{withCredentials:!0},crossDomain:!0,url:window.PersonCard.domain.trees+window.fsPerformDisconnectUrl}).done(function(jsonResponse){jsonResponse.success?($("#familySearchId").val(""),$("#fsOrdStatus").callout("close"),$.modal.close(),location.reload()):$("#fsDisconnectFail").modal({title:window.fsErrorDisconnecting})})});$("#fsDisconnect").click(function(){$("#fsDisconnectConfirm").modal({title:window.fsConfirmTitle})})}}).fail(function(){$("#fsWidget").parent(".familySearchTools").remove()})}}};bindProfileImageClick();$(".pageHeaderStory #researchTools .iconPrint").on("click",function(){$(this).addClass("myCanvasPrintModalTriggered");printFunction()});$(".pageHeaderFacts #researchTools .iconPrint").on("click",function(){$(this).addClass("printFriendlyViewTriggered");printFunction()});$("#treePagesList > li").length>0&&$(".treePagesButton").callout({type:"click",content:"#treePagesList",classes:"calloutMenu treePagesCallout"});$(".pageActions .badge.iconInfo").callout({type:"click",classes:"calloutOwner",content:"#yourRoleDomCalloutDomContent"});$(".researchToolsButton").callout({type:"click",classes:"calloutMenu calloutMenuResearchTools",content:"#researchToolsCalloutDomContent",onOpen:function(){$(".pageNav").hasClass("pageNavExpanded")?$(".researchToolsList .iconAfterCheck").addClass("calloutMenuChecked"):$(".researchToolsList .iconAfterCheck").addClass("calloutMenuUnchecked");loadCommentCount()},onAfterOpen:function(){$(".researchToolsList").one("click",".iconAfterCheck",function(){$(this).toggleClass("calloutMenuChecked calloutMenuUnchecked");researchToolbar();$(this).hasClass("calloutMenuChecked")?personAnalyticsTrackClick("showResearchToolbar"):personAnalyticsTrackClick("hideResearchToolbar")}).one("click",".myNotesBtn",function(){toggleDrawerToTab("#myNotesTab")}).one("click",".personCommentsBtn",function(){toggleDrawerToTab("#personCommentsTab")}).one("click",".iconPrint",function(){$(".researchToolsButton").addClass("printFriendlyViewTriggered");printFunction()});$(".pageHeader").hasClass("pageHeaderStory")||$(".pageHeader").hasClass("pageHeaderFacts")?$(".printOptionForLifeStoryAndFacts").removeClass("printOptionForLifeStoryAndFactsHidden"):$(".printOptionForLifeStoryAndFacts").addClass("printOptionForLifeStoryAndFactsHidden");$(document).on("click",".researchToolsList .iconPrint",function(){$(".pageActions .iconTools").addClass("myCanvasPrintModalTriggered")}).on("click",".researchToolsList .iconPlus",function(){$(".pageActions .iconTools").addClass("savModalTriggered")})},onClose:function(){$(".researchToolsList").off("click")}});loadCommentCount();$(".editToolsButton").callout({type:"click",classes:"calloutMenu calloutMenuEditTools",content:"#editToolsCalloutDomContent",onAfterOpen:function(){$(document).on("click",".editToolsList .iconTrash",function(){$(".pageActions .iconEdit").addClass("remModalTriggered")}).on("click",".editToolsList .iconFamily",function(){$(".pageActions .iconEdit").addClass("editRelModalTriggered")})}});$(".personToolsGuest").callout({type:"click",classes:"calloutMenu calloutMenuGuestTools",content:"#guestToolsCalloutDomContent",onOpen:function(){loadCommentCount()},onAfterOpen:function(){$(".guestToolsList").one("click",".iconPrint",function(){printFunction()}).one("click",".personCommentsBtn",function(){loadComments();toggleDrawerToTab("#personCommentsTab")});$(".pageHeader").hasClass("pageHeaderStory")||$(".pageHeader").hasClass("pageHeaderFacts")?$(".printOptionForLifeStoryAndFacts").removeClass("printOptionForLifeStoryAndFactsHidden"):$(".printOptionForLifeStoryAndFacts").addClass("printOptionForLifeStoryAndFactsHidden")},onClose:function(){$(".guestToolsList").off("click",".personCommentsBtn")}});$(".drawerHeader").on("click","#personCommentsTab",loadComments);window.PersonCard.showFsWidget&&$TreesFunc.FamilySearch.loadWidget(function(){$("#fsOrdStatus, #fsConnectLink, #fsConnectingStatus, #fsNeedsSignIn").unwrap()});i=0;$(".relationshipLink").each(function(){var $this=$(this),url="/tree/"+window.PersonCard.treeId+"/person/"+window.PersonCard.personId+"/getrelationshiptext?page=unknown";$.ajax({url:url,type:"GET",dataType:"json",contentType:"application/json",success:function(data){data.content!=null&&$this.html(data.content)},error:function(){}})});$(document).ajaxSuccess(function(){$("html").hasClass("modalOpen")&&$.modal.center()}).on("click",".closeModal",function(){$.modal.close()}).on("click",".closeCallouts",function(){closeCallouts()}).on("click","#researchTools .saveToTree",function(){$(this).addClass("savModalTriggered")});$(".personView .card").on("focus",function(){var $this=$(this);$this.one("mousemove",function(){$this.blur()})});$(".pageHeader").off("click").on("click",".myNotesBtn",function(){toggleDrawerToTab("#myNotesTab")}).on("click",".personCommentsBtn",function(){toggleDrawerToTab("#personCommentsTab")}).on("click",".relLabel",function(){$(this).addClass("relModalTriggered")});$(".sideDrawer").on("click","#closeSideDrawerBtn",function(){toggleDrawer();checkNotesAndComments()});window.PersonCard.showFindAPerson&&findAPersonTreeOptionsPersonCard();var params=window.location.search.substr(1).split("&"),p=params[0].split("="),p0=p[0];p[0]==="openTestQEModal"&&quickEdit();$(".tabContentComments").on("click",".comment .undo",function(){loadCommentCount()}).on("click",'.comment button[data-ng-click="deleteComment(comment)"]',function(){loadCommentCount()}).on("mouseup pointerup touchend click",'.comment button[data-ng-click="addComment()"]:not(.disabled)',function(){loadCommentCount()});$(window).resize(function(){$("html").addClass("windowIsResizing");setTimeout(function(){$("html").removeClass("windowIsResizing")},250);typeof checkMiniProfile=="function"&&checkMiniProfile()});window.onbeforeprint=beforePrint;window.onafterprint=afterPrint;window.matchMedia&&(mediaQueryList=window.matchMedia("print"),mediaQueryList.addListener(function(mql){mql.matches&&beforePrint()}));$("#myNotesTab").on("click",function(){showingComments=!1;showingNotes=!0;checkNotesAndComments()});$("#personCommentsTab").on("click",function(){showingNotes=!1;showingComments=!0;checkNotesAndComments()});window.acom.bus.on("csm::component::statechange",function(){if(typeof PersonCard!="undefined"&&typeof window.PersonCard.doHintsABTest!="undefined"&&window.PersonCard.doHintsABTest==="True"&&typeof mboxDefine=="function"){var userNameMbox=window.PersonCard?window.PersonCard.name:"",userLifeRangeMbox=window.PersonCard?window.PersonCard.lifeYearRange:"",userBirthPlace=window.PersonCard?window.PersonCard.birthPlace:"",$hintCountDiv=$(".hint-count-pending"),hintNumberMbox=$hintCountDiv.length>0?$hintCountDiv.html():"0";window.mboxUpdate("us_PersonsHintsTab","name="+userNameMbox,"lifeRange="+userLifeRangeMbox,"hintsAvail="+hintNumberMbox,"birthPlace="+userBirthPlace)}})});$.cachedScript=function(url,options){return options=$.extend(options||{},{dataType:"script",cache:!0,url:url}),$.ajax(options)};window.SaveController=function(){function saveWithCheck(callback){var notesField=$("#NotesTextAreaNoEditor"),notesValOriginal,converted;notesField.length>0&&(notesValOriginal=notesField.attr("data-notes-original"),converted=notesField.html(),(notesValOriginal.length!==converted.length||notesValOriginal!==converted)&&savePersonNotes(callback))}function checkSaveWithCallback(callback){return function(){saveWithCheck(callback)}}function triggerDelayedSave(delay,callback){clearChangesSavedText();delay||(delay=window.PersonCard.autoSaveTime);currentTimeout&&clearTimeout(currentTimeout);currentTimeout=setTimeout(checkSaveWithCallback(callback),delay)}var currentTimeout;return{TriggerDelayedSave:triggerDelayedSave,SaveWithCheck:saveWithCheck}}();
"use strict";var personViewModalAlertSettingsNote={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"note"},personViewModalAlertSettingsInfo={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"info"},personViewModalAlertSettingsSuccess={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"success"},personViewModalAlertSettingsWarning={animation:!1,onOpen:function(){$.modal.center()},onClose:function(){$.modal.center()},open:!1,type:"warning"};
(function($){"use strict";function initializeCarousel(modalId){var carouselHeight="auto",$guidanceCarousel=$("#"+modalId+"GuidanceCarousel");window.personScreenType("smart-phone")&&(carouselHeight="varied");$guidanceCarousel.carousel({carouselHeight:carouselHeight,continuous:!1,onSlideLoad:function(){setTimeout(function(){$.modal.center()},500)},onSlideChange:function(i){changing=!0;$("#"+modalId+"GuidanceTabs").find(".tab").eq(i).click();changing=!1;$("#"+modalId+"GuidanceTabs .tabActive").is(":last-child")?$guidanceCarousel.addClass("guidanceComplete"):$guidanceCarousel.removeClass("guidanceComplete")},showPrevNextBtns:!1,pagination:"dots"}).on("click",".guidanceNextBtn",function(){$guidanceCarousel.carousel("goToSlide","next")}).on("click",".guidanceExploreBtn",function(){$.modal.close()})}function initializeTabs(modalId){$("#"+modalId+"GuidanceTabs").tabs().on("click",".tab",function(){changing||$("#"+modalId+"GuidanceCarousel").carousel("goToSlide",$(this).index()+1)})}function destroyCarousel(modalId){$("#"+modalId+"GuidanceCarousel").carousel("destroy").off("click");$("#"+modalId+"GuidanceModal").appendTo("#"+modalId+"NoDisplay")}function destroyTabs(modalId){$("#"+modalId+"GuidanceTabs").tabs("destroy").off("click")}function guidanceModal(){var modalId=$(this).data("modal-id");$("#"+modalId+"GuidanceModal").modal({width:"650",useCustomPadding:!0,onOpen:function(){closeCallouts();initializeTabs(modalId);initializeCarousel(modalId)},onClose:function(){destroyTabs(modalId);destroyCarousel(modalId)}})}var changing=!1;$(document).on("click",".guidanceModalTrigger",guidanceModal)})(jQuery);
function ladderJSON(response){var html='<div class="modalHeader"><div class="modalHeaderActions"><button class="icon iconPrint link" onclick="rcPrintLadder();" type="button">'+response.printText+'<\/button><\/div><h4 class="modalTitle">'+response.title+"<\/h4><\/div>";html=html+response.html;$(html).modal({width:"400",onOpen:function(){$("#modalContents").addClass("modalHasTitle")},onClose:function(){$(".relModalTriggered").removeClass("relModalTriggered").focus()}})}function rcPrintLadder(){var ladderUrl="/tree/"+window.rcTid+"/person/"+window.rcPid+"/printladder",printWindow=window.open(ladderUrl,"PrintWindow","width=750,height=850,top=50,left=50,toolbars=no,scrollbars=yes,status=no,resizable=yes");printWindow.focus()}$(function(){$(".pageHeader").on("click",".relLabel",function(){var ladderUrl=window.rcDomain+"/tree/"+window.rcTid+"/person/"+window.rcPid+"/getladder";$.ajax({jsonpCallback:"ladderJSON",url:ladderUrl,async:!0,type:"GET",dataType:"jsonp",contentType:"application/json",beforeSend:function(){$("<div><\/div>").modal();$.modal.showLoading(!0)},success:function(){},error:function(ex){var html="<div><p>"+ex.html+"<\/p><\/div>";$(html).modal({title:ex.title})}})})});
function newFactEditModal(persondata,assertionId,haslsOptions,tabactivate,contentactivate,apNewPid,seData,iscreateevent,showtabs){var saveEventDataObj,pid,url;if(typeof persondata=="undefined"){alert("persondata cannot be null");return}showTabs=showtabs;hasLifeStoryOptions=haslsOptions;tabActivate=tabactivate;contentActivate=contentactivate;addPersonNewPid=apNewPid;saveEventData=seData;isCreateEvent=iscreateevent;var isValidNewAddPersonId=typeof addPersonNewPid!="undefined"&&addPersonNewPid!=null&&addPersonNewPid.length>0,dateFieldVal="",placeFieldVal="",descriptionFieldVal="",isPrimary=!1,eventType="",newPersonPid="";window.PersonData=persondata;PersonData.hasAddedNewSpouse=!1;PersonData.newAddedSpouseId="";isValidNewAddPersonId&&(newPersonPid=addPersonNewPid,PersonData.hasAddedNewSpouse=!0,PersonData.newAddedSpouseId=addPersonNewPid,typeof saveEventData!="undefined"&&saveEventData.length>0&&(saveEventDataObj=jQuery.parseJSON(saveEventData),eventType=saveEventDataObj.eventType,dateFieldVal=saveEventDataObj.dateField,placeFieldVal=saveEventDataObj.placeField,descriptionFieldVal=saveEventDataObj.descriptionField,isPrimary=!1,saveEventDataObj.isAddNewSpouse==="true"&&($(".editModalSaveButton").unbind("click"),ResetWarningsAndValues(),FactEditModal.isAddNewSpouse=!0)));pid=typeof PersonData.personId!="object"?PersonData.personId:PersonData.personId.value;url="/modals/factedit/tree/"+PersonData.treeId+"/person/"+pid+"/assertionid/"+assertionId;$("<div>").modal({showLoading:!0,useCustomPadding:!0,onOpen:function($this){$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,data:{hasLifeStoryOptions:hasLifeStoryOptions,newPersonPid:newPersonPid,showTabs:showtabs},success:function(data){var size,spouseCount,dateField,placeField,descriptionField,$indvSpouseSelect,$sortingDivTopAlert,$sortingDivBottomAlert,locationField,openTab,modalHeader,cancelClose,factItem,modalEditEvent,selectedPerson,preferredStored,preferredEventStored,individualSpouseSelect,multipleSpouseSelect,displayLifeStory,displayLifeStoryVal;if(data.result){if($.modal.showLoading(!1),size=showtabs?760:508,$.modal.resize(size),$this.html(data.html),$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning),sortingCardOutlineHover(),!isValidNewAddPersonId&&isRelationshipEventType()&&$(".editModalSaveButton").unbind("click"),spouseCount=parseInt(FactEditModal.person.spouseCount),isValidNewAddPersonId&&(dateField=$(".dateField"),dateField.length>0&&dateField.val(dateFieldVal),placeField=$(".placeField"),placeField.length>0&&placeField.val(placeFieldVal),descriptionField=$(".descriptionField"),descriptionField.length>0&&descriptionField.val(descriptionFieldVal),$("#individualSpouseSelect").show(),$("#selectedSpouse-individual").removeClass("selectedPerson"),$indvSpouseSelect=$(".existingSpouseIndividual"),$indvSpouseSelect.length>0&&$indvSpouseSelect.addClass("selectedPerson"),$("#multipleSpouseSelect").hide(),spouseCount>1?($("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();"),$("#chooseOtherButton").hide()):($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")),FactEditModal.warningMessage="",FactEditModal.hasValidationWarningToSelectSpouse=!1,FactEditModal.isAddNewSpouse=!1),typeof FactEditModal!="undefined"&&$(".modalEditEvent .iconRotateRight").callout({position:"left",type:"click",classes:"calloutGenerateNarrative",content:"#generateNarrativeCalloutDomContent",onAfterOpen:function(){$("#generateNarrativeCalloutDomContent").on("click",".closeCallouts",function(){closeCallouts()})},style:"dark"}),$(".modalEditEvent .removeButton").callout({position:"top",style:"dark",type:"click",classes:"calloutRemoveEvent",content:"#removeEventCalloutDomContent",onAfterOpen:function(){$("#removeEventCalloutDomContent").on("click",".closeCallouts",function(){closeCallouts()})}}),sortingCardOutlineHover(),$sortingDivTopAlert=$("#source_sortingDivTop .alert"),$sortingDivBottomAlert=$("#source_sortingDivBottom .alert"),$sortingDivTopAlert.alert(personViewModalAlertSettingsNote),$sortingDivBottomAlert.alert(personViewModalAlertSettingsNote),$.cachedScript(PersonData.animateCardUrl).done(function(){$("#source_sortingDivBottom").animateCard({items:".card",animateMove:{afterAnimate:function(item){item.find(".sortingIcon").hasClass("iconAdd")?(item.removeClass("cardOutline2").addClass("attached"),PersonData.hasEditRights&&item.find(".sortingIcon").removeClass("iconAdd noHover").addClass("iconClose")):(item.removeClass("cardOutline2").removeClass("attached"),PersonData.hasEditRights&&item.find(".sortingIcon").removeClass("iconClose noHover").addClass("iconAdd"));$.modal.center()},beforeAnimate:function(item){item.find(".card").addClass("cardOutline2")},connectWith:"#source_sortingDivTop",emptyContent:".alertNote"},onListEmpty:function(emptyList){emptyList.find(".alertNote").alert("open")},onEmptyListAdd:function(list){list.find(".alertNote").alert("close")}})}),$("#source_sortingDivTop .card").length===0&&$sortingDivTopAlert.alert("open"),$("#source_sortingDivBottom .card").length===0&&$sortingDivBottomAlert.alert("open"),locationField=$("#location"),locationField.length>0&&factModalInitTypeAhead(PersonData.treeId,locationField),openTab=0,typeof PersonData.openOnLoadTab!="undefined"&&(openTab=parseInt(PersonData.openOnLoadTab)),PersonData.openOnLoadTab=openTab,(FactEditModal.isAddNewFact||typeof isCreateEvent!="undefined"&&isCreateEvent)&&(typeof tabActivate!="undefined"&&tabActivate!=null&&tabActivate.length>0&&typeof contentActivate!="undefined"&&contentActivate!=null&&contentActivate.length>0?(modalHeader=$("#modalHeader"),modalHeader.length>0&&modalHeader.remove(),tabActivate!=="factEditModalEvent"&&tabActivate!=="editModalSaveButton"&&($("#factEditModalEvent").removeClass("tabActive active"),$(".tabContent1").removeClass("tabActive active")),$("#"+tabActivate).hasClass("tabActive active")||$("#"+tabActivate).addClass("tabActive active"),contentActivate!=="tabContent1"&&$(".tabContent1").removeClass("tabActive active"),$("."+contentActivate).hasClass("tabActive active")||$("."+contentActivate).addClass("tabActive active"),openTab=contentActivate==="tabContent2"?1:contentActivate==="tabContent3"?2:0,PersonData.openOnLoadTab=openTab,cancelClose=$(".cancelClose"),cancelClose.length>0&&cancelClose.text(FactEditModal.text.close),setFactModalTabsClick(!FactEditModal.hasValidationError,null,!0)):($("#factEditModalEvent").addClass("tabActive active"),$(".tabContent1").addClass("tabActive active"))),$("#modalContainer .tabs").tabs({activeIndex:openTab,onOpen:!1}),modalButtonClick(),setupFactModalUserCard(),factItem=$("#fi"+assertionId),modalEditEvent=$(".tabContent1"),modalEditEvent.length>0&&openTab===0)if(selectedPerson=modalEditEvent.find(".selectedPerson"),isRelationshipEventType()&&selectedPerson.length===0&&(selectedPerson=modalEditEvent.find(".selectedPerson")),!isValidNewAddPersonId&&isRelationshipEventType()&&FactEditModal.originalSpouseId.length===0&&selectedPerson.length>0&&resetIndividualSpouseNode(selectedPerson,0),(FactEditModal.eventType.toLowerCase()==="birth"||FactEditModal.eventType.toLowerCase()==="death"||FactEditModal.eventType.toLowerCase()==="name")&&(factItem.hasClass("preferredEvent"+FactEditModal.eventType)?(modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!0),modalEditEvent.find(".isPrimaryCheckbox").attr("data-original-isprimary","true"),$("#preferredEventButtonLabel").show(),FactEditModal.eventType.toLowerCase()!=="name"&&$("#factEditModalTimelineOptions").css("display","")):($("#preferredEventCheckbox").show(),modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!1))),retrieveStoredFactValues(factItem,".givenNameStored"+assertionId,modalEditEvent,"#givenName"),retrieveStoredFactValues(factItem,".surnameStored"+assertionId,modalEditEvent,"#surname"),retrieveStoredFactValues(factItem,".suffixStored"+assertionId,modalEditEvent,"#suffix"),preferredStored=factItem.find(".preferredStored"+assertionId),preferredStored.length>0&&(preferredStored.val()==="true"&&factItem.hasClass("preferredEvent"+FactEditModal.eventType)?modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!0):modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!1)),retrieveStoredFactValues(factItem,".dateStored"+assertionId,modalEditEvent,"#date"),retrieveStoredFactValues(factItem,".placeStored"+assertionId,modalEditEvent,"#location"),retrieveStoredFactValues(factItem,".descriptionStored"+assertionId,modalEditEvent,"#description"),preferredEventStored=factItem.find(".preferredEventStored"+assertionId),preferredEventStored.length>0&&(preferredEventStored.val()==="true"&&factItem.hasClass("preferredEvent"+FactEditModal.eventType)?modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!0):modalEditEvent.find(".isPrimaryCheckbox").attr("checked",!1)),individualSpouseSelect=modalEditEvent.find("#individualSpouseSelect"),isRelationshipEventType()&&(typeof newPersonPid=="undefined"||typeof newPersonPid!="undefined"&&newPersonPid.length===0)&&FactEditModal.originalSpouseId.length===0)selectedPerson.length>0&&resetIndividualSpouseNode(selectedPerson,0),modalEditEvent.find(".eventAreaBannerWarning").alert("close"),ResetWarningsAndValues(),multipleSpouseSelect=modalEditEvent.find("#multipleSpouseSelect"),spouseCount===1?(individualSpouseSelect.hide(),multipleSpouseSelect.show(),$("#singleScenarioSpouseSelect").show(),$("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):spouseCount>1?(individualSpouseSelect.hide(),$("#spouseText").hide(),$("#selectSpouseForEventText").show(),multipleSpouseSelect.show(),$("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):($("#chooseOtherButton").hide(),$(".addRelationships").show(),showSpouseTypeAheadSection(),$(".erAddCancel").hide()),setEditModalSaveButtonClick();else if(isRelationshipEventType()&&typeof newPersonPid!="undefined"&&newPersonPid.length>0){if(spouseCount===1&&setIndividualSpouseData(modalEditEvent,".singleScenarioSpouseSelect"),!showIndividualSpouse())return;individualSpouseSelect=$(".existingSpouseIndividual");individualSpouseSelect.length>0&&individualSpouseSelect.addClass("selectedPerson");(spouseCount===0||spouseCount===1)&&($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();"));setEditModalSaveButtonClick()}$(".tabContent4").find(".narrativeDataFields").hide();displayLifeStory=$(".tabContent4").find(".displayLifestory");displayLifeStory.length>0&&(displayLifeStoryVal=displayLifeStory.prop("checked"),displayLifeStory.data("original-displaylifestory",displayLifeStoryVal.toString()));FactEditModal.eventType==="Gender"?($(".editModalSaveButton").removeAttr("disabled"),setFactModalTabsClick(!FactEditModal.hasValidationError)):FactEditModal.eventType==="Name"?(modalEditEvent.find(".eventAreaBannerWarning").alert("close"),setFactModalTabsClick(!FactEditModal.hasValidationError)):typeof tabActivate!="undefined"&&tabActivate!=null&&tabActivate.length>0&&typeof contentActivate!="undefined"&&contentActivate!=null&&contentActivate.length>0?setFactModalTabsClick(!FactEditModal.hasValidationError):setButtonandBannerBasedOnValidation(!1);setButtonBasedOnValidation()}$("#modalClose").length===0&&$("#modalContents").prepend('<button type="button" title="Close modal" id="modalClose" class="closeBtn"><\/button>')},error:function(ex){typeof ex!="undefined"&&typeof ex.statusText!="undefined"&&($.modal.showLoading(!1),$("<div><p>"+PersonCard.text.addPersonErrorText+"<\/p><\/div>").modal({title:""}),window.console&&window.console.log(ex.statusText))}})},onClose:function(){$(".factItemSelected").focus()}})}function sortingCardOutlineHover(){$(".sortingCard").on("click",".sortingIcon",function(){$(this).addClass("noHover")}).on("mouseenter",".sortingIcon:not(.noHover)",function(){$(this).closest(".card").addClass("cardOutline2")}).on("mouseleave",".sortingIcon:not(.noHover)",function(){$(this).closest(".card").removeClass("cardOutline2")})}function isRelationshipEventType(){return typeof FactEditModal!="undefined"&&typeof FactEditModal.eventType!="undefined"&&(FactEditModal.isRelationshipType=FactEditModal.eventType==="Marriage"||FactEditModal.eventType==="MarriageBann"||FactEditModal.eventType==="MarriageContract"||FactEditModal.eventType==="MarriageLicense"||FactEditModal.eventType==="MarriageSettlement"||FactEditModal.eventType==="Annulment"||FactEditModal.eventType==="Divorce"||FactEditModal.eventType==="DivorceFiled"||FactEditModal.eventType==="Engagement"||FactEditModal.eventType==="SealSpouseLDS"||FactEditModal.eventType==="NumMarriages"||FactEditModal.eventType==="Separation"),FactEditModal.isRelationshipType}function isValueOnlyEventType(){return FactEditModal.eventType==="Afn"||FactEditModal.eventType==="Gender"||FactEditModal.eventType==="NumMarriages"||FactEditModal.eventType==="NumMarriages"||FactEditModal.eventType==="Personid"||FactEditModal.eventType==="Rin"||FactEditModal.eventType==="Ssn"||FactEditModal.eventType==="uid"||FactEditModal.eventType==="Facebookid"||FactEditModal.eventType==="Aka"||FactEditModal.eventType==="CauseOfDeath"||FactEditModal.eventType==="NameSake"?!0:!1}function factModalInitTypeAhead(treeId,locationField){locationField.autocomplete({source:"/suggest/place?treeId="+treeId+"&tad=none",key:"placeName",queryParameter:"term",dataType:"json",minLength:3,maxResults:12,customDisplay:function(data){return{value:data.value,display:data.display}},onItemSelect:function(itemData){var $this,$card;itemData!==""&&($this=$(this),itemData.PID!=""&&($card=$this.closest(".card"),$card.find(".erAddExistingData").data("itemData",itemData),$card.find(".erAddSave").prop("disabled",!1)))},onOpen:!1,onClose:!1})}function setupFactModalUserCard(){var factTitlePersonCard=$(".factTitlePersonCard");if(factTitlePersonCard.length>0){var userCardImgSquare=factTitlePersonCard.find(".userCardImgSquare"),userCardTitle=factTitlePersonCard.find(".userCardTitle"),userCardSubTitle=factTitlePersonCard.find(".userCardSubTitle");userCardTitle.length>0&&userCardSubTitle.length>0&&(userCardImgSquare.addClass("icon"+PersonCard.gender),userCardTitle.html(PersonCard.name),PersonCard.lifeYearRange.length>1&&PersonCard.lifeYearRange!=="&ndash;"?userCardSubTitle.text("("+PersonCard.lifeYearRange.replace("&ndash;","-")+")"):userCardSubTitle.text(""),factTitlePersonCard.show())}}function retrieveStoredFactValues(factItem,storedAccessor,modalArea,fieldId){var storedValue=factItem.find(storedAccessor);storedValue.length>0&&modalArea.find(fieldId).val(storedValue.val())}function setButtonandBannerBasedOnValidation(showBanner){var modalEditEvent=$(".tabContent1"),bannerObj=modalEditEvent.find(".eventAreaBannerWarning");checkFieldValidation(!1,showBanner,[]);showBanner&&(FactEditModal.hasValidationWarning||FactEditModal.hasValidationDateWarning||FactEditModal.hasValidationError||FactEditModal.hasValidationWarningToSelectSpouse?displayBannerObjWarning(bannerObj):clearAllBanners());setButtonBasedOnValidation();setupCorrectClickActionLinks()}function displayBannerObjWarning(bannerObj){typeof bannerObj!="undefined"&&bannerObj.length>0&&setTimeout(function(){var validationMessage="";FactEditModal.hasValidationError?typeof FactEditModal.validationErrorMessage!="undefined"&&FactEditModal.validationErrorMessage.length>0&&(validationMessage=FactEditModal.validationErrorMessage):FactEditModal.hasValidationWarning||FactEditModal.hasValidationDateWarning?(typeof FactEditModal.validationWarningMessage!="undefined"&&FactEditModal.validationWarningMessage.length>0&&(validationMessage=FactEditModal.validationWarningMessage),isRelationshipEventType()&&FactEditModal.hasValidationWarningToSelectSpouse?validationMessage=validationMessage.length>0?validationMessage+"  "+FactEditModal.text.warnToSelectSpouse:FactEditModal.text.warnToSelectSpouse:isDatePlaceEventType()&&(validationMessage=FactEditModal.hasValidationDateWarning?validationMessage.length>0?validationMessage+"  "+FactEditModal.text.warnStillUseItDate:FactEditModal.text.warnStillUseItDate:validationMessage.length>0?validationMessage+"  "+FactEditModal.text.warnStillUseIt:FactEditModal.text.warnStillUseIt)):isRelationshipEventType()&&FactEditModal.hasValidationWarningToSelectSpouse&&(validationMessage=validationMessage.length>0?validationMessage+"  "+FactEditModal.text.warnToSelectSpouse:FactEditModal.text.warnToSelectSpouse);validationMessage=FactEditModal.isAddNewFact?validationMessage.replace("{createAnywayOrSaveAnyway}",FactEditModal.text.addAnyway):validationMessage.replace("{createAnywayOrSaveAnyway}",FactEditModal.text.saveAnyway);validationMessage.length>0&&(bannerObj.text(validationMessage),bannerObj.alert("open"),$.modal.center())},500)}function checkFieldValidation(checkChanged,showBanner,dictionary){var modalEditEvent=$(".tabContent1"),selectedPerson=modalEditEvent.find(".selectedPerson"),requiredFields=0,emptyRequiredFields=0,fields=0,emptyFields=0,changed=!1,$checkBox,sid;return modalEditEvent.find(".factField").each(function(){var $field=$(this),fState=$field.data("state"),val=$field.val(),originalValue,currentValue,extra;$field.hasClass("requiredField")?requiredFields++:fields++;$field.attr("name")!=="gender"&&(val?(fState=="0"&&(fState=validateField($field.get(0))),fState=="4"||fState=="3"?showBanner&&(FactEditModal.validationWarningMessage=FactEditModal.validationWarningMessage.length===0?$field.data("msg"):FactEditModal.validationWarningMessage+" "+$field.data("msg"),fState=="3"?FactEditModal.hasValidationDateWarning=!0:fState=="4"&&(FactEditModal.hasValidationWarning=!0)):fState=="2"||fState=="1"):$field.hasClass("requiredField")?emptyRequiredFields++:emptyFields++);checkChanged&&($field.attr("name")!=="gender"||$field.is(":checked"))&&(originalValue=typeof $field.data("original-value")!="undefined"?$field.data("original-value"):"",currentValue=$field.val(),originalValue!=currentValue&&(changed=!0),extra=typeof $field.data("extra")!="undefined"?$field.data("extra"):"",dictionary[$field.attr("id")]={value:currentValue,origValue:originalValue,extra:extra})}),checkChanged&&($checkBox=modalEditEvent.find(".isPrimaryCheckbox"),$checkBox.length>0&&$checkBox.is(":checked")&&$checkBox.data("original-isprimary")==!1&&(changed=!0)),isRelationshipEventType()&&(typeof selectedPerson=="undefined"||selectedPerson.length===0?checkChanged&&!FactEditModal.isAddNewFact&&typeof FactEditModal.originalSpouseId!="undefined"&&FactEditModal.originalSpouseId.length>0?changed=!0:showBanner&&(FactEditModal.hasValidationWarningToSelectSpouse=!0):checkChanged&&(typeof FactEditModal.originalSpouseId=="undefined"||FactEditModal.originalSpouseId.length===0?changed=!0:(sid=selectedPerson.data("assertionid"),FactEditModal.originalSpouseId!=sid&&(changed=!0)))),(emptyRequiredFields>0||fields===emptyFields&&fields!==0)&&(showBanner&&PersonData.hasEditRights&&(FactEditModal.validationErrorMessage=getWarningMessage(requiredFields>0&&requiredFields===emptyRequiredFields,fields===emptyFields)),FactEditModal.hasValidationError=!0,changed=!1),changed}function clearAllBanners(){$(".tabContent").find(".alert:not(.alertNote)").each(function(){var $this=$(this);$this.hasClass("alertHidden")||$this.alert("close")})}function setButtonBasedOnValidation(){!FactEditModal.hasValidationError&&(FactEditModal.hasValidationWarning||FactEditModal.hasValidationDateWarning||FactEditModal.hasValidationWarningToSelectSpouse)?(setupCreateOrSaveAnywayTextButton(),$(".editModalSaveButton").removeAttr("disabled")):(setupCreateOrSaveTextButton(),FactEditModal.hasValidationError?$(".editModalSaveButton").attr("disabled","disabled"):$(".editModalSaveButton").removeAttr("disabled"))}function setupCreateOrSaveTextButton(){FactEditModal.isAddNewFact?$(".editModalSaveButton").text(FactEditModal.text.create):$(".editModalSaveButton").text(FactEditModal.text.saveChanges)}function setupCorrectClickActionLinks(){var modalEditEvent=$(".tabContent1"),selectedPerson=modalEditEvent.find(".selectedPerson");FactEditModal.isAddNewFact?setAddNewFactCreateAction():PersonData.hasAddedNewSpouse&&PersonData.newAddedSpouseId.length>0?setFactModalTabsClick(!FactEditModal.hasValidationError,PersonData.newAddedSpouseId):isRelationshipEventType()&&(typeof selectedPerson=="undefined"||typeof selectedPerson!="undefined"&&selectedPerson.length===0)?setFactActionWithValidate():setFactModalTabsClick(!FactEditModal.hasValidationError)}function setFactModalTabsClick(valid,newPidVal,showBanner){var newPid,clearBanners,showBannerVal,jss;valid&&(typeof FactEditModal.buttonsBound!="undefined"&&FactEditModal.buttonsBound||(newPid="",typeof newPidVal!="undefined"&&newPidVal!=null&&newPidVal.length>0&&(newPid=newPidVal),clearBanners=typeof showBanner!="undefined"&&showBanner?"false":"true",showBannerVal=typeof showBanner!="undefined"&&showBanner?"true":"false",$(".editModalSaveButton").attr("onClick","factEditModalHandleTabClick('editModalSaveButton', '"+newPid+"', "+clearBanners+", "+showBannerVal+", true);"),$("#factEditModalEvent").attr("onClick","factEditModalHandleTabClick('factEditModalEvent', '"+newPid+"', "+clearBanners+", "+showBannerVal+", true);"),$("#factEditModalAttachMedia").attr("onClick","factEditModalHandleTabClick('factEditModalAttachMedia', '"+newPid+"', "+clearBanners+", "+showBannerVal+", true);"),$("#factEditModalSourceCitations").attr("onClick","factEditModalHandleTabClick('factEditModalSourceCitations', '"+newPid+"', "+clearBanners+", "+showBannerVal+", true);"),$("#factEditModalTimelineOptions").attr("onClick","factEditModalHandleTabClick('factEditModalTimelineOptions', '"+newPid+"', "+clearBanners+", "+showBannerVal+", true);"),jss="javascript:spouseClickHandler('"+FactEditModal.person.spouseCount+"', '"+FactEditModal.assertionId+"', '"+newPid+"', '');",FactEditModal.person.spouseCount==="1"?$(".chooseOtherButton").attr("onClick",jss):$(".changeSpouseButton").attr("onClick",jss),FactEditModal.buttonsBound=!0))}function spouseClickHandler(count){count==="1"?showSpouseTypeAheadSection():showMultipleSpouseSelect()}function unsetFactModalTabsClick(){}function savePersonNarrativeAndEventDataModal(assertionid,newRelationshipPid,saveEventData,isSpouseDataValidate,clearBanners){var descriptionField,genderTypeField,originalIsPrimary,saveValue,url;toggleAddNewFactCreateAction(!1);typeof clearBanners!="undefined"&&clearBanners&&clearAllBanners();var modalEditEvent=$(".tabContent1"),modalNarrative=$(".tabContent4"),modalEditEventActive=modalEditEvent.hasClass("tabActive"),modalNarrativeActive=modalNarrative.hasClass("tabActive"),selectedPerson=modalEditEvent.find(".selectedPerson"),isCreateRelationshipEvent=!1,eventType=window.FactEditModal.eventType,isPrimary=modalEditEvent.find(".isPrimaryCheckbox").prop("checked"),saveEventDataObj="",placeField="",placeFieldDataExtra="",dictionary=[],eventChanged=modalEditEventActive?checkFieldValidation(!0,!1,dictionary):!1,narrativeChanged=!1,placeGpid=null,titleField=typeof dictionary.title!="undefined"?dictionary.title.value:"",dateField=typeof dictionary.date!="undefined"?dictionary.date.value:"";typeof dictionary.location!="undefined"&&(placeField=dictionary.location.value,placeFieldDataExtra=dictionary.location.extra);descriptionField=typeof dictionary.description!="undefined"?dictionary.description.value:"";genderTypeField=typeof dictionary.genderMale!="undefined"?"Male":typeof dictionary.genderFemale!="undefined"?"Female":"Unknown";typeof placeFieldDataExtra!="undefined"&&placeFieldDataExtra.length>0&&$.each($.parseJSON(placeFieldDataExtra),function(key,value){key==="GPID"&&(placeGpid=value)});var valueField=typeof dictionary.value!="undefined"?dictionary.value.value:"",givenNameField=typeof dictionary.givenName!="undefined"?dictionary.givenName.value:"",surnameField=typeof dictionary.surname!="undefined"?dictionary.surname.value:"",suffixNameField=typeof dictionary.suffix!="undefined"?dictionary.suffix.value:"";if(typeof newRelationshipPid!="undefined"&&newRelationshipPid.length>0&&(isCreateRelationshipEvent=!0,typeof saveEventData!="undefined"&&saveEventData.length>0&&(saveEventDataObj=jQuery.parseJSON(saveEventData),eventType=saveEventDataObj.eventType,dateField=saveEventDataObj.dateField,placeField=saveEventDataObj.placeField,descriptionField=saveEventDataObj.descriptionField,isPrimary=!1)),originalIsPrimary=modalEditEvent.find(".isPrimaryCheckbox").attr("data-original-isprimary"),modalNarrativeActive){var lsTitleVal=modalNarrative.find(".lifestoryTitleField").val(),lsTitleValOrig=modalNarrative.find(".lifestoryTitleField").attr("data-original-lifestorytitle"),narrativeVal=modalNarrative.find(".narrativeField").val(),narrativeValOrig=modalNarrative.find(".narrativeField").attr("data-original-narrative"),displOnLs=modalNarrative.find("#displayLifestory").prop("checked"),displOnLsOrig=modalNarrative.find("#displayLifestory").attr("data-original-displaylifestory");(typeof lsTitleValOrig!="undefined"&&typeof lsTitleVal!="undefined"&&lsTitleValOrig!==lsTitleVal||typeof narrativeValOrig!="undefined"&&typeof narrativeVal!="undefined"&&narrativeValOrig!==narrativeVal||typeof displOnLsOrig!="undefined"&&typeof displOnLs!="undefined"&&displOnLsOrig!==displOnLs.toString())&&(narrativeChanged=!0)}var relationshipEventType=isRelationshipEventType(),relationshipId=typeof newRelationshipPid!="undefined"&&newRelationshipPid.length>0?newRelationshipPid:typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-assertionId")!="undefined"&&selectedPerson.attr("data-assertionId").length>0?selectedPerson.attr("data-assertionId"):"",relTypeAheadVal="false";if(relationshipEventType&&relationshipId!=null&&relationshipId!==""&&FactEditModal.originalSpouseId!==relationshipId?(eventChanged=!0,relTypeAheadVal=typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-isTypeAhead")!="undefined"&&selectedPerson.attr("data-isTypeAhead").length>0?selectedPerson.attr("data-isTypeAhead"):"false"):relationshipEventType&&typeof FactEditModal.originalSpouseId!="undefined"&&FactEditModal.originalSpouseId!=null&&FactEditModal.originalSpouseId.length>0&&typeof FactEditModal.newSpouseId!="undefined"&&FactEditModal.newSpouseId!=null&&FactEditModal.newSpouseId.length>0&&FactEditModal.originalSpouseId!==FactEditModal.newSpouseId&&(eventChanged=!0,relationshipId=FactEditModal.newSpouseId),saveValue="",FactEditModal.hasValidationError||(eventChanged&&narrativeChanged?saveValue="0":eventChanged?saveValue="1":narrativeChanged&&(saveValue="2")),typeof isSpouseDataValidate!="undefined"&&isSpouseDataValidate!==!0||typeof originalDateVal=="undefined"||typeof dateField=="undefined"||originalDateVal===dateField||FactEditModal.hasValidationWarningAgainstSpouseData||!relationshipEventType||FactEditModal.validatedAgainstSpouseData[relationshipId]!=="undefined"&&(FactEditModal.validatedAgainstSpouseData[relationshipId]==="undefined"||FactEditModal.validatedAgainstSpouseData[relationshipId])||(eventChanged=validateRelationshipEventAgainstSpouseData(selectedPerson,eventType,dateField,!1),FactEditModal.hasValidationWarningAgainstSpouseData=!eventChanged,FactEditModal.validatedAgainstSpouseData[relationshipId]=!0),relationshipEventType&&eventChanged&&(FactEditModal.originalSpouseId=relationshipId),typeof assertionid!="undefined"&&assertionid!=null&&saveValue.length>0&&(eventChanged||narrativeChanged))handleButtonsSavingMode(),url="/tree/"+PersonCard.treeId+"/person/"+PersonCard.personId+"/assertionid/"+assertionid+"/savepersonnarrativeandeventdata",$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,data:{saveContentValue:saveValue,title:lsTitleVal,narrative:narrativeVal,isHidden:!displOnLs,isMapOn:$(".narrativeIsMapOn").length>0&&$(".narrativeIsMapOn").val().length>0?$(".narrativeIsMapOn").val():!1,isImageOn:$(".narrativeIsImageOn").length>0&&$(".narrativeIsImageOn").val().length>0?$(".narrativeIsImageOn").val():!1,preferredImageId:$(".narrativePreferredImageId").length>0&&$(".narrativePreferredImageId").val().length>0?$(".narrativePreferredImageId").val():"",eventId:assertionid,eventType:eventType,customEventTitle:titleField,date:dateField,place:placeField,placeGpid:placeGpid,description:valueField!=null&&valueField.length>0?valueField:descriptionField,relationshipId:relationshipId,relTypeAhead:relTypeAheadVal,isPrimary:isPrimary,givenName:givenNameField,surname:surnameField,suffixName:suffixNameField,genderType:genderTypeField},success:function(data){var cancelClose,factItem,successBanner,narrativeTextArea,lifestoryTitle,displayLifestory;toggleAddNewFactCreateAction(!0);handleButtonsNormalMode();data.result&&(FactEditModal.hasValidationWarningAgainstSpouseData=!1,cancelClose=$(".cancelClose"),eventChanged&&(cancelClose.length>0&&cancelClose.text(FactEditModal.text.close),isRelationshipEventType()?window.glue.reload():(factItem=$("#fi"+assertionid),eventType==="Name"?(setFieldValidationValues(dictionary),window.glue.reload()):eventType==="Gender"?window.location.reload():(setFieldValidationValues(dictionary),window.glue.reload(),(eventType==="Birth"||eventType==="Death")&&window.getPersonCard()),isCreateRelationshipEvent&&showIndividualSpouse())),saveValue.length>0&&(successBanner=$(".tabActive").find(".alertSuccess"),successBanner.length>0&&switchOnSuccessBanner(successBanner),setupCreateOrSaveTextButton(),$.modal.center()),narrativeChanged&&(narrativeTextArea=$("#narrative"),narrativeTextArea.length>0&&(narrativeTextArea.text(narrativeVal),narrativeTextArea.val(narrativeVal),narrativeTextArea.attr("data-original-narrative",narrativeVal)),lifestoryTitle=$(".lifestoryTitleField"),lifestoryTitle.length>0&&lifestoryTitle.attr("value",lsTitleVal).attr("data-original-lifestorytitle",lsTitleVal),displayLifestory=$("#displayLifestory"),displayLifestory.length>0&&displayLifestory.prop("checked",displOnLs).attr("data-original-displaylifestory",displOnLs.toString()),modalNarrative.removeClass("loading").find(".narrativeDataFields").show(),cancelClose.length>0&&cancelClose.text(FactEditModal.text.close),narrativeVal.length===0&&factEditModalTimelineOptions(PersonCard.treeId,PersonCard.personId,assertionid),typeof PersonData.GlueReloadAfterNarrativeChange!="undefined"&&PersonData.GlueReloadAfterNarrativeChange===!0&&window.glue.reload()))},error:function(xhr,ajaxOptions,thrownError){throwException("status->"+xhr.status+" thrownError->"+thrownError);toggleAddNewFactCreateAction(!0);handleButtonsNormalMode()}});else{if(FactEditModal.hasValidationError)return setButtonandBannerBasedOnValidation(!0),toggleAddNewFactCreateAction(!0),!1;toggleAddNewFactCreateAction(!0)}return!0}function factEditModalHandleTabClick(selector,newPid,clearBanners,showBannerVal,getMedia){resetValidationValues();personAnalyticsTrackClick(selector);switch(selector){case"factEditModalEvent":case"editModalSaveButton":savePersonNarrativeAndEventDataModal(FactEditModal.assertionId,newPid,"",!0,clearBanners)&&resetEventDetails();break;case"factEditModalAttachMedia":if(!FactEditModal.mediaLoaded||getMedia){if(savePersonNarrativeAndEventDataModal(FactEditModal.assertionId,newPid,"",!1,clearBanners))return factEditModalAttachedMedia(showBannerVal)}else return savePersonNarrativeAndEventDataModal(FactEditModal.assertionId,newPid,"",!1,clearBanners);break;case"factEditModalSourceCitations":if(savePersonNarrativeAndEventDataModal(FactEditModal.assertionId,newPid,"",!1,clearBanners))return factEditModalSources(showBannerVal);break;case"factEditModalTimelineOptions":if(savePersonNarrativeAndEventDataModal(FactEditModal.assertionId,newPid,"",!1,clearBanners))return factEditModalTimelineOptions(FactEditModal.treeId,FactEditModal.personId,FactEditModal.assertionId)}return!0}function factEditModalAttachedMedia(hasBanner){var addMediaSection=$("#addMediaSection"),url;addMediaSection.hide().closest(".tabContent").removeClass("showUpload");url="/modals/factedit/tree/"+FactEditModal.treeId+"/person/"+FactEditModal.personId+"/assertionid/"+FactEditModal.assertionId+"/attachedmedia?noRecordMedia=true";$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,data:{eventType:FactEditModal.eventType,eventTitle:FactEditModal.eventTitle},success:function(data){var tabActive=$(".tabActive"),attachedMediaList=tabActive.find(".attachedMediaList"),hasFactMediaError,$sortingDivTopAlert,$sortingDivBottomAlert,bannerArea;data.result&&data.html!=null&&data.html.length>0?(tabActive.removeClass("loading"),attachedMediaList.html(data.html),$(".attachedMediaList").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning),hasFactMediaError=$("#hasFactMediaError"),hasFactMediaError.length>0&&hasFactMediaError.val()==="true"?($(".sortingDivTopFactNoAttachedMediaMSG").alert("close"),$(".sortingDivTopFactErrorMSG").alert("open"),$(".sortingDivBottomFactNoMediaMSG").alert("close"),$(".sortingDivBottomFactErrorMSG").alert("open")):(FactEditModal.mediaLoaded=!0,(typeof PersonData!="undefined"&&PersonData.hasEditRights||PersonData.hasContributorRights)&&addMediaSection.show().closest(".tabContent").addClass("showUpload"),factEditModalMedia(data.attachedMediaIds,data.unAttachedMediaIds),sortingCardOutlineHover(),$sortingDivTopAlert=$(".sortingDivTopFactMedia .sortingDivTopFactNoAttachedMediaMSG"),$sortingDivBottomAlert=$(".sortingDivBottomFactMedia .sortingDivBottomFactNoMediaMSG"),$sortingDivTopAlert.alert(personViewModalAlertSettingsNote),$sortingDivBottomAlert.alert(personViewModalAlertSettingsNote),$.cachedScript(typeof PersonData!="undefined"&&PersonData.animateCardUrl).done(function(){$(".sortingDivBottomFactMedia").animateCard({animateMove:{afterAnimate:function(item){item.find(".sortingIcon").hasClass("iconAdd")?(item.removeClass("cardOutline2").addClass("attached"),(PersonData.hasEditRights||PersonData.hasContributorRights)&&item.find(".sortingIcon").removeClass("iconAdd noHover").addClass("iconClose")):(item.removeClass("cardOutline2").removeClass("attached"),(PersonData.hasEditRights||PersonData.hasContributorRights)&&item.find(".sortingIcon").removeClass("iconClose noHover").addClass("iconAdd"));window.lock.actionInProgress=!1;$.modal.center()},beforeAnimate:function(item){item.find(".card").addClass("cardOutline2")},connectWith:".sortingDivTopFactMedia",emptyContent:".alertNote"},items:".card",onListEmpty:function(emptyList){emptyList.find(".alertNote").alert("open")},onEmptyListAdd:function(list){list.find(".alertNote").alert("close")}})}),$(".sortingDivTopFactMedia .card").length===0&&$sortingDivTopAlert.alert("open"),$(".sortingDivBottomFactMedia .card").length===0&&$sortingDivBottomAlert.alert("open"),bannerArea=$(".tabActive").find(".alertSuccess"),typeof hasBanner!="undefined"&&hasBanner==="true"&&bannerArea.length>0&&(switchOnSuccessBanner(bannerArea),setFactModalTabsClick(!FactEditModal.hasValidationError)))):($(".sortingDivTopFactNoAttachedMediaMSG").alert("close"),$(".sortingDivTopFactErrorMSG").alert("open"),$(".sortingDivBottomFactNoMediaMSG").alert("close"),$(".sortingDivBottomFactErrorMSG").alert("open"),tabActive.removeClass("loading"))},error:function(){$(".sortingDivTopFactNoAttachedMediaMSG").alert("close");$(".sortingDivTopFactErrorMSG").alert("open");$(".sortingDivBottomFactNoMediaMSG").alert("close");$(".sortingDivBottomFactErrorMSG").alert("open")}});resetValidationValues()}function resetEventDetails(){var modalEditEvent=$(".tabContent1");modalEditEvent.find(".factField").each(function(){var $field=$(this),originalVal;$field.attr("name")!=="gender"&&(originalVal=$field.data("original-value"),$field.val(originalVal))});clearAllBanners();$(".editModalSaveButton").removeAttr("disabled");setFactModalTabsClick(!FactEditModal.hasValidationError)}function resetValidationValues(){FactEditModal.hasValidationWarning=!1;FactEditModal.hasValidationDateWarning=!1;FactEditModal.validationWarningMessage="";FactEditModal.hasValidationError=!1;FactEditModal.validationErrorMessage="";FactEditModal.hasValidationWarningToSelectSpouse=!1}function validateAndSetupDisplay(element){resetValidationValues();typeof element!="undefined"&&validateField(element);setButtonandBannerBasedOnValidation(!0)}function factEditModalMedia(attachedMediaIds,unAttachedMediaIds){attachedMediaIds.length>0&&(setupFactEditModalDetailsForMedia(attachedMediaIds,FactEditModal.assertionId),$.modal.center());unAttachedMediaIds.length&&(setupFactEditModalDetailsForMedia(unAttachedMediaIds,FactEditModal.assertionId),$.modal.center())}function validateField(el){var origVal,eventResults,eventValidationValues,surname,validationNameMessage,msg;if(typeof el!="undefined"){var isjQueryObj=el instanceof jQuery,$element=isjQueryObj?el:$(el),value=$element.val();return value.length===0?($element.data("state","0"),$element.data("msg",""),0):$element.hasClass("dateField")?value.charAt(0)==="\\"||value.charAt(date.length-1)==="\\"?($element.data("state","3"),msg=FactEditModal.text.warnDateMayBeWrong+" "+FactEditModal.text.warnInvalidCharacterStartEndDate,$element.data("msg",msg),3):(origVal=$element.data("original-value"),typeof origVal!="undefined"&&origVal===value)?($element.data("state","1"),$element.data("msg",""),1):(eventResults=validDate(value,FactEditModal.eventType.toLowerCase(),FactEditModal.person.personBirth,FactEditModal.person.personDeath,FactEditModal.person.motherBirth,FactEditModal.person.motherDeath,FactEditModal.person.fatherBirth,FactEditModal.person.fatherDeath,!1),eventValidationValues=validationCheck(FactEditModal.eventType.toLowerCase(),eventResults),eventValidationValues.hasValidationWarning?($element.data("state","3"),$element.data("msg",eventValidationValues.validationMessage),3):($element.data("state","2"),$element.data("msg",""),2)):$element.hasClass("surnameField")?(surname=$element.val(),validationNameMessage=validateSurname(surname,FactEditModal.person.fatherSurname,FactEditModal.person.spouseSurname,FactEditModal.gender,FactEditModal.normalSurnameValidation),validationNameMessage.length>0?($element.data("state","3"),msg=FactEditModal.validationWarningMessage.length>0?FactEditModal.validationWarningMessage+"  "+validationNameMessage:validationNameMessage,$element.data("msg",msg),typeof surname=="undefined"||FactEditModal.person.fatherSurname===surname)?($element.data("state","2"),$element.data("msg",""),2):3:($element.data("state","2"),$element.data("msg",""),2)):($element.data("state","2"),$element.data("msg",""),2)}}function handleButtonsSavingMode(){$(".editModalSaveButton").addClass("loading").attr("aria-busy","true");var cancelClose=$(".cancelClose");cancelClose.length>0&&cancelClose.hide()}function handleButtonsNormalMode(){$(".editModalSaveButton").removeAttr("aria-busy").removeClass("loading");var cancelClose=$(".cancelClose");cancelClose.length>0&&cancelClose.show()}function setFieldValidationValues(dictionary){var modalEditEvent=$(".tabContent1");modalEditEvent.find(".factField").each(function(){var $field=$(this),field;$field.attr("name")=="gender"?(field=dictionary[$field.attr("id")],field!="undefined"?($field.attr("checked",!0),$field.data("state",1),$field.val(field.value),$field.data("original-value",field.value)):($field.attr("checked",!1),$field.data("state",0),$field.val(""),$field.data("original-value",""))):(field=dictionary[$field.attr("id")],field!="undefined"?($field.data("state",field.value.length===0?0:1),$field.val(field.value),$field.data("original-value",field.value),field.extra.length>0&&$field.data("extra",field.extra)):($field.data("state",0),$field.val(""),$field.data("original-value",""),$field.data("extra","")))})}function setupFactEditModalDetailsForMedia(eventMediaIds,factId){var getTrackingId=function(isAttached){return isAttached?"editFactModalRemoveMedia":"editFactModalAttachMedia"},mediaList=eventMediaIds.split(",");mediaList!=null&&mediaList.length>0&&$.each(mediaList,function(i,mediaId){var selector="#card"+mediaId;setupCardClickEvent(selector,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachMediaFromEvent(factId,mediaId,attachDetachCallback):attachMediaToEvent(factId,mediaId,attachDetachCallback)})})}function setupSourceEditModalDetailsForMedia(eventMediaIds,sourceId){var getTrackingId=function(isAttached){return isAttached?"removeMediaFromCitation":"attachMediaToCitation"},mediaList=eventMediaIds.split(",");mediaList!=null&&mediaList.length>0&&$.each(mediaList,function(i,mediaId){var selector="#card"+mediaId;setupCardClickEvent(selector,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachMediaFromCitation(sourceId,mediaId,attachDetachCallback):attachMediaToCitation(sourceId,mediaId,attachDetachCallback)})})}function setupCardClickEvent(selector,getTrackingId,makeServerCall){var $div=$(selector),$button;if($div.length>0&&($button=$div.find("button.sortingIcon"),$button.length>0))$button.on("click",function(e){var isAttached,attachDetachCallback;e.preventDefault();isAttached=$div.hasClass("attached");personAnalyticsTrackClick(getTrackingId(isAttached));clearAllBanners();attachDetachCallback=function(data){data&&data.result&&($div.trigger("animateListItem.move"),saveUIState($(".factItemFocused")),window.glue.reload(function(){loadUIState("click")}))};typeof makeServerCall=="function"&&makeServerCall(isAttached,attachDetachCallback)})}function factEditModalSources(hasBanner){var eventSourcesList=$(".eventSourcesList"+FactEditModal.assertionId),unattachedEventSourcesList,bannerArea;eventSourcesList.length>0&&eventSourcesList.val()!=null&&eventSourcesList.val().length>0&&setupFactEditModalDetailsForSource(eventSourcesList,!0);unattachedEventSourcesList=$(".unattachedEventSourcesList"+FactEditModal.assertionId);unattachedEventSourcesList.length>0&&unattachedEventSourcesList.val()!=null&&unattachedEventSourcesList.val().length>0&&setupFactEditModalDetailsForSource(unattachedEventSourcesList,!1);bannerArea=$(".tabActive").find(".alertSuccess");typeof hasBanner!="undefined"&&hasBanner&&bannerArea.length>0&&(switchOnSuccessBanner(bannerArea),setFactModalTabsClick(!FactEditModal.hasValidationError))}function setupFactEditModalDetailsForSource(listItem){var getTrackingId=function(isAttached){return isAttached?"editFactModalRemoveSource":"editFactModalAddSource"},sourcesList=listItem.val().split(",");sourcesList!=null&&sourcesList.length>0&&$.each(sourcesList,function(i,sourceId){var sourceItem=$("#modal_si"+sourceId),userCardItem=$(".userCardsi"+sourceId),dbId,imgSrc,selector;if(sourceItem.length>0){if(dbId=sourceItem.find(".dbId").val(),dbId==="1030")userCardItem.find(".userCardImg").addClass("icon iconAcom");else{var sourceNode=$("#si"+sourceId),nodeUserCardImg=sourceNode.find(".userCardImg"),imgItem=nodeUserCardImg.children("img");imgItem.length>0?(imgSrc=imgItem.attr("src"),userCardItem.length>0&&(userCardItem.find(".userCardImg").html('<img class="" src="'+imgSrc+'" alt="" />'),userCardItem.find(".userCardImg").attr("style","background-image:url('"+imgSrc+"');"),userCardItem.find(".userCardImg").addClass("userCardImgSquare userCardImgCenter"))):userCardItem.find(".userCardImg").addClass("icon iconDocument")}selector="#modal_si"+sourceId;setupCardClickEvent(selector,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachSourceFromEvent(FactEditModal.assertionId,sourceId,selector,attachDetachCallback):attachSourceToEvent(FactEditModal.assertionId,sourceId,selector,attachDetachCallback)})}else sourceId==="1030"?userCardItem.find(".userCardImg").addClass("icon iconAcom"):userCardItem.find(".userCardImg").addClass("icon iconDocument")})}function factEditModalTimelineOptions(treeId,personId,assertionId){var url="/modals/factedit/tree/"+treeId+"/person/"+personId+"/assertionid/"+assertionId+"/timeline";$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,success:function(data){var narrativeTextArea,displayLifestory,generateNarrativeButton,lifestoryTitleField;$(".tabContent4").removeClass("loading").find(".narrativeDataFields").show();narrativeTextArea=$("#narrative");displayLifestory=$("#displayLifestory");data.result&&data.personEventNarrativeDataResponse!=null?(generateNarrativeButton=$("#generateNarrative"),FactEditModal.showGenerateNarratives&&generateNarrativeButton.length>0&&data.personEventNarrativeDataResponse.DefaultNarrative!=null&&data.personEventNarrativeDataResponse.DefaultNarrative.length>0&&generateNarrativeButton.show(),narrativeTextArea.length>0&&(narrativeTextArea.text(data.personEventNarrativeDataResponse.Narrative),narrativeTextArea.val(data.personEventNarrativeDataResponse.Narrative),narrativeTextArea.attr("data-original-narrative",data.personEventNarrativeDataResponse.Narrative||"")),lifestoryTitleField=$(".lifestoryTitleField"),lifestoryTitleField.length>0&&lifestoryTitleField.attr("value",data.personEventNarrativeDataResponse.Title).attr("data-original-lifestorytitle",data.personEventNarrativeDataResponse.Title),displayLifestory.length>0&&displayLifestory.prop("checked",!data.personEventNarrativeDataResponse.IsHidden).attr("data-original-displaylifestory",(!data.personEventNarrativeDataResponse.IsHidden).toString()),$(".narrativeIsMapOn").val(data.personEventNarrativeDataResponse.IsMapOn),$(".narrativeIsImageOn").val(data.personEventNarrativeDataResponse.IsImageOn),$(".narrativePreferredImageId").val(data.personEventNarrativeDataResponse.PreferredImageId)):displayLifestory.length>0&&($(".narrativeIsMapOn").val(!1),$(".narrativeIsImageOn").val(!0),displayLifestory.prop("checked",!1).attr("disabled",!0).attr("data-original-displaylifestory","false"))}})}function switchOnSuccessBanner(bannerArea){bannerArea.text(FactEditModal.text.savedSuccessfullyBanner);bannerArea.hasClass("alertHidden")&&bannerArea.alert("open")}function showMultipleSpouseSelect(){var hasSelectedPerson,selectedSpouseRadio,dontValidate,spouseCount,selectedSpouseId;$(".editModalSaveButton").unbind("click");FactEditModal.isAddNewSpouse=!1;FactEditModal.showMultipleSpouseSelected=!0;var modalEditEvent=$(".tabContent1"),individualSpouseSelect=modalEditEvent.find("#individualSpouseSelect"),multipleSpouseSelect=modalEditEvent.find("#multipleSpouseSelect"),selectedPerson=modalEditEvent.find(".selectedPerson");isRelationshipEventType()&&selectedPerson.length===0&&(selectedPerson=modalEditEvent.find(".selectedPerson"));hasSelectedPerson=typeof selectedPerson!="undefined"&&selectedPerson.length>0;hasSelectedPerson&&(selectedSpouseId=selectedPerson.attr("id").replace("selectedSpouse","").replace("-individual",""),selectedSpouseRadio=$("#selectedSpouseRadio"+selectedSpouseId),selectedSpouseRadio.attr("checked","checked"),selectedPerson.hide());$("#changeSpouseButton").hide();$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();");dontValidate=!1;spouseCount=parseInt(FactEditModal.person.spouseCount);FactEditModal.isAddNewFact||spouseCount!==1||typeof FactEditModal.originalSpouseId=="undefined"||FactEditModal.originalSpouseId.length!==0?!FactEditModal.isAddNewFact&&spouseCount>1&&typeof FactEditModal.originalSpouseId!="undefined"&&FactEditModal.originalSpouseId.length===0?(individualSpouseSelect.hide(),$("#spouseText").hide(),$("#selectSpouseForEventText").show(),multipleSpouseSelect.show(),$("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").show(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):spouseCount===1?(hasSelectedPerson&&(selectedSpouseId=selectedPerson.attr("id").replace("selectedSpouse","").replace("-individual",""),resetIndividualSpouseNode(selectedPerson,selectedSpouseId)),setIndividualSpouseData(modalEditEvent,".singleScenarioSpouseSelect"),dontValidate=!0,individualSpouseSelect.show(),multipleSpouseSelect.hide()):spouseCount===0?($("#noSpouseChooseOther").show(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):(individualSpouseSelect.hide(),$("#spouseText").hide(),$("#selectSpouseForEventText").show(),multipleSpouseSelect.show().addClass("multipleSpouseSelected"),FactEditModal.previousSelectedSpouseHTML.length>0&&FactEditModal.previousSelectedSpouseHTML.indexOf("selectedPerson")!==-1&&modalEditEvent.find("#individualSpouseSelect").html(FactEditModal.previousSelectedSpouseHTML)):(individualSpouseSelect.hide(),multipleSpouseSelect.show(),$("#singleScenarioSpouseSelect").show(),$("#noSpouseForEventSingle").show(),$("#noSpouseForEventMulti").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();"));dontValidate||hasSelectedPerson?FactEditModal.isAddNewFact?setAddNewFactCreateAction():setFactModalTabsClick(FactEditModal.hasValidationError):setFactActionWithValidate()}function showIndividualSpouse(){var singleScenarioSpouseSelect,existingSpouseIndividual2;FactEditModal.isAddNewSpouse=!1;FactEditModal.showMultipleSpouseSelected=!1;var modalEditEvent=$(".tabContent1"),individualSpouseSelect=modalEditEvent.find("#individualSpouseSelect"),multipleSpouseSelect=modalEditEvent.find("#multipleSpouseSelect"),spouseCount=parseInt(FactEditModal.person.spouseCount);if(spouseCount>=1&&(singleScenarioSpouseSelect=$("#singleScenarioSpouseSelect"),spouseCount===1&&singleScenarioSpouseSelect.length>0&&typeof $("#singleScenarioSpouseSelect").attr("style").length!="undefined"&&$("#singleScenarioSpouseSelect").attr("style").length===0?($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):($("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();"),$("#chooseOtherButton").hide())),$("#spouseText").show(),$("#selectSpouseForEventText").hide(),setIndividualSpouseData(modalEditEvent,".selectedPerson"))$("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").hide();else return!1;return spouseCount>0&&(individualSpouseSelect.show(),multipleSpouseSelect.hide()),existingSpouseIndividual2=individualSpouseSelect.find(".existingSpouseIndividual"),existingSpouseIndividual2.length>0&&existingSpouseIndividual2.hasClass("selectedPerson")&&existingSpouseIndividual2.show(),multipleSpouseSelect.removeClass("multipleSpouseSelected"),$.modal.center(),!0}function showIndividualSpouseCommon(modalEditEvent,selectedPerson,selectedSpouseIndividual){typeof selectedPerson!="undefined"&&selectedPerson.length>0&&(selectedPerson.removeClass("selectedPerson").removeAttr("style"),selectedSpouseIndividual.addClass("selectedPerson").attr("data-assertionId",selectedPerson.attr("data-assertionId")).attr("data-spouseLifeRange",selectedPerson.attr("data-spouseLifeRange")),setEditModalSaveButtonClick())}function validateRelationshipEventAgainstSpouseData(selectedPerson,eventType,dateField,isCreate){var hasValidationWarning=!1,validationMessage=FactEditModal.text.warnDateMayBeWrong+"  ",relationshipLifeRange,lifeRangeSplit,eventResults;return(overrideValidation(),FactEditModal.hasValidationWarning=!1,FactEditModal.validationWarningMessage="",FactEditModal.warningMessage="",relationshipLifeRange=typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-spouseLifeRange")!="undefined"&&selectedPerson.attr("data-spouseLifeRange").length>0?selectedPerson.attr("data-spouseLifeRange").trim():"",relationshipLifeRange.length>0&&relationshipLifeRange.indexOf(":")!==-1&&(lifeRangeSplit=relationshipLifeRange.split(":"),eventResults=validDate(dateField,eventType.toString().toLowerCase(),FactEditModal.person.personBirth,FactEditModal.person.personDeath,FactEditModal.person.motherBirth,FactEditModal.person.motherDeath,FactEditModal.person.fatherBirth,FactEditModal.person.fatherDeath,!1),lifeRangeSplit[0].length>0&&parseInt(eventResults[1],10)<lifeRangeSplit[0]&&(hasValidationWarning=!0,validationMessage+=warnDateBeforeBirthOfSpouse),lifeRangeSplit[1].length>0&&parseInt(eventResults[1],10)>lifeRangeSplit[1]&&(hasValidationWarning=!0,validationMessage+=warnDateAfterDeathOfSpouse),hasValidationWarning))?(FactEditModal.hasValidationWarning=!0,FactEditModal.validationWarningMessage=validationMessage,FactEditModal.warningMessage="",setupCreateOrSaveAnywayTextButton(),isCreate?setAddNewFactCreateAction():setFactModalTabsClick(FactEditModal.hasValidationError),!1):!0}function showSpouseTypeAheadSection(){var typeAheadCancelButton,typeAheadAddPersonButton,typeAheadSaveButton,$typeAheadNameField;FactEditModal.isAddNewSpouse=!0;var modalEditEvent=$(".tabContent1"),selectedPerson=modalEditEvent.find(".selectedPerson"),spouseCount=parseInt(FactEditModal.person.spouseCount);$("#noSpouseForEventMulti").hide();$("#noSpouseForEventSingle").hide();FactEditModal.previousSelectedSpouseHTML=modalEditEvent.find("#individualSpouseSelect").html();typeof selectedPerson!="undefined"&&selectedPerson.length>0&&resetIndividualSpouseNode(selectedPerson,"");spouseCount===0&&$("#noSpouseChooseOther").hide();$("#individualSpouseSelect").hide();$("#multipleSpouseSelect").hide();$("#selectSpouseForEventText").hide();$("#changeSpouseButton").hide();$("#chooseOtherButton").hide();$("#spouseText").show();$("#typeAheadArea").show();$(".addRelationships").show();typeAheadCancelButton=$(".erAddCancel");typeAheadCancelButton.length>0&&typeAheadCancelButton.attr("onClick","hideSpouseTypeAheadSection();");typeAheadAddPersonButton=$(".erAddNew");typeAheadAddPersonButton.length>0&&typeAheadAddPersonButton.attr("onClick","spouseTypeAheadSectionAddPersonModal();");typeAheadSaveButton=$(".erAddSave");$typeAheadNameField=$(".erFindExistingPerson");$typeAheadNameField.length>0&&typeAheadSaveButton.length>0&&(typeAheadSaveButton.attr("onClick","selectFromSpouseTypeAhead(this);"),$typeAheadNameField.data("itemData",""),typeAheadSaveButton.attr("disabled","disabled"),personTypeAheadNameField($typeAheadNameField,FactEditModal.autocompletePidsToExclude,typeAheadSaveButton,"factEditModal",!1))}function hideSpouseTypeAheadSection(){var modalEditEvent,spouseCount,$typeAheadNameField;FactEditModal.isAddNewSpouse=!1;FactEditModal.previousSelectedSpouseHTML.length>0&&FactEditModal.previousSelectedSpouseHTML.indexOf("selectedPerson")!==-1&&(modalEditEvent=$(".tabContent1"),modalEditEvent.find("#individualSpouseSelect").html(FactEditModal.previousSelectedSpouseHTML),FactEditModal.previousSelectedSpouseHTML="");spouseCount=parseInt(FactEditModal.person.spouseCount);spouseCount>1?(FactEditModal.showMultipleSpouseSelected=!0,$("#spouseText").hide(),$("#selectSpouseForEventText").show()):(FactEditModal.showMultipleSpouseSelected=!1,$("#spouseText").show(),$("#selectSpouseForEventText").hide());$("#typeAheadArea").hide();$typeAheadNameField=$(".erFindExistingPerson");$typeAheadNameField.length>0&&$typeAheadNameField.data("itemData","");FactEditModal.hasExistingSpouseToSelect?FactEditModal.showMultipleSpouseSelected||$("#singleScenarioSpouseSelect").attr("style").length===0?($("#multipleSpouseSelect").show(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();"),FactEditModal.isAddNewFact||spouseCount!==1||FactEditModal.originalSpouseId.length!==0?!FactEditModal.isAddNewFact&&spouseCount>1&&FactEditModal.originalSpouseId.length===0&&($("#noSpouseForEventSingle").hide(),$("#noSpouseForEventMulti").show()):($("#noSpouseForEventSingle").show(),$("#noSpouseForEventMulti").hide())):($("#individualSpouseSelect").show(),spouseCount>1?$("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();"):$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):spouseCount===0&&($("#noSpouseChooseOther").show(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();"));setupCreateOrSaveTextButton();setupCorrectClickActionLinks();$.modal.center()}function resetIndividualSpouseNode(selectedPerson,selectedSpouseId){typeof selectedPerson!="undefined"&&selectedPerson.length>0&&(selectedPerson.removeClass("selectedPerson").removeAttr("style"),FactEditModal.previousSelectedSpouseId=selectedSpouseId,FactEditModal.hasValidationWarningAgainstSpouseData=!1,selectedPerson.attr("id","selectedSpouse-individual"),selectedPerson.find(".nodeImageDiv").html(""),selectedPerson.find(".userCardTitle").text(""),selectedPerson.find(".userCardSubTitle").text(""),selectedPerson.attr("data-assertionId","0"))}function setFactActionWithValidate(){FactEditModal.isAddNewFact?setAddNewFactCreateAction():setFactModalTabsClick(FactEditModal.hasValidationError)}function switchSelectedPersonClass(selectedItem){var modalEditEvent=$(".tabContent1"),selectedPerson=modalEditEvent.find(".selectedPerson"),origSelectedSpouseId,selectedSpouseRadio;isRelationshipEventType()&&selectedPerson.length===0&&(selectedPerson=modalEditEvent.find(".selectedPerson"));typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("id")!="undefined"&&(origSelectedSpouseId=selectedPerson.attr("id").replace("selectedSpouse","").replace("-individual",""),resetIndividualSpouseNode(selectedPerson,origSelectedSpouseId));var selectedSpouseId=selectedItem.id.replace("selectedSpouseRadio",""),selectedSpouseItem=$("#selectedSpouse"+selectedSpouseId),spouseCount=parseInt(FactEditModal.person.spouseCount);(FactEditModal.isAddNewFact||spouseCount>0)&&(clearAllBanners(),typeof selectedSpouseItem!="undefined"&&selectedSpouseItem.length>0&&(selectedSpouseRadio=$("#selectedSpouseRadio"+FactEditModal.previousSelectedSpouseId),selectedSpouseRadio.removeAttr("checked"),selectedSpouseItem.addClass("selectedPerson")));FactEditModal.showMultipleSpouseSelected=!1;(spouseCount===1||spouseCount>1)&&(spouseCount===1&&$("#singleScenarioSpouseSelect").attr("style").length===0?($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):($("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();"),$("#chooseOtherButton").hide()));$("#spouseText").show();setFactActionWithValidate();setButtonandBannerBasedOnValidation(!1)}function setIndividualSpouseData(modalEditEvent,selectedPersonClass){var selectedPerson=modalEditEvent.find(selectedPersonClass),$selectedSpouseIndividual=modalEditEvent.find("#selectedSpouse-individual");if(typeof selectedPerson!="undefined"&&selectedPerson.length>0)$selectedSpouseIndividual.attr("id",selectedPerson.attr("id")+"-individual"),$selectedSpouseIndividual.find(".nodeImageDiv").html(selectedPerson.find(".nodeImageDiv").html()),$selectedSpouseIndividual.find(".userCardTitle").text(selectedPerson.find(".userCardTitle").text()),$selectedSpouseIndividual.find(".userCardSubTitle").text(selectedPerson.find(".userCardSubTitle").text());else return!1;return showIndividualSpouseCommon(modalEditEvent,selectedPerson,$selectedSpouseIndividual),$selectedSpouseIndividual.addClass("selectedPerson"),!0}function setEditModalSaveButtonClick(){$(".editModalSaveButton").on("click",function(event){$(".editModalSaveButton").unbind("click");event.stopPropagation()})}function selectFromSpouseTypeAhead(e){var modalEditEvent=$(".tabContent1"),selectedPerson=modalEditEvent.find(".selectedPerson"),imageHtml,dates,spouseCount,selectedSpouseRadio,eventType,dateField;typeof selectedPerson!="undefined"&&selectedPerson.length>0&&(resetIndividualSpouseNode(selectedPerson,""),clearAllBanners());var $this=$(e),$card=$this.closest(".card"),$field=$card.find(".erFindExistingPerson"),data=$card.find(".erAddExistingData").data("itemData"),pid=data.PID;FactEditModal.findExistingPersonPID=pid;var personImage=data.image,personName=data.name,personBirth=data.birth,personDeath=data.death,genderIconType=data.genderIconType,selectedSpouseIndividual=modalEditEvent.find("#selectedSpouse-individual");typeof selectedSpouseIndividual!="undefined"&&selectedSpouseIndividual.length>0&&(selectedSpouseIndividual.attr("id","selectedSpouse"+FactEditModal.findExistingPersonPID+"-individual"),selectedSpouseIndividual.attr("data-isTypeAhead","true"),imageHtml="",imageHtml=personImage.indexOf("mediasvc")!==-1?'<div class="userCardImg userCardImgSquare userCardImgCenter" style="background-image:url(\''+personImage.replace('"','"')+'\');"><img alt="" src="'+personImage+'"><\/div>':'<div class="userCardImg userCardImgSquare icon icon'+genderIconType+'"><\/div>',selectedSpouseIndividual.find(".nodeImageDiv").html(imageHtml),selectedSpouseIndividual.find(".userCardTitle").text(personName),dates=personBirth.length>0&&personDeath.length>0?personBirth+" - "+personDeath:personBirth.length>0?personBirth+" - ":personDeath.length>0?" - "+personDeath:"",selectedSpouseIndividual.find(".userCardSubTitle").text(dates),selectedSpouseIndividual.hasClass("selectedPerson")||selectedSpouseIndividual.addClass("selectedPerson"),selectedSpouseIndividual.attr("data-assertionId",FactEditModal.findExistingPersonPID));$("#spouseText").show();$("#selectSpouseForEventText").hide();$field.length>0&&$field.data("itemData","");$("#typeAheadArea").hide();$("#multipleSpouseSelect").hide();$("#individualSpouseSelect").show();$(".selectedPerson").show();spouseCount=parseInt(FactEditModal.person.spouseCount);spouseCount===0?($("#noSpouseChooseOther").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")):(FactEditModal.isAddNewFact||FactEditModal.originalSpouseId.length!==0?FactEditModal.isAddNewFact&&spouseCount>0?($("#chooseOtherButton").hide(),$("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();")):($("#chooseOtherButton").hide(),$("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();")):spouseCount>=1?($("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();"),$("#chooseOtherButton").hide()):($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")),FactEditModal.previousSelectedSpouseId.length>0&&(selectedSpouseRadio=$("#selectedSpouseRadio"+FactEditModal.previousSelectedSpouseId),selectedSpouseRadio.removeAttr("checked")));eventType=FactEditModal.eventType;dateField=modalEditEvent.find(".dateField").val();validateRelationshipEventAgainstSpouseData(selectedPerson,eventType,dateField,!0);setButtonBasedOnValidation();setupCorrectClickActionLinks()}function overrideValidation(){isRelationshipEventType()&&$(".editModalSaveButton").unbind("click");FactEditModal.warningMessage.length>0&&typeof $(".editModalSaveButton").attr("disabled")=="undefined"?setupCreateOrSaveAnywayTextButton():setupCreateOrSaveTextButton();resetValidationValues();FactEditModal.isAddNewFact&&setAddNewFactCreateAction();FactEditModal.warningMessage=""}function setupCreateOrSaveAnywayTextButton(){(isRelationshipEventType()||!isDatePlaceEventType())&&$(".editModalSaveButton").unbind("click");FactEditModal.isAddNewFact?$(".editModalSaveButton").text(FactEditModal.text.createAnyway):$(".editModalSaveButton").text(FactEditModal.text.saveAnyway);$(".editModalSaveButton").removeAttr("disabled")}function spouseTypeAheadSectionAddPersonModal(){var modalEditEvent=$(".tabContent1"),eventType=FactEditModal.eventType,dateField=modalEditEvent.find(".dateField").val(),placeField=modalEditEvent.find(".placeField").val(),descriptionField=modalEditEvent.find(".descriptionField").val(),addRelType=FactEditModal.gender==="Male"?"w":"h",genderType=FactEditModal.gender==="Male"?"F":"M",addPersonArgs='{"rel":"'+addRelType+'","gender":"'+genderType+'", "eventType": "'+eventType+'", "dateField": "'+dateField+'", "placeField": "'+placeField+'", "descriptionField": "'+descriptionField+'", "modalHeaderTitle": "'+($("#modalHeader").length>0?$("#modalHeader").text():"")+'", "showAddNewOnly": "true", "isAddNewSpouse": "true", "selectedContentArea": "tabContent1", "tabOrButtonItem": "factEditModalEvent"'+(FactEditModal.isAddNewFact?"":', "assertionid": "'+FactEditModal.assertionId+'"')+"}",addPersonPgStkArgs="pg=32768&pgpl=pid&pgps="+FactEditModal.personId,apmCallback=function(cbResponse){var modalContents,hasLifeStoryOptions;return window.isCancelClicked||cbResponse.status!=="success"||(modalContents=$("#modalContents"),modalContents.length>0&&$.modal.showLoading(!0)),hasLifeStoryOptions=!0,(eventType.toLowerCase()!=="birth"&&eventType.toLowerCase()!=="death"||isPrimary)&&eventType.toLowerCase()!=="name"&&eventType.toLowerCase()!=="gender"||(hasLifeStoryOptions=!1),FactEditModal.isAddNewFact?addNewFact(cbResponse.newPid,addPersonArgs):newFactEditModal(window.PersonData,FactEditModal.assertionId,hasLifeStoryOptions,tabActivate,contentActivate,cbResponse.newPid,addPersonArgs,isCreateEvent,showTabs),!0};AddPerson.Add(PersonData.treeId,PersonData.personId,addPersonArgs,apmCallback)}function validationCheck(eventType,eventResults){var returnValues={hasValidationWarning:!1,validationMessage:""},dateMonthYear,dateSplit;return eventResults[0]!==0&&(returnValues.hasValidationWarning=!0,returnValues.validationMessage=FactEditModal.text.warnDateMayBeWrong),dateMonthYear=FactEditModal.person.dateStamp,dateMonthYear.length>0?(dateSplit=dateMonthYear.split(","),eventResults[2]!=null&&typeof eventResults[2]!="undefined"&&eventResults[1]===dateSplit[2]&&parseInt(eventResults[2])>parseInt(dateSplit[1])||eventResults[2]!=null&&typeof eventResults[2]!="undefined"&&eventResults[1]===dateSplit[2]&&parseInt(eventResults[2])===parseInt(dateSplit[1])&&eventResults[3]!=null&&parseInt(eventResults[3])>parseInt(dateSplit[0])?(returnValues.hasValidationWarning=!0,returnValues.validationMessage=FactEditModal.text.warnDateMayBeWrong+" "+FactEditModal.text.warnDateIsInFuture):eventResults[1].length>0&&(returnValues.validationMessage=returnValues.validationMessage.length>0?returnValues.validationMessage+" "+eventResults[1]:eventResults[1])):eventResults[1].length>0&&(returnValues.validationMessage=returnValues.validationMessage.length>0?returnValues.validationMessage+" "+eventResults[1]:eventResults[1]),returnValues}function getWarningMessage(requiredEmpty,isEmpty){return requiredEmpty?isEmpty?FactEditModal.text.warnToEnterTitleAndData:FactEditModal.text.warnToEnterTitle:FactEditModal.text.warnToEnterData}function isDatePlaceEventType(){return typeof FactEditModal.datePlaceType=="undefined"&&(FactEditModal.datePlaceType=FactEditModal.eventType!=="Name"&&FactEditModal.eventType!=="Gender"),FactEditModal.datePlaceType}function addFactModal(persondata){var modalContainer,url;if(typeof persondata=="undefined"){alert("persondata cannot be null");return}window.PersonData=persondata;modalContainer=$("#modalContainer");modalContainer.length>0&&modalContainer.remove();closeCallouts();url="/modals/addfact/tree/"+PersonData.treeId+"/person/"+PersonData.personId;$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,success:function(data){data.result&&$(data.html).modal({width:"410",title:PersonData.menu.facts.addFactTitle,useCustomPadding:!1,onOpen:function(){$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning);$("#addFactSelect").change(function(){var selectedFactType=$(this).find("option:selected");selectedFactType.hasClass("creatableOption")&&(personAnalyticsTrackClick("addNewFact"+selectedFactType.val()),addNewFact());$("#modalClose").on("click.addFactModalCloseButton",function(){personAnalyticsTrackClick("addFactModalCloseButton")})})},onClose:function(){$(".addModalTriggered").removeClass("addModalTriggered").focus();$("#modalClose").off("click.addFactModal");resetModalContents(!0)}})}})}function addNewFact(newRelationshipPid,saveEventData){var isValidaNewRelationshipPID=typeof newRelationshipPid!="undefined"&&newRelationshipPid.length>0,eventType=$("#addFactSelect").val(),dateFieldVal="",placeFieldVal="",descriptionFieldVal="",modalHeaderTitle="",isPrimary=!1,saveEventDataObj="",isCreateRelationshipEvent=!1,newPersonPid="",url;PersonData.hasAddedNewSpouse=!1;PersonData.newAddedSpouseId="";isValidaNewRelationshipPID&&(isCreateRelationshipEvent=!0,newPersonPid=newRelationshipPid,PersonData.hasAddedNewSpouse=!0,PersonData.newAddedSpouseId=newRelationshipPid);typeof saveEventData!="undefined"&&saveEventData.length>0&&(saveEventDataObj=jQuery.parseJSON(saveEventData),eventType=saveEventDataObj.eventType,dateFieldVal=saveEventDataObj.dateField,placeFieldVal=saveEventDataObj.placeField,descriptionFieldVal=saveEventDataObj.descriptionField,modalHeaderTitle=saveEventDataObj.modalHeaderTitle,isPrimary=!1,saveEventDataObj.isAddNewSpouse==="true"&&(ResetWarningsAndValues(),FactEditModal.isAddNewSpouse=!0));url="/modals/addnewfact/tree/"+PersonData.treeId+"/person/"+PersonData.personId;$("<div>").modal({showLoading:!0,useCustomPadding:!0,onOpen:function($this){$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,data:{eventType:eventType,newPersonPid:newPersonPid},success:function(data){var addPerson,spouseCount,dateField,placeField,descriptionField,$iSpouseSelect,$indvSpouseSelect,locationField,modalEditEvent;data.result&&($.modal.showLoading(!1),$.modal.resize(760),resetModalContents(!0),isValidaNewRelationshipPID&&(addPerson=$("#AddPerson"),addPerson.length>0&&$("#AddPerson").remove()),$this.html(data.html),modalHeaderTitle.length>0?setupModalHeader(modalHeaderTitle):setupModalHeader(data.title),$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning),setupFactModalUserCard(),$.modal.center(),$("#factEditModalEvent").addClass("tabActive active"),$(".tabContent1").addClass("tabActive active"),spouseCount=parseInt(FactEditModal.person.spouseCount),isRelationshipEventType()&&(isValidaNewRelationshipPID||spouseCount>0)&&(dateField=$(".dateField"),dateField.length>0&&dateField.val(dateFieldVal),placeField=$(".placeField"),placeField.length>0&&placeField.val(placeFieldVal),descriptionField=$(".descriptionField"),descriptionField.length>0&&descriptionField.val(descriptionFieldVal),$iSpouseSelect=$("#individualSpouseSelect"),$iSpouseSelect.is(":visible")?($("#multipleSpouseSelect").is(":visible")&&spouseCount>1?($("#changeSpouseButton").show().attr("onClick","showMultipleSpouseSelect();"),$("#chooseOtherButton").hide()):($("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();")),$indvSpouseSelect=$iSpouseSelect.find(".existingSpouseIndividual"),$indvSpouseSelect.length>0&&$indvSpouseSelect.addClass("selectedPerson"),$("#multipleSpouseSelect").hide()):($indvSpouseSelect=$iSpouseSelect.find(".existingSpouseIndividual"),$indvSpouseSelect.length>0&&$indvSpouseSelect.removeClass("selectedPerson"),spouseCount<2&&($("#individualSpouseSelect").show(),$("#multipleSpouseSelect").hide()),$("#changeSpouseButton").hide(),$("#chooseOtherButton").show().attr("onClick","showSpouseTypeAheadSection();"))),locationField=$("#location"),locationField.length>0&&factModalInitTypeAhead(PersonData.treeId,locationField),FactEditModal.eventType.toLowerCase()==="birth"||FactEditModal.eventType.toLowerCase()==="death"?$(".card").hasClass("preferredEvent"+FactEditModal.eventType)&&$("#preferredEventCheckbox").show():FactEditModal.eventType.toLowerCase()==="name"&&($("#preferredEventCheckbox").show(),FactEditModal.person.fatherSurname.length>0&&(modalEditEvent=$(".tabContent1"),modalEditEvent.find("#surname").val(FactEditModal.person.fatherSurname))),FactEditModal.eventType==="Gender"?($(".editModalSaveButton").removeAttr("disabled"),setAddNewFactCreateAction()):(FactEditModal.eventType==="Name"?$(".editModalSaveButton").removeAttr("disabled"):(isRelationshipEventType()&&dateFieldVal===""&&placeFieldVal===""&&descriptionFieldVal===""&&$(".editModalSaveButton").attr("disabled","disabled"),setupCreateOrSaveTextButton()),setFactActionWithValidate()),isValidaNewRelationshipPID?FactEditModal.isAddNewSpouse=!0:isRelationshipEventType()&&(setAddNewFactCreateAction(),spouseCount===0&&FactEditModal.isAddNewFact&&($("#chooseOtherButton").hide(),$(".addRelationships").show(),showSpouseTypeAheadSection(),$(".erAddCancel").hide())),setButtonandBannerBasedOnValidation(!1))}})}})}function setAddNewFactCreateAction(){$(".editModalSaveButton").attr("onClick","createNewEvent('tabContent1', 'editModalSaveButton');");$("#factEditModalEvent").attr("onClick","createNewEvent('tabContent1', 'factEditModalEvent');");$("#factEditModalAttachMedia").attr("onClick","createNewEvent('tabContent2', 'factEditModalAttachMedia');");$("#factEditModalSourceCitations").attr("onClick","createNewEvent('tabContent3', 'factEditModalSourceCitations');");$("#factEditModalTimelineOptions").attr("onClick","createNewEvent('tabContent4', 'factEditModalTimelineOptions');")}function toggleAddNewFactCreateAction(enable){enable?($(".editModalSaveButton").removeAttr("disabled").removeClass("disabled"),$("#factEditModalEvent").removeAttr("disabled").removeClass("disabled"),$("#factEditModalAttachMedia").removeAttr("disabled").removeClass("disabled"),$("#factEditModalSourceCitations").removeAttr("disabled").removeClass("disabled"),$("#factEditModalTimelineOptions").removeAttr("disabled").removeClass("disabled")):($(".editModalSaveButton").addClass("disabled").attr("disabled","true"),$("#factEditModalEvent").addClass("disabled").attr("disabled","true"),$("#factEditModalAttachMedia").addClass("disabled").attr("disabled","true"),$("#factEditModalSourceCitations").addClass("disabled").attr("disabled","true"),$("#factEditModalTimelineOptions").addClass("disabled").attr("disabled","true"))}function setupModalHeader(modalTitle){var factEditModalHeader=$("#factEditModalHeader");factEditModalHeader.length>0?factEditModalHeader.find(".modalTitle").text(modalTitle):($("#modalHeader").length===0&&$("#modalContents").append('<h4 class="modalHeader" id="modalHeader"><\/h4>'),$("#modalHeader").text(modalTitle))}function ResetWarningsAndValues(){var modalEditEvent=$(".tabContent1");modalEditEvent.find(".eventAreaBanner").alert("close");modalEditEvent.find(".eventAreaBannerWarning").alert("close");resetValidationValues();setupCreateOrSaveTextButton()}function resetModalContents(){var loading=$(".loading"),modalContents,modalHeader,modalContainer;loading.length>0&&loading.remove();modalContents=$("#modalContents");modalContents.length>0&&(modalHeader=$("#modalHeader"),modalHeader.length>0&&modalHeader.remove(),modalContainer=$("#modalContainer"),modalContainer.length>0&&modalContainer.remove())}function createNewEvent(selectedContentArea,tabOrButtonItem){var dataExtra,relTypeAheadVal,dateField,$checkBox,url;toggleAddNewFactCreateAction(!1);var modalEditEvent=$(".tabContent1"),modalEditEventActive=modalEditEvent.hasClass("tabActive"),selectedPerson=modalEditEvent.find(".selectedPerson"),isCreateRelationshipEvent=!1,eventType=FactEditModal.eventType,isPrimary=!1,eventChanged=!1,isFailedSpouseData=!1,dictionary=[];eventChanged=modalEditEventActive?checkFieldValidation(!0,!0,dictionary):!1;var relationshipEventType=isRelationshipEventType(),relationshipId=typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-assertionId")!="undefined"&&selectedPerson.attr("data-assertionId").length>0?selectedPerson.attr("data-assertionId"):"",isFindExistingPerson=!1;if(relationshipEventType&&(relationshipId==="0"||relationshipId.length===0)&&(dataExtra=typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-extra")!="undefined"&&selectedPerson.attr("data-extra").length>0?selectedPerson.attr("data-extra"):"",typeof dataExtra!="undefined"&&dataExtra.length>0&&(dataExtra=jQuery.parseJSON(dataExtra)),relationshipId=typeof dataExtra!="undefined"?dataExtra.PID:"",isCreateRelationshipEvent=!0,FactEditModal.originalSpouseId=relationshipId,isFindExistingPerson=!0),relTypeAheadVal="false",relationshipEventType&&relationshipId!=null&&relationshipId!==""&&(relTypeAheadVal=typeof selectedPerson!="undefined"&&selectedPerson.length>0&&typeof selectedPerson.attr("data-isTypeAhead")!="undefined"&&selectedPerson.attr("data-isTypeAhead").length>0?selectedPerson.attr("data-isTypeAhead"):isFindExistingPerson?"true":"false",relTypeAheadVal==="true"&&(isCreateRelationshipEvent=!0),FactEditModal.originalSpouseId=relationshipId),!FactEditModal.hasValidationWarningAgainstSpouseData&&relationshipEventType&&(dateField=modalEditEvent.find(".dateField").val(),typeof dateField!="undefined"&&dateField.length>0&&(eventChanged=validateRelationshipEventAgainstSpouseData(selectedPerson,eventType,dateField,!0,isFailedSpouseData),isFailedSpouseData=!eventChanged,FactEditModal.hasValidationWarningAgainstSpouseData=isFailedSpouseData)),eventChanged){var titleField=typeof dictionary.title!="undefined"?dictionary.title.value:"",dateField=typeof dictionary.date!="undefined"?dictionary.date.value:"",placeField="",placeFieldDataExtra="";typeof dictionary.location!="undefined"&&(placeField=dictionary.location.value,typeof dictionary.location.extra!="undefined"&&(placeFieldDataExtra=dictionary.location.extra));var descriptionField=typeof dictionary.description!="undefined"?dictionary.description.value:"",valueField=typeof dictionary.value!="undefined"?dictionary.value.value:"",givenNameField=typeof dictionary.givenName!="undefined"?dictionary.givenName.value:"",surnameField=typeof dictionary.surname!="undefined"?dictionary.surname.value:"",suffixNameField=typeof dictionary.suffix!="undefined"?dictionary.suffix.value:"",genderTypeField=typeof dictionary.genderMale!="undefined"?"Male":typeof dictionary.genderFemale!="undefined"?"Female":"Unknown";handleButtonsSavingMode();FactEditModal.isPrimary&&(isPrimary=!0);$checkBox=modalEditEvent.find(".isPrimaryCheckbox");$checkBox.length>0&&$checkBox.is(":checked")&&(isPrimary=!0);url="/tree/"+PersonData.treeId+"/person/"+PersonData.personId+"/createnewevent";$.ajax({type:"POST",url:url,cache:!1,timeout:2e4,data:{eventType:eventType,customEventTitle:titleField,date:dateField,place:placeField,description:valueField!=null&&valueField.length>0?valueField:descriptionField,relationshipId:relationshipId,relTypeAhead:relTypeAheadVal,isPrimary:isPrimary,givenName:givenNameField,surname:surnameField,suffixName:suffixNameField,genderType:genderTypeField},success:function(data){var fullname,hasBirth,hasDeath,hasLifeStoryOptions,cancelClose;if(toggleAddNewFactCreateAction(!0),handleButtonsNormalMode(),data.result&&typeof data.assertionId!="undefined"){if(resetModalContents(!1),typeof isPrimary!="undefined"&&isPrimary===!0&&(eventType.toString()==="Birth"||eventType.toString()==="Death"||eventType.toString()==="Name"))if(eventType.toString()==="Name")typeof surnameField!="undefined"&&(fullname=(givenNameField.length>0?givenNameField:"")+(surnameField.length>0?(givenNameField.length>0?" ":"")+surnameField:"")+(suffixNameField.length>0?" "+suffixNameField:""),$("#personCard .userCardTitle").html(fullname),PersonCard.name=fullname,handleFactModalUserCardData(".userCardTitle",fullname));else if(hasBirth=PersonCard.lifeYearRange.indexOf("&ndash;")>0||PersonCard.lifeYearRange.indexOf("-")>0,hasDeath=(PersonCard.lifeYearRange.indexOf("&ndash;")===0||PersonCard.lifeYearRange.indexOf("-")===0)&&PersonCard.lifeYearRange.length>7||PersonCard.lifeYearRange.length>11,!PersonCard.isFamilySearchUser||(hasBirth||eventType.toLowerCase()!=="birth")&&(hasDeath||eventType.toLowerCase()!=="death")){var splitYears=PersonCard.lifeYearRange.indexOf("&ndash;")!==-1?PersonCard.lifeYearRange.split("&ndash;"):PersonCard.lifeYearRange.split("-"),eventResults=validDate(dateField,eventType.toString().toLowerCase(),FactEditModal.person.personBirth,FactEditModal.person.personDeath,FactEditModal.person.motherBirth,FactEditModal.person.motherDeath,FactEditModal.person.fatherBirth,FactEditModal.person.fatherDeath,!1),dateSet="";typeof dateField!="undefined"&&typeof placeField!="undefined"&&eventType.toString()==="Birth"?(window.getPersonCard(),dateSet=(eventResults[0]===0?eventResults[1]:splitYears.length>0&&hasBirth?splitYears[0]:"")+"&ndash;"+(splitYears.length>0&&hasDeath?splitYears.length>1?splitYears[1]:splitYears[0]:""),PersonCard.lifeYearRange=dateSet,dateSet.length>1&&dateSet!=="&ndash;"?handleFactModalUserCardData(".userCardSubTitle","("+dateSet.replace("&ndash;","-")+")"):handleFactModalUserCardData(".userCardSubTitle","")):typeof dateField!="undefined"&&typeof placeField!="undefined"&&eventType.toString()==="Death"&&(window.getPersonCard(),dateSet=(splitYears.length>0&&hasBirth?splitYears[0]:"")+"&ndash;"+(eventResults[0]===0?eventResults[1]:splitYears.length>0&&hasDeath?splitYears.length>1?splitYears[1]:splitYears[0]:""),PersonCard.lifeYearRange=dateSet,dateSet.length>1&&dateSet!=="&ndash;"?handleFactModalUserCardData(".userCardSubTitle","("+dateSet.replace("&ndash;","-")+")"):handleFactModalUserCardData(".userCardSubTitle",""))}else location.reload();tabOrButtonItem!=="editModalSaveButton"&&tabOrButtonItem!=="factEditModalEvent"?(hasLifeStoryOptions=!0,(eventType.toLowerCase()!=="birth"&&eventType.toLowerCase()!=="death"||isPrimary)&&eventType.toLowerCase()!=="name"&&eventType.toLowerCase()!=="gender"||(hasLifeStoryOptions=!1),newFactEditModal(PersonData,data.assertionId,hasLifeStoryOptions,tabOrButtonItem,selectedContentArea,"","",!0,!0)):$.modal.close();isCreateRelationshipEvent&&showIndividualSpouse();window.glue.reload();typeof PersonData.GrowlForValueOnlyAndAlternates!="undefined"&&PersonData.GrowlForValueOnlyAndAlternates===!0&&((isValueOnlyEventType()||eventType=="Name"||eventType=="Gender")&&acom!=null&&acom.bus!=null&&acom.bus.emit("LifeStory::Notify::Success",FactEditModal.text.lifeStoryValueOnlyEventGrowl,"",!0),eventType!="Birth"&&eventType!="Death"||isPrimary||acom!=null&&acom.bus!=null&&acom.bus.emit("LifeStory::Notify::Success",FactEditModal.text.lifeStoryAlternateEventGrowl,"",!0))}else cancelClose=$(".cancelClose"),cancelClose.length>0&&cancelClose.show(),setButtonandBannerBasedOnValidation(!0)},error:function(xhr,ajaxOptions,thrownError){throwException("status->"+xhr.status+" thrownError->"+thrownError);toggleAddNewFactCreateAction(!0);handleButtonsNormalMode()}})}else setButtonandBannerBasedOnValidation(!0),toggleAddNewFactCreateAction(!0)}function handleFactModalUserCardData(titleSelector,titleData){var factTitlePersonCard=$(".factTitlePersonCard"),userCardTitle;factTitlePersonCard.length>0&&(userCardTitle=factTitlePersonCard.find(titleSelector),userCardTitle.length>0&&userCardTitle.html(titleData))}function generateNarrativeDataModal(assertionid){var modalNarrative=$(".tabContent4");modalNarrative.addClass("loading").find(".narrativeDataFields").hide();modalNarrative.find(".narrativeField").val("");savePersonNarrativeAndEventDataModal(assertionid,"","",!1)}function sourceEditModalFacts(){var sourceFactsList=$(".sourceFactsList"+SourceEditModal.citationId),unattachedSourceFactsList;sourceFactsList.length>0&&sourceFactsList.val()!=null&&sourceFactsList.val().length>0&&setupSourceEditModalDetailsForFacts(sourceFactsList,!0);unattachedSourceFactsList=$(".unattachedSourceFactsList"+SourceEditModal.citationId);unattachedSourceFactsList.length>0&&unattachedSourceFactsList.val()!=null&&unattachedSourceFactsList.val().length>0&&setupSourceEditModalDetailsForFacts(unattachedSourceFactsList,!1)}function setupSourceEditModalDetailsForFacts(listItem){var getTrackingId=function(isAttached){return isAttached?"editFactModalRemoveSource":"editFactModalAddSource"},factsList=listItem.val().split(",");factsList!=null&&factsList.length>0&&$.each(factsList,function(i,factId){var selector="#modal_fi"+factId;setupCardClickEvent(selector,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachSourceFromEvent(factId,SourceEditModal.citationId,selector,attachDetachCallback):attachSourceToEvent(factId,SourceEditModal.citationId,selector,attachDetachCallback)})})}function sourceEditModalAttachedMedia(treeId,personId,citationId){var addMediaSection=$("#addMediaSection"),url;addMediaSection.hide().closest(".tabContent").removeClass("showUpload");url="/modals/sourceedit/tree/"+treeId+"/person/"+personId+"/citationid/"+citationId+"/attachedmedia?noRecordMedia=true";$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,success:function(data){var tabActive=$(".tabActive"),attachedMediaList=tabActive.find(".attachedMediaList"),hasSourceMediaError,$sortingDivTopAlert,$sortingDivBottomAlert;data.result&&data.html!=null&&data.html.length>0?(tabActive.removeClass("loading"),attachedMediaList.html(data.html.replace(/CitationIdValReplace/g,citationId)),$(".attachedMediaList").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning),hasSourceMediaError=$("#hasSourceMediaError"),hasSourceMediaError.length>0&&hasSourceMediaError.val()==="true"?($(".sortingDivTopSourceNoAttachedMediaMSG").alert("close"),$(".sortingDivTopSourceErrorMSG").alert("open"),$(".sortingDivBottomSourceNoMediaMSG").alert("close"),$(".sortingDivBottomSourceErrorMSG").alert("open")):($("#sourceEditModalAttachMedia").unbind("click"),(PersonResearch.hasEditRights||PersonResearch.hasContributorRights)&&addMediaSection.show().closest(".tabContent").addClass("showUpload"),sourceEditModalMedia(data.attachedMediaIds,data.unAttachedMediaIds),sortingCardOutlineHover(),$sortingDivTopAlert=$(".sortingDivTopSourceMedia .sortingDivTopSourceNoAttachedMediaMSG"),$sortingDivBottomAlert=$(".sortingDivBottomSourceMedia .sortingDivBottomSourceNoMediaMSG"),$sortingDivTopAlert.alert(personViewModalAlertSettingsNote),$sortingDivBottomAlert.alert(personViewModalAlertSettingsNote),$.cachedScript(PersonResearch.animateCardUrl).done(function(){$(".sortingDivBottomSourceMedia").animateCard({animateMove:{afterAnimate:function(item){item.find(".sortingIcon").hasClass("iconAdd")?(item.removeClass("cardOutline2"),(PersonResearch.hasEditRights||PersonResearch.hasContributorRights)&&item.find(".sortingIcon").removeClass("iconAdd noHover").addClass("iconClose")):(item.removeClass("cardOutline2"),(PersonResearch.hasEditRights||PersonResearch.hasContributorRights)&&item.find(".sortingIcon").removeClass("iconClose noHover").addClass("iconAdd"));window.lock.actionInProgress=!1},beforeAnimate:function(item){item.find(".card").addClass("cardOutline2")},connectWith:".sortingDivTopSourceMedia",emptyContent:".alertNote"},items:".card",onListEmpty:function(emptyList){emptyList.find(".alertNote").alert("open")},onEmptyListAdd:function(list){list.find(".alertNote").alert("close")}})}),$(".sortingDivTopSourceMedia .card").length===0&&$sortingDivTopAlert.alert("open"),$(".sortingDivBottomSourceMedia .card").length===0&&$sortingDivBottomAlert.alert("open"))):($(".sortingDivTopSourceNoAttachedMediaMSG").alert("close"),$(".sortingDivTopSourceErrorMSG").show(),$(".sortingDivBottomSourceNoMediaMSG").alert("close"),$(".sortingDivBottomSourceErrorMSG").show(),tabActive.removeClass("loading"))},error:function(){$(".sortingDivTopSourceNoAttachedMediaMSG").alert("close");$(".sortingDivTopSourceErrorMSG").alert("open");$(".sortingDivBottomSourceNoMediaMSG").alert("close");$(".sortingDivBottomSourceErrorMSG").alert("open")}})}function factEditModalSources(hasBanner){var eventSourcesList=$(".eventSourcesList"+FactEditModal.assertionId),unattachedEventSourcesList,bannerArea;eventSourcesList.length>0&&eventSourcesList.val()!=null&&eventSourcesList.val().length>0&&setupFactEditModalDetailsForSource(eventSourcesList,!0);unattachedEventSourcesList=$(".unattachedEventSourcesList"+FactEditModal.assertionId);unattachedEventSourcesList.length>0&&unattachedEventSourcesList.val()!=null&&unattachedEventSourcesList.val().length>0&&setupFactEditModalDetailsForSource(unattachedEventSourcesList,!1);bannerArea=$(".tabActive").find(".alertSuccess");typeof hasBanner!="undefined"&&hasBanner&&bannerArea.length>0&&(switchOnSuccessBanner(bannerArea),setFactModalTabsClick())}function setupFactEditModalDetailsForSource(listItem){var getTrackingId=function(isAttached){return isAttached?"editFactModalRemoveSource":"editFactModalAddSource"},sourcesList=listItem.val().split(",");sourcesList!=null&&sourcesList.length>0&&$.each(sourcesList,function(i,sourceId){var sourceItem=$("#modal_si"+sourceId),userCardItem=$(".userCardsi"+sourceId),dbId,imgSrc,selector;if(sourceItem.length>0){if(dbId=sourceItem.find(".dbId").val(),dbId==="1030")userCardItem.find(".userCardImg").addClass("icon iconAcom");else{var sourceNode=$("#si"+sourceId),nodeUserCardImg=sourceNode.find(".userCardImg"),imgItem=nodeUserCardImg.children("img");imgItem.length>0?(imgSrc=imgItem.attr("src"),userCardItem.length>0&&(userCardItem.find(".userCardImg").html('<img class="" src="'+imgSrc+'" alt="" />'),userCardItem.find(".userCardImg").attr("style","background-image:url('"+imgSrc+"');"),userCardItem.find(".userCardImg").addClass("userCardImgSquare userCardImgCenter"))):userCardItem.find(".userCardImg").addClass("icon iconDocument")}selector="#modal_si"+sourceId;setupCardClickEvent(selector,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachSourceFromEvent(FactEditModal.assertionId,sourceId,selector,attachDetachCallback):attachSourceToEvent(FactEditModal.assertionId,sourceId,selector,attachDetachCallback)})}else sourceId==="1030"?userCardItem.find(".userCardImg").addClass("icon iconAcom"):userCardItem.find(".userCardImg").addClass("icon iconDocument")})}function factEditModalMedia(attachedMediaIds,unAttachedMediaIds){attachedMediaIds.length>0&&setupFactEditModalDetailsForMedia(attachedMediaIds,FactEditModal.assertionId);unAttachedMediaIds.length&&setupFactEditModalDetailsForMedia(unAttachedMediaIds,FactEditModal.assertionId)}function sourceEditModalMedia(attachedMediaIds,unAttachedMediaIds){attachedMediaIds.length>0&&(setupSourceEditModalDetailsForMedia(attachedMediaIds,SourceEditModal.sourceId,!0),$.modal.center());unAttachedMediaIds.length&&(setupSourceEditModalDetailsForMedia(unAttachedMediaIds,SourceEditModal.sourceId,!1),$.modal.center())}function setupFactEditModalDetailsForMedia(eventMediaIds,factId){var getTrackingId=function(isAttached){return isAttached?"editFactModalRemoveMedia":"editFactModalAttachMedia"},mediaList=eventMediaIds.split(",");mediaList!=null&&mediaList.length>0&&$.each(mediaList,function(i,mediaId){var selector="#card"+mediaId;setupCardClickEvent(selector,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachMediaFromEvent(factId,mediaId,attachDetachCallback):attachMediaToEvent(factId,mediaId,attachDetachCallback)})})}function setupSourceEditModalDetailsForMedia(eventMediaIds,sourceId){var getTrackingId=function(isAttached){return isAttached?"removeMediaFromCitation":"attachMediaToCitation"},mediaList=eventMediaIds.split(",");mediaList!=null&&mediaList.length>0&&$.each(mediaList,function(i,mediaId){var selector="#card"+mediaId;setupCardClickEvent(selector,getTrackingId,function(isAttached,attachDetachCallback){isAttached?detachMediaFromCitation(sourceId,mediaId,attachDetachCallback):attachMediaToCitation(sourceId,mediaId,attachDetachCallback)})})}function factEditModalTimelineOptions(treeId,personId,assertionId){var url="/modals/factedit/tree/"+treeId+"/person/"+personId+"/assertionid/"+assertionId+"/timeline";$.ajax({type:"GET",url:url,cache:!1,timeout:2e4,success:function(data){var narrativeTextArea,displayLifestory,generateNarrativeButton,lifestoryTitleField;$(".tabContent4").removeClass("loading").find(".narrativeDataFields").show();narrativeTextArea=$("#narrative");displayLifestory=$("#displayLifestory");data.result&&data.personEventNarrativeDataResponse!=null?(generateNarrativeButton=$("#generateNarrative"),FactEditModal.showGenerateNarratives&&generateNarrativeButton.length>0&&data.personEventNarrativeDataResponse.DefaultNarrative!=null&&data.personEventNarrativeDataResponse.DefaultNarrative.length>0&&generateNarrativeButton.show(),narrativeTextArea.length>0&&(narrativeTextArea.text(data.personEventNarrativeDataResponse.Narrative),narrativeTextArea.val(data.personEventNarrativeDataResponse.Narrative),narrativeTextArea.attr("data-original-narrative",data.personEventNarrativeDataResponse.Narrative||"")),lifestoryTitleField=$(".lifestoryTitleField"),lifestoryTitleField.length>0&&lifestoryTitleField.attr("value",data.personEventNarrativeDataResponse.Title).attr("data-original-lifestorytitle",data.personEventNarrativeDataResponse.Title),displayLifestory.length>0&&displayLifestory.prop("checked",!data.personEventNarrativeDataResponse.IsHidden).attr("data-original-displaylifestory",(!data.personEventNarrativeDataResponse.IsHidden).toString()),$(".narrativeIsMapOn").val(data.personEventNarrativeDataResponse.IsMapOn),$(".narrativeIsImageOn").val(data.personEventNarrativeDataResponse.IsImageOn),$(".narrativePreferredImageId").val(data.personEventNarrativeDataResponse.PreferredImageId)):displayLifestory.length>0&&($(".narrativeIsMapOn").val(!1),$(".narrativeIsImageOn").val(!1),displayLifestory.prop("checked",!1).attr("disabled",!0).attr("data-original-displaylifestory","false"))}})}function sourceEditModal(treeId,personId,sourceId,formId){var url="/modals/sourceedit/tree/"+treeId+"/person/"+personId+"/sourceid/"+sourceId;$("<div>").modal({showLoading:!0,useCustomPadding:!0,onOpen:function($this){$.ajax({type:"GET",url:url,data:$("#FormSourceItem"+formId+" :input").serialize(),cache:!1,timeout:2e4,success:function(data){var $sortingDivTopAlert,$sortingDivBottomAlert,openTab;$.modal.showLoading(!1);$.modal.resize(760);$this.html(data);$("#modal").find(".alertNote").alert(personViewModalAlertSettingsNote).end().find(".alertInfo").alert(personViewModalAlertSettingsInfo).end().find(".alertSuccess").alert(personViewModalAlertSettingsSuccess).end().find(".alert:not(.alertNote):not(.alertInfo):not(.alertSuccess)").alert(personViewModalAlertSettingsWarning);sortingCardOutlineHover();$sortingDivTopAlert=$("#fact_sortingDivTop .alert");$sortingDivBottomAlert=$("#fact_sortingDivBottom .alert");$sortingDivTopAlert.alert(personViewModalAlertSettingsNote);$sortingDivBottomAlert.alert(personViewModalAlertSettingsNote);$.cachedScript(PersonResearch.animateCardUrl).done(function(){$("#fact_sortingDivBottom").animateCard({animateMove:{afterAnimate:function(item){item.find(".sortingIcon").hasClass("iconAdd")?(item.removeClass("cardOutline2").addClass("attached"),PersonResearch.hasEditRights&&item.find(".sortingIcon").removeClass("iconAdd noHover").addClass("iconClose")):(item.removeClass("cardOutline2").removeClass("attached"),PersonResearch.hasEditRights&&item.find(".sortingIcon").removeClass("iconClose noHover").addClass("iconAdd"))},beforeAnimate:function(item){item.find(".card").addClass("cardOutline2")},connectWith:"#fact_sortingDivTop",emptyContent:".alertNote"},items:".card",onListEmpty:function(emptyList){emptyList.find(".alertNote").alert("open")},onEmptyListAdd:function(list){list.find(".alertNote").alert("close")}})});$("#fact_sortingDivTop .card").length===0&&$sortingDivTopAlert.alert("open");$("#fact_sortingDivBottom .card").length===0&&$sortingDivBottomAlert.alert("open");typeof SourceEditModal!="undefined"&&$(".modalEditSource .removeButton").callout({classes:"calloutRemoveSource",content:"#removeSourceCalloutDomContent",onAfterOpen:function(){$("#callout").on("click",".closeCallouts",function(){closeCallouts()})},position:"top",style:"dark",type:"click"});openTab=0;typeof PersonResearch.openOnLoadTab!="undefined"&&(openTab=parseInt(PersonResearch.openOnLoadTab));PersonResearch.tabName==="Media"&&(sourceEditModalAttachedMedia(PersonResearch.treeId,PersonResearch.personId,sourceId),openTab=SourceEditModal.hasRecord?3:2);$("#modalContainer .tabs").tabs({activeIndex:openTab,onOpen:!1});modalButtonClick();updateModalTitle($(".sourceEditModaltitle").val(),$(".citationDetailTitle").val(),$(".associatedFactsEventsTitle").val(),$(".attachedMediaTitle").val());$("#sourceEditModalFacts").on("click",function(){sourceEditModalFacts()});$("#sourceEditModalAttachMedia").on("click",function(){sourceEditModalAttachedMedia(PersonResearch.treeId,PersonResearch.personId,sourceId)})}})},onClose:function(){$(".factItemSelected").focus();PersonResearch.tabName==="Media"&&window.glue.reload()}})}(function(){window.PersonData||(window.PersonData={})})();var showTabs,hasLifeStoryOptions,tabActivate,contentActivate,addPersonNewPid,saveEventData,isCreateEvent;
var $genTreesModal={Modal:$("#modalDLG"),Params:null,TitleName:"",init:function(id,width,title,datatitlename,modalEvents){$genTreesModal.TitleName=datatitlename;$("<div data-title='' id='"+id+"'><div id='"+id+"Content'><\/div><\/div>").modal({hideCloseBtn:!1,useCustomPadding:!0,closeOnBkgClick:!0,closeOnEscape:!0,isMarketing:!1,showLoading:!0,width:width,onOpen:modalEvents&&modalEvents.onOpen?modalEvents.onOpen:function(){},onClose:modalEvents&&modalEvents.onClose?modalEvents.onClose:function(){$(".addFamModalTriggered").removeClass("addFamModalTriggered").focus();setTimeout(function(){closeCallouts()},0)}})},create:function(id,url,htmlSrc,callback){if(url!=null&&url=="0"&&htmlSrc!=null&&htmlSrc.length>0)return $genTreesModal.getView(id,htmlSrc),$("#modalHeader").hide(),callback!=null&&callback(),$.modal.center(),!0;if(htmlSrc!=null&&htmlSrc.length>0){var htmlSrcGet=$("#"+htmlSrc);htmlSrcGet&&($genTreesModal.getView(id,htmlSrcGet.html()),$("#modalHeader").hide(),callback!=null&&callback(),$.modal.center())}else $.ajax({url:url,cache:!1,timeout:2e4,type:"GET",data:{params:$genTreesModal.Params},success:function(data){var result,modalCont,modalTitle,titleVal;typeof data.hasexception!="undefined"&&data.hasexception!=null&&data.hasexception&&$genTreesModal.throwException(id,"view has thrown an exception!");$("#modalHeader").hide();result=data.html!=null&&data.html.length>0?data.html:typeof data[0]!="undefined"&&data[0].length>1?data[0]:data;$genTreesModal.getView(id,result);modalCont=$("#modal");modalCont.length>0&&modalCont.show();$.modal.center();modalTitle=$("#modalTitle");modalTitle.length>0&&$genTreesModal.TitleName.length>0&&(titleVal=modalTitle.data($genTreesModal.TitleName),$("#modalHeader").text(titleVal),$("#modalHeader").show());callback!=null&&callback();$.modal.center()},error:function(xhr,ajaxOptions,thrownError){$genTreesModal.throwException(id,"source->"+id+" status->"+xhr.status+" thrownError->"+thrownError)}})},getView:function(id,html){if(html==null||html.responseText=="fail")$genTreesModal.throwException(id,html);else if(html!=null&&html.length>0){var $callouts=$("#"+id+"Content").html(html).find("[data-callout]");typeof $callouts.callout!="undefined"&&$callouts.length>0&&$callouts.callout()}},throwException:function(id,msg){window.console!=null&&console.error(msg);$.ajax({url:"/pt/Down.aspx?noHeaderFooter=1",cache:!1,timeout:2e4,type:"GET",data:{},success:function(data){var modalcontent=document.getElementById(id);modalcontent.innerHTML=data}})}};
var AddPerson=function($){var _addPerson={cacheLoaded:!1,apmDefCallback:function(cbResponse){cbResponse.mode==="m"?$.modal.close():window.isCancelClicked||location.reload()},apsCallback:function(cbResponse){return cbResponse.newPid!=null&&cbResponse.status!=null&&(cbResponse.status==="success"?(window.glue.reload(),acom!=null&&acom.bus!=null&&acom.bus.emit("AddPerson::Notify::Success",cbResponse.message,cbResponse.title,!0)):cbResponse.status==="failure"&&acom!=null&&acom.bus!=null&&acom.bus.emit("AddPerson::Notify::Failure",cbResponse.message,cbResponse.title)),typeof AddPerson.apmCallback=="function"?AddPerson.apmCallback(cbResponse):AddPerson.apmDefCallback(cbResponse)},Modal:function(tid,pid,args,apmCallback,type){var url="http://"+addPersonUrl+"/modals/addPerson/tree/"+tid+"/person/"+pid,title=PersonCard.text.addPersonModalTitle,params;type==="edit"&&(url+="/edit",title=PersonCard.text.quickEditModalTitle);params={};typeof args=="object"?params=args:typeof args=="string"&&(params=JSON.parse(args));params.useNewVersion="5";params.isPageVersion=!1;$('<div id="AddPersonModal"><\/div>').modal({showLoading:!0,hideCloseBtn:!1,useCustomPadding:!0,closeOnBkgClick:!0,closeOnEscape:!0,isMarketing:!1,title:title,onOpen:function($this){$.ajax({url:url,xhrFields:{withCredentials:!0},crossDomain:!0,cache:!1,timeout:15e3,type:"GET",data:params,dataType:"jsonp",contentType:"application/json",success:function(response){if(response.hasexception){var html='<div class="ancGrid ancGridPadded"><div class="ancCol w100"><p class="icon iconWarning">'+PersonCard.text.addPersonErrorText+"<\/p><\/div><\/div>";$.modal.showLoading(!1);$this.html(html);$.modal.center()}else $.when(loadCacheFiles(response)).done(function(){if(AddPerson.cacheLoaded=!0,$.modal.resize(760),response.name){$.modal.title("");var profileHtml=response.imageUrl?'<div class="userCardImg"><img alt="'+response.title+'" src="'+response.imageUrl+'" style="vertical-align:middle;"><\/div>':'<div class="userCardImg userCardImgSquare icon icon'+response.gender+'" role="presentation"><\/div>',dateRangeHtml=response.dateRange?'&nbsp;<p class="userCardSubTitle" style="font-weight:normal;">'+response.dateRange+"<\/p>":"";$this.html('<div class="modalHeader modalHeaderUserCard" id="addPersonModalHeader"><div class="ancGrid full480"><div class="ancCol"><h4 class="modalTitle">'+response.title+'<\/h4><\/div><div class="ancCol ancColUserCard hide480"><div class="userCard userCardSize3" style="margin:4px 0 5px;">'+profileHtml+'<div class="userCardContent"><h6 class="userCardTitle">'+response.name+"<\/h6>"+dateRangeHtml+"<\/div><\/div><\/div><\/div><\/div>");$this.append(response.html);$.modal.showLoading(!1)}else $.modal.title(response.title),$this.html(response.html),$.modal.showLoading(!1);AddPerson.apmCallback=typeof apmCallback!="undefined"?apmCallback:AddPerson.apmDefCallback;typeof AddPersonModalInit=="function"&&(typeof $Ap!="undefined"&&(window.$Ap.APMAutoCompleteDates=window.PersonCard.autoCompleteDates),window.AddPersonModalInit(tid,pid,args.history,AddPerson.apsCallback,"m"))}).fail(function(file){$this.html(response.html);window&&window.console&&console.error("AddPerson: Unable to load"+file+".")})},error:function(){var html='<div class="ancGrid ancGridPadded"><div class="ancCol w100"><p class="icon iconWarning">'+PersonCard.text.addPersonErrorText+"<\/p><\/div><\/div>";$.modal.showLoading(!1);$this.html(html);$.modal.center()}})},onClose:function(){$(".addFamModalTriggered").removeClass("addFamModalTriggered").focus()}})},Add:function(tid,pid,args,onCloseCallback){typeof $.modal!="undefined"&&window.closeCallouts();AddPerson.Modal(tid,pid,args,onCloseCallback,"add")},Edit:function(tid,pid,args,onCloseCallback){typeof $.modal!="undefined"&&window.closeCallouts();typeof args=="string"?args=JSON.parse(args):typeof args=="undefined"&&(args={});typeof args=="object"&&(args.otid==null&&(args.otid=tid),args.opid==null&&(args.opid=pid));AddPerson.Modal(tid,pid,args,onCloseCallback,"edit")}},loadCacheFiles=function(response){var filesToLoad=[],deferred=$.Deferred();return AddPerson.cacheLoaded?deferred.resolve(!0):($(".add-person-css").remove(),$.each(response.css,function(i,css){$("head").append('<link class="add-person-css" rel="stylesheet" href="'+css+'" type="text/css" />')}),$.each(response.js,function(i,js){var def=new $.Deferred;$.ajax({dataType:"script",cache:!0,url:js,crossDomain:!0,success:function(){def.resolve(!0)},failure:function(){deferred.reject(js)}});filesToLoad.push(def)}),$.when.apply($,filesToLoad).done(function(){deferred.resolve(!0)})),deferred};return _addPerson}(jQuery);
function CreateClickHandlers(item){var action=utag_data.page_name+item.actionName,clickableItem=$(item.selector);if(clickableItem.length>0&&typeof utag!="undefined")clickableItem.on("click",function(){utag.link({action:action})});else console.log("Attempt to register invalid selector for analytics:"+item.actionName)}function personAnalyticsTrackClick(actionName){if($(".printFriendly").length===0&&typeof utag!="undefined"){var action=utag_data.page_name+": "+actionName;utag.link({action:action})}}function personAnalyticsTrackMediaClicks(element){$(element).parents(".HistoricalInsight").length>0?personAnalyticsTrackClick("HistoricalInsightMediaClick"):personAnalyticsTrackClick("mediaNarrativeMediaClick")}function personAnalyticsTrackFactsPersonClick(personType){personAnalyticsTrackClick("familyListPerson");personType.indexOf("Child")>0&&personAnalyticsTrackClick("familyListPersonChild");personType.indexOf("Spouse")>0&&personAnalyticsTrackClick("familyListPersonSpouse");personType.indexOf("Parent")>0&&personAnalyticsTrackClick("familyListPersonParent");personType.indexOf("Sibling")>0&&personAnalyticsTrackClick("familyListPersonSibling")}function personAnalyticsChangePageName(pageId){if(typeof utag_data!="undefined"&&typeof utag!="undefined"){var newPageName=utag_data.page_name.substr(0,utag_data.page_name.lastIndexOf(": ")+2)+pageId;utag.view({page_name:newPageName})}}function logPersonPageContentView(pageId,treeId,personId,isPublicTree,userRole){if(typeof utag_data!="undefined"&&typeof utag!="undefined"){var newPageName=utag_data.page_name.substr(0,utag_data.page_name.lastIndexOf(": ")+2)+pageId,params={omniturePageName:newPageName,isPublicTree:isPublicTree.toLowerCase()==="true",userRole:userRole},url="/tree/"+treeId+"/person/"+personId+"/logPersonPageContentView";$.ajax({type:"POST",url:url,data:params,cache:!1,success:function(){},failure:function(){},complete:function(){}})}}function logContentSuccessPrint(treeId,personId){if(typeof utag_data!="undefined"&&typeof utag!="undefined"){var newPageName=utag_data.page_name,params={omniturePageName:newPageName},url="/tree/"+treeId+"/person/"+personId+"/logContentSuccessPrint";$.ajax({type:"POST",url:url,data:params,cache:!1,success:function(){},failure:function(){},complete:function(){}})}}var personAnalytics={showInformation:!1,pageIds:{LifeStory:[]},init:function(pageId,isDevEnvironment){personAnalytics.pageIds.length>0&&typeof utag!="undefined"&&$.each(personAnalytics.pageIds[pageId],function(index,item){CreateClickHandlers(item,isDevEnvironment)})}}